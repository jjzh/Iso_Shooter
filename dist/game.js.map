{
  "version": 3,
  "sources": ["../src/config/arena.ts", "../src/engine/renderer.ts", "../src/config/player.ts", "../src/config/abilities.ts", "../src/ui/damageNumbers.ts", "../src/engine/aoeTelegraph.ts", "../src/config/enemies.ts", "../src/engine/pools.ts", "../src/entities/projectile.ts", "../src/entities/enemyRig.ts", "../src/engine/events.ts", "../src/entities/enemy.ts", "../src/entities/mortarProjectile.ts", "../src/entities/playerRig.ts", "../src/entities/playerAnimator.ts", "../src/entities/player.ts", "../src/engine/input.ts", "../src/config/rooms.ts", "../src/config/spawn.ts", "../src/config/physics.ts", "../src/engine/meleemath.ts", "../src/engine/physics.ts", "../src/engine/particles.ts", "../src/engine/telegraph.ts", "../src/config/door.ts", "../src/engine/door.ts", "../src/entities/physicsObject.ts", "../src/config/bends.ts", "../src/engine/bendSystem.ts", "../src/engine/bulletTime.ts", "../src/ui/radialMenu.ts", "../src/engine/bendMode.ts", "../src/engine/roomManager.ts", "../src/ui/hud.ts", "../src/ui/screens.ts", "../src/engine/audio.ts", "../src/config/boss.ts", "../src/engine/urlParams.ts", "../src/ui/tuning.ts", "../src/config/waves.ts", "../src/engine/waveRunner.ts", "../src/ui/editorHandles.ts", "../src/ui/levelEditor.ts", "../src/ui/spawnEditor.ts", "../src/engine/game.ts"],
  "sourcesContent": ["import { Obstacle, Pit, AABB } from '../types/index';\n\nexport let ARENA_HALF_X = 20;\nexport let ARENA_HALF_Z = 20;\n// Legacy alias \u2014 equals ARENA_HALF_X for backward compat (spawn editor export)\nexport let ARENA_HALF = 20;\n\nexport const OBSTACLES: Obstacle[] = [\n  { x: 5, z: 9, w: 2, h: 1.5, d: 3 },\n  { x: -9, z: -7.5, w: 4, h: 1.5, d: 2 },\n  { x: 3.5, z: -3, w: 1.5, h: 2, d: 1.5 },\n  { x: 3.5, z: -9.5, w: 1.5, h: 2, d: 1.5 },\n  { x: 1, z: 10, w: 9, h: 1, d: 1 },\n  { x: 8.5, z: -8, w: 3, h: 1, d: 1 },\n  { x: 10, z: 9, w: 1, h: 2.5, d: 1 },\n  { x: -7.5, z: 8, w: 1, h: 2.5, d: 1 },\n];\n\nexport const WALL_THICKNESS = 0.5;\nexport const WALL_HEIGHT = 2;\n\nexport const PITS: Pit[] = [\n  { x: 0, z: 7.5, w: 8, d: 3 },\n  { x: 16, z: -17, w: 4.5, d: 4.5 },\n  { x: -7.5, z: 0, w: 2.5, d: 8 },\n  { x: -0.5, z: -7, w: 8.5, d: 2.5 },\n  { x: 8, z: 0, w: 3, d: 9 },\n];\n\nexport function setArenaConfig(obstacles: Obstacle[], pits: Pit[], arenaHalfX: number, arenaHalfZ?: number) {\n  OBSTACLES.length = 0;\n  obstacles.forEach(o => OBSTACLES.push(o));\n  PITS.length = 0;\n  pits.forEach(p => PITS.push(p));\n  ARENA_HALF_X = arenaHalfX;\n  ARENA_HALF_Z = arenaHalfZ ?? arenaHalfX;\n  ARENA_HALF = ARENA_HALF_X; // legacy alias\n}\n\nexport function getPitBounds(): AABB[] {\n  return PITS.map(p => ({\n    minX: p.x - p.w / 2,\n    maxX: p.x + p.w / 2,\n    minZ: p.z - p.d / 2,\n    maxZ: p.z + p.d / 2,\n  }));\n}\n\nexport function getCollisionBounds(): AABB[] {\n  const bounds: AABB[] = [];\n\n  for (const o of OBSTACLES) {\n    bounds.push({\n      minX: o.x - o.w / 2,\n      maxX: o.x + o.w / 2,\n      minZ: o.z - o.d / 2,\n      maxZ: o.z + o.d / 2,\n    });\n  }\n\n  const hx = ARENA_HALF_X;\n  const hz = ARENA_HALF_Z;\n  const t = WALL_THICKNESS;\n  // North wall (far end, +Z)\n  bounds.push({ minX: -hx - t/2, maxX: hx + t/2, minZ: hz - t/2, maxZ: hz + t/2 });\n  // South wall (near end, -Z)\n  bounds.push({ minX: -hx - t/2, maxX: hx + t/2, minZ: -hz - t/2, maxZ: -hz + t/2 });\n  // East wall (+X)\n  bounds.push({ minX: hx - t/2, maxX: hx + t/2, minZ: -hz - t/2, maxZ: hz + t/2 });\n  // West wall (-X)\n  bounds.push({ minX: -hx - t/2, maxX: -hx + t/2, minZ: -hz - t/2, maxZ: hz + t/2 });\n\n  return bounds;\n}\n", "import { OBSTACLES, PITS, ARENA_HALF_X, ARENA_HALF_Z, WALL_THICKNESS, WALL_HEIGHT } from '../config/arena';\n\nlet scene: any, camera: any, renderer: any;\nconst baseFrustum = 12;\nlet currentFrustum = 12;\nconst cameraOffset = new THREE.Vector3(20, 20, 20);\n\n// Tracked arena meshes for dynamic rebuild\nlet obstacleMeshes: any[] = [];\nlet wallMeshes: any[] = [];\nlet pitMeshes: any[] = [];\n\n// Screen shake state\nlet shakeRemaining = 0;\nlet shakeIntensity = 0;\n\n// Reusable vectors\nconst _camTarget = new THREE.Vector3();\nconst _unprojectVec = new THREE.Vector3();\nconst _camDir = new THREE.Vector3();\n\nexport function initRenderer() {\n  scene = new THREE.Scene();\n  scene.background = new THREE.Color(0x0a0a1a);\n  scene.fog = new THREE.Fog(0x0a0a1a, 30, 60);\n\n  const { w, h } = getViewportSize();\n  const aspect = w / h;\n  camera = new THREE.OrthographicCamera(\n    -baseFrustum * aspect, baseFrustum * aspect,\n    baseFrustum, -baseFrustum, 0.1, 100\n  );\n  camera.position.copy(cameraOffset);\n  camera.lookAt(0, 0, 0);\n\n  // Zoom camera in on mobile for tighter view\n  const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n  if (hasTouch) applyFrustum(8);\n\n  renderer = new THREE.WebGLRenderer({ antialias: true });\n  renderer.setSize(w, h);\n  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n  document.body.prepend(renderer.domElement);\n\n  // Lighting\n  const ambient = new THREE.AmbientLight(0x6666aa, 0.4);\n  scene.add(ambient);\n\n  const dirLight = new THREE.DirectionalLight(0xffeedd, 0.8);\n  dirLight.position.set(10, 15, 10);\n  scene.add(dirLight);\n\n  const rimLight = new THREE.DirectionalLight(0x4488ff, 0.3);\n  rimLight.position.set(-10, 5, -10);\n  scene.add(rimLight);\n\n  // Ground \u2014 sized generously so it covers any room shape\n  const groundSize = 120;\n  const ground = new THREE.Mesh(\n    new THREE.PlaneGeometry(groundSize, groundSize),\n    new THREE.MeshStandardMaterial({ color: 0x1a1a2e, roughness: 0.9, metalness: 0.1 })\n  );\n  ground.rotation.x = -Math.PI / 2;\n  scene.add(ground);\n\n  // Grid overlay\n  const grid = new THREE.GridHelper(groundSize, 60, 0x2a4a4a, 0x1a2a3a);\n  grid.position.y = 0.01;\n  scene.add(grid);\n\n  // Arena obstacles\n  createObstacles();\n\n  // Arena pits\n  createPits();\n\n  // Resize handler \u2014 also handle mobile orientation changes\n  window.addEventListener('resize', onResize);\n  window.addEventListener('orientationchange', () => {\n    // Delay to let browser settle after orientation change\n    setTimeout(onResize, 150);\n  });\n  if (window.visualViewport) {\n    window.visualViewport.addEventListener('resize', onResize);\n  }\n\n  return { scene, camera, renderer };\n}\n\nfunction clearObstacleMeshes() {\n  for (const m of obstacleMeshes) {\n    scene.remove(m);\n    if (m.geometry) m.geometry.dispose();\n  }\n  obstacleMeshes = [];\n  for (const m of wallMeshes) {\n    scene.remove(m);\n    if (m.geometry) m.geometry.dispose();\n  }\n  wallMeshes = [];\n}\n\nfunction createObstacles() {\n  clearObstacleMeshes();\n\n  const normalMat = new THREE.MeshStandardMaterial({\n    color: 0x2a2a4a,\n    emissive: 0x223355,\n    emissiveIntensity: 0.3,\n    roughness: 0.7,\n    metalness: 0.2\n  });\n  const destructibleMat = new THREE.MeshStandardMaterial({\n    color: 0x4a3a2a,\n    emissive: 0x553322,\n    emissiveIntensity: 0.3,\n    roughness: 0.8,\n    metalness: 0.1\n  });\n\n  for (const o of OBSTACLES) {\n    const mat = o.destructible ? destructibleMat.clone() : normalMat;\n    const mesh = new THREE.Mesh(new THREE.BoxGeometry(o.w, o.h, o.d), mat);\n    mesh.position.set(o.x, o.h / 2, o.z);\n    scene.add(mesh);\n    obstacleMeshes.push(mesh);\n  }\n\n  // Arena perimeter walls\n  const wallMat = new THREE.MeshStandardMaterial({\n    color: 0x1a1a2e,\n    emissive: 0x334466,\n    emissiveIntensity: 0.4,\n    roughness: 0.8\n  });\n\n  // North/South walls (span arena width)\n  for (const zSign of [-1, 1]) {\n    const wall = new THREE.Mesh(\n      new THREE.BoxGeometry(ARENA_HALF_X * 2 + WALL_THICKNESS, WALL_HEIGHT, WALL_THICKNESS),\n      wallMat\n    );\n    wall.position.set(0, WALL_HEIGHT / 2, zSign * ARENA_HALF_Z);\n    scene.add(wall);\n    wallMeshes.push(wall);\n  }\n  // East/West walls (span arena depth)\n  for (const xSign of [-1, 1]) {\n    const wall = new THREE.Mesh(\n      new THREE.BoxGeometry(WALL_THICKNESS, WALL_HEIGHT, ARENA_HALF_Z * 2 + WALL_THICKNESS),\n      wallMat\n    );\n    wall.position.set(xSign * ARENA_HALF_X, WALL_HEIGHT / 2, 0);\n    scene.add(wall);\n    wallMeshes.push(wall);\n  }\n}\n\nfunction clearPitMeshes() {\n  for (const m of pitMeshes) {\n    scene.remove(m);\n    if (m.geometry) m.geometry.dispose();\n  }\n  pitMeshes = [];\n}\n\nfunction createPits() {\n  clearPitMeshes();\n\n  const edgeThickness = 0.08;\n  const edgeHeight = 0.02;\n\n  const edgeMat = new THREE.MeshBasicMaterial({\n    color: 0xff2244,\n    transparent: true,\n    opacity: 0.8,\n  });\n\n  for (const p of PITS) {\n    // Dark void floor (slightly below ground)\n    const voidMesh = new THREE.Mesh(\n      new THREE.PlaneGeometry(p.w, p.d),\n      new THREE.MeshBasicMaterial({ color: 0x000000 })\n    );\n    voidMesh.rotation.x = -Math.PI / 2;\n    voidMesh.position.set(p.x, -0.05, p.z);\n    scene.add(voidMesh);\n    pitMeshes.push(voidMesh);\n\n    // North edge\n    const nEdge = new THREE.Mesh(\n      new THREE.BoxGeometry(p.w + edgeThickness * 2, edgeHeight, edgeThickness),\n      edgeMat\n    );\n    nEdge.position.set(p.x, 0.01, p.z + p.d / 2);\n    scene.add(nEdge);\n    pitMeshes.push(nEdge);\n\n    // South edge\n    const sEdge = new THREE.Mesh(\n      new THREE.BoxGeometry(p.w + edgeThickness * 2, edgeHeight, edgeThickness),\n      edgeMat\n    );\n    sEdge.position.set(p.x, 0.01, p.z - p.d / 2);\n    scene.add(sEdge);\n    pitMeshes.push(sEdge);\n\n    // East edge\n    const eEdge = new THREE.Mesh(\n      new THREE.BoxGeometry(edgeThickness, edgeHeight, p.d),\n      edgeMat\n    );\n    eEdge.position.set(p.x + p.w / 2, 0.01, p.z);\n    scene.add(eEdge);\n    pitMeshes.push(eEdge);\n\n    // West edge\n    const wEdge = new THREE.Mesh(\n      new THREE.BoxGeometry(edgeThickness, edgeHeight, p.d),\n      edgeMat\n    );\n    wEdge.position.set(p.x - p.w / 2, 0.01, p.z);\n    scene.add(wEdge);\n    pitMeshes.push(wEdge);\n  }\n}\n\n// Rebuild all arena visuals (obstacles + pits) \u2014 called by level editor\nexport function rebuildArenaVisuals() {\n  createObstacles();\n  createPits();\n}\n\nfunction getViewportSize() {\n  // visualViewport gives accurate size on mobile (accounts for browser chrome)\n  if (window.visualViewport) {\n    return { w: window.visualViewport.width, h: window.visualViewport.height };\n  }\n  return { w: window.innerWidth, h: window.innerHeight };\n}\n\nfunction onResize() {\n  const { w, h } = getViewportSize();\n  applyFrustum(currentFrustum);\n  renderer.setSize(w, h);\n}\n\nfunction applyFrustum(f: number) {\n  const { w, h } = getViewportSize();\n  const aspect = w / h;\n  camera.left = -f * aspect;\n  camera.right = f * aspect;\n  camera.top = f;\n  camera.bottom = -f;\n  camera.updateProjectionMatrix();\n  currentFrustum = f;\n}\n\nexport function setZoom(frustum: number) {\n  applyFrustum(Math.max(8, Math.min(30, frustum)));\n}\n\nexport function resetZoom() {\n  applyFrustum(baseFrustum);\n}\n\nexport function getCurrentFrustum() {\n  return currentFrustum;\n}\n\nexport function updateCamera(playerPos: any, dt: number) {\n  // Snap camera to player \u2014 no lerp. Ortho camera + lerp causes a sliding/swimming feel\n  // because the lookAt target and position desync subtly each frame.\n  camera.position.copy(playerPos).add(cameraOffset);\n\n  // Screen shake (offset from snapped position)\n  if (shakeRemaining > 0) {\n    shakeRemaining -= dt * 1000;\n    const decay = Math.max(0, shakeRemaining / 150);\n    const amt = shakeIntensity * decay;\n    camera.position.x += (Math.random() - 0.5) * amt * 0.1;\n    camera.position.z += (Math.random() - 0.5) * amt * 0.1;\n  }\n\n  camera.lookAt(playerPos);\n}\n\nexport function screenShake(intensity: number, durationMs = 100) {\n  shakeIntensity = intensity;\n  shakeRemaining = durationMs;\n}\n\n// Convert mouse NDC to world position on y=0 plane\nexport function screenToWorld(ndcX: number, ndcY: number) {\n  _unprojectVec.set(ndcX, ndcY, 0);\n  _unprojectVec.unproject(camera);\n\n  // Camera direction\n  _camDir.set(0, 0, -1).applyQuaternion(camera.quaternion);\n\n  // Intersect ray with y=0 plane\n  const t = -_unprojectVec.y / _camDir.y;\n  return new THREE.Vector3(\n    _unprojectVec.x + _camDir.x * t,\n    0,\n    _unprojectVec.z + _camDir.z * t\n  );\n}\n\nexport function getScene() { return scene; }\nexport function getCamera() { return camera; }\nexport function getRendererInstance() { return renderer; }\n", "import { PlayerConfig } from '../types/index';\n\nexport const PLAYER: PlayerConfig = {\n  maxHealth: 100,\n  speed: 5,\n  fireRate: 410,\n  projectile: { speed: 16, damage: 10, color: 0x44ff88, size: 0.2 },\n  size: { radius: 0.35, height: 1.2 }\n};\n\n// Melee combat config \u2014 tunable via tuning panel\nexport const MELEE = {\n  damage: 10,\n  range: 2.2,           // how far the swing reaches from player center\n  arc: 2.4,             // radians (~137\u00B0) \u2014 generous cone\n  cooldown: 380,         // ms between swings\n  knockback: 1.5,        // units pushed on hit\n  autoTargetRange: 3.0,  // radius to search for snap-targeting\n  autoTargetArc: 2.8,    // radians (~160\u00B0) \u2014 wide search for auto-target\n  screenShake: 1.5,      // shake intensity on hit\n  hitPause: 40,          // ms of freeze-frame on hit (juice)\n};\n", "import { AbilitiesConfig } from '../types/index';\n\nexport const ABILITIES: AbilitiesConfig = {\n  dash: {\n    name: 'Shadow Dash',\n    key: 'Space',\n    cooldown: 3000,\n    duration: 200,\n    distance: 5,\n    curve: 'easeOut',\n    invincible: true,\n    iFrameStart: 0,\n    iFrameEnd: 200,\n    directionSource: 'movement',\n    afterimageCount: 3,\n    afterimageFadeDuration: 300,\n    ghostColor: 0x44ffaa,\n    trailColor: 0x44ff88,\n    screenShakeOnStart: 1.5,\n    canShootDuring: false,\n    canAbilityCancel: false,\n    endLag: 50,\n    description: 'Dash forward, briefly invincible'\n  },\n  ultimate: {\n    name: 'Force Push',\n    key: 'E',\n    cooldown: 500,\n    chargeTimeMs: 1500,\n    minLength: 3,\n    maxLength: 12,\n    width: 3,\n    minKnockback: 4,\n    maxKnockback: 12,\n    color: 0x44ffaa,\n    telegraphOpacity: 0.3,\n    chargeMoveSpeedMult: 0.4,\n    description: 'Charge a directional push \u2014 hold to extend range'\n  }\n};\n", "// Canvas 2D damage number system \u2014 no DOM thrash, scales to hundreds of numbers\nimport { getCamera } from '../engine/renderer';\n\nlet canvas: any, ctx: any;\nconst POOL_SIZE = 40;\nconst LIFETIME = 600; // ms\nconst FLOAT_DISTANCE = 40; // px upward travel\n\n// Pre-allocated pool of damage number slots\nconst pool: any[] = [];\nfor (let i = 0; i < POOL_SIZE; i++) {\n  pool.push({ active: false, x: 0, y: 0, value: 0, life: 0, color: '#ffffff' });\n}\n\n// Reusable vector for world\u2192screen projection\nconst _projVec = new THREE.Vector3();\n\nexport function initDamageNumbers() {\n  canvas = document.createElement('canvas');\n  canvas.id = 'damage-canvas';\n  canvas.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:15;';\n  document.body.appendChild(canvas);\n  resizeCanvas();\n  window.addEventListener('resize', resizeCanvas);\n}\n\nfunction resizeCanvas() {\n  canvas.width = window.innerWidth;\n  canvas.height = window.innerHeight;\n}\n\nexport function spawnDamageNumber(worldX: number, worldZ: number, value: any, color?: string) {\n  if (!color) color = '#ffffff';\n\n  // Find inactive slot\n  let slot: any = null;\n  for (let i = 0; i < POOL_SIZE; i++) {\n    if (!pool[i].active) {\n      slot = pool[i];\n      break;\n    }\n  }\n  // If pool full, recycle oldest\n  if (!slot) {\n    let oldest = pool[0];\n    for (let i = 1; i < POOL_SIZE; i++) {\n      if (pool[i].life > oldest.life) oldest = pool[i];\n    }\n    slot = oldest;\n  }\n\n  // Project world position to screen\n  const camera = getCamera();\n  _projVec.set(worldX, 1.5, worldZ); // slightly above ground\n  _projVec.project(camera);\n\n  slot.active = true;\n  slot.x = (_projVec.x * 0.5 + 0.5) * canvas.width;\n  slot.y = (-_projVec.y * 0.5 + 0.5) * canvas.height;\n  slot.value = typeof value === 'string' ? value : Math.round(value);\n  slot.life = 0;\n  slot.color = color;\n\n  // Add slight random horizontal offset to prevent stacking\n  slot.x += (Math.random() - 0.5) * 20;\n}\n\nexport function updateDamageNumbers(dt: number) {\n  if (!ctx) ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n  const dtMs = dt * 1000;\n\n  for (let i = 0; i < POOL_SIZE; i++) {\n    const slot = pool[i];\n    if (!slot.active) continue;\n\n    slot.life += dtMs;\n    if (slot.life >= LIFETIME) {\n      slot.active = false;\n      continue;\n    }\n\n    const t = slot.life / LIFETIME;\n    const alpha = 1 - t * t; // fade out with ease\n    const yOffset = -FLOAT_DISTANCE * t; // float upward\n    const scale = 1 + t * 0.3; // slight grow\n\n    const x = slot.x;\n    const y = slot.y + yOffset;\n\n    ctx.save();\n    ctx.globalAlpha = alpha;\n    ctx.font = `bold ${Math.round(16 * scale)}px 'SF Mono', 'Consolas', monospace`;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n\n    // Shadow for readability\n    ctx.shadowColor = 'rgba(0,0,0,0.8)';\n    ctx.shadowBlur = 4;\n    ctx.shadowOffsetX = 1;\n    ctx.shadowOffsetY = 1;\n\n    ctx.fillStyle = slot.color;\n    ctx.fillText(slot.value, x, y);\n    ctx.restore();\n  }\n}\n\nexport function clearDamageNumbers() {\n  for (let i = 0; i < POOL_SIZE; i++) {\n    pool[i].active = false;\n  }\n  if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);\n}\n", "// Generic AoE telegraph system \u2014 expanding rings, rectangles, and cascading per-target effects.\n// Not tied to any specific mechanic \u2014 works for stun, damage, slow, etc.\n\nimport { spawnDamageNumber } from '../ui/damageNumbers';\n\nlet sceneRef: any;\n\n// Active telegraph shapes (rings + rects)\nconst activeTelegraphs: any[] = [];\n\n// Pending per-target effects (delayed callbacks)\nconst pendingEffects: any[] = [];\n\n// Shared geometries (created once)\nlet ringGeo: any;\nlet planeGeo: any;\n\n// --- Easing ---\n\nfunction easeOutQuad(t: number) {\n  return t * (2 - t);\n}\n\n// --- Init ---\n\nexport function initAoeTelegraph(scene: any) {\n  sceneRef = scene;\n}\n\n// --- Ring Shape ---\n\nexport function createAoeRing(x: number, z: number, maxRadius: number, durationMs: number, color: number) {\n  if (!ringGeo) {\n    ringGeo = new THREE.RingGeometry(0.8, 1.0, 32);\n    ringGeo.rotateX(-Math.PI / 2); // lay flat on ground\n  }\n\n  const mat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.8,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n\n  const mesh = new THREE.Mesh(ringGeo, mat);\n  mesh.position.set(x, 0.05, z); // slightly above ground\n  mesh.scale.set(0.01, 0.01, 0.01); // start tiny\n  sceneRef.add(mesh);\n\n  const telegraph = {\n    type: 'ring',\n    mesh: mesh,\n    material: mat,\n    center: { x, z },\n    maxRadius: maxRadius,\n    duration: durationMs,\n    elapsed: 0,\n    color: color,\n  };\n\n  activeTelegraphs.push(telegraph);\n  return telegraph;\n}\n\n// --- Rectangle Shape ---\n\nexport function createAoeRect(x: number, z: number, width: number, height: number, rotation: number, durationMs: number, color: number) {\n  if (!planeGeo) {\n    planeGeo = new THREE.PlaneGeometry(1, 1);\n    planeGeo.rotateX(-Math.PI / 2); // lay flat on ground\n  }\n\n  const group = new THREE.Group();\n  group.position.set(x, 0.05, z);\n  group.rotation.y = rotation;\n\n  // Fill plane\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.0, // ramps up over first 30%\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const fillMesh = new THREE.Mesh(planeGeo, fillMat);\n  fillMesh.scale.set(width * 0.8, 1, height * 0.8); // start at 80%\n  group.add(fillMesh);\n\n  // Border outline\n  const edgeGeo = new THREE.EdgesGeometry(new THREE.PlaneGeometry(width, height));\n  edgeGeo.rotateX(-Math.PI / 2);\n  const borderMat = new THREE.LineBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.9,\n    depthWrite: false,\n  });\n  const borderMesh = new THREE.LineSegments(edgeGeo, borderMat);\n  group.add(borderMesh);\n\n  sceneRef.add(group);\n\n  const telegraph = {\n    type: 'rect',\n    mesh: group,\n    fillMesh: fillMesh,\n    fillMaterial: fillMat,\n    borderMesh: borderMesh,\n    borderMaterial: borderMat,\n    borderEdgeGeo: edgeGeo,\n    center: { x, z },\n    width: width,\n    height: height,\n    rotation: rotation,\n    duration: durationMs,\n    elapsed: 0,\n    color: color,\n  };\n\n  activeTelegraphs.push(telegraph);\n  return telegraph;\n}\n\n// --- Hit Testing ---\n\n/**\n * Check if a point is inside a rotated rectangle.\n */\nexport function isInRotatedRect(ex: number, ez: number, cx: number, cz: number, w: number, h: number, rotation: number, padding?: number) {\n  const pad = padding || 0;\n  const dx = ex - cx;\n  const dz = ez - cz;\n  const cos = Math.cos(-rotation);\n  const sin = Math.sin(-rotation);\n  const localX = dx * cos - dz * sin;\n  const localZ = dx * sin + dz * cos;\n  return Math.abs(localX) < (w / 2 + pad) && Math.abs(localZ) < (h / 2 + pad);\n}\n\n// --- Update Telegraphs ---\n\nexport function updateAoeTelegraphs(dt: number) {\n  const dtMs = dt * 1000;\n\n  for (let i = activeTelegraphs.length - 1; i >= 0; i--) {\n    const t = activeTelegraphs[i];\n    t.elapsed += dtMs;\n    const progress = Math.min(t.elapsed / t.duration, 1);\n\n    if (t.type === 'ring') {\n      updateRing(t, progress);\n    } else if (t.type === 'rect') {\n      updateRect(t, progress);\n    }\n\n    // Remove when complete\n    if (progress >= 1) {\n      removeTelegraph(t);\n      activeTelegraphs.splice(i, 1);\n    }\n  }\n}\n\nfunction updateRing(t: any, progress: number) {\n  const easedProgress = easeOutQuad(progress);\n\n  // Scale \u2014 expand from 0 to maxRadius\n  const currentRadius = t.maxRadius * easedProgress;\n  t.mesh.scale.set(currentRadius, currentRadius, currentRadius);\n\n  // Thickness shrinks (simulated via Y scale stretching the ring thinner feel)\n  // The ring geometry is 0.8\u21921.0 inner/outer, so at scale 1 it's 0.2 thick.\n  // We modulate opacity instead for the thinning effect.\n\n  // Opacity fades out\n  t.material.opacity = 0.8 * (1 - progress);\n}\n\nfunction updateRect(t: any, progress: number) {\n  const easedProgress = easeOutQuad(progress);\n\n  // Fill: opacity ramps 0 \u2192 0.3 over first 30%, then fades\n  let fillOpacity;\n  if (progress < 0.3) {\n    fillOpacity = 0.3 * (progress / 0.3);\n  } else {\n    fillOpacity = 0.3 * (1 - (progress - 0.3) / 0.7);\n  }\n  t.fillMaterial.opacity = Math.max(0, fillOpacity);\n\n  // Fill scale: 80% \u2192 100%\n  const scaleMult = 0.8 + 0.2 * easedProgress;\n  t.fillMesh.scale.set(t.width * scaleMult, 1, t.height * scaleMult);\n\n  // Border: pulse frequency accelerates 2Hz \u2192 8Hz\n  const freq = 2 + 6 * progress;\n  const pulse = 0.5 + 0.5 * Math.sin(performance.now() * freq * 0.00628); // 2\u03C0/1000\n  t.borderMaterial.opacity = 0.4 + 0.5 * pulse;\n\n  // Brightness ramp in last 100ms \u2014 telegraph flashes bright before firing\n  const flashThreshold = 1 - (100 / t.duration); // last 100ms as fraction of total\n  if (progress > flashThreshold) {\n    const flashProgress = (progress - flashThreshold) / (1 - flashThreshold); // 0\u21921\n    // Ramp fill to full bright\n    t.fillMaterial.opacity = 0.3 + 0.5 * flashProgress;\n    // Solid bright border\n    t.borderMaterial.opacity = 0.8 + 0.2 * flashProgress;\n    // Brighten fill color toward white\n    const r = ((t.color >> 16) & 0xff) / 255;\n    const g = ((t.color >> 8) & 0xff) / 255;\n    const b = (t.color & 0xff) / 255;\n    t.fillMaterial.color.setRGB(\n      r + (1 - r) * flashProgress * 0.6,\n      g + (1 - g) * flashProgress * 0.6,\n      b + (1 - b) * flashProgress * 0.6\n    );\n    t.borderMaterial.color.setRGB(\n      r + (1 - r) * flashProgress * 0.6,\n      g + (1 - g) * flashProgress * 0.6,\n      b + (1 - b) * flashProgress * 0.6\n    );\n  } else if (progress > 0.8) {\n    // Border fades in last 20% (but before the flash window)\n    const fadeProgress = (progress - 0.8) / (flashThreshold - 0.8);\n    t.borderMaterial.opacity *= (1 - fadeProgress * 0.5);\n    t.fillMaterial.opacity *= (1 - fadeProgress * 0.5);\n  }\n}\n\nfunction removeTelegraph(t: any) {\n  if (t.type === 'ring') {\n    t.material.dispose();\n    sceneRef.remove(t.mesh);\n  } else if (t.type === 'rect') {\n    t.fillMaterial.dispose();\n    t.borderMaterial.dispose();\n    t.borderEdgeGeo.dispose();\n    sceneRef.remove(t.mesh);\n  }\n}\n\n// --- Pending Effects ---\n\nexport function schedulePendingEffect(enemy: any, delayMs: number, callback: (enemy: any) => void) {\n  pendingEffects.push({ enemy, delay: delayMs, callback });\n}\n\n// Generic delayed callback (not tied to an enemy)\nexport function scheduleCallback(delayMs: number, callback: () => void) {\n  pendingEffects.push({ enemy: null, delay: delayMs, callback });\n}\n\nexport function updatePendingEffects(dt: number) {\n  const dtMs = dt * 1000;\n\n  for (let i = pendingEffects.length - 1; i >= 0; i--) {\n    const p = pendingEffects[i];\n    p.delay -= dtMs;\n    if (p.delay <= 0) {\n      if (p.enemy) {\n        p.callback(p.enemy);\n      } else {\n        p.callback();\n      }\n      pendingEffects.splice(i, 1);\n    }\n  }\n}\n\n// --- Generic AoE Applicator ---\n\n/**\n * Trigger an AoE effect with visual telegraph and cascading per-target application.\n */\nexport function applyAoeEffect({ x, z, radius, durationMs, color, label, effectFn, gameState, excludeEnemy }: {\n  x: number;\n  z: number;\n  radius: number;\n  durationMs: number;\n  color: number;\n  label?: string;\n  effectFn: (enemy: any) => void;\n  gameState: any;\n  excludeEnemy?: any;\n}) {\n  // 1. Create expanding ring visual\n  createAoeRing(x, z, radius, durationMs, color);\n\n  // 2. Schedule cascade effects on each enemy in range\n  const colorStr = '#' + color.toString(16).padStart(6, '0');\n\n  for (const enemy of gameState.enemies) {\n    if (enemy === excludeEnemy) continue;\n\n    const dx = enemy.pos.x - x;\n    const dz = enemy.pos.z - z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n\n    if (dist < radius) {\n      // Delay proportional to distance \u2014 closest react first\n      const delayMs = (dist / radius) * durationMs;\n\n      schedulePendingEffect(enemy, delayMs, (e) => {\n        // Apply the actual game effect\n        effectFn(e);\n\n        // Visual feedback \u2014 flash enemy to effect color\n        e.flashTimer = 200;\n        e.bodyMesh.material.emissive.setHex(color);\n        if (e.headMesh) e.headMesh.material.emissive.setHex(color);\n\n        // Floating text label\n        if (label) {\n          spawnDamageNumber(e.pos.x, e.pos.z, label, colorStr);\n        }\n      });\n    }\n  }\n}\n\n// --- Rectangle AoE Applicator ---\n\n/**\n * Trigger a rectangle AoE \u2014 shows a telegraph, then fires a damage corridor.\n * Hits both enemies AND the player (friendly fire / environmental hazard).\n */\nexport function applyAoeRectEffect({\n  x, z, width, height, rotation,\n  telegraphDurationMs, lingerDurationMs,\n  color, damage,\n  playerDamageFn, enemyDamageFn,\n  gameState, excludeEnemy\n}: {\n  x: number;\n  z: number;\n  width: number;\n  height: number;\n  rotation: number;\n  telegraphDurationMs: number;\n  lingerDurationMs: number;\n  color: number;\n  damage: number;\n  playerDamageFn?: (x: number, z: number, width: number, height: number, rotation: number) => void;\n  enemyDamageFn?: (enemy: any) => void;\n  gameState: any;\n  excludeEnemy?: any;\n}) {\n  // 1. Show telegraph rect (warning phase)\n  createAoeRect(x, z, width, height, rotation, telegraphDurationMs, color);\n\n  // 2. Schedule the actual damage at the end of the telegraph\n  const colorStr = '#' + color.toString(16).padStart(6, '0');\n\n  scheduleCallback(telegraphDurationMs, () => {\n    // Show a bright \"fired\" rect that lingers briefly\n    createAoeRect(x, z, width, height, rotation, lingerDurationMs, color);\n\n    // Check all enemies in the rect (pad by enemy collision radius for generous hit detection)\n    for (const enemy of gameState.enemies) {\n      if (enemy === excludeEnemy) continue;\n      const enemyRadius = (enemy.config && enemy.config.size) ? enemy.config.size.radius : 0;\n      if (isInRotatedRect(enemy.pos.x, enemy.pos.z, x, z, width, height, rotation, enemyRadius)) {\n        if (enemyDamageFn) {\n          enemyDamageFn(enemy);\n        }\n        // Visual feedback\n        enemy.flashTimer = 200;\n        enemy.bodyMesh.material.emissive.setHex(color);\n        if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(color);\n        spawnDamageNumber(enemy.pos.x, enemy.pos.z, damage, colorStr);\n      }\n    }\n\n    // Check player\n    if (playerDamageFn) {\n      playerDamageFn(x, z, width, height, rotation);\n    }\n  });\n}\n\n// --- Cleanup ---\n\nexport function clearAoeTelegraphs() {\n  // Remove all active telegraph shapes\n  for (const t of activeTelegraphs) {\n    removeTelegraph(t);\n  }\n  activeTelegraphs.length = 0;\n\n  // Clear pending effects\n  pendingEffects.length = 0;\n}\n", "import { EnemyConfig } from '../types/index';\n\n// Global multipliers for tuning all mobs at once\nexport const MOB_GLOBAL = {\n  speedMult: 1,\n  damageMult: 1,\n  healthMult: 1,\n  telegraphMult: 1,\n  recoveryMult: 1,\n};\n\nexport const ENEMY_TYPES: Record<string, EnemyConfig> = {\n  goblin: {\n    name: \"Goblin\",\n    health: 30,\n    speed: 2.45,\n    damage: 10,\n    attackRange: 1.5,\n    attackRate: 800,\n    behavior: \"rush\",\n    knockbackResist: 0,\n    mass: 1.0,\n    color: 16729190,\n    emissive: 16720452,\n    size: { radius: 0.3, height: 0.8 },\n    drops: { currency: { min: 1, max: 3 }, healthChance: 0.1 },\n    rush: { stopDistance: 0.5 },\n    melee: {\n      telegraphDuration: 300,\n      attackDuration: 100,\n      recoveryDuration: 400,\n      lungeDistance: 0.8,\n      damage: 10,\n      hitArc: 1.5,\n      hitRange: 1.2,\n    },\n    pitLeap: {\n      edgeTimeRequired: 1500,\n      leapSpeed: 7,\n      arcHeight: 2,\n      cooldown: 4000\n    }\n  },\n  skeletonArcher: {\n    name: \"Skeleton Archer\",\n    health: 20,\n    speed: 1.4,\n    damage: 15,\n    attackRange: 12,\n    attackRate: 2500,\n    behavior: \"kite\",\n    knockbackResist: 0.1,\n    mass: 0.8,\n    color: 11176191,\n    emissive: 8930508,\n    size: { radius: 0.25, height: 1 },\n    drops: { currency: { min: 2, max: 4 }, healthChance: 0.05 },\n    kite: { preferredRangeMult: 0.7, retreatBuffer: 1, advanceBuffer: 3 },\n    sniper: {\n      telegraphDuration: 800,\n      shotWidth: 1.2,\n      shotLength: 14,\n      damage: 15,\n      color: 11158783,\n      lingerDuration: 200,\n      slowDuration: 1000,\n      slowMult: 0.5\n    }\n  },\n  iceMortarImp: {\n    name: \"Ice Mortar Imp\",\n    health: 25,\n    speed: 1.6,\n    damage: 12,\n    attackRange: 15.5,\n    attackRate: 3000,\n    behavior: \"mortar\",\n    knockbackResist: 0.1,\n    mass: 0.9,\n    color: 4513279,\n    emissive: 13391104,\n    size: { radius: 0.3, height: 0.9 },\n    drops: { currency: { min: 2, max: 5 }, healthChance: 0.08 },\n    kite: { preferredRangeMult: 0.65, retreatBuffer: 1.5, advanceBuffer: 3 },\n    mortar: {\n      aimDuration: 900,\n      projectileSpeed: 11,\n      arcHeight: 6,\n      blastRadius: 2.5,\n      damage: 18,\n      color: 5765887,\n      inaccuracy: 1.5,\n      slowDuration: 800,\n      slowMult: 0.6,\n      explosionDuration: 300,\n      circleStartScale: 0.25,\n      circleScaleTime: 800,\n      icePatch: {\n        enabled: true,\n        duration: 2000,\n        color: 8454143,\n        speedMult: 2.0,\n        knockbackMult: 2.0,\n        affectsPlayer: true,\n        affectsEnemies: true\n      }\n    }\n  },\n  stoneGolem: {\n    name: \"Stone Golem\",\n    health: 80,\n    speed: 1.05,\n    damage: 25,\n    attackRange: 2,\n    attackRate: 1200,\n    behavior: \"tank\",\n    knockbackResist: 0.6,\n    mass: 3.0,\n    color: 16746547,\n    emissive: 2263244,\n    size: { radius: 0.5, height: 1.4 },\n    drops: { currency: { min: 3, max: 6 }, healthChance: 0.2 },\n    tank: {\n      chargeSpeedMult: 3,\n      chargeDuration: 500,\n      chargeCooldownMin: 3000,\n      chargeCooldownMax: 5000,\n      chargeMinDist: 2,\n      chargeMaxDist: 10,\n      chargeDamageMult: 1.5,\n      telegraphDuration: 300\n    },\n    shield: {\n      maxHealth: 40,\n      stunRadius: 5,\n      stunDuration: 1500,\n      breakRingDuration: 400,\n      color: 8974079,\n      emissive: 4508927,\n      opacity: 0.35\n    },\n    melee: {\n      telegraphDuration: 700,\n      attackDuration: 150,\n      recoveryDuration: 800,\n      damage: 30,\n      hitArc: 2.0,\n      hitRange: 2.5,\n    },\n    deathExplosion: {\n      radius: 4,\n      damage: 20,\n      color: 4513279,\n      ringDuration: 400,\n      stunDuration: 0,\n      telegraphDuration: 1200\n    }\n  },\n};\n", "export class ObjectPool {\n  pool: any[];\n  active: any[];\n  createFn: () => any;\n\n  constructor(createFn: () => any, initialSize = 50) {\n    this.pool = [];\n    this.active = [];\n    this.createFn = createFn;\n    for (let i = 0; i < initialSize; i++) {\n      const obj = createFn();\n      obj.mesh.visible = false;\n      this.pool.push(obj);\n    }\n  }\n\n  acquire() {\n    let obj = this.pool.pop();\n    if (!obj) {\n      obj = this.createFn();\n    }\n    obj.mesh.visible = true;\n    this.active.push(obj);\n    return obj;\n  }\n\n  release(obj: any) {\n    obj.mesh.visible = false;\n    const idx = this.active.indexOf(obj);\n    if (idx !== -1) {\n      // Swap-remove: O(1) instead of O(n) splice\n      const last = this.active.length - 1;\n      if (idx !== last) this.active[idx] = this.active[last];\n      this.active.length = last;\n    }\n    this.pool.push(obj);\n  }\n\n  releaseAll() {\n    for (let i = this.active.length - 1; i >= 0; i--) {\n      const obj = this.active[i];\n      obj.mesh.visible = false;\n      this.pool.push(obj);\n    }\n    this.active.length = 0;\n  }\n\n  getActive() { return this.active; }\n}\n", "import { ObjectPool } from '../engine/pools';\nimport { PLAYER } from '../config/player';\n\nlet playerPool: any, enemyPool: any;\nlet sceneRef: any;\nlet basePlayerProjSize: number; // original geometry radius for scale calculation\n\nexport function initProjectilePool(scene: any) {\n  sceneRef = scene;\n\n  basePlayerProjSize = PLAYER.projectile.size;\n  const playerProjGeo = new THREE.SphereGeometry(basePlayerProjSize, 6, 4);\n  const playerProjMat = new THREE.MeshStandardMaterial({\n    color: PLAYER.projectile.color,\n    emissive: PLAYER.projectile.color,\n    emissiveIntensity: 0.8\n  });\n\n  playerPool = new ObjectPool(() => {\n    const mesh = new THREE.Mesh(playerProjGeo, playerProjMat.clone());\n    scene.add(mesh);\n    return { mesh, dir: new THREE.Vector3(), speed: 0, damage: 0, life: 0, isEnemy: false };\n  }, 80);\n\n  const enemyProjGeo = new THREE.SphereGeometry(0.1, 6, 4);\n\n  enemyPool = new ObjectPool(() => {\n    const mesh = new THREE.Mesh(\n      enemyProjGeo,\n      new THREE.MeshStandardMaterial({\n        color: 0xff4466,\n        emissive: 0xff2244,\n        emissiveIntensity: 0.8\n      })\n    );\n    scene.add(mesh);\n    return { mesh, dir: new THREE.Vector3(), speed: 0, damage: 0, life: 0, isEnemy: true };\n  }, 40);\n}\n\nexport function fireProjectile(origin: any, direction: any, config: any, isEnemy?: boolean) {\n  if (isEnemy === undefined) isEnemy = false;\n  const pool = isEnemy ? enemyPool : playerPool;\n  const p = pool.acquire();\n  p.mesh.position.set(origin.x, 0.8, origin.z);\n  p.dir.copy(direction).normalize();\n  p.speed = config.speed;\n  p.damage = config.damage;\n  p.life = 0;\n\n  // Scale player projectile mesh based on current config size vs base geometry\n  if (!isEnemy && basePlayerProjSize) {\n    const s = PLAYER.projectile.size / basePlayerProjSize;\n    p.mesh.scale.set(s, s, s);\n  }\n\n  // Update enemy projectile color per-type\n  if (isEnemy && config.color) {\n    p.mesh.material.color.setHex(config.color);\n    p.mesh.material.emissive.setHex(config.color);\n  }\n\n  return p;\n}\n\nexport function updateProjectiles(dt: number) {\n  const maxLife = 2.0;\n  for (const pool of [playerPool, enemyPool]) {\n    const active = pool.getActive();\n    for (let i = active.length - 1; i >= 0; i--) {\n      const p = active[i];\n      p.mesh.position.x += p.dir.x * p.speed * dt;\n      p.mesh.position.z += p.dir.z * p.speed * dt;\n      p.life += dt;\n      if (p.life > maxLife) {\n        pool.release(p);\n      }\n    }\n  }\n}\n\nexport function getPlayerProjectiles() { return playerPool ? playerPool.getActive() : []; }\nexport function getEnemyProjectiles() { return enemyPool ? enemyPool.getActive() : []; }\n\nexport function releaseProjectile(p: any) {\n  if (p.isEnemy) {\n    enemyPool.release(p);\n  } else {\n    playerPool.release(p);\n  }\n}\n\nexport function releaseAllProjectiles() {\n  if (playerPool) playerPool.releaseAll();\n  if (enemyPool) enemyPool.releaseAll();\n}\n", "// EnemyRig \u2014 Builds distinctive silhouettes for each enemy type from primitives.\n// Each type has unique proportions and identifying details (ears, ribs, hat, etc.)\n// while sharing the same construction pattern. No animation \u2014 just static models\n// with a shared hit reaction system.\n\n// \u2500\u2500\u2500 Per-Type Silhouette Config \u2500\u2500\u2500\n// Proportions are expressed as multipliers relative to cfg.size.radius and cfg.size.height.\n\ninterface SilhouetteConfig {\n  // Proportions (multiplied by cfg.size dimensions)\n  headScale: number;        // head radius as fraction of body radius\n  torsoW: number;           // torso width multiplier\n  torsoH: number;           // torso height multiplier\n  torsoD: number;           // torso depth multiplier\n  armW: number;             // arm width multiplier\n  armLen: number;           // arm length multiplier\n  legW: number;             // leg width multiplier\n  legLen: number;           // leg length multiplier\n  legSpread: number;        // horizontal distance between legs\n  hipY: number;             // hip height as fraction of total height\n  // Color adjustments\n  limbDarken: number;       // how much to darken limbs (0 = same, 0.3 = 30% darker)\n  headBrighten: number;     // how much to brighten head (0 = same, 0.2 = 20% brighter)\n  // Extras\n  extras: string[];\n}\n\n// Multipliers are relative to cfg.size (radius, height).\n// Old enemies were: cylinder(radius, height*0.6) + sphere(radius*0.7).\n// These are tuned so each type fits within roughly the same bounding volume\n// as the old primitives, while reading as distinct silhouettes.\n\nconst SILHOUETTES: Record<string, SilhouetteConfig> = {\n  goblin: {\n    headScale: 1.2,       // big exaggerated head \u2014 dominant feature\n    torsoW: 0.55, torsoH: 0.30, torsoD: 0.50,\n    armW: 0.28, armLen: 0.42,   // long-ish dangling arms\n    legW: 0.30, legLen: 0.28,   // short stubby legs\n    legSpread: 0.30,\n    hipY: 0.35,\n    limbDarken: 0.15,\n    headBrighten: 0.1,\n    extras: ['snout', 'ears'],\n  },\n  skeletonArcher: {\n    headScale: 0.7,        // small skull\n    torsoW: 0.38, torsoH: 0.42, torsoD: 0.30,  // narrow tall\n    armW: 0.18, armLen: 0.38,\n    legW: 0.20, legLen: 0.45,\n    legSpread: 0.22,\n    hipY: 0.45,\n    limbDarken: 0.1,\n    headBrighten: 0.05,\n    extras: ['bow', 'ribs'],\n  },\n  iceMortarImp: {\n    headScale: 0.9,\n    torsoW: 0.55, torsoH: 0.28, torsoD: 0.50,  // wide round body, scaled down\n    armW: 0.18, armLen: 0.20,   // stubby arms\n    legW: 0.22, legLen: 0.20,   // tiny legs\n    legSpread: 0.25,\n    hipY: 0.28,\n    limbDarken: 0.1,\n    headBrighten: 0.15,\n    extras: ['hat'],\n  },\n  stoneGolem: {\n    headScale: 0.5,        // tiny head sunk in shoulders\n    torsoW: 0.70, torsoH: 0.40, torsoD: 0.60,   // massive (golem already has large cfg.size)\n    armW: 0.38, armLen: 0.45,   // thick heavy arms\n    legW: 0.38, legLen: 0.38,   // thick legs\n    legSpread: 0.32,\n    hipY: 0.40,\n    limbDarken: 0.1,\n    headBrighten: 0.05,\n    extras: ['shoulders'],\n  },\n};\n\n// Default silhouette for unknown types\nconst DEFAULT_SILHOUETTE: SilhouetteConfig = {\n  headScale: 0.9,\n  torsoW: 0.50, torsoH: 0.35, torsoD: 0.45,\n  armW: 0.25, armLen: 0.35,\n  legW: 0.28, legLen: 0.35,\n  legSpread: 0.25,\n  hipY: 0.40,\n  limbDarken: 0.1,\n  headBrighten: 0.1,\n  extras: [],\n};\n\n// \u2500\u2500\u2500 Color Utilities \u2500\u2500\u2500\n\nfunction darkenColor(color: number, amount: number): number {\n  const r = Math.max(0, ((color >> 16) & 0xff) * (1 - amount)) | 0;\n  const g = Math.max(0, ((color >> 8) & 0xff) * (1 - amount)) | 0;\n  const b = Math.max(0, (color & 0xff) * (1 - amount)) | 0;\n  return (r << 16) | (g << 8) | b;\n}\n\nfunction brightenColor(color: number, amount: number): number {\n  const r = Math.min(255, ((color >> 16) & 0xff) * (1 + amount)) | 0;\n  const g = Math.min(255, ((color >> 8) & 0xff) * (1 + amount)) | 0;\n  const b = Math.min(255, (color & 0xff) * (1 + amount)) | 0;\n  return (r << 16) | (g << 8) | b;\n}\n\n// \u2500\u2500\u2500 Build Enemy Model \u2500\u2500\u2500\n\nexport interface EnemyModel {\n  bodyMesh: any;       // main torso mesh (backward compat for flash)\n  headMesh: any;       // head mesh (backward compat for flash)\n  allMeshes: any[];    // every mesh part (for comprehensive effects)\n  allMaterials: any[]; // every material (for flash/transparency)\n}\n\nexport function buildEnemyModel(typeName: string, cfg: any, group: any): EnemyModel {\n  const sil = SILHOUETTES[typeName] || DEFAULT_SILHOUETTE;\n  const r = cfg.size.radius;\n  const h = cfg.size.height;\n\n  const allMeshes: any[] = [];\n  const allMaterials: any[] = [];\n\n  function addMesh(geo: any, color: number, emissive: number, emissiveI: number, parent: any, x = 0, y = 0, z = 0) {\n    const mat = new THREE.MeshStandardMaterial({\n      color, emissive, emissiveIntensity: emissiveI,\n    });\n    const mesh = new THREE.Mesh(geo, mat);\n    mesh.position.set(x, y, z);\n    mesh.castShadow = true;\n    parent.add(mesh);\n    allMeshes.push(mesh);\n    allMaterials.push(mat);\n    return mesh;\n  }\n\n  const bodyColor = cfg.color;\n  const bodyEmissive = cfg.emissive;\n  const headColor = brightenColor(bodyColor, sil.headBrighten);\n  const headEmissive = brightenColor(bodyEmissive, sil.headBrighten);\n  const limbColor = darkenColor(bodyColor, sil.limbDarken);\n  const limbEmissive = darkenColor(bodyEmissive, sil.limbDarken);\n\n  // \u2500\u2500\u2500 Core body parts \u2500\u2500\u2500\n\n  const hipY = h * sil.hipY;\n  const torsoW = r * 2 * sil.torsoW;\n  const torsoH = h * sil.torsoH;\n  const torsoD = r * 2 * sil.torsoD;\n  const torsoY = hipY + torsoH / 2 + r * 0.05;\n\n  // Torso\n  const torsoGeo = new THREE.BoxGeometry(torsoW, torsoH, torsoD);\n  const bodyMesh = addMesh(torsoGeo, bodyColor, bodyEmissive, 0.5, group, 0, torsoY, 0);\n\n  // Head\n  const headRadius = r * sil.headScale * 0.7;\n  const headY = torsoY + torsoH / 2 + headRadius * 0.8;\n  const headGeo = new THREE.SphereGeometry(headRadius, 8, 6);\n  const headMesh = addMesh(headGeo, headColor, headEmissive, 0.6, group, 0, headY, 0);\n\n  // Arms\n  const shoulderY = torsoY + torsoH * 0.3;\n  const armW = r * sil.armW;\n  const armLen = h * sil.armLen;\n  const armGeo = new THREE.BoxGeometry(armW, armLen, armW);\n\n  addMesh(armGeo, limbColor, limbEmissive, 0.4, group,\n    -(torsoW / 2 + armW / 2), shoulderY - armLen / 2, 0);\n  addMesh(armGeo, limbColor, limbEmissive, 0.4, group,\n    (torsoW / 2 + armW / 2), shoulderY - armLen / 2, 0);\n\n  // Legs\n  const legW = r * sil.legW;\n  const legLen = h * sil.legLen;\n  const legSpread = r * sil.legSpread;\n  const legGeo = new THREE.BoxGeometry(legW, legLen, legW);\n\n  addMesh(legGeo, limbColor, limbEmissive, 0.4, group,\n    -legSpread, hipY - legLen / 2, 0);\n  addMesh(legGeo, limbColor, limbEmissive, 0.4, group,\n    legSpread, hipY - legLen / 2, 0);\n\n  // \u2500\u2500\u2500 Type-specific extras \u2500\u2500\u2500\n\n  if (sil.extras.includes('snout')) {\n    const snoutGeo = new THREE.ConeGeometry(headRadius * 0.35, headRadius * 0.7, 5);\n    const snout = addMesh(snoutGeo, headColor, headEmissive, 0.5, group,\n      0, headY - headRadius * 0.15, -(headRadius + headRadius * 0.15));\n    snout.rotation.x = -Math.PI / 2;\n  }\n\n  if (sil.extras.includes('ears')) {\n    const earGeo = new THREE.ConeGeometry(headRadius * 0.25, headRadius * 0.7, 4);\n\n    const earL = addMesh(earGeo, headColor, headEmissive, 0.5, group,\n      -(headRadius + headRadius * 0.1), headY + headRadius * 0.3, 0);\n    earL.rotation.z = Math.PI / 2 + 0.4;\n\n    const earR = addMesh(earGeo, headColor, headEmissive, 0.5, group,\n      (headRadius + headRadius * 0.1), headY + headRadius * 0.3, 0);\n    earR.rotation.z = -(Math.PI / 2 + 0.4);\n  }\n\n  if (sil.extras.includes('bow')) {\n    const bowGeo = new THREE.BoxGeometry(armW * 0.4, h * 0.35, armW * 0.8);\n    addMesh(bowGeo, darkenColor(bodyColor, 0.4), darkenColor(bodyEmissive, 0.4), 0.3, group,\n      -(torsoW / 2 + armW * 1.5), shoulderY - armLen * 0.4, -r * 0.4);\n  }\n\n  if (sil.extras.includes('ribs')) {\n    const ribColor = brightenColor(bodyColor, 0.15);\n    const ribEmissive = brightenColor(bodyEmissive, 0.1);\n    for (let i = 0; i < 3; i++) {\n      const ribGeo = new THREE.BoxGeometry(torsoW * 1.15, h * 0.012, torsoD * 0.6);\n      const ribY = torsoY + torsoH * (0.25 - i * 0.25);\n      addMesh(ribGeo, ribColor, ribEmissive, 0.3, group, 0, ribY, 0);\n    }\n  }\n\n  if (sil.extras.includes('hat')) {\n    const hatGeo = new THREE.ConeGeometry(headRadius * 0.9, h * 0.28, 6);\n    const hat = addMesh(hatGeo, darkenColor(bodyColor, 0.25), darkenColor(bodyEmissive, 0.25), 0.4, group,\n      0, headY + headRadius * 0.6 + h * 0.1, 0);\n    hat.rotation.z = 0.15; // jaunty tilt\n  }\n\n  if (sil.extras.includes('shoulders')) {\n    const shW = torsoW * 0.4;\n    const shH = torsoH * 0.25;\n    const shGeo = new THREE.BoxGeometry(shW, shH, shW);\n\n    addMesh(shGeo, darkenColor(bodyColor, 0.1), darkenColor(bodyEmissive, 0.1), 0.35, group,\n      -(torsoW / 2 + shW * 0.1), shoulderY + shH * 0.5, 0);\n    addMesh(shGeo, darkenColor(bodyColor, 0.1), darkenColor(bodyEmissive, 0.1), 0.35, group,\n      (torsoW / 2 + shW * 0.1), shoulderY + shH * 0.5, 0);\n  }\n\n  return { bodyMesh, headMesh, allMeshes, allMaterials };\n}\n\n// \u2500\u2500\u2500 Hit Reaction \u2500\u2500\u2500\n// Shared squash/bounce on damage \u2014 applied to any enemy mesh group.\n// Call triggerHitReaction on damage, updateHitReaction each frame.\n\nexport interface HitReactionState {\n  active: boolean;\n  timer: number;      // seconds elapsed\n  duration: number;   // total duration (seconds)\n}\n\nexport function createHitReaction(): HitReactionState {\n  return { active: false, timer: 0, duration: 0.12 };\n}\n\nexport function triggerHitReaction(state: HitReactionState) {\n  state.active = true;\n  state.timer = 0;\n}\n\nexport function updateHitReaction(state: HitReactionState, meshGroup: any, dt: number) {\n  if (!state.active) return;\n\n  state.timer += dt;\n  const t = Math.min(state.timer / state.duration, 1);\n\n  if (t < 0.3) {\n    // Squash phase \u2014 compress vertically, widen\n    const squashT = t / 0.3;\n    meshGroup.scale.set(1 + 0.12 * squashT, 1 - 0.15 * squashT, 1 + 0.12 * squashT);\n  } else {\n    // Bounce back \u2014 overshoot slightly then settle\n    const bounceT = (t - 0.3) / 0.7;\n    const ease = 1 - Math.pow(1 - bounceT, 3); // ease out cubic\n    const overshoot = bounceT < 0.5 ? 1.06 : 1 + 0.06 * (1 - (bounceT - 0.5) * 2);\n    const scaleY = (1 - 0.15) + (overshoot - (1 - 0.15)) * ease;\n    const scaleXZ = (1 + 0.12) + (1 - (1 + 0.12)) * ease;\n    meshGroup.scale.set(scaleXZ, scaleY, scaleXZ);\n  }\n\n  if (t >= 1) {\n    state.active = false;\n    meshGroup.scale.set(1, 1, 1);\n  }\n}\n", "// Event Bus \u2014 lightweight pub/sub for game events\n// Systems emit events at key moments (damage, death, dash, etc.)\n// Other systems subscribe to react (audio, particles, screen effects)\n// Existing side effects (damage numbers, screen shake) are NOT migrated \u2014\n// the bus is additive. New systems subscribe; old ones stay as-is.\n\n// \u2500\u2500\u2500 Event Types \u2500\u2500\u2500\n\nexport type GameEvent =\n  | { type: 'enemyHit'; enemy: any; damage: number; position: { x: number; z: number }; wasShielded: boolean }\n  | { type: 'enemyDied'; enemy: any; position: { x: number; z: number } }\n  | { type: 'playerHit'; damage: number; position: { x: number; z: number } }\n  | { type: 'playerDash'; direction: { x: number; z: number }; position: { x: number; z: number } }\n  | { type: 'playerDashEnd' }\n  | { type: 'waveCleared'; waveIndex: number }\n  | { type: 'waveBegan'; waveIndex: number }\n  | { type: 'shieldBreak'; enemy: any; position: { x: number; z: number } }\n  | { type: 'chargeFired'; chargeT: number; direction: { x: number; z: number }; position: { x: number; z: number } }\n  | { type: 'enemyPushed'; enemy: any; position: { x: number; z: number } }\n  | { type: 'pitFall'; position: { x: number; z: number }; isPlayer: boolean }\n  | { type: 'meleeSwing'; position: { x: number; z: number }; direction: { x: number; z: number } }\n  | { type: 'meleeHit'; enemy: any; damage: number; position: { x: number; z: number } }\n  | { type: 'roomCleared'; roomIndex: number }\n  | { type: 'roomClearComplete'; roomIndex: number }\n  | { type: 'doorUnlocked'; roomIndex: number }\n  | { type: 'doorEntered'; roomIndex: number }\n  | { type: 'spawnPackTelegraph'; packIndex: number; roomIndex: number }\n  | { type: 'spawnPackSpawned'; packIndex: number; roomIndex: number }\n  | { type: 'restRoomEntered'; roomIndex: number }\n  | { type: 'playerHealed'; amount: number; position: { x: number; z: number } }\n  | { type: 'enemyMeleeTelegraph'; position: { x: number; z: number }; facingAngle: number; hitArc: number; hitRange: number; duration: number }\n  | { type: 'wallSlam'; enemy: any; speed: number; damage: number; position: { x: number; z: number } }\n  | { type: 'enemyImpact'; enemyA: any; enemyB: any; speed: number; damage: number; position: { x: number; z: number } }\n  | { type: 'bulletTimeActivated' }\n  | { type: 'bulletTimeDeactivated' }\n  | { type: 'objectPushed'; object: any; position: { x: number; z: number } }\n  | { type: 'objectWallSlam'; object: any; speed: number; damage: number; position: { x: number; z: number } }\n  | { type: 'objectImpact'; objectA: any; objectB: any; speed: number; damage: number; position: { x: number; z: number } }\n  | { type: 'objectDestroyed'; object: any; position: { x: number; z: number } }\n  | { type: 'objectPitFall'; object: any; position: { x: number; z: number } }\n  | { type: 'obstacleDestroyed'; obstacleIndex: number; position: { x: number; z: number } }\n  | { type: 'bendModeActivated' }\n  | { type: 'bendModeDeactivated' }\n  | { type: 'bendApplied'; bendId: string; targetType: string; targetId: number; position: { x: number; z: number } }\n  | { type: 'bendFailed'; bendId: string; reason: string };\n\n// \u2500\u2500\u2500 Bus Implementation \u2500\u2500\u2500\n\ntype EventType = GameEvent['type'];\ntype ListenerFn = (event: GameEvent) => void;\n\nconst listeners: Map<EventType, Set<ListenerFn>> = new Map();\n\nexport function emit(event: GameEvent): void {\n  const set = listeners.get(event.type);\n  if (!set) return;\n  for (const fn of set) {\n    fn(event);\n  }\n}\n\nexport function on(type: EventType, callback: ListenerFn): void {\n  let set = listeners.get(type);\n  if (!set) {\n    set = new Set();\n    listeners.set(type, set);\n  }\n  set.add(callback);\n}\n\nexport function off(type: EventType, callback: ListenerFn): void {\n  const set = listeners.get(type);\n  if (set) {\n    set.delete(callback);\n  }\n}\n\n// Clear all listeners \u2014 call on game reset if needed\nexport function clearAllListeners(): void {\n  listeners.clear();\n}\n", "import { ENEMY_TYPES, MOB_GLOBAL } from '../config/enemies';\nimport { getCollisionBounds, getPitBounds } from '../config/arena';\nimport { applyAoeEffect } from '../engine/aoeTelegraph';\nimport { getPlayerPos, isPlayerInvincible } from './player';\nimport { screenShake } from '../engine/renderer';\nimport { spawnDamageNumber } from '../ui/damageNumbers';\nimport { fireMortarProjectile, getIceEffects } from './mortarProjectile';\nimport { fireProjectile } from './projectile';\nimport { buildEnemyModel, createHitReaction, triggerHitReaction, updateHitReaction } from './enemyRig';\nimport { emit } from '../engine/events';\n\nlet sceneRef: any;\n\n// Shared shield geometry (created once)\nlet shieldGeo: any;\n\n// Shared mortar fill circle geometry\nlet _mortarFillGeoShared: any = null;\n\n// Shared death telegraph fill geometry\nlet _deathFillGeoShared: any = null;\n\nexport function initEnemySystem(scene: any) {\n  sceneRef = scene;\n}\n\nfunction createShieldMesh(cfg: any) {\n  const shieldCfg = cfg.shield;\n  const radius = cfg.size.radius * 1.8;\n  if (!shieldGeo) shieldGeo = new THREE.SphereGeometry(1, 16, 12); // unit sphere, scaled per enemy\n  const mat = new THREE.MeshStandardMaterial({\n    color: shieldCfg.color || 0x88eeff,\n    emissive: shieldCfg.emissive || 0x44ccff,\n    emissiveIntensity: 0.4,\n    transparent: true,\n    opacity: shieldCfg.opacity || 0.35,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const mesh = new THREE.Mesh(shieldGeo, mat);\n  mesh.scale.set(radius, radius, radius);\n  return mesh;\n}\n\nexport function spawnEnemy(typeName: string, position: any, gameState: any) {\n  const cfg = ENEMY_TYPES[typeName];\n  if (!cfg) return null;\n\n  const group = new THREE.Group();\n\n  // Build distinctive silhouette from primitives\n  const model = buildEnemyModel(typeName, cfg, group);\n  const bodyMesh = model.bodyMesh;\n  const headMesh = model.headMesh;\n\n  group.position.copy(position);\n  sceneRef.add(group);\n\n  const enemy: any = {\n    mesh: group,\n    bodyMesh,\n    headMesh,\n    type: typeName,\n    config: cfg,\n    health: cfg.health,\n    pos: position.clone(),\n    behavior: cfg.behavior,\n    lastAttackTime: 0,\n    flashTimer: 0,\n    stunTimer: 0,\n    // Tank-specific\n    chargeTimer: 0,\n    chargeCooldown: 4000,\n    isCharging: false,\n    chargeDir: new THREE.Vector3(),\n    // Shield\n    shieldHealth: 0,\n    shieldActive: false,\n    shieldMesh: null as any,\n    // Slow debuff\n    slowTimer: 0,\n    slowMult: 1,               // speed multiplier while slowed (e.g., 0.5 = half speed)\n    // Sniper (kite behavior)\n    sniperPhase: 'idle',       // 'idle' | 'telegraphing' | 'cooldown'\n    sniperTimer: 0,\n    sniperAimAngle: 0,         // locked aim direction (radians)\n    sniperAimCenter: { x: 0, z: 0 }, // center of the damage rect\n    // Mortar\n    mortarPhase: 'idle',       // 'idle' | 'aiming' | 'cooldown'\n    mortarTimer: 0,\n    mortarTarget: { x: 0, z: 0 }, // aimed landing position\n    mortarArcLine: null as any,       // THREE.Line for aim arc preview\n    mortarGroundCircle: null as any,  // THREE.Mesh for persistent ground circle\n    // Physics velocity (knockback system)\n    vel: { x: 0, z: 0 },      // knockback velocity \u2014 integrated by applyVelocities()\n    // Pit / edge-slide\n    wasDeflected: false,       // true when movement was deflected by collision (edge-sliding)\n    fellInPit: false,          // true when killed by falling into a pit\n    // Pit leap (goblins)\n    pitEdgeTimer: 0,           // ms spent hugging a pit edge (wasDeflected near pit)\n    isLeaping: false,          // true during arc leap over pit\n    leapElapsed: 0,            // time into leap\n    leapDuration: 0,           // total flight time\n    leapStartX: 0,\n    leapStartZ: 0,\n    leapTargetX: 0,\n    leapTargetZ: 0,\n    leapArcHeight: 0,\n    leapCooldown: 0,           // ms until next leap allowed\n    // Melee attack state machine (for enemies with config.melee)\n    meleePhase: 'idle' as 'idle' | 'telegraph' | 'attacking' | 'recovery',\n    meleeTimer: 0,\n    meleeHasHit: false,       // prevent double-hit per attack cycle\n    // Hit reaction (squash/bounce)\n    hitReaction: createHitReaction(),\n    allMaterials: model.allMaterials,\n  };\n\n  // Initialize shield if config has one\n  if (cfg.shield && cfg.shield.maxHealth > 0) {\n    enemy.shieldHealth = cfg.shield.maxHealth;\n    enemy.shieldActive = true;\n    enemy.shieldMesh = createShieldMesh(cfg);\n    enemy.shieldMesh.position.y = cfg.size.height * 0.5;\n    group.add(enemy.shieldMesh);\n  }\n\n  gameState.enemies.push(enemy);\n  return enemy;\n}\n\nexport function spawnTestGroup(gameState: any) {\n  // Larger group for longer sessions\n  const spawns = [\n    // Goblins \u2014 scattered around arena\n    { type: 'goblin', x: 10, z: 5 },\n    { type: 'goblin', x: -8, z: 7 },\n    { type: 'goblin', x: 5, z: -10 },\n    { type: 'goblin', x: -12, z: -3 },\n    { type: 'goblin', x: 15, z: 0 },\n    { type: 'goblin', x: -5, z: 12 },\n    { type: 'goblin', x: -15, z: 8 },\n    { type: 'goblin', x: 8, z: -15 },\n    { type: 'goblin', x: -3, z: -14 },\n    { type: 'goblin', x: 14, z: 10 },\n    { type: 'goblin', x: -10, z: -10 },\n    { type: 'goblin', x: 16, z: -8 },\n    // Archers \u2014 positioned at range\n    { type: 'skeletonArcher', x: 12, z: 12 },\n    { type: 'skeletonArcher', x: -12, z: -12 },\n    { type: 'skeletonArcher', x: -14, z: 10 },\n    { type: 'skeletonArcher', x: 14, z: -10 },\n    { type: 'skeletonArcher', x: 0, z: -16 },\n    // Mortar Imps \u2014 lobbed AoE\n    { type: 'iceMortarImp', x: 10, z: -14 },\n    { type: 'iceMortarImp', x: -10, z: 14 },\n    { type: 'iceMortarImp', x: -16, z: -10 },\n    // Golems \u2014 fewer but threatening\n    { type: 'stoneGolem', x: 0, z: 15 },\n    { type: 'stoneGolem', x: -15, z: -5 },\n    { type: 'stoneGolem', x: 15, z: -5 },\n  ];\n\n  for (const s of spawns) {\n    spawnEnemy(s.type, new THREE.Vector3(s.x, 0, s.z), gameState);\n  }\n}\n\n// Reusable vector for calculations\nconst _toPlayer = new THREE.Vector3();\n\n// Cached collision bounds (loaded once)\nlet _collisionBounds: any = null;\nlet _pitBoundsCache: any = null;\n\n/**\n * Check if position (x,z) is inside any pit (with margin).\n * Returns the pit AABB if inside, or null.\n */\nfunction pitAt(x: number, z: number, margin: number) {\n  if (!_pitBoundsCache) _pitBoundsCache = getPitBounds();\n  for (const pit of _pitBoundsCache) {\n    if (x > pit.minX - margin && x < pit.maxX + margin &&\n        z > pit.minZ - margin && z < pit.maxZ + margin) {\n      return pit;\n    }\n  }\n  return null;\n}\n\n/**\n * Pit-aware movement: given a desired movement direction (dx, dz \u2014 normalized),\n * check if a lookahead step would enter a pit. If so, deflect the direction\n * sideways (perpendicular to the original direction, choosing the side away\n * from the pit center). Returns adjusted { dx, dz }.\n */\nfunction pitAwareDir(x: number, z: number, dx: number, dz: number, lookahead: number) {\n  const ahead = pitAt(x + dx * lookahead, z + dz * lookahead, 0.5);\n  if (!ahead) return { dx, dz }; // no pit ahead \u2014 go straight\n\n  // Pit center\n  const pcx = (ahead.minX + ahead.maxX) / 2;\n  const pcz = (ahead.minZ + ahead.maxZ) / 2;\n\n  // Two perpendicular options: rotate +/-90deg\n  // Option A: (dz, -dx)   Option B: (-dz, dx)\n  // Pick the one whose lookahead is further from pit center\n  const ax = x + dz * lookahead, az = z + (-dx) * lookahead;\n  const bx = x + (-dz) * lookahead, bz = z + dx * lookahead;\n  const distA = (ax - pcx) * (ax - pcx) + (az - pcz) * (az - pcz);\n  const distB = (bx - pcx) * (bx - pcx) + (bz - pcz) * (bz - pcz);\n\n  // Also verify the chosen strafe doesn't land in another pit\n  if (distA >= distB) {\n    if (!pitAt(ax, az, 0.5)) return { dx: dz, dz: -dx };\n    if (!pitAt(bx, bz, 0.5)) return { dx: -dz, dz: dx };\n  } else {\n    if (!pitAt(bx, bz, 0.5)) return { dx: -dz, dz: dx };\n    if (!pitAt(ax, az, 0.5)) return { dx: dz, dz: -dx };\n  }\n\n  // Both sides blocked \u2014 stop moving (better than walking into a pit)\n  return { dx: 0, dz: 0 };\n}\n\n/**\n * Raycast from (ox, oz) in direction (dx, dz) and find distance to first AABB hit.\n * Returns the distance, or maxDist if nothing is hit.\n * Uses slab method for ray-AABB intersection on the XZ plane.\n */\nfunction raycastTerrainDist(ox: number, oz: number, dx: number, dz: number, maxDist: number) {\n  if (!_collisionBounds) _collisionBounds = getCollisionBounds();\n\n  let closest = maxDist;\n\n  for (const box of _collisionBounds) {\n    // Slab method on X axis\n    let tmin: number, tmax: number;\n    if (Math.abs(dx) < 1e-8) {\n      // Ray parallel to X \u2014 check if origin is within X slab\n      if (ox < box.minX || ox > box.maxX) continue;\n      tmin = -Infinity;\n      tmax = Infinity;\n    } else {\n      const invDx = 1 / dx;\n      let t1 = (box.minX - ox) * invDx;\n      let t2 = (box.maxX - ox) * invDx;\n      if (t1 > t2) { const tmp = t1; t1 = t2; t2 = tmp; }\n      tmin = t1;\n      tmax = t2;\n    }\n\n    // Slab method on Z axis\n    if (Math.abs(dz) < 1e-8) {\n      if (oz < box.minZ || oz > box.maxZ) continue;\n      // tmin/tmax unchanged\n    } else {\n      const invDz = 1 / dz;\n      let t1 = (box.minZ - oz) * invDz;\n      let t2 = (box.maxZ - oz) * invDz;\n      if (t1 > t2) { const tmp = t1; t1 = t2; t2 = tmp; }\n      tmin = Math.max(tmin, t1);\n      tmax = Math.min(tmax, t2);\n    }\n\n    // Check valid intersection\n    if (tmax < 0 || tmin > tmax) continue; // behind ray or no intersection\n    const t = tmin > 0 ? tmin : tmax; // entry point (or exit if starting inside)\n    if (t > 0 && t < closest) {\n      closest = t;\n    }\n  }\n\n  return closest;\n}\n\nexport function updateEnemies(dt: number, playerPos: any, gameState: any) {\n  for (let i = gameState.enemies.length - 1; i >= 0; i--) {\n    const enemy = gameState.enemies[i];\n\n    // Pit leap update \u2014 runs independently of stun (can't stun mid-air)\n    if (enemy.isLeaping) {\n      updateLeap(enemy, dt);\n      // Skip normal behavior/movement but still check death below\n    } else if (enemy.stunTimer > 0) {\n      // Stun check \u2014 stunned enemies cannot move or attack\n      enemy.stunTimer -= dt * 1000;\n    } else {\n      // Behavior dispatch (only when not stunned)\n      switch (enemy.behavior) {\n        case 'rush': behaviorRush(enemy, playerPos, dt, gameState); break;\n        case 'kite': behaviorKite(enemy, playerPos, dt, gameState); break;\n        case 'tank': behaviorTank(enemy, playerPos, dt, gameState); break;\n        case 'mortar': behaviorMortar(enemy, playerPos, dt, gameState); break;\n      }\n    }\n\n    // Arena clamp\n    enemy.pos.x = Math.max(-19, Math.min(19, enemy.pos.x));\n    enemy.pos.z = Math.max(-19, Math.min(19, enemy.pos.z));\n    if (enemy.isLeaping) {\n      // Sync clamped XZ but preserve arc Y set by updateLeap\n      enemy.mesh.position.x = enemy.pos.x;\n      enemy.mesh.position.z = enemy.pos.z;\n    } else {\n      enemy.mesh.position.copy(enemy.pos);\n    }\n\n    // Flash timer (hit feedback)\n    if (enemy.flashTimer > 0) {\n      enemy.flashTimer -= dt * 1000;\n      if (enemy.flashTimer <= 0) {\n        enemy.bodyMesh.material.emissive.setHex(enemy.config.emissive);\n        if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(enemy.config.emissive);\n      }\n    }\n\n    // Hit reaction (squash/bounce)\n    if (enemy.hitReaction && enemy.hitReaction.active) {\n      updateHitReaction(enemy.hitReaction, enemy.mesh, dt);\n    }\n\n    // Slow debuff timer\n    if (enemy.slowTimer > 0) {\n      enemy.slowTimer -= dt * 1000;\n      if (enemy.slowTimer <= 0) {\n        enemy.slowTimer = 0;\n        enemy.slowMult = 1;\n      }\n    }\n\n    // Shield durability visual feedback\n    if (enemy.shieldActive && enemy.shieldMesh) {\n      const shieldCfg = enemy.config.shield;\n      const ratio = enemy.shieldHealth / shieldCfg.maxHealth; // 1.0 = full, 0.0 = broken\n\n      const baseOpacity = shieldCfg.opacity || 0.35;\n\n      // Opacity fades as shield depletes\n      let opacity = baseOpacity * (0.3 + 0.7 * ratio); // never fully invisible while active\n\n      // Color shifts cyan -> red as shield weakens\n      const r = Math.round(0x44 + (0xff - 0x44) * (1 - ratio));\n      const g = Math.round(0xcc * ratio);\n      const b = Math.round(0xff * ratio);\n      enemy.shieldMesh.material.emissive.setRGB(r / 255, g / 255, b / 255);\n\n      // Flicker when below 25%\n      if (ratio < 0.25) {\n        const flicker = 0.5 + 0.5 * Math.sin(performance.now() * 0.06); // ~10Hz\n        opacity *= (0.5 + 0.5 * flicker);\n      } else {\n        // Gentle pulse when healthy\n        opacity += 0.05 * Math.sin(performance.now() * 0.003);\n      }\n\n      enemy.shieldMesh.material.opacity = Math.max(0.05, opacity);\n    }\n\n    // Death telegraph countdown (golem detonation delay)\n    if (enemy.deathTimer > 0) {\n      enemy.deathTimer -= dt * 1000;\n      updateDeathTelegraph(enemy, dt);\n\n      // Sync mesh position (enemy can be pushed by Force Push during telegraph)\n      enemy.mesh.position.copy(enemy.pos);\n\n      // If pushed into a pit during telegraph, cancel explosion and remove immediately\n      if (enemy.fellInPit) {\n        removeDeathTelegraph(enemy);\n        if (enemy.shieldMesh) {\n          enemy.shieldMesh.geometry.dispose();\n          enemy.shieldMesh.material.dispose();\n        }\n        removeMortarArcLine(enemy);\n        removeMortarGroundCircle(enemy);\n        sceneRef.remove(enemy.mesh);\n        gameState.enemies.splice(i, 1);\n        const drops = enemy.config.drops;\n        gameState.currency += Math.floor(\n          drops.currency.min + Math.random() * (drops.currency.max - drops.currency.min + 1)\n        );\n        continue;\n      }\n\n      if (enemy.deathTimer <= 0) {\n        // Telegraph expired \u2014 detonate at CURRENT position (may have been pushed)\n        if (enemy.config.deathExplosion && !enemy.fellInPit) {\n          onDeathExplosion(enemy, gameState);\n        }\n        removeDeathTelegraph(enemy);\n\n        // Clean up shield mesh\n        if (enemy.shieldMesh) {\n          enemy.shieldMesh.geometry.dispose();\n          enemy.shieldMesh.material.dispose();\n        }\n        removeMortarArcLine(enemy);\n        removeMortarGroundCircle(enemy);\n        sceneRef.remove(enemy.mesh);\n        gameState.enemies.splice(i, 1);\n        const drops = enemy.config.drops;\n        gameState.currency += Math.floor(\n          drops.currency.min + Math.random() * (drops.currency.max - drops.currency.min + 1)\n        );\n      }\n      continue; // Skip normal death check while telegraph is active\n    }\n\n    // Death\n    if (enemy.health <= 0) {\n      const deathCfg = enemy.config.deathExplosion;\n\n      // If this enemy has a telegraph duration, defer the explosion\n      if (deathCfg && deathCfg.telegraphDuration && !enemy.fellInPit) {\n        enemy.deathTimer = deathCfg.telegraphDuration;\n        enemy.stunTimer = deathCfg.telegraphDuration + 100; // keep stunned through telegraph\n        createDeathTelegraph(enemy);\n        continue;\n      }\n\n      // Immediate death (no telegraph) \u2014 AoE damage to nearby units (skip if fell in pit)\n      if (deathCfg && !enemy.fellInPit) {\n        onDeathExplosion(enemy, gameState);\n      }\n\n      emit({ type: 'enemyDied', enemy, position: { x: enemy.pos.x, z: enemy.pos.z } });\n\n      // Clean up shield mesh\n      if (enemy.shieldMesh) {\n        enemy.shieldMesh.geometry.dispose();\n        enemy.shieldMesh.material.dispose();\n      }\n      // Clean up mortar visuals\n      removeMortarArcLine(enemy);\n      removeMortarGroundCircle(enemy);\n      sceneRef.remove(enemy.mesh);\n      gameState.enemies.splice(i, 1);\n      // Currency drop\n      const drops = enemy.config.drops;\n      gameState.currency += Math.floor(\n        drops.currency.min + Math.random() * (drops.currency.max - drops.currency.min + 1)\n      );\n    }\n  }\n}\n\n// \u2500\u2500\u2500 Enemy Melee State Machine \u2500\u2500\u2500\n// Shared telegraph \u2192 attack \u2192 recovery flow for enemies with config.melee\n\nfunction startEnemyMelee(enemy: any) {\n  const meleeCfg = enemy.config.melee;\n  if (!meleeCfg) return;\n  const telegraphDur = meleeCfg.telegraphDuration * MOB_GLOBAL.telegraphMult;\n  enemy.meleePhase = 'telegraph';\n  enemy.meleeTimer = telegraphDur;\n  enemy.meleeHasHit = false;\n  // Flash emissive to signal telegraph\n  enemy.flashTimer = telegraphDur;\n  enemy.bodyMesh.material.emissive.setHex(0xffaa00);\n  if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(0xffaa00);\n\n  // Emit telegraph event for ground arc decal\n  emit({\n    type: 'enemyMeleeTelegraph',\n    position: { x: enemy.pos.x, z: enemy.pos.z },\n    facingAngle: enemy.mesh.rotation.y,\n    hitArc: meleeCfg.hitArc,\n    hitRange: meleeCfg.hitRange,\n    duration: telegraphDur + meleeCfg.attackDuration,  // visible through telegraph + attack\n  });\n}\n\nfunction updateEnemyMelee(enemy: any, dt: number, playerPos: any, gameState: any) {\n  const meleeCfg = enemy.config.melee;\n  if (!meleeCfg || enemy.meleePhase === 'idle') return;\n\n  enemy.meleeTimer -= dt * 1000;\n\n  if (enemy.meleePhase === 'telegraph') {\n    // Pulsing emissive during telegraph\n    const pulse = 0.5 + 0.5 * Math.sin(performance.now() * 0.015);\n    const r = Math.floor(0xff * pulse);\n    const g = Math.floor(0xaa * pulse);\n    enemy.bodyMesh.material.emissive.setRGB(r / 255, g / 255, 0);\n    if (enemy.headMesh) enemy.headMesh.material.emissive.setRGB(r / 255, g / 255, 0);\n\n    if (enemy.meleeTimer <= 0) {\n      // Transition to attacking\n      enemy.meleePhase = 'attacking';\n      enemy.meleeTimer = meleeCfg.attackDuration;\n\n      // Lunge toward player if configured\n      if (meleeCfg.lungeDistance) {\n        _toPlayer.subVectors(playerPos, enemy.pos);\n        _toPlayer.y = 0;\n        const dist = _toPlayer.length();\n        if (dist > 0.1) {\n          _toPlayer.normalize();\n          enemy.pos.x += _toPlayer.x * meleeCfg.lungeDistance;\n          enemy.pos.z += _toPlayer.z * meleeCfg.lungeDistance;\n        }\n      }\n\n      // Bright flash on attack\n      enemy.bodyMesh.material.emissive.setHex(0xff4400);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(0xff4400);\n    }\n  } else if (enemy.meleePhase === 'attacking') {\n    // Check if player is in hit arc/range (once per attack)\n    if (!enemy.meleeHasHit) {\n      const dx = playerPos.x - enemy.pos.x;\n      const dz = playerPos.z - enemy.pos.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n\n      if (dist < meleeCfg.hitRange && !isPlayerInvincible()) {\n        // Check arc\n        const angleToPlayer = Math.atan2(-dx, -dz);\n        const facingAngle = enemy.mesh.rotation.y;\n        let angleDiff = angleToPlayer - facingAngle;\n        while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n        while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n\n        if (Math.abs(angleDiff) <= meleeCfg.hitArc / 2) {\n          // Hit the player!\n          const dmg = meleeCfg.damage * MOB_GLOBAL.damageMult;\n          gameState.playerHealth -= dmg;\n          enemy.meleeHasHit = true;\n          screenShake(3, 120);\n          emit({ type: 'playerHit', damage: dmg, position: { x: playerPos.x, z: playerPos.z } });\n          spawnDamageNumber(playerPos.x, playerPos.z, Math.round(dmg), '#ff4466');\n\n          if (gameState.playerHealth <= 0) {\n            gameState.playerHealth = 0;\n            gameState.phase = 'gameOver';\n          }\n        }\n      }\n    }\n\n    if (enemy.meleeTimer <= 0) {\n      // Transition to recovery\n      enemy.meleePhase = 'recovery';\n      enemy.meleeTimer = meleeCfg.recoveryDuration * MOB_GLOBAL.recoveryMult;\n      // Dim emissive during recovery \u2014 punish window\n      enemy.bodyMesh.material.emissive.setHex(0x222222);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(0x222222);\n    }\n  } else if (enemy.meleePhase === 'recovery') {\n    if (enemy.meleeTimer <= 0) {\n      // Back to idle\n      enemy.meleePhase = 'idle';\n      enemy.lastAttackTime = performance.now();\n      // Restore normal emissive\n      enemy.bodyMesh.material.emissive.setHex(enemy.config.emissive);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(enemy.config.emissive);\n    }\n  }\n}\n\nfunction behaviorRush(enemy: any, playerPos: any, dt: number, gameState: any) {\n  // Skip normal movement during leap (handled by updateLeap)\n  if (enemy.isLeaping) return;\n\n  // If in melee attack cycle, update that and skip movement\n  if (enemy.meleePhase !== 'idle') {\n    updateEnemyMelee(enemy, dt, playerPos, gameState);\n    return;\n  }\n\n  _toPlayer.subVectors(playerPos, enemy.pos);\n  _toPlayer.y = 0;\n  const dist = _toPlayer.length();\n\n  const stopDist = (enemy.config.rush && enemy.config.rush.stopDistance) || 0.5;\n\n  // Check if close enough to start a melee attack\n  const meleeCfg = enemy.config.melee;\n  if (meleeCfg && dist <= meleeCfg.hitRange) {\n    const now = performance.now();\n    if (now - enemy.lastAttackTime > enemy.config.attackRate) {\n      startEnemyMelee(enemy);\n      return;\n    }\n  }\n\n  if (dist > stopDist) {\n    _toPlayer.normalize();\n    const slideBoost = enemy.wasDeflected ? 1.175 : 1.0;\n    const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n    const speed = enemy.config.speed * MOB_GLOBAL.speedMult * (enemy.slowTimer > 0 ? enemy.slowMult : 1) * slideBoost * iceEffects.speedMult;\n    enemy.pos.x += _toPlayer.x * speed * dt;\n    enemy.pos.z += _toPlayer.z * speed * dt;\n  }\n\n  // Face player\n  if (dist > 0.1) {\n    enemy.mesh.rotation.y = Math.atan2(-_toPlayer.x, -_toPlayer.z);\n  }\n\n  // --- Pit leap detection ---\n  const leapCfg = enemy.config.pitLeap;\n  if (!leapCfg) return;\n\n  // Tick cooldown\n  if (enemy.leapCooldown > 0) {\n    enemy.leapCooldown -= dt * 1000;\n    enemy.pitEdgeTimer = 0;\n    return;\n  }\n\n  // Track time spent hugging a pit edge\n  if (enemy.wasDeflected && pitAt(enemy.pos.x, enemy.pos.z, 1.0)) {\n    enemy.pitEdgeTimer += dt * 1000;\n  } else {\n    enemy.pitEdgeTimer = 0;\n  }\n\n  // Trigger leap after hugging long enough\n  if (enemy.pitEdgeTimer >= leapCfg.edgeTimeRequired) {\n    startPitLeap(enemy, playerPos, leapCfg);\n  }\n}\n\n// --- Pit Leap (goblin arc jump over pits) ---\n\nfunction startPitLeap(enemy: any, playerPos: any, leapCfg: any) {\n  // Direction toward player\n  const dx = playerPos.x - enemy.pos.x;\n  const dz = playerPos.z - enemy.pos.z;\n  const dist = Math.sqrt(dx * dx + dz * dz);\n  if (dist < 0.1) return; // too close, skip\n\n  const dirX = dx / dist;\n  const dirZ = dz / dist;\n\n  // Find how far we need to leap to clear the pit ahead\n  // Scan forward in small steps to find where the pit ends\n  let leapDist = 3; // minimum leap distance\n  for (let probe = 1; probe <= 15; probe += 0.5) {\n    const px = enemy.pos.x + dirX * probe;\n    const pz = enemy.pos.z + dirZ * probe;\n    if (!pitAt(px, pz, 0.3)) {\n      leapDist = probe + 1; // overshoot by 1 unit to land clear\n      break;\n    }\n    leapDist = probe + 1;\n  }\n\n  // Cap the leap distance\n  leapDist = Math.min(leapDist, 12);\n\n  enemy.isLeaping = true;\n  enemy.leapStartX = enemy.pos.x;\n  enemy.leapStartZ = enemy.pos.z;\n  enemy.leapTargetX = enemy.pos.x + dirX * leapDist;\n  enemy.leapTargetZ = enemy.pos.z + dirZ * leapDist;\n  enemy.leapArcHeight = leapCfg.arcHeight || 3;\n  enemy.leapElapsed = 0;\n  enemy.pitEdgeTimer = 0;\n\n  // Flight time based on distance and speed\n  const flightDist = leapDist + 2 * enemy.leapArcHeight * enemy.leapArcHeight / Math.max(leapDist, 0.1);\n  enemy.leapDuration = flightDist / (leapCfg.leapSpeed || 12);\n\n}\n\nfunction updateLeap(enemy: any, dt: number) {\n  enemy.leapElapsed += dt;\n  const t = Math.min(enemy.leapElapsed / enemy.leapDuration, 1);\n\n  // Interpolate XZ position linearly\n  enemy.pos.x = enemy.leapStartX + (enemy.leapTargetX - enemy.leapStartX) * t;\n  enemy.pos.z = enemy.leapStartZ + (enemy.leapTargetZ - enemy.leapStartZ) * t;\n\n  // Parabolic arc for Y (visual only)\n  const arcY = 4 * enemy.leapArcHeight * t * (1 - t);\n  enemy.mesh.position.set(enemy.pos.x, arcY, enemy.pos.z);\n\n  // Face direction of travel\n  const dx = enemy.leapTargetX - enemy.leapStartX;\n  const dz = enemy.leapTargetZ - enemy.leapStartZ;\n  if (dx * dx + dz * dz > 0.01) {\n    enemy.mesh.rotation.y = Math.atan2(-dx, -dz);\n  }\n\n  // Landing\n  if (t >= 1) {\n    enemy.isLeaping = false;\n    enemy.leapCooldown = (enemy.config.pitLeap && enemy.config.pitLeap.cooldown) || 4000;\n    // Snap mesh back to ground\n    enemy.mesh.position.set(enemy.pos.x, 0, enemy.pos.z);\n  }\n}\n\nfunction behaviorKite(enemy: any, playerPos: any, dt: number, gameState: any) {\n  _toPlayer.subVectors(playerPos, enemy.pos);\n  _toPlayer.y = 0;\n  const dist = _toPlayer.length();\n  const kite = enemy.config.kite || {};\n  const sniper = enemy.config.sniper || {};\n  const preferredRange = enemy.config.attackRange * (kite.preferredRangeMult || 0.7);\n\n  const isTelegraphing = enemy.sniperPhase === 'telegraphing';\n\n  // Movement: maintain preferred range (freeze during telegraph \u2014 lining up the shot)\n  if (!isTelegraphing) {\n    const slideBoost = enemy.wasDeflected ? 1.175 : 1.0;\n    const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n    const speed = enemy.config.speed * MOB_GLOBAL.speedMult * (enemy.slowTimer > 0 ? enemy.slowMult : 1) * slideBoost * iceEffects.speedMult;\n    if (dist < preferredRange - (kite.retreatBuffer || 1)) {\n      // Too close \u2014 retreat (pit-aware)\n      _toPlayer.normalize();\n      const retreat = pitAwareDir(enemy.pos.x, enemy.pos.z, -_toPlayer.x, -_toPlayer.z, 2.5);\n      enemy.pos.x += retreat.dx * speed * dt;\n      enemy.pos.z += retreat.dz * speed * dt;\n    } else if (dist > preferredRange + (kite.advanceBuffer || 3)) {\n      // Too far \u2014 approach (pit-aware)\n      _toPlayer.normalize();\n      const advance = pitAwareDir(enemy.pos.x, enemy.pos.z, _toPlayer.x, _toPlayer.z, 2.5);\n      enemy.pos.x += advance.dx * speed * dt;\n      enemy.pos.z += advance.dz * speed * dt;\n    }\n  }\n\n  // Always face player (or locked aim direction during telegraph)\n  if (isTelegraphing) {\n    enemy.mesh.rotation.y = enemy.sniperAimAngle + Math.PI;\n  } else if (dist > 0.1) {\n    const nx = _toPlayer.x / dist;\n    const nz = _toPlayer.z / dist;\n    enemy.mesh.rotation.y = Math.atan2(-nx, -nz);\n  }\n\n  // Sniper attack logic\n  const now = performance.now();\n\n  if (enemy.sniperPhase === 'idle') {\n    // Check if ready to fire\n    if (dist < enemy.config.attackRange && now - enemy.lastAttackTime > enemy.config.attackRate) {\n      // Lock aim and begin telegraph\n      enemy.sniperPhase = 'telegraphing';\n      enemy.sniperTimer = (sniper.telegraphDuration || 800) * MOB_GLOBAL.telegraphMult;\n\n      // Calculate aim direction\n      const aimAngle = Math.atan2(playerPos.x - enemy.pos.x, playerPos.z - enemy.pos.z);\n      enemy.sniperAimAngle = aimAngle;\n\n      // Flash emissive to signal telegraph start\n      enemy.flashTimer = enemy.sniperTimer;\n      enemy.bodyMesh.material.emissive.setHex(sniper.color || 0xaa44ff);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(sniper.color || 0xaa44ff);\n    }\n  } else if (enemy.sniperPhase === 'telegraphing') {\n    // Count down telegraph timer\n    enemy.sniperTimer -= dt * 1000;\n\n    // Pulsing emissive during telegraph\n    const pulse = 0.5 + 0.5 * Math.sin(performance.now() * 0.012);\n    const c = sniper.color || 0xaa44ff;\n    const r = ((c >> 16) & 0xff) / 255;\n    const g = ((c >> 8) & 0xff) / 255;\n    const b = (c & 0xff) / 255;\n    enemy.bodyMesh.material.emissive.setRGB(r * pulse, g * pulse, b * pulse);\n    if (enemy.headMesh) enemy.headMesh.material.emissive.setRGB(r * pulse, g * pulse, b * pulse);\n\n    if (enemy.sniperTimer <= 0) {\n      // Fire a real projectile in the locked aim direction\n      enemy.sniperPhase = 'idle';\n      enemy.lastAttackTime = now;\n\n      const dirX = Math.sin(enemy.sniperAimAngle);\n      const dirZ = Math.cos(enemy.sniperAimAngle);\n      const origin = { x: enemy.pos.x, y: 0.5, z: enemy.pos.z };\n      const direction = { x: dirX, y: 0, z: dirZ };\n      const projConfig = {\n        speed: 12,\n        damage: (sniper.damage || 15) * MOB_GLOBAL.damageMult,\n        color: sniper.color || 0xaa44ff,\n      };\n      fireProjectile(origin, direction, projConfig, true);\n\n      // Restore emissive\n      enemy.bodyMesh.material.emissive.setHex(enemy.config.emissive);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(enemy.config.emissive);\n    }\n  }\n}\n\n\nfunction behaviorMortar(enemy: any, playerPos: any, dt: number, gameState: any) {\n  _toPlayer.subVectors(playerPos, enemy.pos);\n  _toPlayer.y = 0;\n  const dist = _toPlayer.length();\n  const kite = enemy.config.kite || {};\n  const mortar = enemy.config.mortar || {};\n  const preferredRange = enemy.config.attackRange * (kite.preferredRangeMult || 0.65);\n\n  const isAiming = enemy.mortarPhase === 'aiming';\n\n  // Movement: kite like an archer (freeze during aim to line up the shot, pit-aware)\n  if (!isAiming) {\n    const slideBoost = enemy.wasDeflected ? 1.175 : 1.0;\n    const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n    const speed = enemy.config.speed * MOB_GLOBAL.speedMult * (enemy.slowTimer > 0 ? enemy.slowMult : 1) * slideBoost * iceEffects.speedMult;\n    if (dist < preferredRange - (kite.retreatBuffer || 1.5)) {\n      _toPlayer.normalize();\n      const retreat = pitAwareDir(enemy.pos.x, enemy.pos.z, -_toPlayer.x, -_toPlayer.z, 2.5);\n      enemy.pos.x += retreat.dx * speed * dt;\n      enemy.pos.z += retreat.dz * speed * dt;\n    } else if (dist > preferredRange + (kite.advanceBuffer || 3)) {\n      _toPlayer.normalize();\n      const advance = pitAwareDir(enemy.pos.x, enemy.pos.z, _toPlayer.x, _toPlayer.z, 2.5);\n      enemy.pos.x += advance.dx * speed * dt;\n      enemy.pos.z += advance.dz * speed * dt;\n    }\n  }\n\n  // Face player (or target during aim)\n  if (isAiming) {\n    const dx = enemy.mortarTarget.x - enemy.pos.x;\n    const dz = enemy.mortarTarget.z - enemy.pos.z;\n    if (Math.abs(dx) > 0.01 || Math.abs(dz) > 0.01) {\n      enemy.mesh.rotation.y = Math.atan2(-dx, -dz);\n    }\n  } else if (dist > 0.1) {\n    const nx = _toPlayer.x / dist;\n    const nz = _toPlayer.z / dist;\n    enemy.mesh.rotation.y = Math.atan2(-nx, -nz);\n  }\n\n  // Mortar attack logic\n  const now = performance.now();\n\n  if (enemy.mortarPhase === 'idle') {\n    if (dist < enemy.config.attackRange && now - enemy.lastAttackTime > enemy.config.attackRate) {\n      // Start aim phase \u2014 pick a target near the player\n      enemy.mortarPhase = 'aiming';\n      enemy.mortarTimer = mortar.aimDuration || 1200;\n\n      // Target = player position + random inaccuracy offset\n      const inaccuracy = mortar.inaccuracy || 1.5;\n      const angle = Math.random() * Math.PI * 2;\n      enemy.mortarTarget.x = playerPos.x + Math.cos(angle) * Math.random() * inaccuracy;\n      enemy.mortarTarget.z = playerPos.z + Math.sin(angle) * Math.random() * inaccuracy;\n\n      // Clamp target to arena\n      enemy.mortarTarget.x = Math.max(-19, Math.min(19, enemy.mortarTarget.x));\n      enemy.mortarTarget.z = Math.max(-19, Math.min(19, enemy.mortarTarget.z));\n\n      // Flash emissive to signal aim start\n      enemy.flashTimer = mortar.aimDuration || 1200;\n      enemy.bodyMesh.material.emissive.setHex(mortar.color || 0xff6622);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(mortar.color || 0xff6622);\n\n      // Create aim arc line preview\n      createMortarArcLine(enemy);\n\n      // Create persistent ground circle at landing point (stays through aim + flight)\n      createMortarGroundCircle(enemy);\n    }\n  } else if (enemy.mortarPhase === 'aiming') {\n    enemy.mortarTimer -= dt * 1000;\n\n    // Update arc line visual each frame\n    updateMortarArcLine(enemy);\n\n    // Pulse the ground circle during aim phase (stays at or above 0.3 opacity)\n    if (enemy.mortarGroundCircle) {\n      const gc = enemy.mortarGroundCircle;\n      const aimDuration = mortar.aimDuration || 1200;\n      const aimProgress = 1 - (enemy.mortarTimer / aimDuration); // 0->1 over aim phase\n\n      // Scale-in animation: circleStartScale -> 1.0 over circleScaleTime (easeOutQuad)\n      gc.scaleElapsed += dt;\n      const scaleT = Math.min(gc.scaleElapsed / gc.scaleDuration, 1);\n      const eased = 1 - (1 - scaleT) * (1 - scaleT); // easeOutQuad\n      const startS = gc.circleStartScale;\n      const s = gc.targetRadius * (startS + (1 - startS) * eased);\n      gc.group.scale.set(s, s, s);\n\n      // Ring: pulse between 0.3 and 0.5, accelerating pulse rate as aim progresses\n      const freq = 0.004 + 0.008 * aimProgress; // pulse speeds up\n      const pulse = 0.85 + 0.15 * Math.sin(performance.now() * freq);\n      gc.ringMat.opacity = (0.3 + 0.15 * aimProgress) * pulse;\n      gc.fillMat.opacity = 0.08 + 0.04 * aimProgress;\n    }\n\n    if (enemy.mortarTimer <= 0) {\n      // Fire the mortar projectile!\n      enemy.mortarPhase = 'idle';\n      enemy.lastAttackTime = now;\n\n      // Remove aim arc line\n      removeMortarArcLine(enemy);\n\n      // Hand the ground circle to the projectile (it persists during flight)\n      const groundCircle = enemy.mortarGroundCircle;\n      enemy.mortarGroundCircle = null;\n\n      // Launch the projectile along the arc\n      fireMortarProjectile({\n        startX: enemy.pos.x,\n        startZ: enemy.pos.z,\n        targetX: enemy.mortarTarget.x,\n        targetZ: enemy.mortarTarget.z,\n        arcHeight: mortar.arcHeight || 6,\n        speed: mortar.projectileSpeed || 8,\n        color: mortar.color || 0xff6622,\n        blastRadius: mortar.blastRadius || 2.5,\n        damage: mortar.damage || 18,\n        slowDuration: mortar.slowDuration || 800,\n        slowMult: mortar.slowMult || 0.6,\n        explosionDuration: mortar.explosionDuration || 300,\n        icePatch: mortar.icePatch || null,\n        gameState,\n        sourceEnemy: enemy,\n        groundCircle,\n      });\n    }\n  }\n}\n\n// --- Mortar arc line helpers ---\n\nconst ARC_SEGMENTS = 20;\nlet _arcLineGeo: any = null;\n\nfunction createMortarArcLine(enemy: any) {\n  if (!_arcLineGeo) {\n    const positions = new Float32Array((ARC_SEGMENTS + 1) * 3);\n    _arcLineGeo = new THREE.BufferGeometry();\n    _arcLineGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n  }\n\n  // Clone geometry so each enemy gets its own buffer\n  const geo = _arcLineGeo.clone();\n  geo.setAttribute('position', new THREE.BufferAttribute(\n    new Float32Array((ARC_SEGMENTS + 1) * 3), 3\n  ));\n\n  const mat = new THREE.LineBasicMaterial({\n    color: enemy.config.mortar?.color || 0xff6622,\n    transparent: true,\n    opacity: 0.6,\n    depthWrite: false,\n  });\n\n  const line = new THREE.Line(geo, mat);\n  sceneRef.add(line);\n  enemy.mortarArcLine = line;\n\n  updateMortarArcLine(enemy);\n}\n\nfunction updateMortarArcLine(enemy: any) {\n  if (!enemy.mortarArcLine) return;\n  const mortar = enemy.config.mortar || {};\n  const sx = enemy.pos.x;\n  const sz = enemy.pos.z;\n  const tx = enemy.mortarTarget.x;\n  const tz = enemy.mortarTarget.z;\n  const arcH = mortar.arcHeight || 6;\n  const startY = 0.8; // launch from body height\n\n  const positions = enemy.mortarArcLine.geometry.attributes.position.array;\n  for (let i = 0; i <= ARC_SEGMENTS; i++) {\n    const t = i / ARC_SEGMENTS;\n    const x = sx + (tx - sx) * t;\n    const z = sz + (tz - sz) * t;\n    // Parabolic arc: y = startY + 4*arcH*t*(1-t) gives a nice arc peaking at arcH\n    const y = startY + 4 * arcH * t * (1 - t);\n    positions[i * 3] = x;\n    positions[i * 3 + 1] = y;\n    positions[i * 3 + 2] = z;\n  }\n  enemy.mortarArcLine.geometry.attributes.position.needsUpdate = true;\n\n  // Pulse opacity for telegraph effect\n  const pulse = 0.3 + 0.3 * Math.sin(performance.now() * 0.008);\n  enemy.mortarArcLine.material.opacity = pulse;\n}\n\nfunction removeMortarArcLine(enemy: any) {\n  if (enemy.mortarArcLine) {\n    enemy.mortarArcLine.geometry.dispose();\n    enemy.mortarArcLine.material.dispose();\n    sceneRef.remove(enemy.mortarArcLine);\n    enemy.mortarArcLine = null;\n  }\n}\n\n// --- Mortar ground circle (persistent through aim + flight) ---\n\nlet _circleGeo: any = null;\n\nfunction createMortarGroundCircle(enemy: any) {\n  const mortar = enemy.config.mortar || {};\n  const radius = mortar.blastRadius || 2.5;\n  const color = mortar.color || 0xff6622;\n\n  // Shared ring geometry (unit scale, scaled per instance)\n  if (!_circleGeo) {\n    _circleGeo = new THREE.RingGeometry(0.85, 1.0, 32);\n    _circleGeo.rotateX(-Math.PI / 2);\n  }\n\n  // Ring outline\n  const ringMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.3,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const ringMesh = new THREE.Mesh(_circleGeo, ringMat);\n\n  // Filled disc for area indication (shared geometry)\n  if (!_mortarFillGeoShared) {\n    _mortarFillGeoShared = new THREE.CircleGeometry(1, 32);\n    _mortarFillGeoShared.rotateX(-Math.PI / 2);\n  }\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.08,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const fillMesh = new THREE.Mesh(_mortarFillGeoShared, fillMat);\n\n  const group = new THREE.Group();\n  group.add(ringMesh);\n  group.add(fillMesh);\n  group.position.set(enemy.mortarTarget.x, 0.05, enemy.mortarTarget.z);\n  const circleStartScale = mortar.circleStartScale || 0.25;\n  const startScale = radius * circleStartScale;\n  group.scale.set(startScale, startScale, startScale);\n  sceneRef.add(group);\n\n  enemy.mortarGroundCircle = {\n    group,\n    ringMat,\n    fillMat,\n    color,\n    targetRadius: radius,\n    circleStartScale,\n    scaleElapsed: 0,                              // tracks time for scale-in animation\n    scaleDuration: (mortar.circleScaleTime || 200) / 1000, // convert ms -> seconds\n  };\n}\n\nfunction removeMortarGroundCircle(enemy: any) {\n  if (enemy.mortarGroundCircle) {\n    const gc = enemy.mortarGroundCircle;\n    gc.ringMat.dispose();\n    gc.fillMat.dispose();\n    // geometry is shared \u2014 don't dispose\n    sceneRef.remove(gc.group);\n    enemy.mortarGroundCircle = null;\n  }\n}\n\n// --- Death telegraph circle (expanding ring before golem explosion) ---\n\nlet _deathCircleGeo: any = null;\n\nfunction createDeathTelegraph(enemy: any) {\n  const cfg = enemy.config.deathExplosion;\n  const radius = cfg.radius;\n  const color = cfg.color;\n\n  // Shared ring geometry (unit scale)\n  if (!_deathCircleGeo) {\n    _deathCircleGeo = new THREE.RingGeometry(0.85, 1.0, 32);\n    _deathCircleGeo.rotateX(-Math.PI / 2);\n  }\n\n  // Ring outline\n  const ringMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.5,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const ringMesh = new THREE.Mesh(_deathCircleGeo, ringMat);\n\n  // Filled disc (shared geometry)\n  if (!_deathFillGeoShared) {\n    _deathFillGeoShared = new THREE.CircleGeometry(1, 32);\n    _deathFillGeoShared.rotateX(-Math.PI / 2);\n  }\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.12,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const fillMesh = new THREE.Mesh(_deathFillGeoShared, fillMat);\n\n  const group = new THREE.Group();\n  group.add(ringMesh);\n  group.add(fillMesh);\n  group.position.set(enemy.pos.x, 0.05, enemy.pos.z);\n  // Start tiny, will scale up\n  group.scale.set(0.1, 0.1, 0.1);\n  sceneRef.add(group);\n\n  enemy.deathTelegraph = {\n    group,\n    ringMat,\n    fillMat,\n    targetRadius: radius,\n  };\n}\n\nfunction updateDeathTelegraph(enemy: any, _dt: number) {\n  const tg = enemy.deathTelegraph;\n  if (!tg) return;\n\n  const cfg = enemy.config.deathExplosion;\n  const duration = (cfg.telegraphDuration || 200) / 1000;\n  const elapsed = (cfg.telegraphDuration - enemy.deathTimer) / 1000;\n  const t = Math.min(elapsed / duration, 1);\n\n  // Scale from tiny to target radius\n  const scale = tg.targetRadius * t;\n  tg.group.scale.set(scale, scale, scale);\n\n  // Follow the enemy position (can be pushed)\n  tg.group.position.set(enemy.pos.x, 0.05, enemy.pos.z);\n\n  // Pulsing opacity on ring\n  const pulse = 0.5 + 0.3 * Math.sin(performance.now() * 0.02);\n  tg.ringMat.opacity = pulse;\n  tg.fillMat.opacity = 0.12 + 0.08 * t;\n}\n\nfunction removeDeathTelegraph(enemy: any) {\n  const tg = enemy.deathTelegraph;\n  if (!tg) return;\n  tg.ringMat.dispose();\n  tg.fillMat.dispose();\n  // geometry is shared \u2014 don't dispose\n  sceneRef.remove(tg.group);\n  enemy.deathTelegraph = null;\n}\n\n// --- Death explosion (crystal golem etc.) ---\n\nfunction onDeathExplosion(enemy: any, gameState: any) {\n  const cfg = enemy.config.deathExplosion;\n  const x = enemy.pos.x;\n  const z = enemy.pos.z;\n\n  // Screen shake\n  screenShake(5, 250);\n\n  // Show \"BOOM\" text on dying enemy\n  const colorStr = '#' + cfg.color.toString(16).padStart(6, '0');\n  spawnDamageNumber(x, z, 'BOOM', colorStr);\n\n  // AoE effect \u2014 damages nearby enemies with cascade visual\n  applyAoeEffect({\n    x,\n    z,\n    radius: cfg.radius,\n    durationMs: cfg.ringDuration || 400,\n    color: cfg.color,\n    label: cfg.damage + '',\n    effectFn: (e: any) => {\n      e.health -= cfg.damage;\n      if (cfg.stunDuration > 0) {\n        stunEnemy(e, cfg.stunDuration);\n      }\n    },\n    gameState,\n    excludeEnemy: enemy, // exclude the dying enemy itself\n  });\n\n  // Check player damage\n  const pp = getPlayerPos();\n  const pdx = pp.x - x;\n  const pdz = pp.z - z;\n  const playerDist = Math.sqrt(pdx * pdx + pdz * pdz);\n  if (playerDist < cfg.radius && !isPlayerInvincible()) {\n    gameState.playerHealth -= cfg.damage;\n    screenShake(4, 200);\n    spawnDamageNumber(pp.x, pp.z, cfg.damage, '#ff4466');\n    if (gameState.playerHealth <= 0) {\n      gameState.playerHealth = 0;\n      gameState.phase = 'gameOver';\n    }\n  }\n}\n\nfunction behaviorTank(enemy: any, playerPos: any, dt: number, gameState: any) {\n  const tank = enemy.config.tank || {};\n  _toPlayer.subVectors(playerPos, enemy.pos);\n  _toPlayer.y = 0;\n  const dist = _toPlayer.length();\n\n  // If in melee attack cycle, update that and skip movement\n  if (enemy.meleePhase !== 'idle') {\n    updateEnemyMelee(enemy, dt, playerPos, gameState);\n    return;\n  }\n\n  const slowFactor = enemy.slowTimer > 0 ? enemy.slowMult : 1;\n  const slideBoost = enemy.wasDeflected ? 1.175 : 1.0;\n  const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n  const baseSpeed = enemy.config.speed * MOB_GLOBAL.speedMult;\n\n  if (enemy.isCharging) {\n    // Charge forward at multiplied speed\n    const speedMult = tank.chargeSpeedMult || 3;\n    enemy.pos.x += enemy.chargeDir.x * baseSpeed * speedMult * slowFactor * slideBoost * iceEffects.speedMult * dt;\n    enemy.pos.z += enemy.chargeDir.z * baseSpeed * speedMult * slowFactor * slideBoost * iceEffects.speedMult * dt;\n    enemy.chargeTimer -= dt * 1000;\n\n    if (enemy.chargeTimer <= 0) {\n      enemy.isCharging = false;\n      const cdMin = tank.chargeCooldownMin || 3000;\n      const cdMax = tank.chargeCooldownMax || 5000;\n      enemy.chargeCooldown = cdMin + Math.random() * (cdMax - cdMin);\n    }\n  } else {\n    // Check if close enough for melee swing (when charge is on cooldown or too close)\n    const meleeCfg = enemy.config.melee;\n    if (meleeCfg && dist <= meleeCfg.hitRange) {\n      const now = performance.now();\n      if (now - enemy.lastAttackTime > enemy.config.attackRate) {\n        startEnemyMelee(enemy);\n        return;\n      }\n    }\n\n    // Normal slow movement toward player\n    if (dist > 1) {\n      _toPlayer.normalize();\n      enemy.pos.x += _toPlayer.x * baseSpeed * slowFactor * slideBoost * iceEffects.speedMult * dt;\n      enemy.pos.z += _toPlayer.z * baseSpeed * slowFactor * slideBoost * iceEffects.speedMult * dt;\n    }\n\n    // Charge cooldown\n    enemy.chargeCooldown -= dt * 1000;\n    const minD = tank.chargeMinDist || 2;\n    const maxD = tank.chargeMaxDist || 10;\n    if (enemy.chargeCooldown <= 0 && dist < maxD && dist > minD) {\n      // Start charge \u2014 telegraph with flash\n      enemy.isCharging = true;\n      enemy.chargeTimer = tank.chargeDuration || 500;\n      _toPlayer.subVectors(playerPos, enemy.pos).normalize();\n      enemy.chargeDir.copy(_toPlayer);\n\n      // Telegraph flash\n      const telegraphMs = tank.telegraphDuration || 300;\n      enemy.flashTimer = telegraphMs;\n      enemy.bodyMesh.material.emissive.setHex(0xffffff);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(0xffffff);\n    }\n  }\n\n  // Face movement direction\n  if (dist > 0.1) {\n    const nx = (playerPos.x - enemy.pos.x);\n    const nz = (playerPos.z - enemy.pos.z);\n    const l = Math.sqrt(nx * nx + nz * nz);\n    if (l > 0) {\n      enemy.mesh.rotation.y = Math.atan2(-nx / l, -nz / l);\n    }\n  }\n}\n\nexport function slowEnemy(enemy: any, durationMs: number, mult: number) {\n  enemy.slowTimer = durationMs;\n  enemy.slowMult = mult;\n}\n\nexport function stunEnemy(enemy: any, durationMs: number) {\n  enemy.stunTimer = durationMs;\n  // Cancel any active charge\n  enemy.isCharging = false;\n  // Cancel melee attack\n  if (enemy.meleePhase !== 'idle') {\n    enemy.meleePhase = 'idle';\n    enemy.bodyMesh.material.emissive.setHex(enemy.config.emissive);\n    if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(enemy.config.emissive);\n  }\n  // Cancel sniper telegraph (shot will still fire visually but enemy resets state)\n  if (enemy.sniperPhase === 'telegraphing') {\n    enemy.sniperPhase = 'idle';\n  }\n  // Cancel mortar aim\n  if (enemy.mortarPhase === 'aiming') {\n    enemy.mortarPhase = 'idle';\n    removeMortarArcLine(enemy);\n    removeMortarGroundCircle(enemy);\n  }\n}\n\nexport function stunEnemiesInRadius(centerPos: any, radius: number, durationMs: number, gameState: any) {\n  const r2 = radius * radius;\n  for (const enemy of gameState.enemies) {\n    const dx = enemy.pos.x - centerPos.x;\n    const dz = enemy.pos.z - centerPos.z;\n    if (dx * dx + dz * dz < r2) {\n      stunEnemy(enemy, durationMs);\n    }\n  }\n}\n\nexport function clearEnemies(gameState: any) {\n  for (const enemy of gameState.enemies) {\n    // Clean up shield mesh if present\n    if (enemy.shieldMesh) {\n      enemy.shieldMesh.geometry.dispose();\n      enemy.shieldMesh.material.dispose();\n    }\n    // Clean up mortar visuals\n    removeMortarArcLine(enemy);\n    removeMortarGroundCircle(enemy);\n    // Clean up death telegraph if active\n    removeDeathTelegraph(enemy);\n    sceneRef.remove(enemy.mesh);\n  }\n  gameState.enemies.length = 0;\n\n  // Invalidate cached bounds (level editor may have changed arena)\n  _collisionBounds = null;\n  _pitBoundsCache = null;\n}\n", "// Mortar projectile system \u2014 lobbed arc projectiles with AoE impact\n// Each projectile travels along a parabolic arc, then explodes on landing.\n// Ice Mortar Imps leave behind ice patches that affect movement and knockback.\n\nimport { applyAoeEffect } from '../engine/aoeTelegraph';\nimport { getPlayerPos, isPlayerInvincible } from './player';\nimport { slowEnemy } from './enemy';\nimport { screenShake } from '../engine/renderer';\nimport { spawnDamageNumber } from '../ui/damageNumbers';\n\nlet sceneRef: any;\n\n// Active mortar projectiles in flight\nconst activeMortars: any[] = [];\n\n// Active ice patches on the ground\nconst activeIcePatches: any[] = [];\n\n// Shared geometry (created once)\nlet shellGeo: any;\n\nexport function initMortarSystem(scene: any) {\n  sceneRef = scene;\n}\n\n/**\n * Fire a mortar projectile along a parabolic arc.\n */\nexport function fireMortarProjectile(opts: any) {\n  if (!shellGeo) {\n    shellGeo = new THREE.SphereGeometry(0.15, 6, 4);\n  }\n\n  const mat = new THREE.MeshStandardMaterial({\n    color: opts.color,\n    emissive: opts.color,\n    emissiveIntensity: 0.8,\n  });\n\n  const mesh = new THREE.Mesh(shellGeo, mat);\n  mesh.position.set(opts.startX, 0.8, opts.startZ);\n  sceneRef.add(mesh);\n\n  // Create a glowing trail line behind the projectile\n  const trailPositions = new Float32Array(30 * 3); // 30-point trail\n  const trailGeo = new THREE.BufferGeometry();\n  trailGeo.setAttribute('position', new THREE.BufferAttribute(trailPositions, 3));\n  const trailMat = new THREE.LineBasicMaterial({\n    color: opts.color,\n    transparent: true,\n    opacity: 0.5,\n    depthWrite: false,\n  });\n  const trail = new THREE.Line(trailGeo, trailMat);\n  sceneRef.add(trail);\n\n  // Calculate arc distance and total flight time\n  const dx = opts.targetX - opts.startX;\n  const dz = opts.targetZ - opts.startZ;\n  const groundDist = Math.sqrt(dx * dx + dz * dz);\n\n  // Approximate arc length (parabolic arc is longer than ground distance)\n  // Using a simple approximation: arcLen ~ groundDist + 2*arcHeight^2/groundDist\n  const arcLen = groundDist > 0.1\n    ? groundDist + 2 * opts.arcHeight * opts.arcHeight / groundDist\n    : opts.arcHeight * 2;\n  const flightTime = arcLen / opts.speed;\n\n  const mortar: any = {\n    mesh,\n    trail,\n    trailGeo,\n    trailMat,\n    mat,\n    startX: opts.startX,\n    startZ: opts.startZ,\n    targetX: opts.targetX,\n    targetZ: opts.targetZ,\n    arcHeight: opts.arcHeight,\n    flightTime,\n    elapsed: 0,\n    color: opts.color,\n    blastRadius: opts.blastRadius,\n    damage: opts.damage,\n    slowDuration: opts.slowDuration,\n    slowMult: opts.slowMult,\n    explosionDuration: opts.explosionDuration,\n    icePatch: opts.icePatch || null,\n    gameState: opts.gameState,\n    sourceEnemy: opts.sourceEnemy,\n    trailHistory: [], // past positions for trail\n    groundCircle: opts.groundCircle || null, // persistent ground circle from aim phase\n  };\n\n  activeMortars.push(mortar);\n  return mortar;\n}\n\n/**\n * Update all in-flight mortar projectiles.\n * Call this every frame from the game loop.\n */\nexport function updateMortarProjectiles(dt: number) {\n  for (let i = activeMortars.length - 1; i >= 0; i--) {\n    const m = activeMortars[i];\n    m.elapsed += dt;\n    const t = Math.min(m.elapsed / m.flightTime, 1);\n\n    // Interpolate position along parabolic arc\n    const x = m.startX + (m.targetX - m.startX) * t;\n    const z = m.startZ + (m.targetZ - m.startZ) * t;\n    const y = 0.8 + 4 * m.arcHeight * t * (1 - t); // parabolic arc\n\n    m.mesh.position.set(x, y, z);\n\n    // Pulse glow\n    const pulse = 0.6 + 0.4 * Math.sin(performance.now() * 0.01);\n    m.mat.emissiveIntensity = pulse;\n\n    // Update trail\n    m.trailHistory.push({ x, y, z });\n    if (m.trailHistory.length > 30) m.trailHistory.shift();\n\n    const positions = m.trailGeo.attributes.position.array;\n    for (let j = 0; j < 30; j++) {\n      const idx = j < m.trailHistory.length ? j : m.trailHistory.length - 1;\n      const p = m.trailHistory[idx];\n      positions[j * 3] = p.x;\n      positions[j * 3 + 1] = p.y;\n      positions[j * 3 + 2] = p.z;\n    }\n    m.trailGeo.attributes.position.needsUpdate = true;\n    m.trailGeo.setDrawRange(0, m.trailHistory.length);\n\n    // Trail fades as projectile progresses\n    m.trailMat.opacity = 0.5 * (1 - t * 0.5);\n\n    // Update ground circle opacity \u2014 ramps from 0.3 -> 0.9 as projectile approaches\n    if (m.groundCircle) {\n      const gc = m.groundCircle;\n      // Ring: 0.3 at launch -> 0.9 at impact (never below 0.3)\n      const ringOpacity = 0.3 + 0.6 * t;\n      // Fill: 0.08 at launch -> 0.35 at impact\n      const fillOpacity = 0.08 + 0.27 * t;\n      // Pulse border for urgency\n      const gcPulse = 0.85 + 0.15 * Math.sin(performance.now() * (0.006 + 0.012 * t));\n      gc.ringMat.opacity = ringOpacity * gcPulse;\n      gc.fillMat.opacity = fillOpacity;\n    }\n\n    // Impact \u2014 projectile has landed\n    if (t >= 1) {\n      onMortarImpact(m);\n      removeMortar(m);\n      activeMortars.splice(i, 1);\n    }\n  }\n}\n\n/**\n * Handle mortar impact \u2014 AoE damage + slow + visual.\n */\nfunction onMortarImpact(m: any) {\n  const tx = m.targetX;\n  const tz = m.targetZ;\n\n  // Screen shake on impact\n  screenShake(3, 150);\n\n  // AoE effect \u2014 damages and slows all enemies in blast radius\n  applyAoeEffect({\n    x: tx,\n    z: tz,\n    radius: m.blastRadius,\n    durationMs: m.explosionDuration,\n    color: m.color,\n    label: 'SLOWED',\n    effectFn: (e: any) => {\n      e.health -= m.damage;\n      slowEnemy(e, m.slowDuration, m.slowMult);\n    },\n    gameState: m.gameState,\n    excludeEnemy: m.sourceEnemy,\n  });\n\n  // Check player damage\n  const pp = getPlayerPos();\n  const pdx = pp.x - tx;\n  const pdz = pp.z - tz;\n  const playerDist = Math.sqrt(pdx * pdx + pdz * pdz);\n  if (playerDist < m.blastRadius && !isPlayerInvincible()) {\n    m.gameState.playerHealth -= m.damage;\n    screenShake(4, 200);\n    spawnDamageNumber(pp.x, pp.z, m.damage, '#ff4466');\n    if (m.gameState.playerHealth <= 0) {\n      m.gameState.playerHealth = 0;\n      m.gameState.phase = 'gameOver';\n    }\n  }\n\n  // Create ice patch if enabled\n  if (m.icePatch && m.icePatch.enabled) {\n    createIcePatch(tx, tz, m.blastRadius, m.icePatch);\n  }\n}\n\n/**\n * Create a persistent ice patch on the ground.\n */\nfunction createIcePatch(x: number, z: number, radius: number, config: any) {\n  // Create visual ice patch (flat circle on ground)\n  const geo = new THREE.CircleGeometry(radius, 32);\n  geo.rotateX(-Math.PI / 2); // lay flat\n\n  const mat = new THREE.MeshBasicMaterial({\n    color: config.color || 0x80E0FF,\n    transparent: true,\n    opacity: 0.5,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n\n  const mesh = new THREE.Mesh(geo, mat);\n  mesh.position.set(x, 0.02, z); // slightly above ground to avoid z-fighting\n  sceneRef.add(mesh);\n\n  const patch = {\n    x,\n    z,\n    radius,\n    mesh,\n    mat,\n    geo,\n    duration: config.duration,\n    elapsed: 0,\n    speedMult: config.speedMult,\n    knockbackMult: config.knockbackMult,\n    affectsPlayer: config.affectsPlayer,\n    affectsEnemies: config.affectsEnemies,\n  };\n\n  activeIcePatches.push(patch);\n  return patch;\n}\n\n/**\n * Update all ice patches \u2014 handle duration and fading.\n */\nexport function updateIcePatches(dt: number) {\n  for (let i = activeIcePatches.length - 1; i >= 0; i--) {\n    const patch = activeIcePatches[i];\n    patch.elapsed += dt * 1000;\n\n    // Fade out in last 500ms\n    const remaining = patch.duration - patch.elapsed;\n    if (remaining < 500) {\n      patch.mat.opacity = 0.5 * (remaining / 500);\n    }\n\n    // Remove when expired\n    if (patch.elapsed >= patch.duration) {\n      patch.geo.dispose();\n      patch.mat.dispose();\n      sceneRef.remove(patch.mesh);\n      activeIcePatches.splice(i, 1);\n    }\n  }\n}\n\n/**\n * Check if a position is on any ice patch.\n * Returns the ice patch config if on ice, null otherwise.\n */\nexport function getIcePatchAt(x: number, z: number) {\n  for (const patch of activeIcePatches) {\n    const dx = x - patch.x;\n    const dz = z - patch.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n    if (dist <= patch.radius) {\n      return patch;\n    }\n  }\n  return null;\n}\n\n/**\n * Get ice effect multipliers for an entity at position.\n */\nexport function getIceEffects(x: number, z: number, isPlayer: boolean) {\n  const patch = getIcePatchAt(x, z);\n  if (!patch) {\n    return { speedMult: 1.0, knockbackMult: 1.0 };\n  }\n\n  // Check if this entity type is affected\n  if (isPlayer && !patch.affectsPlayer) {\n    return { speedMult: 1.0, knockbackMult: 1.0 };\n  }\n  if (!isPlayer && !patch.affectsEnemies) {\n    return { speedMult: 1.0, knockbackMult: 1.0 };\n  }\n\n  return {\n    speedMult: patch.speedMult,\n    knockbackMult: patch.knockbackMult,\n  };\n}\n\n/**\n * Clean up a mortar projectile's visual resources.\n */\nfunction removeMortar(m: any) {\n  m.mat.dispose();\n  sceneRef.remove(m.mesh);\n  m.trailGeo.dispose();\n  m.trailMat.dispose();\n  sceneRef.remove(m.trail);\n  // Clean up ground circle (geometry is shared \u2014 don't dispose)\n  if (m.groundCircle) {\n    const gc = m.groundCircle;\n    gc.ringMat.dispose();\n    gc.fillMat.dispose();\n    sceneRef.remove(gc.group);\n    m.groundCircle = null;\n  }\n}\n\n/**\n * Clear all in-flight mortar projectiles (on restart/cleanup).\n */\nexport function clearMortarProjectiles() {\n  for (const m of activeMortars) {\n    removeMortar(m);\n  }\n  activeMortars.length = 0;\n}\n\n/**\n * Clear all ice patches (on restart/cleanup).\n */\nexport function clearIcePatches() {\n  for (const patch of activeIcePatches) {\n    patch.geo.dispose();\n    patch.mat.dispose();\n    sceneRef.remove(patch.mesh);\n  }\n  activeIcePatches.length = 0;\n}\n", "// PlayerRig \u2014 Procedural bipedal mannequin built from box/sphere primitives.\n// Constructs a joint hierarchy suitable for procedural animation.\n// No external assets \u2014 everything is THREE.js primitives.\n\nimport { PLAYER } from '../config/player';\n\n// \u2500\u2500\u2500 Exported Types \u2500\u2500\u2500\n\nexport interface PlayerJoints {\n  rigRoot: any;    // whole-body transforms (squash/stretch, lean)\n  hip: any;        // pivot for legs, rotates to face movement direction\n  torso: any;      // upper body, inherits aim rotation from playerGroup\n  head: any;\n  shoulderL: any;\n  upperArmL: any;\n  lowerArmL: any;\n  shoulderR: any;\n  upperArmR: any;\n  lowerArmR: any;\n  sword: any;      // sword group attached to right forearm\n  thighL: any;\n  shinL: any;\n  thighR: any;\n  shinR: any;\n}\n\nexport interface PlayerRig {\n  joints: PlayerJoints;\n  meshes: any[];           // all Mesh objects (for world-position sampling)\n  materials: any[];        // all MeshStandardMaterial instances (for glow)\n}\n\n// \u2500\u2500\u2500 Proportions \u2500\u2500\u2500\n// Tuned for readability at isometric distance. Slightly exaggerated (big head, wide torso).\n\nconst P = {\n  // Overall scale reference\n  scale: 0.9,  // global multiplier if everything feels too big/small\n\n  // Hip (root of legs + torso)\n  hipY: 0.5,\n\n  // Torso\n  torsoWidth: 0.28,\n  torsoHeight: 0.32,\n  torsoDepth: 0.18,\n  torsoY: 0.22,  // above hip\n\n  // Head\n  headRadius: 0.16,\n  headY: 0.30,  // above torso\n\n  // Arms\n  shoulderOffsetX: 0.19,\n  shoulderY: 0.22,        // relative to torso (near top of torso)\n  upperArmWidth: 0.08,\n  upperArmHeight: 0.20,\n  upperArmDepth: 0.08,\n  upperArmY: -0.12,       // hangs down from shoulder\n  elbowY: -0.20,          // relative to upper arm\n  lowerArmWidth: 0.07,\n  lowerArmHeight: 0.18,\n  lowerArmDepth: 0.07,\n  lowerArmY: -0.10,       // hangs down from elbow\n\n  // Legs\n  legOffsetX: 0.09,\n  thighWidth: 0.10,\n  thighHeight: 0.24,\n  thighDepth: 0.10,\n  thighY: -0.14,          // hangs down from hip\n  kneeY: -0.24,           // relative to thigh\n  shinWidth: 0.08,\n  shinHeight: 0.22,\n  shinDepth: 0.08,\n  shinY: -0.12,           // hangs down from knee\n};\n\n// \u2500\u2500\u2500 Color Palette \u2500\u2500\u2500\n// Green family matching current player. Limbs slightly darker for depth.\n\nconst COLORS = {\n  torso:    { color: 0x44cc88, emissive: 0x22aa66, emissiveIntensity: 0.4 },\n  head:     { color: 0x55ddaa, emissive: 0x33bb88, emissiveIntensity: 0.5 },\n  arm:      { color: 0x3ab87a, emissive: 0x1e9960, emissiveIntensity: 0.35 },\n  leg:      { color: 0x38b575, emissive: 0x1c9658, emissiveIntensity: 0.35 },\n  sword:    { color: 0xccccdd, emissive: 0x8888aa, emissiveIntensity: 0.3 },\n};\n\n// \u2500\u2500\u2500 Shared Geometry Cache (created once) \u2500\u2500\u2500\n\nlet _torsoGeo: any = null;\nlet _headGeo: any = null;\nlet _upperArmGeo: any = null;\nlet _lowerArmGeo: any = null;\nlet _thighGeo: any = null;\nlet _shinGeo: any = null;\nlet _swordBladeGeo: any = null;\nlet _swordGuardGeo: any = null;\n\nfunction ensureGeometry() {\n  if (_torsoGeo) return;\n  _torsoGeo    = new THREE.BoxGeometry(P.torsoWidth, P.torsoHeight, P.torsoDepth);\n  _headGeo     = new THREE.SphereGeometry(P.headRadius, 8, 6);\n  _upperArmGeo = new THREE.BoxGeometry(P.upperArmWidth, P.upperArmHeight, P.upperArmDepth);\n  _lowerArmGeo = new THREE.BoxGeometry(P.lowerArmWidth, P.lowerArmHeight, P.lowerArmDepth);\n  _thighGeo    = new THREE.BoxGeometry(P.thighWidth, P.thighHeight, P.thighDepth);\n  _shinGeo     = new THREE.BoxGeometry(P.shinWidth, P.shinHeight, P.shinDepth);\n  _swordBladeGeo = new THREE.BoxGeometry(0.06, 0.50, 0.03);  // visible blade, ~3\u00D7 forearm length\n  _swordGuardGeo = new THREE.BoxGeometry(0.18, 0.04, 0.05);  // wide crosspiece\n}\n\nfunction makeMat(palette: { color: number; emissive: number; emissiveIntensity: number }) {\n  return new THREE.MeshStandardMaterial({\n    color: palette.color,\n    emissive: palette.emissive,\n    emissiveIntensity: palette.emissiveIntensity,\n  });\n}\n\n// \u2500\u2500\u2500 Rig Construction \u2500\u2500\u2500\n\nexport function createPlayerRig(parentGroup: any): PlayerRig {\n  ensureGeometry();\n\n  const meshes: any[] = [];\n  const materials: any[] = [];\n\n  function addMesh(geo: any, palette: any, parent: any, x = 0, y = 0, z = 0) {\n    const mat = makeMat(palette);\n    const mesh = new THREE.Mesh(geo, mat);\n    mesh.position.set(x, y, z);\n    parent.add(mesh);\n    meshes.push(mesh);\n    materials.push(mat);\n    return mesh;\n  }\n\n  // rigRoot \u2014 whole-body transforms (squash/stretch, forward lean)\n  const rigRoot = new THREE.Group();\n  rigRoot.scale.setScalar(P.scale);\n  parentGroup.add(rigRoot);\n\n  // Hip \u2014 root of legs + torso\n  const hip = new THREE.Group();\n  hip.position.y = P.hipY;\n  rigRoot.add(hip);\n\n  // Torso \u2014 upper body pivot (inherits aim from playerGroup via hierarchy)\n  const torso = new THREE.Group();\n  torso.position.y = P.torsoY;\n  hip.add(torso);\n\n  // Torso mesh\n  addMesh(_torsoGeo, COLORS.torso, torso, 0, P.torsoHeight / 2, 0);\n\n  // Head\n  const head = new THREE.Group();\n  head.position.y = P.torsoHeight + P.headY * 0.5;\n  torso.add(head);\n  addMesh(_headGeo, COLORS.head, head, 0, 0, 0);\n\n  // \u2500\u2500\u2500 Arms \u2500\u2500\u2500\n\n  // Left shoulder pivot (attached to torso)\n  const shoulderL = new THREE.Group();\n  shoulderL.position.set(-P.shoulderOffsetX, P.shoulderY, 0);\n  torso.add(shoulderL);\n\n  // Left upper arm pivot\n  const upperArmL = new THREE.Group();\n  shoulderL.add(upperArmL);\n  addMesh(_upperArmGeo, COLORS.arm, upperArmL, 0, P.upperArmY, 0);\n\n  // Left elbow \u2192 lower arm\n  const lowerArmL = new THREE.Group();\n  lowerArmL.position.y = P.elbowY;\n  upperArmL.add(lowerArmL);\n  addMesh(_lowerArmGeo, COLORS.arm, lowerArmL, 0, P.lowerArmY, 0);\n\n  // Right shoulder pivot\n  const shoulderR = new THREE.Group();\n  shoulderR.position.set(P.shoulderOffsetX, P.shoulderY, 0);\n  torso.add(shoulderR);\n\n  // Right upper arm pivot\n  const upperArmR = new THREE.Group();\n  shoulderR.add(upperArmR);\n  addMesh(_upperArmGeo, COLORS.arm, upperArmR, 0, P.upperArmY, 0);\n\n  // Right elbow \u2192 lower arm\n  const lowerArmR = new THREE.Group();\n  lowerArmR.position.y = P.elbowY;\n  upperArmR.add(lowerArmR);\n  addMesh(_lowerArmGeo, COLORS.arm, lowerArmR, 0, P.lowerArmY, 0);\n\n  // \u2500\u2500\u2500 Sword (attached to right forearm) \u2500\u2500\u2500\n  const sword = new THREE.Group();\n  sword.position.set(0, -0.24, 0);  // extends below hand\n  lowerArmR.add(sword);\n  addMesh(_swordBladeGeo, COLORS.sword, sword, 0, -0.22, 0);  // blade center\n  addMesh(_swordGuardGeo, COLORS.sword, sword, 0, 0.03, 0);   // guard at top (handguard)\n\n  // \u2500\u2500\u2500 Legs \u2500\u2500\u2500\n\n  // Left thigh pivot (attached to hip)\n  const thighL = new THREE.Group();\n  thighL.position.set(-P.legOffsetX, 0, 0);\n  hip.add(thighL);\n  addMesh(_thighGeo, COLORS.leg, thighL, 0, P.thighY, 0);\n\n  // Left knee \u2192 shin\n  const shinL = new THREE.Group();\n  shinL.position.y = P.kneeY;\n  thighL.add(shinL);\n  addMesh(_shinGeo, COLORS.leg, shinL, 0, P.shinY, 0);\n\n  // Right thigh pivot\n  const thighR = new THREE.Group();\n  thighR.position.set(P.legOffsetX, 0, 0);\n  hip.add(thighR);\n  addMesh(_thighGeo, COLORS.leg, thighR, 0, P.thighY, 0);\n\n  // Right knee \u2192 shin\n  const shinR = new THREE.Group();\n  shinR.position.y = P.kneeY;\n  thighR.add(shinR);\n  addMesh(_shinGeo, COLORS.leg, shinR, 0, P.shinY, 0);\n\n  return {\n    joints: {\n      rigRoot,\n      hip,\n      torso,\n      head,\n      shoulderL,\n      upperArmL,\n      lowerArmL,\n      shoulderR,\n      upperArmR,\n      lowerArmR,\n      sword,\n      thighL,\n      shinL,\n      thighR,\n      shinR,\n    },\n    meshes,\n    materials,\n  };\n}\n\n// \u2500\u2500\u2500 Afterimage Helpers \u2500\u2500\u2500\n\n// Shared ghost geometries (simplified \u2014 just torso + head for performance)\nlet _ghostTorsoGeo: any = null;\nlet _ghostHeadGeo: any = null;\n\nexport function getGhostGeometries() {\n  if (!_ghostTorsoGeo) {\n    _ghostTorsoGeo = new THREE.BoxGeometry(P.torsoWidth * P.scale, P.torsoHeight * P.scale, P.torsoDepth * P.scale);\n    _ghostHeadGeo  = new THREE.SphereGeometry(P.headRadius * P.scale, 6, 4);\n  }\n  return { torso: _ghostTorsoGeo, head: _ghostHeadGeo };\n}\n", "// PlayerAnimator \u2014 Procedural animation state machine for the bipedal rig.\n// Drives joint rotations for idle, run, dash, and end lag.\n// Designed for snappy, commitment-based combat feel (Hades/HLD/Ys).\n//\n// Key concept: upper/lower body separation.\n// - playerGroup.rotation.y = aim direction (set by player.ts, torso inherits this)\n// - hip.rotation.y = offset from aim to movement direction (legs face where you're going)\n\nimport type { PlayerJoints } from './playerRig';\n\n// \u2500\u2500\u2500 Tuning Config \u2500\u2500\u2500\n// All timing/amplitude constants in one place for easy iteration.\n\nexport const C = {\n  // Run cycle\n  runCycleRate: 0.4,           // full leg cycles per world unit traveled\n  strideAngle: 0.6,           // radians (~35\u00B0) thigh swing amplitude\n  kneeBendMax: 0.8,           // radians (~45\u00B0) maximum forward knee bend\n  armSwingRatio: 0.6,         // arm swing as fraction of leg amplitude\n  forearmLag: 0.3,            // phase offset for forearm (secondary motion)\n  bodyBounceHeight: 0.03,     // world units of vertical bounce per step\n  forwardLean: 0.09,          // radians (~5\u00B0) lean into movement\n  forwardLeanSpeed: 8,        // how fast lean blends in/out (per second)\n\n  // Idle\n  breathRate: 2,              // Hz\n  breathAmplitude: 0.02,      // world units\n  weightShiftRate: 0.8,       // Hz\n  weightShiftAngle: 0.04,     // radians (~2.3\u00B0)\n  headDriftRate: 0.5,         // Hz\n  headDriftAngle: 0.02,       // radians (~1\u00B0)\n  idleArmDroop: 0.15,         // radians \u2014 slight outward droop\n\n  // Dash squash/stretch\n  squashScaleY: 0.75,\n  squashScaleXZ: 1.15,\n  stretchScaleY: 1.12,\n  stretchScaleXZ: 0.92,\n  dashLeanAngle: 0.26,        // radians (~15\u00B0) aggressive forward lean\n  dashArmSweep: -0.8,         // radians \u2014 arms swept back\n  dashLegLunge: 0.7,          // radians \u2014 front leg forward\n  dashLegTrail: -0.5,         // radians \u2014 back leg behind\n\n  // Transitions (ms)\n  idleToRunBlend: 80,\n  runToIdleBlend: 120,\n  endLagToNormalBlend: 60,\n\n  // Upper/lower body\n  hipTurnSpeed: 15,           // radians/sec \u2014 how fast legs reorient to movement direction\n};\n\n// \u2500\u2500\u2500 Animation State \u2500\u2500\u2500\n\nexport type AnimState = 'idle' | 'run' | 'dash' | 'endLag' | 'swing';\n\nexport interface AnimatorState {\n  currentState: AnimState;\n  prevState: AnimState;\n  stateTimer: number;          // seconds in current state\n  blendTimer: number;          // seconds remaining in transition blend\n  blendDuration: number;       // total blend duration in seconds\n  runCyclePhase: number;       // 0\u20131 oscillator for run cycle\n  moveDir: number;             // world-space angle of movement direction (radians)\n  moveDirSmoothed: number;     // lerped version for smooth leg turning\n  currentLean: number;         // current forward lean (smoothed)\n  dashDir: number;             // direction of dash (for squash orientation)\n  dashT: number;               // 0\u20131 progress through dash\n  time: number;                // accumulated time for idle oscillations\n}\n\nexport function createAnimatorState(): AnimatorState {\n  return {\n    currentState: 'idle',\n    prevState: 'idle',\n    stateTimer: 0,\n    blendTimer: 0,\n    blendDuration: 0,\n    runCyclePhase: 0,\n    moveDir: 0,\n    moveDirSmoothed: 0,\n    currentLean: 0,\n    dashDir: 0,\n    dashT: 0,\n    time: 0,\n  };\n}\n\nexport function resetAnimatorState(anim: AnimatorState) {\n  anim.currentState = 'idle';\n  anim.prevState = 'idle';\n  anim.stateTimer = 0;\n  anim.blendTimer = 0;\n  anim.blendDuration = 0;\n  anim.runCyclePhase = 0;\n  anim.currentLean = 0;\n  anim.dashT = 0;\n  anim.time = 0;\n}\n\n// \u2500\u2500\u2500 Easing Functions \u2500\u2500\u2500\n\nfunction easeOutBack(t: number): number {\n  const c1 = 1.70158;\n  const c3 = c1 + 1;\n  return 1 + c3 * Math.pow(t - 1, 3) + c1 * Math.pow(t - 1, 2);\n}\n\nfunction easeOutQuad(t: number): number {\n  return 1 - (1 - t) * (1 - t);\n}\n\nfunction easeInOutQuad(t: number): number {\n  return t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;\n}\n\nfunction clamp(v: number, min: number, max: number): number {\n  return v < min ? min : v > max ? max : v;\n}\n\nfunction lerpAngle(from: number, to: number, t: number): number {\n  // Shortest-path angle lerp\n  let diff = to - from;\n  while (diff > Math.PI) diff -= Math.PI * 2;\n  while (diff < -Math.PI) diff += Math.PI * 2;\n  return from + diff * t;\n}\n\n// \u2500\u2500\u2500 Main Update \u2500\u2500\u2500\n\nexport function updateAnimation(\n  joints: PlayerJoints,\n  anim: AnimatorState,\n  dt: number,\n  inputState: { moveX: number; moveZ: number },\n  aimAngle: number,\n  isDashing: boolean,\n  isInEndLag: boolean,\n  dashProgress: number,\n  isSwinging: boolean = false,\n  swingProgress: number = 0\n): void {\n  anim.time += dt;\n\n  // \u2500\u2500\u2500 State Transitions \u2500\u2500\u2500\n  const isMoving = Math.abs(inputState.moveX) > 0.01 || Math.abs(inputState.moveZ) > 0.01;\n  const prevState = anim.currentState;\n\n  if (isDashing) {\n    if (anim.currentState !== 'dash') {\n      transitionTo(anim, 'dash', 0); // instant\n    }\n    anim.dashT = dashProgress;\n  } else if (isInEndLag) {\n    if (anim.currentState !== 'endLag') {\n      transitionTo(anim, 'endLag', 0); // instant\n    }\n  } else if (isSwinging) {\n    if (anim.currentState !== 'swing') {\n      transitionTo(anim, 'swing', 0); // instant\n    }\n    anim.dashT = swingProgress; // reuse dashT for swing progress\n  } else if (isMoving) {\n    if (anim.currentState !== 'run') {\n      const blend = anim.currentState === 'endLag' || anim.currentState === 'swing'\n        ? C.endLagToNormalBlend : C.idleToRunBlend;\n      transitionTo(anim, 'run', blend / 1000);\n    }\n  } else {\n    if (anim.currentState !== 'idle') {\n      const blend = anim.currentState === 'endLag' || anim.currentState === 'swing'\n        ? C.endLagToNormalBlend : C.runToIdleBlend;\n      transitionTo(anim, 'idle', blend / 1000);\n    }\n  }\n\n  anim.stateTimer += dt;\n  if (anim.blendTimer > 0) {\n    anim.blendTimer = Math.max(0, anim.blendTimer - dt);\n  }\n\n  // \u2500\u2500\u2500 Movement Direction (for hip rotation) \u2500\u2500\u2500\n  if (isMoving) {\n    anim.moveDir = Math.atan2(-inputState.moveX, -inputState.moveZ);\n  }\n  // Smooth hip rotation toward movement direction\n  anim.moveDirSmoothed = lerpAngle(\n    anim.moveDirSmoothed,\n    anim.moveDir,\n    Math.min(1, C.hipTurnSpeed * dt)\n  );\n\n  // \u2500\u2500\u2500 Apply Pose \u2500\u2500\u2500\n  // Reset all joints to neutral first\n  resetJointsToNeutral(joints);\n\n  // Apply current state's pose\n  switch (anim.currentState) {\n    case 'idle':  applyIdle(joints, anim); break;\n    case 'run':   applyRun(joints, anim, dt, inputState); break;\n    case 'dash':  applyDash(joints, anim); break;\n    case 'endLag': applyEndLag(joints, anim); break;\n    case 'swing': applySwing(joints, anim); break;\n  }\n\n  // \u2500\u2500\u2500 Upper/Lower Body Separation \u2500\u2500\u2500\n  // Hip rotates to face movement direction, offset from aim\n  // playerGroup.rotation.y = aimAngle (set externally)\n  // hip.rotation.y = moveDirSmoothed - aimAngle \u2192 legs face movement in world space\n  const hipOffset = anim.moveDirSmoothed - aimAngle;\n  joints.hip.rotation.y = hipOffset;\n\n  // \u2500\u2500\u2500 Forward Lean (smoothed) \u2500\u2500\u2500\n  const targetLean = (anim.currentState === 'run') ? C.forwardLean : 0;\n  anim.currentLean += (targetLean - anim.currentLean) * Math.min(1, C.forwardLeanSpeed * dt);\n  joints.rigRoot.rotation.x = anim.currentLean;\n\n  // During dash, override lean\n  if (anim.currentState === 'dash') {\n    joints.rigRoot.rotation.x = getDashLean(anim.dashT);\n  }\n}\n\n// \u2500\u2500\u2500 State Transition \u2500\u2500\u2500\n\nfunction transitionTo(anim: AnimatorState, newState: AnimState, blendDuration: number) {\n  anim.prevState = anim.currentState;\n  anim.currentState = newState;\n  anim.stateTimer = 0;\n  anim.blendDuration = blendDuration;\n  anim.blendTimer = blendDuration;\n\n  // Capture dash direction from movement direction when entering dash\n  if (newState === 'dash') {\n    anim.dashDir = anim.moveDir;\n    anim.dashT = 0;\n  }\n}\n\n// \u2500\u2500\u2500 Reset Joints \u2500\u2500\u2500\n\nfunction resetJointsToNeutral(joints: PlayerJoints) {\n  // Reset rotations\n  joints.rigRoot.rotation.set(0, 0, 0);\n  joints.rigRoot.scale.set(1, 1, 1);\n  joints.torso.rotation.set(0, 0, 0);\n  joints.head.rotation.set(0, 0, 0);\n  joints.upperArmL.rotation.set(0, 0, 0);\n  joints.lowerArmL.rotation.set(0, 0, 0);\n  joints.upperArmR.rotation.set(0, 0, 0);\n  joints.lowerArmR.rotation.set(0, 0, 0);\n  joints.thighL.rotation.set(0, 0, 0);\n  joints.shinL.rotation.set(0, 0, 0);\n  joints.thighR.rotation.set(0, 0, 0);\n  joints.shinR.rotation.set(0, 0, 0);\n  // Don't reset hip.rotation.y \u2014 set separately for upper/lower body split\n  joints.hip.rotation.x = 0;\n  joints.hip.rotation.z = 0;\n\n  // Reset positions to rig defaults (prevents cumulative drift from += animations)\n  joints.hip.position.y = 0.5;       // P.hipY from playerRig.ts\n  joints.torso.position.y = 0.22;    // P.torsoY from playerRig.ts\n}\n\n// \u2500\u2500\u2500 Idle Pose \u2500\u2500\u2500\n\nfunction applyIdle(joints: PlayerJoints, anim: AnimatorState) {\n  const t = anim.time;\n\n  // Breathing bob \u2014 torso rises and falls gently\n  joints.torso.position.y += Math.sin(t * C.breathRate * Math.PI * 2) * C.breathAmplitude;\n\n  // Weight shift \u2014 hip tilts side to side\n  joints.hip.rotation.z = Math.sin(t * C.weightShiftRate * Math.PI * 2) * C.weightShiftAngle;\n\n  // Head micro-drift \u2014 alive feel\n  joints.head.rotation.y = Math.sin(t * C.headDriftRate * Math.PI * 2) * C.headDriftAngle;\n\n  // Arms relaxed at sides \u2014 slight outward droop\n  joints.upperArmL.rotation.z = C.idleArmDroop;\n  joints.upperArmR.rotation.z = -C.idleArmDroop;\n\n  // Slight forearm bend (not ramrod straight)\n  joints.lowerArmL.rotation.x = -0.1;\n  joints.lowerArmR.rotation.x = -0.1;\n}\n\n// \u2500\u2500\u2500 Run Pose \u2500\u2500\u2500\n\nfunction applyRun(joints: PlayerJoints, anim: AnimatorState, dt: number, input: { moveX: number; moveZ: number }) {\n  // Advance run cycle based on distance traveled (not time)\n  const speed = Math.sqrt(input.moveX * input.moveX + input.moveZ * input.moveZ);\n  const distThisFrame = speed * 5 * dt; // speed normalized to ~0-1, times PLAYER.speed\n  anim.runCyclePhase = (anim.runCyclePhase + distThisFrame * C.runCycleRate) % 1;\n\n  const phase = anim.runCyclePhase * Math.PI * 2;\n\n  // \u2500\u2500\u2500 Legs \u2500\u2500\u2500\n  // Thigh swings forward/back\n  const thighSwing = Math.sin(phase) * C.strideAngle;\n  joints.thighL.rotation.x = thighSwing;\n  joints.thighR.rotation.x = -thighSwing;\n\n  // Knee bends forward only (anatomically correct)\n  // Offset phase so knee bends as leg swings back (follow-through)\n  const kneeL = Math.max(0, Math.sin(phase - 0.6)) * C.kneeBendMax;\n  const kneeR = Math.max(0, Math.sin(phase - 0.6 + Math.PI)) * C.kneeBendMax;\n  joints.shinL.rotation.x = -kneeL;  // negative = bend forward (flex)\n  joints.shinR.rotation.x = -kneeR;\n\n  // \u2500\u2500\u2500 Arms (counter-swing) \u2500\u2500\u2500\n  const armSwing = Math.sin(phase) * C.strideAngle * C.armSwingRatio;\n  joints.upperArmL.rotation.x = -armSwing;  // opposite to same-side leg\n  joints.upperArmR.rotation.x = armSwing;\n\n  // Forearm secondary motion (delayed, more swing)\n  const forearmSwing = Math.sin(phase - C.forearmLag) * C.strideAngle * C.armSwingRatio * 0.5;\n  joints.lowerArmL.rotation.x = -Math.abs(forearmSwing) - 0.15; // always slightly bent\n  joints.lowerArmR.rotation.x = -Math.abs(forearmSwing) - 0.15;\n\n  // \u2500\u2500\u2500 Body Bounce \u2500\u2500\u2500\n  // Hip bobs at 2\u00D7 leg frequency (bounces with each step)\n  const bounce = Math.abs(Math.sin(phase * 2)) * C.bodyBounceHeight;\n  joints.hip.position.y = 0.5 + bounce; // base hip Y from rig + bounce\n\n  // \u2500\u2500\u2500 Torso Twist \u2500\u2500\u2500\n  // Slight counter-rotation to arm swing (natural gait)\n  joints.torso.rotation.y = Math.sin(phase) * 0.06;\n}\n\n// \u2500\u2500\u2500 Dash Pose \u2500\u2500\u2500\n\nfunction applyDash(joints: PlayerJoints, anim: AnimatorState) {\n  const t = anim.dashT; // 0\u20131 through dash\n\n  // Three sub-phases: squash (0-0.15), stretch (0.15-0.85), settle (0.85-1.0)\n  if (t < 0.15) {\n    // SQUASH \u2014 compress on dash start\n    const subT = t / 0.15;\n    const ease = easeOutQuad(subT);\n\n    joints.rigRoot.scale.set(\n      1 + (C.squashScaleXZ - 1) * ease,\n      1 + (C.squashScaleY - 1) * ease,\n      1 + (C.squashScaleXZ - 1) * ease\n    );\n\n    // Legs snap to wide lunge\n    joints.thighL.rotation.x = C.dashLegLunge * ease;\n    joints.thighR.rotation.x = C.dashLegTrail * ease;\n    joints.shinL.rotation.x = -0.3 * ease;\n    joints.shinR.rotation.x = -0.4 * ease;\n\n    // Arms start sweeping back\n    joints.upperArmL.rotation.x = C.dashArmSweep * ease * 0.5;\n    joints.upperArmR.rotation.x = C.dashArmSweep * ease * 0.5;\n\n  } else if (t < 0.85) {\n    // STRETCH \u2014 elongate during travel\n    const subT = (t - 0.15) / 0.7;\n    const ease = easeOutQuad(subT);\n\n    joints.rigRoot.scale.set(\n      C.stretchScaleXZ,\n      C.stretchScaleY,\n      C.stretchScaleXZ\n    );\n\n    // Legs in mid-stride\n    joints.thighL.rotation.x = 0.4;\n    joints.thighR.rotation.x = -0.3;\n    joints.shinL.rotation.x = -0.5;\n    joints.shinR.rotation.x = -0.2;\n\n    // Arms swept fully back\n    joints.upperArmL.rotation.x = C.dashArmSweep;\n    joints.upperArmR.rotation.x = C.dashArmSweep;\n    joints.lowerArmL.rotation.x = C.dashArmSweep * 0.4;\n    joints.lowerArmR.rotation.x = C.dashArmSweep * 0.4;\n\n  } else {\n    // SETTLE \u2014 snap back with slight overshoot\n    const subT = (t - 0.85) / 0.15;\n    const ease = easeOutBack(Math.min(subT, 1));\n\n    // Scale returns to 1.0 with Y overshoot\n    const yScale = C.stretchScaleY + (1.0 - C.stretchScaleY) * ease;\n    const xzScale = C.stretchScaleXZ + (1.0 - C.stretchScaleXZ) * ease;\n    joints.rigRoot.scale.set(xzScale, yScale, xzScale);\n\n    // Legs plant into wide stance\n    const legSettle = 1 - ease;\n    joints.thighL.rotation.x = 0.3 * legSettle;\n    joints.thighR.rotation.x = -0.2 * legSettle;\n    joints.shinL.rotation.x = -0.3 * legSettle;\n    joints.shinR.rotation.x = -0.1 * legSettle;\n\n    // Arms relax\n    joints.upperArmL.rotation.x = C.dashArmSweep * (1 - ease);\n    joints.upperArmR.rotation.x = C.dashArmSweep * (1 - ease);\n  }\n}\n\nfunction getDashLean(t: number): number {\n  // Aggressive lean that eases in and settles out\n  if (t < 0.15) {\n    return C.dashLeanAngle * easeOutQuad(t / 0.15);\n  } else if (t < 0.85) {\n    return C.dashLeanAngle;\n  } else {\n    const subT = (t - 0.85) / 0.15;\n    return C.dashLeanAngle * (1 - easeOutQuad(subT));\n  }\n}\n\n// \u2500\u2500\u2500 End Lag Pose \u2500\u2500\u2500\n\nfunction applyEndLag(joints: PlayerJoints, anim: AnimatorState) {\n  // Short recovery \u2014 body settling from dash\n  const t = Math.min(anim.stateTimer / 0.05, 1); // 50ms end lag\n  const ease = easeOutQuad(t);\n\n  // Scale settles to neutral\n  const scaleY = 1 + (1.05 - 1) * (1 - ease); // slight overshoot settling down\n  joints.rigRoot.scale.set(1, scaleY, 1);\n\n  // Slight backward lean (deceleration)\n  joints.rigRoot.rotation.x = -0.06 * (1 - ease);\n\n  // Wide braking stance that settles\n  const legSpread = 0.25 * (1 - ease);\n  joints.thighL.rotation.x = legSpread;\n  joints.thighR.rotation.x = -legSpread;\n  joints.shinL.rotation.x = -legSpread * 0.5;\n  joints.shinR.rotation.x = -legSpread * 0.5;\n\n  // Arms settle forward\n  joints.upperArmL.rotation.x = -0.2 * (1 - ease);\n  joints.upperArmR.rotation.x = -0.2 * (1 - ease);\n}\n\n// \u2500\u2500\u2500 Melee Swing Pose \u2500\u2500\u2500\n\nfunction applySwing(joints: PlayerJoints, anim: AnimatorState) {\n  const t = clamp(anim.dashT, 0, 1); // dashT reused for swing progress\n\n  // Two sub-phases: wind-up (0-0.3), follow-through (0.3-1.0)\n  if (t < 0.3) {\n    // WIND-UP \u2014 coil back, brief preparation\n    const subT = t / 0.3;\n    const ease = easeOutQuad(subT);\n\n    // Right arm winds back\n    joints.upperArmR.rotation.x = 0.4 * ease;    // pull back\n    joints.upperArmR.rotation.z = -0.3 * ease;    // out to side\n    joints.lowerArmR.rotation.x = -0.6 * ease;    // elbow bent\n\n    // Left arm guards\n    joints.upperArmL.rotation.x = -0.2 * ease;\n    joints.lowerArmL.rotation.x = -0.3 * ease;\n\n    // Torso coils opposite to swing\n    joints.torso.rotation.y = -0.25 * ease;\n\n    // Slight crouch\n    joints.rigRoot.rotation.x = 0.06 * ease;\n  } else {\n    // FOLLOW-THROUGH \u2014 explosive sweep across body\n    const subT = (t - 0.3) / 0.7;\n    const ease = easeOutQuad(subT);\n\n    // Right arm sweeps forward and across\n    joints.upperArmR.rotation.x = 0.4 + (-1.0 - 0.4) * ease;   // -1.0: fully forward\n    joints.upperArmR.rotation.z = -0.3 + (0.5 + 0.3) * ease;    // 0.5: across body\n    joints.lowerArmR.rotation.x = -0.6 + (0.6 - 0.2) * ease;    // extend arm\n\n    // Left arm sweeps back for counterbalance\n    joints.upperArmL.rotation.x = -0.2 + (0.3 + 0.2) * ease;\n    joints.lowerArmL.rotation.x = -0.3 + (-0.2 + 0.3) * ease;\n\n    // Torso twists through \u2014 big rotation sells the swing\n    joints.torso.rotation.y = -0.25 + (0.45 + 0.25) * ease;\n\n    // Forward lean intensifies then settles\n    const leanCurve = subT < 0.5 ? easeOutQuad(subT * 2) : 1 - easeOutQuad((subT - 0.5) * 2);\n    joints.rigRoot.rotation.x = 0.06 + 0.08 * leanCurve;\n\n    // Front leg plants, back leg braces\n    joints.thighL.rotation.x = 0.2 * ease;\n    joints.thighR.rotation.x = -0.15 * ease;\n  }\n}\n", "import { PLAYER, MELEE } from '../config/player';\nimport { ABILITIES } from '../config/abilities';\nimport { ARENA_HALF_X, ARENA_HALF_Z } from '../config/arena';\nimport { screenShake, getScene } from '../engine/renderer';\nimport { getAbilityDirOverride, clearAbilityDirOverride } from '../engine/input';\nimport { getIceEffects } from './mortarProjectile';\nimport { emit } from '../engine/events';\nimport { createPlayerRig, getGhostGeometries } from './playerRig';\nimport type { PlayerRig } from './playerRig';\nimport { createAnimatorState, updateAnimation, resetAnimatorState } from './playerAnimator';\nimport type { AnimatorState } from './playerAnimator';\n\nlet playerGroup: any, aimIndicator: any;\nlet rig: PlayerRig;\nlet animState: AnimatorState;\nconst playerPos = new THREE.Vector3(0, 0, 0);\n\n// Melee state\nlet meleeSwinging = false;\nlet meleeCooldownTimer = 0;  // ms remaining until next swing allowed\nlet meleeSwingTimer = 0;     // ms into current swing (for animation)\nconst MELEE_SWING_DURATION = 200; // ms \u2014 how long the swing animation plays\nconst meleeHitEnemies: Set<any> = new Set(); // track which enemies were hit this swing (multi-hit)\nlet meleeSwingDir = 0;        // angle of the swing (radians)\n\n// Dash state\nlet isDashing = false;\nlet dashTimer = 0;\nlet dashDuration = 0;\nlet dashDistance = 0;\nconst dashDir = new THREE.Vector3();\nconst dashStartPos = new THREE.Vector3();\nlet isInvincible = false;\nlet endLagTimer = 0;\n\n// Afterimages\nconst afterimages: any[] = [];\n\n// Push event (consumed by physics each frame)\nlet pushEvent: any = null;\n\n// Charge state\nlet isCharging = false;\nlet chargeTimer = 0;\nlet chargeAimAngle = 0;\nlet chargeTelegraphGroup: any = null;\nlet chargeFillMesh: any = null;\nlet chargeBorderMesh: any = null;\nlet chargeBorderGeo: any = null;\n\n// Original emissive colors (used for charge glow reset)\nconst DEFAULT_EMISSIVE = 0x22aa66;\nconst DEFAULT_EMISSIVE_INTENSITY = 0.4;\n\nfunction restoreDefaultEmissive() {\n  if (!rig) return;\n  for (const mat of rig.materials) {\n    mat.emissive.setHex(DEFAULT_EMISSIVE);\n    mat.emissiveIntensity = DEFAULT_EMISSIVE_INTENSITY;\n  }\n}\n\nexport function createPlayer(scene: any) {\n  playerGroup = new THREE.Group();\n\n  // Build bipedal rig (joint hierarchy + box-limb meshes)\n  rig = createPlayerRig(playerGroup);\n  animState = createAnimatorState();\n\n  // Aim indicator \u2014 attached to playerGroup directly (not rig)\n  // so squash/stretch doesn't affect it\n  aimIndicator = new THREE.Mesh(\n    new THREE.ConeGeometry(0.12, 0.6, 4),\n    new THREE.MeshStandardMaterial({\n      color: 0x44ff88,\n      emissive: 0x44ff88,\n      emissiveIntensity: 0.8\n    })\n  );\n  aimIndicator.rotation.x = -Math.PI / 2;\n  aimIndicator.position.set(0, 0.8, -0.7);\n  playerGroup.add(aimIndicator);\n\n  scene.add(playerGroup);\n  return playerGroup;\n}\n\nexport function updatePlayer(inputState: any, dt: number, gameState: any) {\n  const now = performance.now();\n\n  // Tick ability cooldowns\n  for (const key of Object.keys(gameState.abilities)) {\n    if (gameState.abilities[key].cooldownRemaining > 0) {\n      gameState.abilities[key].cooldownRemaining -= dt * 1000;\n    }\n  }\n\n  // Tick charge system\n  if (isCharging) {\n    updateCharge(inputState, dt, gameState);\n  }\n\n  // End lag (post-dash lockout)\n  if (endLagTimer > 0) {\n    endLagTimer -= dt * 1000;\n    // During end lag, don't process movement or abilities\n    playerGroup.position.copy(playerPos);\n    aimAtCursor(inputState);\n    updateAnimation(rig.joints, animState, dt,\n      { moveX: 0, moveZ: 0 }, playerGroup.rotation.y,\n      false, true, 0);\n    updateAfterimages(dt);\n    return;\n  }\n\n  // === DASH ===\n  if (isDashing) {\n    updateDash(dt, gameState);\n    playerGroup.position.copy(playerPos);\n\n    // Aim still tracks cursor during dash\n    aimAtCursor(inputState);\n\n    updateAnimation(rig.joints, animState, dt,\n      { moveX: inputState.moveX, moveZ: inputState.moveZ }, playerGroup.rotation.y,\n      true, false, Math.min(dashTimer / dashDuration, 1));\n    updateAfterimages(dt);\n    return;\n  }\n\n  // Trigger dash\n  if (inputState.dash && gameState.abilities.dash.cooldownRemaining <= 0) {\n    startDash(inputState, gameState);\n  }\n\n  // Trigger charge (start)\n  if (inputState.ultimate && gameState.abilities.ultimate.cooldownRemaining <= 0 && !isCharging) {\n    startCharge(inputState, gameState);\n  }\n\n  // === MOVEMENT ===\n  if (Math.abs(inputState.moveX) > 0.01 || Math.abs(inputState.moveZ) > 0.01) {\n    const chargeSlow = isCharging ? ABILITIES.ultimate.chargeMoveSpeedMult : 1;\n    // Check for ice patch effects (doubled speed on ice)\n    const iceEffects = getIceEffects(playerPos.x, playerPos.z, true);\n    const speedMod = chargeSlow * iceEffects.speedMult;\n    playerPos.x += inputState.moveX * PLAYER.speed * speedMod * dt;\n    playerPos.z += inputState.moveZ * PLAYER.speed * speedMod * dt;\n\n  }\n\n  // Arena clamp \u2014 0.5 margin from walls (dynamic per room size)\n  const clampX = ARENA_HALF_X - 0.5;\n  const clampZ = ARENA_HALF_Z - 0.5;\n  playerPos.x = Math.max(-clampX, Math.min(clampX, playerPos.x));\n  playerPos.z = Math.max(-clampZ, Math.min(clampZ, playerPos.z));\n\n  playerGroup.position.copy(playerPos);\n\n  // === AIM ===\n  aimAtCursor(inputState);\n\n  // === PROCEDURAL ANIMATION ===\n  updateAnimation(\n    rig.joints,\n    animState,\n    dt,\n    { moveX: inputState.moveX, moveZ: inputState.moveZ },\n    playerGroup.rotation.y,\n    isDashing,\n    endLagTimer > 0,\n    isDashing ? Math.min(dashTimer / dashDuration, 1) : 0,\n    meleeSwinging,\n    meleeSwinging ? meleeSwingTimer / MELEE_SWING_DURATION : 0\n  );\n\n  // === MELEE COOLDOWN ===\n  if (meleeCooldownTimer > 0) {\n    meleeCooldownTimer -= dt * 1000;\n  }\n\n  // === MELEE SWING UPDATE ===\n  if (meleeSwinging) {\n    meleeSwingTimer += dt * 1000;\n    if (meleeSwingTimer >= MELEE_SWING_DURATION) {\n      meleeSwinging = false;\n      meleeSwingTimer = 0;\n    }\n  }\n\n  // === MELEE ATTACK (left click) ===\n  if (inputState.attack && meleeCooldownTimer <= 0 && !isDashing && !isCharging) {\n    // Auto-targeting: snap aim to nearest enemy within cone before swinging\n    const enemies = gameState.enemies;\n    if (enemies) {\n      let bestDist = MELEE.autoTargetRange * MELEE.autoTargetRange;\n      let bestEnemy: any = null;\n      const aimAngle = playerGroup.rotation.y;\n      for (let i = 0; i < enemies.length; i++) {\n        const e = enemies[i];\n        if (e.health <= 0 || e.fellInPit) continue;\n        const dx = e.pos.x - playerPos.x;\n        const dz = e.pos.z - playerPos.z;\n        const distSq = dx * dx + dz * dz;\n        if (distSq > bestDist) continue;\n        // Check if within auto-target arc\n        const angleToEnemy = Math.atan2(-dx, -dz);\n        let angleDiff = angleToEnemy - aimAngle;\n        while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n        while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n        if (Math.abs(angleDiff) <= MELEE.autoTargetArc / 2) {\n          bestDist = distSq;\n          bestEnemy = e;\n        }\n      }\n      if (bestEnemy) {\n        const dx = bestEnemy.pos.x - playerPos.x;\n        const dz = bestEnemy.pos.z - playerPos.z;\n        playerGroup.rotation.y = Math.atan2(-dx, -dz);\n      }\n    }\n\n    meleeSwinging = true;\n    meleeSwingTimer = 0;\n    meleeCooldownTimer = MELEE.cooldown;\n    meleeHitEnemies.clear();\n    meleeSwingDir = playerGroup.rotation.y;\n\n    emit({\n      type: 'meleeSwing',\n      position: { x: playerPos.x, z: playerPos.z },\n      direction: { x: -Math.sin(meleeSwingDir), z: -Math.cos(meleeSwingDir) },\n    });\n  }\n\n  updateAfterimages(dt);\n}\n\nfunction aimAtCursor(inputState: any) {\n  const dx = inputState.aimWorldPos.x - playerPos.x;\n  const dz = inputState.aimWorldPos.z - playerPos.z;\n  if (dx * dx + dz * dz > 0.01) {\n    playerGroup.rotation.y = Math.atan2(-dx, -dz);\n  }\n}\n\n// === DASH SYSTEM ===\nfunction startDash(inputState: any, gameState: any) {\n  const cfg = ABILITIES.dash;\n  isDashing = true;\n  dashTimer = 0;\n  dashDuration = cfg.duration;\n  dashDistance = cfg.distance;\n  dashStartPos.copy(playerPos);\n\n  // Direction source \u2014 drag-to-aim override takes priority (mobile buttons)\n  const override = getAbilityDirOverride();\n  const hasMovement = Math.abs(inputState.moveX) > 0.01 || Math.abs(inputState.moveZ) > 0.01;\n\n  if (override) {\n    dashDir.set(override.x, 0, override.z).normalize();\n    clearAbilityDirOverride();\n  } else if (cfg.directionSource === 'movement' && hasMovement) {\n    dashDir.set(inputState.moveX, 0, inputState.moveZ).normalize();\n  } else if (cfg.directionSource === 'aim') {\n    dashDir.set(\n      inputState.aimWorldPos.x - playerPos.x, 0,\n      inputState.aimWorldPos.z - playerPos.z\n    ).normalize();\n  } else {\n    // 'movementOrAim' or fallback\n    if (hasMovement) {\n      dashDir.set(inputState.moveX, 0, inputState.moveZ).normalize();\n    } else {\n      dashDir.set(\n        inputState.aimWorldPos.x - playerPos.x, 0,\n        inputState.aimWorldPos.z - playerPos.z\n      ).normalize();\n    }\n  }\n\n  gameState.abilities.dash.cooldownRemaining = cfg.cooldown;\n\n  if (cfg.screenShakeOnStart > 0) {\n    screenShake(cfg.screenShakeOnStart, 80);\n  }\n\n  emit({ type: 'playerDash', direction: { x: dashDir.x, z: dashDir.z }, position: { x: playerPos.x, z: playerPos.z } });\n}\n\nfunction updateDash(dt: number, gameState: any) {\n  const cfg = ABILITIES.dash;\n  dashTimer += dt * 1000;\n  const t = Math.min(dashTimer / dashDuration, 1.0);\n\n  // Easing\n  let easedT: number;\n  switch (cfg.curve) {\n    case 'easeOut':   easedT = 1 - (1 - t) * (1 - t); break;\n    case 'easeIn':    easedT = t * t; break;\n    case 'easeInOut': easedT = t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2; break;\n    default:          easedT = t;\n  }\n\n  // Position along dash path\n  playerPos.copy(dashStartPos);\n  playerPos.x += dashDir.x * dashDistance * easedT;\n  playerPos.z += dashDir.z * dashDistance * easedT;\n\n  // Arena clamp during dash \u2014 dynamic per room size\n  const dashClampX = ARENA_HALF_X - 0.5;\n  const dashClampZ = ARENA_HALF_Z - 0.5;\n  playerPos.x = Math.max(-dashClampX, Math.min(dashClampX, playerPos.x));\n  playerPos.z = Math.max(-dashClampZ, Math.min(dashClampZ, playerPos.z));\n\n  // I-frame window\n  isInvincible = cfg.invincible && (dashTimer >= cfg.iFrameStart && dashTimer <= cfg.iFrameEnd);\n\n  // Spawn afterimages at intervals\n  if (cfg.afterimageCount > 0) {\n    const interval = dashDuration / (cfg.afterimageCount + 1);\n    const prevCount = Math.floor((dashTimer - dt * 1000) / interval);\n    const currCount = Math.floor(dashTimer / interval);\n    if (currCount > prevCount) {\n      spawnAfterimage(cfg);\n    }\n  }\n\n  // End dash\n  if (t >= 1.0) {\n    isDashing = false;\n    isInvincible = false;\n    endLagTimer = cfg.endLag;\n    emit({ type: 'playerDashEnd' });\n  }\n}\n\nfunction spawnAfterimage(cfg: any) {\n  const scene = getScene();\n  const ghost = new THREE.Group();\n\n  // Update world matrices so we can sample joint positions\n  playerGroup.updateMatrixWorld(true);\n\n  // Simplified ghost \u2014 torso + head silhouettes from rig world positions\n  const geos = getGhostGeometries();\n  const ghostMat = new THREE.MeshBasicMaterial({\n    color: cfg.ghostColor,\n    transparent: true,\n    opacity: 0.5,\n  });\n\n  // Torso ghost at rig torso's world position\n  const torsoWorld = new THREE.Vector3();\n  rig.joints.torso.getWorldPosition(torsoWorld);\n  const ghostTorso = new THREE.Mesh(geos.torso, ghostMat.clone());\n  ghostTorso.position.copy(torsoWorld).sub(playerPos);\n  ghost.add(ghostTorso);\n\n  // Head ghost at rig head's world position\n  const headWorld = new THREE.Vector3();\n  rig.joints.head.getWorldPosition(headWorld);\n  const ghostHead = new THREE.Mesh(geos.head, ghostMat.clone());\n  ghostHead.position.copy(headWorld).sub(playerPos);\n  ghost.add(ghostHead);\n\n  ghost.position.copy(playerPos);\n  ghost.rotation.y = playerGroup.rotation.y;\n  scene.add(ghost);\n\n  afterimages.push({ mesh: ghost, life: 0, maxLife: cfg.afterimageFadeDuration });\n}\n\nfunction updateAfterimages(dt: number) {\n  const scene = getScene();\n  for (let i = afterimages.length - 1; i >= 0; i--) {\n    const ai = afterimages[i];\n    ai.life += dt * 1000;\n    const fade = Math.max(0, 1 - ai.life / ai.maxLife);\n\n    ai.mesh.children.forEach((child: any) => {\n      if (child.material) child.material.opacity = fade * 0.5;\n    });\n\n    if (ai.life >= ai.maxLife) {\n      scene.remove(ai.mesh);\n      afterimages.splice(i, 1);\n    }\n  }\n}\n\n// === CHARGE PUSH SYSTEM ===\nfunction startCharge(inputState: any, gameState: any) {\n  const cfg = ABILITIES.ultimate;\n  isCharging = true;\n  chargeTimer = 0;\n  gameState.abilities.ultimate.charging = true;\n  gameState.abilities.ultimate.chargeT = 0;\n\n  // Calculate initial aim angle toward cursor\n  // atan2(dx, dz) so that sin(angle)=dx/len, cos(angle)=dz/len -> local +Z extends toward cursor\n  const dx = inputState.aimWorldPos.x - playerPos.x;\n  const dz = inputState.aimWorldPos.z - playerPos.z;\n  chargeAimAngle = Math.atan2(dx, dz);\n\n  // Create telegraph visual\n  createChargeTelegraph(cfg);\n\n  // Visual feedback \u2014 player glows while charging\n  for (const mat of rig.materials) {\n    mat.emissive.setHex(0x44ffaa);\n    mat.emissiveIntensity = 0.6;\n  }\n}\n\nfunction createChargeTelegraph(cfg: any) {\n  const scene = getScene();\n\n  chargeTelegraphGroup = new THREE.Group();\n  chargeTelegraphGroup.position.set(playerPos.x, 0.05, playerPos.z);\n  chargeTelegraphGroup.rotation.y = chargeAimAngle;\n\n  // Fill plane (unit plane, scaled each frame)\n  const fillGeo = new THREE.PlaneGeometry(1, 1);\n  fillGeo.rotateX(-Math.PI / 2);\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: cfg.color,\n    transparent: true,\n    opacity: cfg.telegraphOpacity,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  chargeFillMesh = new THREE.Mesh(fillGeo, fillMat);\n  // Position fill to start from player (offset by half minLength)\n  const halfLen = cfg.minLength / 2;\n  chargeFillMesh.scale.set(cfg.width, 1, cfg.minLength);\n  chargeFillMesh.position.set(0, 0, halfLen);\n  chargeTelegraphGroup.add(chargeFillMesh);\n\n  // Border \u2014 edges of a unit-sized plane, scaled each frame\n  const basePlane = new THREE.PlaneGeometry(1, 1);\n  const borderGeo = new THREE.EdgesGeometry(basePlane);\n  borderGeo.rotateX(-Math.PI / 2);\n  const borderMat = new THREE.LineBasicMaterial({\n    color: cfg.color,\n    transparent: true,\n    opacity: 0.8,\n    depthWrite: false,\n  });\n  chargeBorderMesh = new THREE.LineSegments(borderGeo, borderMat);\n  chargeBorderGeo = borderGeo;\n  chargeBorderMesh.scale.set(cfg.width, 1, cfg.minLength);\n  chargeBorderMesh.position.set(0, 0, halfLen);\n  chargeTelegraphGroup.add(chargeBorderMesh);\n\n  scene.add(chargeTelegraphGroup);\n}\n\nfunction updateCharge(inputState: any, dt: number, gameState: any) {\n  const cfg = ABILITIES.ultimate;\n  chargeTimer += dt * 1000;\n  const chargeT = Math.min(chargeTimer / cfg.chargeTimeMs, 1);\n  gameState.abilities.ultimate.chargeT = chargeT;\n\n  // Update aim angle from cursor\n  const dx = inputState.aimWorldPos.x - playerPos.x;\n  const dz = inputState.aimWorldPos.z - playerPos.z;\n  if (dx * dx + dz * dz > 0.01) {\n    chargeAimAngle = Math.atan2(dx, dz);\n  }\n\n  // Calculate current rect length\n  const currentLength = cfg.minLength + (cfg.maxLength - cfg.minLength) * chargeT;\n\n  // Update telegraph position and rotation\n  if (chargeTelegraphGroup) {\n    chargeTelegraphGroup.position.set(playerPos.x, 0.05, playerPos.z);\n    chargeTelegraphGroup.rotation.y = chargeAimAngle;\n\n    // Offset fill and border so the rect starts at the player and extends forward\n    const halfLen = currentLength / 2;\n\n    // Scale fill (unit plane scaled to desired size)\n    chargeFillMesh.scale.set(cfg.width, 1, currentLength);\n    chargeFillMesh.position.set(0, 0, halfLen);\n\n    // Scale border (unit-sized EdgesGeometry, scale to desired size)\n    chargeBorderMesh.scale.set(cfg.width, 1, currentLength);\n    chargeBorderMesh.position.set(0, 0, halfLen);\n\n    // Pulse border opacity\n    const pulse = 0.6 + 0.3 * Math.sin(performance.now() * 0.008);\n    chargeBorderMesh.material.opacity = pulse;\n\n    // Fill gets brighter as charge increases\n    chargeFillMesh.material.opacity = cfg.telegraphOpacity + chargeT * 0.2;\n  }\n\n  // Player glow intensifies with charge\n  for (const mat of rig.materials) {\n    mat.emissiveIntensity = 0.6 + chargeT * 0.4;\n  }\n\n  // Fire on key release (100ms grace period prevents instant-fire)\n  // Player can hold at max charge indefinitely \u2014 fires when they release\n  if (chargeTimer > 100 && !inputState.ultimateHeld) {\n    fireChargePush(chargeT, gameState);\n  }\n}\n\nfunction fireChargePush(chargeT: number, gameState: any) {\n  const cfg = ABILITIES.ultimate;\n  const currentLength = cfg.minLength + (cfg.maxLength - cfg.minLength) * chargeT;\n  const force = cfg.minKnockback + (cfg.maxKnockback - cfg.minKnockback) * chargeT;\n\n  // Rectangle center = player position + half length toward cursor\n  // chargeAimAngle = atan2(dx, dz), so sin(angle) = dx/len, cos(angle) = dz/len -> toward cursor\n  const halfLen = currentLength / 2;\n  const dirX = Math.sin(chargeAimAngle);\n  const dirZ = Math.cos(chargeAimAngle);\n  const centerX = playerPos.x + dirX * halfLen;\n  const centerZ = playerPos.z + dirZ * halfLen;\n\n  // Emit push event for physics\n  pushEvent = {\n    x: centerX,\n    z: centerZ,\n    width: cfg.width,\n    length: currentLength,\n    rotation: chargeAimAngle,\n    force: force,\n    dirX: dirX,\n    dirZ: dirZ,\n  };\n\n  // Clean up telegraph\n  removeChargeTelegraph();\n\n  // Reset charge state\n  isCharging = false;\n  gameState.abilities.ultimate.charging = false;\n  gameState.abilities.ultimate.chargeT = 0;\n  gameState.abilities.ultimate.cooldownRemaining = cfg.cooldown;\n\n  // Restore player visuals\n  restoreDefaultEmissive();\n\n  // Screen shake scales with charge\n  screenShake(2 + chargeT * 3, 120);\n\n  emit({ type: 'chargeFired', chargeT, direction: { x: dirX, z: dirZ }, position: { x: playerPos.x, z: playerPos.z } });\n}\n\nfunction removeChargeTelegraph() {\n  if (chargeTelegraphGroup) {\n    const scene = getScene();\n    // Dispose materials and geometries\n    if (chargeFillMesh) {\n      chargeFillMesh.material.dispose();\n      chargeFillMesh.geometry.dispose();\n    }\n    if (chargeBorderMesh) {\n      chargeBorderMesh.material.dispose();\n      if (chargeBorderGeo) chargeBorderGeo.dispose();\n    }\n    scene.remove(chargeTelegraphGroup);\n    chargeTelegraphGroup = null;\n    chargeFillMesh = null;\n    chargeBorderMesh = null;\n    chargeBorderGeo = null;\n  }\n}\n\n// === MELEE PUBLIC API ===\nexport function isMeleeSwinging() { return meleeSwinging; }\nexport function getMeleeSwingDir() { return meleeSwingDir; }\nexport function getMeleeHitEnemies() { return meleeHitEnemies; }\n\n// === PUBLIC API ===\nexport function getPlayerPos() { return playerPos; }\nexport function getPlayerGroup() { return playerGroup; }\nexport function isPlayerInvincible() { return isInvincible; }\nexport function isPlayerDashing() { return isDashing; }\nexport function consumePushEvent() {\n  const evt = pushEvent;\n  pushEvent = null;\n  return evt;\n}\n\nexport function resetPlayer() {\n  playerPos.set(0, 0, 0);\n  playerGroup.position.set(0, 0, 0);\n  playerGroup.rotation.y = 0;\n  isDashing = false;\n  isInvincible = false;\n  endLagTimer = 0;\n  meleeSwinging = false;\n  meleeCooldownTimer = 0;\n  meleeSwingTimer = 0;\n  meleeHitEnemies.clear();\n  isCharging = false;\n  chargeTimer = 0;\n  pushEvent = null;\n  removeChargeTelegraph();\n  restoreDefaultEmissive();\n  resetAnimatorState(animState);\n\n  // Clean up afterimages\n  const scene = getScene();\n  for (const ai of afterimages) {\n    scene.remove(ai.mesh);\n  }\n  afterimages.length = 0;\n}\n\nexport function setPlayerPosition(x: number, z: number) {\n  playerPos.set(x, 0, z);\n  playerGroup.position.set(x, 0, z);\n}\n", "import { screenToWorld } from './renderer';\nimport { getPlayerPos } from '../entities/player';\n\nconst keys: Record<string, boolean> = {};\n\nconst inputState = {\n  moveX: 0,\n  moveZ: 0,\n  aimWorldPos: { x: 0, y: 0, z: 0 },\n  mouseNDC: { x: 0, y: 0 },\n  dash: false,\n  attack: false,\n  ultimate: false,\n  ultimateHeld: false,\n  interact: false,\n  toggleEditor: false,\n  bulletTime: false,\n  bendMode: false,\n};\n\n// Isometric basis vectors (from prototype)\n// Camera faces along (-1, -1, -1)\n// Screen-right \u2192 world (1, 0, -1) normalized\n// Screen-up \u2192 world (-1, 0, -1) normalized\nconst INV_SQRT2 = 1 / Math.SQRT2;\nconst ISO_RIGHT_X = INV_SQRT2;\nconst ISO_RIGHT_Z = -INV_SQRT2;\nconst ISO_UP_X = -INV_SQRT2;\nconst ISO_UP_Z = -INV_SQRT2;\n\n// Gamepad state\nconst DEADZONE = 0.15;\nlet gamepadIndex = -1;\nlet gamepadAimActive = false;   // true while right stick is deflected beyond deadzone\nlet prevGamepadButtons: Record<string, boolean> = {};    // for edge-triggered button detection\n\n// Track input source \u2014 gamepad/touch aim overrides mouse aim when active\nlet usingGamepad = false;\n\n// Touch joystick state (nipplejs)\nlet touchMoveX = 0, touchMoveY = 0;  // screen-space from left stick\nlet touchAimX = 0, touchAimY = 0;    // screen-space from right stick\nlet touchAimActive = false;\nlet touchActive = false;             // true when any touch joystick is in use\n\nexport function initInput() {\n  window.addEventListener('keydown', (e) => {\n    if (e.repeat) return;\n    keys[e.code] = true;\n    usingGamepad = false;\n\n    // Edge-triggered ability inputs\n    if (e.code === 'Space') { inputState.dash = true; e.preventDefault(); }\n    if (e.code === 'KeyE') inputState.ultimate = true;\n    if (e.code === 'KeyF' || e.code === 'Enter') inputState.interact = true;\n    if (e.code === 'Backquote') inputState.toggleEditor = true;\n    if (e.code === 'KeyQ') inputState.bendMode = true;\n  });\n\n  window.addEventListener('keyup', (e) => {\n    keys[e.code] = false;\n  });\n\n  window.addEventListener('mousemove', (e) => {\n    inputState.mouseNDC.x = (e.clientX / window.innerWidth) * 2 - 1;\n    inputState.mouseNDC.y = -(e.clientY / window.innerHeight) * 2 + 1;\n    usingGamepad = false;\n  });\n\n  window.addEventListener('mousedown', (e) => {\n    if (e.button === 0) { // left click\n      inputState.attack = true;\n      usingGamepad = false;\n    }\n  });\n\n  // Gamepad connect/disconnect\n  window.addEventListener('gamepadconnected', (e: GamepadEvent) => {\n    console.log(`[input] Gamepad connected: ${e.gamepad.id}`);\n    gamepadIndex = e.gamepad.index;\n  });\n  window.addEventListener('gamepaddisconnected', (e: GamepadEvent) => {\n    console.log(`[input] Gamepad disconnected: ${e.gamepad.id}`);\n    if (e.gamepad.index === gamepadIndex) gamepadIndex = -1;\n  });\n\n  // Touch joysticks (nipplejs) \u2014 only on touch-capable devices\n  initTouchJoysticks();\n}\n\nfunction applyDeadzone(value: number) {\n  if (Math.abs(value) < DEADZONE) return 0;\n  // Remap from [deadzone..1] to [0..1] for smooth ramp\n  const sign = value > 0 ? 1 : -1;\n  return sign * (Math.abs(value) - DEADZONE) / (1 - DEADZONE);\n}\n\nfunction initTouchJoysticks() {\n  // Only initialize if nipplejs is loaded and we have touch capability\n  if (typeof nipplejs === 'undefined') return;\n  const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n  if (!hasTouch) return;\n\n  const zoneLeft = document.getElementById('zone-left');\n  const zoneRight = document.getElementById('zone-right');\n  if (!zoneLeft || !zoneRight) return;\n\n  // Ensure zones are visible on touch devices\n  zoneLeft.style.display = 'block';\n  zoneRight.style.display = 'block';\n\n  console.log('[input] Touch joysticks initialized');\n\n  // Left joystick \u2014 movement\n  const leftJoystick = nipplejs.create({\n    zone: zoneLeft,\n    mode: 'dynamic',\n    position: { left: '50%', top: '50%' },\n    color: 'rgba(68, 204, 136, 0.35)',\n    size: 120,\n    restOpacity: 0.5,\n  });\n\n  leftJoystick.on('move', (evt: any, data: any) => {\n    const force = Math.min(data.force, 1.5) / 1.5;\n    const angle = data.angle.radian;\n    touchMoveX = Math.cos(angle) * force;   // screen-right\n    touchMoveY = Math.sin(angle) * force;   // screen-up\n    touchActive = true;\n  });\n  leftJoystick.on('end', () => {\n    touchMoveX = 0;\n    touchMoveY = 0;\n  });\n\n  // Right joystick \u2014 aim + auto-fire\n  const rightJoystick = nipplejs.create({\n    zone: zoneRight,\n    mode: 'dynamic',\n    position: { left: '50%', top: '50%' },\n    color: 'rgba(255, 102, 68, 0.35)',\n    size: 120,\n    restOpacity: 0.5,\n  });\n\n  rightJoystick.on('move', (evt: any, data: any) => {\n    const force = Math.min(data.force, 1.5) / 1.5;\n    const angle = data.angle.radian;\n    touchAimX = Math.cos(angle) * force;\n    touchAimY = Math.sin(angle) * force;\n    touchAimActive = true;\n    touchActive = true;\n  });\n  rightJoystick.on('end', () => {\n    touchAimX = 0;\n    touchAimY = 0;\n    touchAimActive = false;\n  });\n}\n\nfunction pollTouchJoysticks() {\n  if (!touchActive) return;\n\n  // --- Left stick: movement ---\n  if (Math.abs(touchMoveX) > 0.01 || Math.abs(touchMoveY) > 0.01) {\n    // Map screen-space joystick to isometric world-space (same as WASD/gamepad)\n    // touchMoveX = screen right, touchMoveY = screen up\n    const tMoveX = touchMoveX * ISO_RIGHT_X + touchMoveY * ISO_UP_X;\n    const tMoveZ = touchMoveX * ISO_RIGHT_Z + touchMoveY * ISO_UP_Z;\n\n    // Touch overrides keyboard if keyboard isn't active\n    const kbActive = Math.abs(inputState.moveX) > 0.01 || Math.abs(inputState.moveZ) > 0.01;\n    if (!kbActive) {\n      inputState.moveX = tMoveX;\n      inputState.moveZ = tMoveZ;\n      const len = Math.sqrt(inputState.moveX * inputState.moveX + inputState.moveZ * inputState.moveZ);\n      if (len > 1) {\n        inputState.moveX /= len;\n        inputState.moveZ /= len;\n      }\n    }\n  }\n\n  // --- Right stick: aim ---\n  if (touchAimActive) {\n    const aimDirX = touchAimX * ISO_RIGHT_X + touchAimY * ISO_UP_X;\n    const aimDirZ = touchAimX * ISO_RIGHT_Z + touchAimY * ISO_UP_Z;\n\n    const pp = getPlayerPos();\n    const aimDist = 10;\n    inputState.aimWorldPos.x = pp.x + aimDirX * aimDist;\n    inputState.aimWorldPos.y = 0;\n    inputState.aimWorldPos.z = pp.z + aimDirZ * aimDist;\n  }\n}\n\nfunction pollGamepad() {\n  if (gamepadIndex < 0) return;\n  const gamepads = navigator.getGamepads();\n  const gp = gamepads[gamepadIndex];\n  if (!gp) return;\n\n  usingGamepad = true;\n\n  // --- Left stick: movement (axes 0, 1) ---\n  const lx = applyDeadzone(gp.axes[0] || 0);\n  const ly = applyDeadzone(gp.axes[1] || 0); // Y axis inverted (up = negative)\n\n  // Map screen-space stick to isometric world-space (same as WASD)\n  // lx = screen right, -ly = screen up (stick Y is inverted)\n  const gpMoveX = lx * ISO_RIGHT_X + (-ly) * ISO_UP_X;\n  const gpMoveZ = lx * ISO_RIGHT_Z + (-ly) * ISO_UP_Z;\n\n  // Blend with keyboard: if keyboard has input, keyboard wins; otherwise gamepad\n  const kbActive = Math.abs(inputState.moveX) > 0.01 || Math.abs(inputState.moveZ) > 0.01;\n  if (!kbActive && (Math.abs(gpMoveX) > 0.01 || Math.abs(gpMoveZ) > 0.01)) {\n    inputState.moveX = gpMoveX;\n    inputState.moveZ = gpMoveZ;\n    // Normalize if > 1\n    const len = Math.sqrt(inputState.moveX * inputState.moveX + inputState.moveZ * inputState.moveZ);\n    if (len > 1) {\n      inputState.moveX /= len;\n      inputState.moveZ /= len;\n    }\n  }\n\n  // --- Right stick: aim (axes 2, 3) ---\n  const rx = applyDeadzone(gp.axes[2] || 0);\n  const ry = applyDeadzone(gp.axes[3] || 0);\n\n  gamepadAimActive = (Math.abs(rx) > 0.01 || Math.abs(ry) > 0.01);\n\n  if (gamepadAimActive) {\n    // Convert stick direction to isometric world direction\n    const aimDirX = rx * ISO_RIGHT_X + (-ry) * ISO_UP_X;\n    const aimDirZ = rx * ISO_RIGHT_Z + (-ry) * ISO_UP_Z;\n\n    // Place aim target at player + direction * distance\n    const pp = getPlayerPos();\n    const aimDist = 10; // arbitrary distance so atan2 calculation works\n    inputState.aimWorldPos.x = pp.x + aimDirX * aimDist;\n    inputState.aimWorldPos.y = 0;\n    inputState.aimWorldPos.z = pp.z + aimDirZ * aimDist;\n  }\n\n  // --- Buttons (edge-triggered) ---\n  // Standard gamepad mapping:\n  // 0 = A (South), 1 = B (East), 2 = X (West), 3 = Y (North)\n  // 4 = LB, 5 = RB, 6 = LT, 7 = RT\n  const buttons = gp.buttons;\n\n  // Dash: A button (0) or LB (4)\n  const dashBtn = (buttons[0] && buttons[0].pressed) || (buttons[4] && buttons[4].pressed);\n  if (dashBtn && !prevGamepadButtons.dash) inputState.dash = true;\n  prevGamepadButtons.dash = !!dashBtn;\n\n  // Ultimate: RB (5) or RT (7)\n  const ultBtn = (buttons[5] && buttons[5].pressed) || (buttons[7] && buttons[7].pressed);\n  if (ultBtn && !prevGamepadButtons.ult) inputState.ultimate = true;\n  prevGamepadButtons.ult = !!ultBtn;\n\n  // Interact: Y button (3) \u2014 door interaction\n  const interactBtn = buttons[3] && buttons[3].pressed;\n  if (interactBtn && !prevGamepadButtons.interact) inputState.interact = true;\n  prevGamepadButtons.interact = !!interactBtn;\n\n  // Bullet Time: LT (6)\n  const btBtn = buttons[6] && buttons[6].pressed;\n  if (btBtn && !prevGamepadButtons.bulletTime) inputState.bulletTime = true;\n  prevGamepadButtons.bulletTime = !!btBtn;\n\n  // Ultimate held (for charge release detection)\n  if (ultBtn) inputState.ultimateHeld = true;\n}\n\nexport function updateInput() {\n  // WASD \u2192 raw screen-space directions\n  let rawX = 0, rawY = 0;\n  if (keys['KeyD'] || keys['ArrowRight']) rawX += 1;\n  if (keys['KeyA'] || keys['ArrowLeft'])  rawX -= 1;\n  if (keys['KeyW'] || keys['ArrowUp'])    rawY += 1;\n  if (keys['KeyS'] || keys['ArrowDown'])  rawY -= 1;\n\n  // Map screen-space to isometric world-space\n  inputState.moveX = rawX * ISO_RIGHT_X + rawY * ISO_UP_X;\n  inputState.moveZ = rawX * ISO_RIGHT_Z + rawY * ISO_UP_Z;\n\n  // Normalize diagonal movement\n  const len = Math.sqrt(inputState.moveX * inputState.moveX + inputState.moveZ * inputState.moveZ);\n  if (len > 1) {\n    inputState.moveX /= len;\n    inputState.moveZ /= len;\n  }\n\n  // Continuous held state for charge abilities\n  // Merge keyboard + touch button hold (gamepad sets it in pollGamepad)\n  inputState.ultimateHeld = !!keys['KeyE'] || _touchUltHeld;\n\n  // Mouse \u2192 world position on y=0 plane (only if not overridden by gamepad/touch/ability drag)\n  if ((!usingGamepad || !gamepadAimActive) && !touchAimActive && !_abilityAimActive) {\n    const worldPos = screenToWorld(inputState.mouseNDC.x, inputState.mouseNDC.y);\n    inputState.aimWorldPos.x = worldPos.x;\n    inputState.aimWorldPos.y = worldPos.y;\n    inputState.aimWorldPos.z = worldPos.z;\n  }\n\n  // Poll gamepad (blends with keyboard/mouse above)\n  pollGamepad();\n\n  // Poll touch joysticks (blends with keyboard/mouse/gamepad above)\n  pollTouchJoysticks();\n}\n\nexport function consumeInput() {\n  inputState.dash = false;\n  inputState.attack = false;\n  inputState.ultimate = false;\n  inputState.interact = false;\n  inputState.toggleEditor = false;\n  inputState.bulletTime = false;\n  inputState.bendMode = false;\n}\n\nexport function getInputState() { return inputState; }\n\n// Expose for touch-screen ability buttons\nlet _touchUltHeld = false;\nexport function triggerDash() { inputState.dash = true; }\nexport function triggerUltimate() { inputState.ultimate = true; }\nexport function setUltimateHeld(held: boolean) { _touchUltHeld = held; }\n\n// Drag-to-aim: set aim world position from screen-space drag direction\nlet _abilityAimActive = false; // true while a mobile button drag is overriding aim\nexport function setAimFromScreenDrag(screenX: number, screenY: number) {\n  _abilityAimActive = true;\n  const aimDirX = screenX * ISO_RIGHT_X + screenY * ISO_UP_X;\n  const aimDirZ = screenX * ISO_RIGHT_Z + screenY * ISO_UP_Z;\n\n  const pp = getPlayerPos();\n  const aimDist = 10;\n  inputState.aimWorldPos.x = pp.x + aimDirX * aimDist;\n  inputState.aimWorldPos.y = 0;\n  inputState.aimWorldPos.z = pp.z + aimDirZ * aimDist;\n}\n\n// Override movement direction for dash drag-to-aim\nlet _abilityDirOverride: { x: number; z: number } | null = null;\nexport function setAbilityDirOverride(x: number, z: number) { _abilityDirOverride = { x, z }; }\nexport function clearAbilityDirOverride() { _abilityDirOverride = null; _abilityAimActive = false; }\nexport function getAbilityDirOverride() { return _abilityDirOverride; }\n\n/**\n * Mobile auto-aim: if on a touch device and the right joystick / ability drag\n * is NOT active, aim at the closest enemy automatically.\n * Called from game loop after updateInput(), before updatePlayer().\n */\nexport function autoAimClosestEnemy(enemies: any[]) {\n  // Only on touch devices, and only when no manual aim is active\n  if (!touchActive) return;\n  if (touchAimActive || _abilityAimActive) return;\n\n  if (!enemies || enemies.length === 0) return;\n\n  const pp = getPlayerPos();\n  let closest: any = null;\n  let closestDist = Infinity;\n\n  for (let i = 0; i < enemies.length; i++) {\n    const e = enemies[i];\n    if (e.fellInPit || e.health <= 0) continue;\n    const dx = e.pos.x - pp.x;\n    const dz = e.pos.z - pp.z;\n    const dist = dx * dx + dz * dz; // squared distance is fine for comparison\n    if (dist < closestDist) {\n      closestDist = dist;\n      closest = e;\n    }\n  }\n\n  if (closest) {\n    inputState.aimWorldPos.x = closest.pos.x;\n    inputState.aimWorldPos.y = 0;\n    inputState.aimWorldPos.z = closest.pos.z;\n  }\n}\n", "// Room definitions for the Hades prototype\n// Each room defines its own arena layout, obstacles, pits, and incremental spawn budget\n// Rooms are rectangular (longer on Z) \u2014 player enters from +Z (bottom-left in iso),\n// progresses toward -Z (top-right in iso), exits through a door at the far end\n\nimport { Obstacle, Pit, SpawnPack, RoomSpawnBudget, PhysicsObjectPlacement } from '../types/index';\n\nexport interface RoomDefinition {\n  name: string;\n  arenaHalfX: number;\n  arenaHalfZ: number;\n  obstacles: Obstacle[];\n  pits: Pit[];\n  spawnBudget: RoomSpawnBudget;\n  playerStart: { x: number; z: number };\n  physicsObjects?: PhysicsObjectPlacement[];\n  isRestRoom?: boolean;\n  isVictoryRoom?: boolean;\n}\n\n// \u2500\u2500\u2500 Helper: build packs of N enemies \u2500\u2500\u2500\n\nfunction pack(enemies: { type: string }[], zone: SpawnPack['spawnZone'] = 'ahead'): SpawnPack {\n  return { enemies, spawnZone: zone };\n}\n\nfunction goblins(n: number): { type: string }[] {\n  return Array.from({ length: n }, () => ({ type: 'goblin' }));\n}\n\nfunction archers(n: number): { type: string }[] {\n  return Array.from({ length: n }, () => ({ type: 'skeletonArcher' }));\n}\n\nfunction imps(n: number): { type: string }[] {\n  return Array.from({ length: n }, () => ({ type: 'iceMortarImp' }));\n}\n\n// \u2500\u2500\u2500 Room Definitions \u2500\u2500\u2500\n\nexport const ROOMS: RoomDefinition[] = [\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // Room 1: \"The Approach\" \u2014 goblins only, teach melee + dash\n  // Player enters at +Z (bottom-left in iso), progresses toward -Z (top-right)\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  {\n    name: 'The Approach',\n    arenaHalfX: 10,\n    arenaHalfZ: 22,\n    obstacles: [\n      { x: -4, z: 5, w: 1.5, h: 2, d: 1.5 },    // pillar left near entrance\n      { x: 4, z: -5, w: 1.5, h: 2, d: 1.5, destructible: true, health: 50, maxHealth: 50, material: 'stone' as const },  // destructible pillar right mid\n      { x: 0, z: -12, w: 3, h: 1, d: 1 },         // low wall far\n    ],\n    pits: [\n      { x: 5, z: -8, w: 3, d: 3 },                // small pit mid-right (teaches force push)\n    ],\n    physicsObjects: [\n      { meshType: 'rock', material: 'stone', x: -2, z: -2, mass: 2.0, health: 9999, radius: 0.8 },\n      { meshType: 'barrel', material: 'wood', x: 3, z: -6, mass: 0.5, health: 150, radius: 0.5, scale: 0.8 },\n      { meshType: 'crate', material: 'wood', x: -5, z: -8, mass: 0.8, health: 150, radius: 0.6 },\n      { meshType: 'barrel', material: 'metal', x: 6, z: 2, mass: 1.0, health: 200, radius: 0.5 },\n    ],\n    spawnBudget: {\n      maxConcurrent: 4,\n      telegraphDuration: 1500,\n      packs: [\n        // Start light: 2 goblins ahead\n        pack(goblins(2), 'ahead'),\n        pack(goblins(2), 'ahead'),\n        // Ramp up: 3 goblins, mix positions\n        pack(goblins(3), 'ahead'),\n        pack(goblins(3), 'sides'),\n        // One final push from far end\n        pack(goblins(2), 'far'),\n      ],\n    },\n    playerStart: { x: 0, z: 18 },\n  },\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // Room 2: \"The Crossfire\" \u2014 goblins + archers, introduce ranged pressure\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  {\n    name: 'The Crossfire',\n    arenaHalfX: 12,\n    arenaHalfZ: 24,\n    obstacles: [\n      { x: -6, z: 0, w: 2, h: 2, d: 2 },         // cover pillar left\n      { x: 6, z: 0, w: 2, h: 2, d: 2 },           // cover pillar right\n      { x: 0, z: -10, w: 4, h: 1.5, d: 1 },       // mid wall (toward far/exit end)\n      { x: -3, z: 10, w: 1.5, h: 2, d: 1.5 },     // pillar near entrance\n    ],\n    pits: [\n      { x: -8, z: -8, w: 3, d: 4 },               // pit left mid (toward exit)\n      { x: 8, z: 5, w: 3, d: 3 },                  // pit right near entrance\n    ],\n    spawnBudget: {\n      maxConcurrent: 5,\n      telegraphDuration: 1500,\n      packs: [\n        // Intro: goblins rush\n        pack(goblins(2), 'ahead'),\n        // Archer appears far back\n        pack([...archers(1), ...goblins(1)], 'far'),\n        // More melee pressure\n        pack(goblins(3), 'ahead'),\n        // Flanking archers\n        pack(archers(2), 'sides'),\n        // Mixed push\n        pack([...goblins(2), ...archers(1)], 'ahead'),\n        // Final rush\n        pack(goblins(3), 'sides'),\n      ],\n    },\n    physicsObjects: [\n      { meshType: 'barrel', material: 'wood', x: -3, z: 5, mass: 0.5, health: 150, radius: 0.5 },\n      { meshType: 'rock', material: 'stone', x: 7, z: -3, mass: 1.5, health: 9999, radius: 0.7 },\n      { meshType: 'crate', material: 'metal', x: -7, z: -5, mass: 1.2, health: 200, radius: 0.6 },\n    ],\n    playerStart: { x: 0, z: 20 },\n  },\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // Room 3: \"The Crucible\" \u2014 full mix with imps, area denial\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  {\n    name: 'The Crucible',\n    arenaHalfX: 13,\n    arenaHalfZ: 25,\n    obstacles: [\n      { x: -5, z: 8, w: 2, h: 2, d: 2 },         // pillar near entrance left\n      { x: 5, z: 8, w: 2, h: 2, d: 2 },           // pillar near entrance right\n      { x: 0, z: -5, w: 1.5, h: 2.5, d: 1.5 },   // tall center pillar\n      { x: -8, z: -10, w: 3, h: 1, d: 1 },        // low wall far left\n      { x: 8, z: -10, w: 3, h: 1, d: 1 },         // low wall far right\n    ],\n    pits: [\n      { x: 0, z: 3, w: 5, d: 3 },                 // central pit (forces flanking)\n      { x: -9, z: -15, w: 3, d: 4 },              // far left pit\n      { x: 9, z: -15, w: 3, d: 4 },               // far right pit\n    ],\n    spawnBudget: {\n      maxConcurrent: 6,\n      telegraphDuration: 1500,\n      packs: [\n        // Start with melee rush\n        pack(goblins(3), 'ahead'),\n        // Introduce ranged\n        pack([...archers(1), ...goblins(1)], 'far'),\n        // First imp \u2014 area denial begins\n        pack([...imps(1), ...goblins(1)], 'sides'),\n        // Melee wave to push player into imp zones\n        pack(goblins(3), 'ahead'),\n        // More imps + archer\n        pack([...imps(1), ...archers(1)], 'far'),\n        // Heavy mixed final push\n        pack([...goblins(2), ...imps(1)], 'ahead'),\n        pack([...archers(1), ...goblins(1)], 'sides'),\n      ],\n    },\n    physicsObjects: [\n      { meshType: 'pillar', material: 'stone', x: -3, z: 0, mass: 3.0, health: 9999, radius: 0.5 },\n      { meshType: 'barrel', material: 'wood', x: 6, z: -8, mass: 0.5, health: 150, radius: 0.5, scale: 0.9 },\n      { meshType: 'crate', material: 'wood', x: -6, z: -12, mass: 0.8, health: 150, radius: 0.6 },\n      { meshType: 'rock', material: 'ice', x: 3, z: 12, mass: 1.0, health: 100, radius: 0.6 },\n    ],\n    playerStart: { x: 0, z: 21 },\n  },\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // Room 4: \"The Respite\" \u2014 rest room, heal to full\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  {\n    name: 'The Respite',\n    arenaHalfX: 8,\n    arenaHalfZ: 12,\n    obstacles: [],\n    pits: [],\n    spawnBudget: {\n      maxConcurrent: 0,\n      telegraphDuration: 0,\n      packs: [],\n    },\n    playerStart: { x: 0, z: 8 },\n    isRestRoom: true,\n  },\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // Room 5: \"The Throne\" \u2014 victory room (boss designed separately)\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  {\n    name: 'The Throne',\n    arenaHalfX: 10,\n    arenaHalfZ: 10,\n    obstacles: [],\n    pits: [],\n    spawnBudget: {\n      maxConcurrent: 0,\n      telegraphDuration: 0,\n      packs: [],\n    },\n    playerStart: { x: 0, z: 6 },\n    isVictoryRoom: true,\n  },\n];\n", "// Spawn pacing config \u2014 tunable at runtime via tuning panel\n\nexport const SPAWN_CONFIG = {\n  telegraphDuration: 1500,   // ms \u2014 how long spawn warnings show before enemies appear\n  spawnCooldown: 500,        // ms \u2014 minimum delay between consecutive pack dispatches\n  maxConcurrentMult: 1.0,    // multiplier on per-room maxConcurrent\n  spawnAheadMin: 8,          // minimum distance ahead of player to spawn enemies (Z units)\n  spawnAheadMax: 15,         // maximum distance ahead of player to spawn enemies (Z units)\n};\n", "// Physics config \u2014 tunable via tuning panel\n// Controls velocity-based knockback, wall slam damage, and bounce behavior\n\nexport const PHYSICS = {\n  // Knockback velocity\n  friction: 25,              // deceleration rate (units/s\u00B2) \u2014 higher = snappier stop\n  minVelocity: 0.1,          // below this speed, zero out velocity\n  pushInstantRatio: 0,       // fraction of knockback as instant position offset (0 = pure velocity)\n\n  // Wall slam\n  wallSlamMinSpeed: 3,       // minimum impact speed for wall damage\n  wallSlamDamage: 8,         // damage per unit of impact speed above threshold\n  wallSlamStun: 400,         // ms stun on wall slam\n  wallSlamBounce: 0.4,       // velocity reflection coefficient (0 = dead stop, 1 = perfect bounce)\n  wallSlamShake: 3,          // screen shake intensity on wall slam\n\n  // Force push wave occlusion\n  pushWaveBlockRadius: 0.8,  // lateral distance for one enemy to block another from push wave\n\n  // Enemy-enemy collision\n  enemyBounce: 0.4,          // enemy-enemy restitution coefficient\n  impactMinSpeed: 2,         // minimum relative speed for collision damage\n  impactDamage: 5,           // damage per unit of relative speed above threshold\n  impactStun: 300,           // ms stun when hit by another enemy\n\n  // Physics objects\n  objectFriction: 25,          // deceleration for physics objects\n  objectWallSlamMinSpeed: 3,   // min impact speed for wall slam damage\n  objectWallSlamDamage: 8,     // damage per unit of speed above threshold\n  objectWallSlamStun: 0,       // objects don't stun (no AI)\n  objectWallSlamBounce: 0.4,   // velocity reflection coefficient\n  objectWallSlamShake: 2,      // screen shake intensity\n  objectImpactMinSpeed: 2,     // min relative speed for impact damage\n  objectImpactDamage: 5,       // damage per unit of relative speed above threshold\n};\n", "// Pure math utilities for melee combat \u2014 no THREE.js dependency\n// Extracted for testability\n\n/**\n * Check if a target is within a melee arc.\n * @param playerX Player X position\n * @param playerZ Player Z position\n * @param swingAngle Player facing angle (radians, atan2 convention: atan2(-dx,-dz))\n * @param targetX Target X position\n * @param targetZ Target Z position\n * @param range Max hit distance\n * @param arc Total arc width in radians\n */\nexport function isInMeleeArc(\n  playerX: number, playerZ: number, swingAngle: number,\n  targetX: number, targetZ: number, range: number, arc: number\n): boolean {\n  const dx = targetX - playerX;\n  const dz = targetZ - playerZ;\n  const distSq = dx * dx + dz * dz;\n  if (distSq > range * range) return false;\n  if (distSq < 0.001) return true; // on top of player = always hit\n\n  const angleToTarget = Math.atan2(-dx, -dz);\n  let angleDiff = angleToTarget - swingAngle;\n  while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n  while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n  return Math.abs(angleDiff) <= arc / 2;\n}\n", "import { getPlayerPos, isPlayerInvincible, isPlayerDashing, consumePushEvent, isMeleeSwinging, getMeleeSwingDir, getMeleeHitEnemies } from '../entities/player';\nimport { getPlayerProjectiles, getEnemyProjectiles, releaseProjectile } from '../entities/projectile';\nimport { stunEnemy } from '../entities/enemy';\nimport { getIceEffects } from '../entities/mortarProjectile';\nimport { triggerHitReaction } from '../entities/enemyRig';\nimport { emit } from './events';\nimport { screenShake, getScene, rebuildArenaVisuals } from './renderer';\nimport { PLAYER, MELEE } from '../config/player';\nimport { PHYSICS } from '../config/physics';\nimport { isInMeleeArc } from './meleemath';\nimport { getCollisionBounds, getPitBounds, OBSTACLES } from '../config/arena';\nimport { spawnDamageNumber } from '../ui/damageNumbers';\nimport { applyAoeEffect, isInRotatedRect, createAoeRing } from './aoeTelegraph';\nimport { AABB, GameState, Enemy } from '../types/index';\nimport type { Group, CylinderGeometry, SphereGeometry, Mesh, MeshBasicMaterial, Material } from 'three';\n\n// Cache collision bounds (invalidated when arena layout changes)\nlet collisionBounds: AABB[] | null = null;\nlet pitBounds: AABB[] | null = null;\nlet movementBounds: AABB[] | null = null;\n\n// Invalidate cached bounds \u2014 called by level editor when obstacles/pits change\nexport function invalidateCollisionBounds(): void {\n  collisionBounds = null;\n  pitBounds = null;\n  movementBounds = null;\n}\n\n// Effect ghosts \u2014 push afterimages + pit fall sinking ghosts\ninterface EffectGhost {\n  type: 'fade' | 'sink';\n  mesh: Group;\n  life: number;\n  maxLife: number;\n}\nconst effectGhosts: EffectGhost[] = [];\n\n// Shared unit geometries for ghost meshes (scaled per-instance)\nlet _ghostBodyGeo: CylinderGeometry | null = null;\nlet _ghostHeadGeo: SphereGeometry | null = null;\n\nfunction createGhostMesh(x: number, z: number, radius: number, height: number, color: number): Group {\n  if (!_ghostBodyGeo) {\n    _ghostBodyGeo = new THREE.CylinderGeometry(1, 1, 1, 6);\n    _ghostHeadGeo = new THREE.SphereGeometry(1, 6, 4);\n  }\n  const group = new THREE.Group();\n\n  const bodyMat = new THREE.MeshBasicMaterial({ color, transparent: true, opacity: 0.4 });\n  const body = new THREE.Mesh(_ghostBodyGeo, bodyMat);\n  const bodyH = height * 0.6;\n  body.scale.set(radius, bodyH, radius);\n  body.position.y = height * 0.3;\n  group.add(body);\n\n  const headMat = new THREE.MeshBasicMaterial({ color, transparent: true, opacity: 0.4 });\n  const headR = radius * 0.7;\n  const head = new THREE.Mesh(_ghostHeadGeo!, headMat);\n  head.scale.set(headR, headR, headR);\n  head.position.y = height * 0.75;\n  group.add(head);\n\n  group.position.set(x, 0, z);\n  getScene().add(group);\n  return group;\n}\n\nfunction spawnPushGhosts(enemy: Enemy, oldX: number, oldZ: number, newX: number, newZ: number): void {\n  const cfg = enemy.config;\n  const r = cfg.size.radius;\n  const h = cfg.size.height;\n  for (let t = 0.33; t < 1; t += 0.33) {\n    const gx = oldX + (newX - oldX) * t;\n    const gz = oldZ + (newZ - oldZ) * t;\n    const mesh = createGhostMesh(gx, gz, r, h, 0x44ffaa);\n    effectGhosts.push({ type: 'fade', mesh, life: 0, maxLife: 300 });\n  }\n}\n\nfunction spawnPitFallGhost(enemy: Enemy): void {\n  const cfg = enemy.config;\n  const r = cfg.size.radius;\n  const h = cfg.size.height;\n  const mesh = createGhostMesh(enemy.pos.x, enemy.pos.z, r, h, 0x8844ff);\n  mesh.children.forEach(child => {\n    ((child as Mesh).material as MeshBasicMaterial).opacity = 0.7;\n  });\n  effectGhosts.push({ type: 'sink', mesh, life: 0, maxLife: 500 });\n}\n\nexport function updateEffectGhosts(dt: number): void {\n  const dtMs = dt * 1000;\n  const scene = getScene();\n\n  for (let i = effectGhosts.length - 1; i >= 0; i--) {\n    const g = effectGhosts[i];\n    g.life += dtMs;\n    const t = Math.min(g.life / g.maxLife, 1);\n\n    if (g.type === 'fade') {\n      const alpha = 0.4 * (1 - t);\n      g.mesh.children.forEach(child => {\n        ((child as Mesh).material as MeshBasicMaterial).opacity = alpha;\n      });\n    } else if (g.type === 'sink') {\n      const scale = 1 - t;\n      g.mesh.scale.set(scale, scale, scale);\n      g.mesh.position.y = -1.5 * t;\n      const alpha = 0.7 * (1 - t * t);\n      g.mesh.children.forEach(child => {\n        ((child as Mesh).material as MeshBasicMaterial).opacity = alpha;\n      });\n    }\n\n    if (t >= 1) {\n      g.mesh.children.forEach(child => {\n        ((child as Mesh).material as Material).dispose();\n      });\n      scene.remove(g.mesh);\n      effectGhosts.splice(i, 1);\n    }\n  }\n}\n\nexport function clearEffectGhosts(): void {\n  const scene = getScene();\n  for (const g of effectGhosts) {\n    g.mesh.children.forEach(child => {\n      ((child as Mesh).material as Material).dispose();\n    });\n    scene.remove(g.mesh);\n  }\n  effectGhosts.length = 0;\n}\n\nexport function getBounds(): AABB[] {\n  if (!collisionBounds) collisionBounds = getCollisionBounds();\n  return collisionBounds;\n}\n\nexport function getPits(): AABB[] {\n  if (!pitBounds) pitBounds = getPitBounds();\n  return pitBounds;\n}\n\nfunction getMoveBounds(): AABB[] {\n  if (!movementBounds) movementBounds = [...getBounds(), ...getPits()];\n  return movementBounds;\n}\n\nfunction circleVsAABB(cx: number, cz: number, radius: number, box: AABB): { x: number; z: number } | null {\n  const closestX = Math.max(box.minX, Math.min(cx, box.maxX));\n  const closestZ = Math.max(box.minZ, Math.min(cz, box.maxZ));\n\n  const dx = cx - closestX;\n  const dz = cz - closestZ;\n  const distSq = dx * dx + dz * dz;\n\n  if (distSq < radius * radius) {\n    const dist = Math.sqrt(distSq);\n    if (dist === 0) {\n      const overlapLeft = cx - box.minX;\n      const overlapRight = box.maxX - cx;\n      const overlapTop = cz - box.minZ;\n      const overlapBottom = box.maxZ - cz;\n      const minOverlap = Math.min(overlapLeft, overlapRight, overlapTop, overlapBottom);\n      if (minOverlap === overlapLeft) return { x: -(overlapLeft + radius), z: 0 };\n      if (minOverlap === overlapRight) return { x: overlapRight + radius, z: 0 };\n      if (minOverlap === overlapTop) return { x: 0, z: -(overlapTop + radius) };\n      return { x: 0, z: overlapBottom + radius };\n    }\n    const overlap = radius - dist;\n    return { x: (dx / dist) * overlap, z: (dz / dist) * overlap };\n  }\n  return null;\n}\n\nfunction pointVsAABB(px: number, pz: number, box: AABB): boolean {\n  return px >= box.minX && px <= box.maxX && pz >= box.minZ && pz <= box.maxZ;\n}\n\nexport function resolveTerrainCollision(x: number, z: number, radius: number): { x: number; z: number } {\n  const bounds = getBounds();\n  let rx = x, rz = z;\n  for (const box of bounds) {\n    const push = circleVsAABB(rx, rz, radius, box);\n    if (push) {\n      rx += push.x;\n      rz += push.z;\n    }\n  }\n  return { x: rx, z: rz };\n}\n\nexport function pointHitsTerrain(px: number, pz: number): boolean {\n  const bounds = getBounds();\n  for (const box of bounds) {\n    if (pointVsAABB(px, pz, box)) return true;\n  }\n  return false;\n}\n\nexport function resolveMovementCollision(x: number, z: number, radius: number): { x: number; z: number; wasDeflected: boolean } {\n  const bounds = getMoveBounds();\n  let rx = x, rz = z;\n  let wasDeflected = false;\n  for (const box of bounds) {\n    const push = circleVsAABB(rx, rz, radius, box);\n    if (push) {\n      rx += push.x;\n      rz += push.z;\n      wasDeflected = true;\n    }\n  }\n  return { x: rx, z: rz, wasDeflected };\n}\n\n// Enhanced terrain collision that returns wall normal info (for wall slam detection)\ninterface CollisionResult {\n  x: number;\n  z: number;\n  hitWall: boolean;\n  normalX: number;\n  normalZ: number;\n}\n\nfunction resolveTerrainCollisionEx(x: number, z: number, radius: number): CollisionResult {\n  const bounds = getBounds();\n  let rx = x, rz = z;\n  let hitWall = false;\n  let totalNX = 0, totalNZ = 0;\n\n  for (const box of bounds) {\n    const push = circleVsAABB(rx, rz, radius, box);\n    if (push) {\n      rx += push.x;\n      rz += push.z;\n      hitWall = true;\n      // Accumulate push direction as wall normal\n      const len = Math.sqrt(push.x * push.x + push.z * push.z);\n      if (len > 0.001) {\n        totalNX += push.x / len;\n        totalNZ += push.z / len;\n      }\n    }\n  }\n\n  // Normalize accumulated normal\n  const nLen = Math.sqrt(totalNX * totalNX + totalNZ * totalNZ);\n  if (nLen > 0.001) {\n    totalNX /= nLen;\n    totalNZ /= nLen;\n  }\n\n  return { x: rx, z: rz, hitWall, normalX: totalNX, normalZ: totalNZ };\n}\n\n// \u2500\u2500\u2500 Velocity Integration + Wall Slam \u2500\u2500\u2500\n\nexport function applyVelocities(dt: number, gameState: GameState): void {\n  for (const enemy of gameState.enemies) {\n    if (enemy.health <= 0) continue;\n    if ((enemy as any).isLeaping) continue;\n\n    const vel = (enemy as any).vel;\n    if (!vel) continue;\n\n    const speed = Math.sqrt(vel.x * vel.x + vel.z * vel.z);\n    if (speed < PHYSICS.minVelocity) {\n      vel.x = 0;\n      vel.z = 0;\n      continue;\n    }\n\n    // Move by velocity \u2014 step in increments of enemy radius to prevent wall tunneling\n    const moveDist = speed * dt;\n    const enemyRadius = enemy.config.size.radius;\n    const moveSteps = Math.ceil(moveDist / enemyRadius);\n    const subDt = dt / Math.max(moveSteps, 1);\n    let result: CollisionResult = { x: enemy.pos.x, z: enemy.pos.z, hitWall: false, normalX: 0, normalZ: 0 };\n\n    let fellInPit = false;\n    for (let s = 0; s < moveSteps; s++) {\n      enemy.pos.x += vel.x * subDt;\n      enemy.pos.z += vel.z * subDt;\n\n      // Check for pit fall BEFORE terrain resolution \u2014 if knockback carries\n      // the enemy into a pit, they fall in immediately\n      if (pointInPit(enemy.pos.x, enemy.pos.z)) {\n        fellInPit = true;\n        break;\n      }\n\n      result = resolveTerrainCollisionEx(enemy.pos.x, enemy.pos.z, enemyRadius);\n      enemy.pos.x = result.x;\n      enemy.pos.z = result.z;\n      if (result.hitWall) break; // Stop stepping on wall hit \u2014 wall slam will handle the rest\n    }\n    (enemy as any).mesh.position.copy(enemy.pos);\n\n    // Pit fall \u2014 enemy was knocked into a pit by velocity\n    if (fellInPit) {\n      spawnPitFallGhost(enemy);\n      emit({ type: 'pitFall', position: { x: enemy.pos.x, z: enemy.pos.z }, isPlayer: false });\n      createAoeRing(enemy.pos.x, enemy.pos.z, 2.5, 500, 0x8844ff);\n      enemy.health = 0;\n      (enemy as any).fellInPit = true;\n      enemy.stunTimer = 9999;\n      spawnDamageNumber(enemy.pos.x, enemy.pos.z, 'FELL!', '#8844ff');\n      screenShake(4, 200);\n      vel.x = 0;\n      vel.z = 0;\n      continue; // Skip wall slam + friction \u2014 enemy is gone\n    }\n\n    // Wall slam detection\n    if (result.hitWall && speed > PHYSICS.wallSlamMinSpeed) {\n      const slamDamage = Math.round((speed - PHYSICS.wallSlamMinSpeed) * PHYSICS.wallSlamDamage);\n      applyDamageToEnemy(enemy, slamDamage, gameState);\n      stunEnemy(enemy, PHYSICS.wallSlamStun);\n\n      // Feedback\n      emit({ type: 'wallSlam', enemy, speed, damage: slamDamage, position: { x: enemy.pos.x, z: enemy.pos.z } });\n      spawnDamageNumber(enemy.pos.x, enemy.pos.z, slamDamage, '#ff8844');\n      screenShake(PHYSICS.wallSlamShake, 120);\n\n      // Flash enemy\n      enemy.flashTimer = 120;\n      if ((enemy as any).bodyMesh) (enemy as any).bodyMesh.material.emissive.setHex(0xff8844);\n      if ((enemy as any).headMesh) (enemy as any).headMesh.material.emissive.setHex(0xff8844);\n\n      // Impact ring at slam point (terrain flash)\n      createAoeRing(enemy.pos.x, enemy.pos.z, 1.5, 300, 0xff8844);\n\n      // Reflect velocity off wall normal\n      const dot = vel.x * result.normalX + vel.z * result.normalZ;\n      vel.x = (vel.x - 2 * dot * result.normalX) * PHYSICS.wallSlamBounce;\n      vel.z = (vel.z - 2 * dot * result.normalZ) * PHYSICS.wallSlamBounce;\n    }\n\n    // Apply friction (reduce speed, preserve direction)\n    const newSpeed = speed - PHYSICS.friction * dt;\n    if (newSpeed <= PHYSICS.minVelocity) {\n      vel.x = 0;\n      vel.z = 0;\n    } else {\n      const scale = newSpeed / speed;\n      vel.x *= scale;\n      vel.z *= scale;\n    }\n  }\n}\n\n// \u2500\u2500\u2500 PhysicsObject Velocity Integration \u2500\u2500\u2500\n\nexport function applyObjectVelocities(dt: number, gameState: GameState): void {\n  for (const obj of gameState.physicsObjects) {\n    if (obj.destroyed) continue;\n\n    const vel = obj.vel;\n    const speed = Math.sqrt(vel.x * vel.x + vel.z * vel.z);\n    if (speed < PHYSICS.minVelocity) {\n      vel.x = 0;\n      vel.z = 0;\n      continue;\n    }\n\n    // Stepped movement to prevent wall tunneling\n    const moveDist = speed * dt;\n    const moveSteps = Math.ceil(moveDist / obj.radius);\n    const subDt = dt / Math.max(moveSteps, 1);\n    let result: CollisionResult = { x: obj.pos.x, z: obj.pos.z, hitWall: false, normalX: 0, normalZ: 0 };\n\n    let fellInPit = false;\n    for (let s = 0; s < moveSteps; s++) {\n      obj.pos.x += vel.x * subDt;\n      obj.pos.z += vel.z * subDt;\n\n      if (pointInPit(obj.pos.x, obj.pos.z)) {\n        fellInPit = true;\n        break;\n      }\n\n      result = resolveTerrainCollisionEx(obj.pos.x, obj.pos.z, obj.radius);\n      obj.pos.x = result.x;\n      obj.pos.z = result.z;\n\n      if (result.hitWall) {\n        // Slide along wall: remove velocity component into the wall normal\n        const dot = vel.x * result.normalX + vel.z * result.normalZ;\n        if (dot < 0) {\n          vel.x -= dot * result.normalX;\n          vel.z -= dot * result.normalZ;\n        }\n        const slideSpeed = Math.sqrt(vel.x * vel.x + vel.z * vel.z);\n        if (slideSpeed < PHYSICS.minVelocity) break;\n      }\n\n      // Check collision with other physics objects during stepping.\n      // This prevents a fast-moving object from tunneling through another.\n      let hitObject = false;\n      for (const other of gameState.physicsObjects) {\n        if (other === obj || other.destroyed) continue;\n        const odx = obj.pos.x - other.pos.x;\n        const odz = obj.pos.z - other.pos.z;\n        const oDistSq = odx * odx + odz * odz;\n        const oMinDist = obj.radius + other.radius;\n        if (oDistSq < oMinDist * oMinDist && oDistSq > 0.0001) {\n          // Push this object back out and stop stepping\n          const oDist = Math.sqrt(oDistSq);\n          const oOverlap = oMinDist - oDist;\n          const onx = odx / oDist;\n          const onz = odz / oDist;\n          obj.pos.x += onx * oOverlap;\n          obj.pos.z += onz * oOverlap;\n\n          // Remove velocity component into the other object\n          const vDot = vel.x * (-onx) + vel.z * (-onz);\n          if (vDot > 0) {\n            vel.x += vDot * onx;\n            vel.z += vDot * onz;\n          }\n          hitObject = true;\n          break;\n        }\n      }\n      if (hitObject) break;\n    }\n\n    // Sync mesh position\n    if (obj.mesh) {\n      obj.mesh.position.set(obj.pos.x, 0, obj.pos.z);\n    }\n\n    // Pit fall\n    if (fellInPit) {\n      obj.destroyed = true;\n      obj.fellInPit = true;\n      emit({ type: 'objectPitFall', object: obj, position: { x: obj.pos.x, z: obj.pos.z } });\n      if (obj.mesh) obj.mesh.visible = false;\n      vel.x = 0;\n      vel.z = 0;\n      continue;\n    }\n\n    // Wall slam \u2014 uses original speed (before wall slide) for damage calculation\n    if (result.hitWall && speed > PHYSICS.objectWallSlamMinSpeed) {\n      const slamDamage = Math.round((speed - PHYSICS.objectWallSlamMinSpeed) * PHYSICS.objectWallSlamDamage);\n\n      // Damage the object itself\n      obj.health -= slamDamage;\n      if (obj.health <= 0) {\n        obj.health = 0;\n        obj.destroyed = true;\n        if (obj.mesh) obj.mesh.visible = false;\n        emit({ type: 'objectDestroyed', object: obj, position: { x: obj.pos.x, z: obj.pos.z } });\n      }\n\n      emit({ type: 'objectWallSlam', object: obj, speed, damage: slamDamage, position: { x: obj.pos.x, z: obj.pos.z } });\n      screenShake(PHYSICS.objectWallSlamShake, 120);\n\n      // Apply bounce damping to remaining (slid) velocity \u2014 energy is lost on wall impact\n      const bounce = obj.restitution ?? PHYSICS.objectWallSlamBounce;\n      vel.x *= bounce;\n      vel.z *= bounce;\n    }\n\n    // Friction \u2014 based on current velocity (may have been modified by wall slide/bounce)\n    const currentSpeed = Math.sqrt(vel.x * vel.x + vel.z * vel.z);\n    if (currentSpeed > PHYSICS.minVelocity) {\n      const newSpeed = currentSpeed - PHYSICS.objectFriction * dt;\n      if (newSpeed <= PHYSICS.minVelocity) {\n        vel.x = 0;\n        vel.z = 0;\n      } else {\n        const scale = newSpeed / currentSpeed;\n        vel.x *= scale;\n        vel.z *= scale;\n      }\n    } else {\n      vel.x = 0;\n      vel.z = 0;\n    }\n  }\n}\n\n// \u2500\u2500\u2500 Enemy-Enemy Collision + Momentum Transfer \u2500\u2500\u2500\n\nexport function resolveEnemyCollisions(gameState: GameState): void {\n  const enemies = gameState.enemies;\n  const len = enemies.length;\n\n  for (let i = 0; i < len; i++) {\n    const a = enemies[i];\n    if (a.health <= 0) continue;\n    if ((a as any).isLeaping) continue;\n\n    for (let j = i + 1; j < len; j++) {\n      const b = enemies[j];\n      if (b.health <= 0) continue;\n      if ((b as any).isLeaping) continue;\n\n      const dx = b.pos.x - a.pos.x;\n      const dz = b.pos.z - a.pos.z;\n      const distSq = dx * dx + dz * dz;\n      const radA = a.config.size.radius;\n      const radB = b.config.size.radius;\n      const minDist = radA + radB;\n\n      if (distSq >= minDist * minDist) continue;\n\n      const dist = Math.sqrt(distSq);\n      if (dist < 0.01) continue; // degenerate overlap\n\n      const overlap = minDist - dist;\n      const nx = dx / dist;\n      const nz = dz / dist;\n\n      // Mass-weighted separation\n      const massA = a.config.mass ?? 1.0;\n      const massB = b.config.mass ?? 1.0;\n      const totalMass = massA + massB;\n      const ratioA = massB / totalMass; // lighter = moves more\n      const ratioB = massA / totalMass;\n\n      // Push apart\n      a.pos.x -= nx * overlap * ratioA;\n      a.pos.z -= nz * overlap * ratioA;\n      b.pos.x += nx * overlap * ratioB;\n      b.pos.z += nz * overlap * ratioB;\n\n      // Momentum transfer (only if at least one has velocity)\n      const velA = (a as any).vel;\n      const velB = (b as any).vel;\n      if (!velA || !velB) continue;\n\n      const relVelX = velA.x - velB.x;\n      const relVelZ = velA.z - velB.z;\n      const relVelDotN = relVelX * nx + relVelZ * nz;\n\n      if (relVelDotN <= 0) continue; // moving apart, skip\n\n      // 2D elastic collision with restitution\n      const e = PHYSICS.enemyBounce;\n      const impulse = (1 + e) * relVelDotN / totalMass;\n\n      velA.x -= impulse * massB * nx;\n      velA.z -= impulse * massB * nz;\n      velB.x += impulse * massA * nx;\n      velB.z += impulse * massA * nz;\n\n      // Impact damage (if relative speed above threshold)\n      const relSpeed = Math.sqrt(relVelX * relVelX + relVelZ * relVelZ);\n      if (relSpeed > PHYSICS.impactMinSpeed) {\n        const dmg = Math.round((relSpeed - PHYSICS.impactMinSpeed) * PHYSICS.impactDamage);\n        const midX = (a.pos.x + b.pos.x) / 2;\n        const midZ = (a.pos.z + b.pos.z) / 2;\n\n        // Lighter enemy takes more damage\n        const dmgA = Math.round(dmg * ratioA);\n        const dmgB = Math.round(dmg * ratioB);\n\n        if (dmgA > 0) {\n          applyDamageToEnemy(a, dmgA, gameState);\n          a.flashTimer = 100;\n          if ((a as any).bodyMesh) (a as any).bodyMesh.material.emissive.setHex(0xffaa44);\n          if ((a as any).headMesh) (a as any).headMesh.material.emissive.setHex(0xffaa44);\n        }\n        if (dmgB > 0) {\n          applyDamageToEnemy(b, dmgB, gameState);\n          b.flashTimer = 100;\n          if ((b as any).bodyMesh) (b as any).bodyMesh.material.emissive.setHex(0xffaa44);\n          if ((b as any).headMesh) (b as any).headMesh.material.emissive.setHex(0xffaa44);\n        }\n\n        stunEnemy(a, PHYSICS.impactStun);\n        stunEnemy(b, PHYSICS.impactStun);\n\n        spawnDamageNumber(midX, midZ, dmg, '#ffaa44');\n        screenShake(2, 80);\n\n        emit({\n          type: 'enemyImpact',\n          enemyA: a, enemyB: b,\n          speed: relSpeed, damage: dmg,\n          position: { x: midX, z: midZ }\n        });\n      }\n\n      // Sync mesh positions\n      (a as any).mesh.position.copy(a.pos);\n      (b as any).mesh.position.copy(b.pos);\n    }\n  }\n}\n\n// \u2500\u2500\u2500 PhysicsObject Collisions (Object-Object + Object-Enemy) \u2500\u2500\u2500\n\nexport function resolveObjectCollisions(gameState: GameState): void {\n  const objects = gameState.physicsObjects;\n  const enemies = gameState.enemies;\n\n  // Object-Object collisions \u2014 run multiple iterations to handle chain/wall cases\n  for (let iter = 0; iter < 3; iter++) {\n    for (let i = 0; i < objects.length; i++) {\n      const a = objects[i];\n      if (a.destroyed) continue;\n\n      for (let j = i + 1; j < objects.length; j++) {\n        const b = objects[j];\n        if (b.destroyed) continue;\n\n        const dx = b.pos.x - a.pos.x;\n        const dz = b.pos.z - a.pos.z;\n        const distSq = dx * dx + dz * dz;\n        const minDist = a.radius + b.radius;\n\n        if (distSq >= minDist * minDist) continue;\n\n        const dist = Math.sqrt(distSq);\n        if (dist < 0.01) continue;\n\n        const overlap = minDist - dist;\n        const nx = dx / dist;\n        const nz = dz / dist;\n\n        // Check which objects are terrain-blocked (can't move in separation direction)\n        const aTerrainCheck = resolveTerrainCollisionEx(\n          a.pos.x - nx * 0.05, a.pos.z - nz * 0.05, a.radius);\n        const bTerrainCheck = resolveTerrainCollisionEx(\n          b.pos.x + nx * 0.05, b.pos.z + nz * 0.05, b.radius);\n        const aBlocked = aTerrainCheck.hitWall;\n        const bBlocked = bTerrainCheck.hitWall;\n\n        // Distribute separation: blocked objects get 0 share\n        let ratioA: number, ratioB: number;\n        if (aBlocked && !bBlocked) {\n          ratioA = 0; ratioB = 1;\n        } else if (!aBlocked && bBlocked) {\n          ratioA = 1; ratioB = 0;\n        } else {\n          const totalMass = a.mass + b.mass;\n          ratioA = b.mass / totalMass;\n          ratioB = a.mass / totalMass;\n        }\n\n        a.pos.x -= nx * overlap * ratioA;\n        a.pos.z -= nz * overlap * ratioA;\n        b.pos.x += nx * overlap * ratioB;\n        b.pos.z += nz * overlap * ratioB;\n\n        // Momentum transfer (only on first iteration to avoid double-counting)\n        if (iter === 0) {\n          const totalMass = a.mass + b.mass;\n          const relVelX = a.vel.x - b.vel.x;\n          const relVelZ = a.vel.z - b.vel.z;\n          const relVelDotN = relVelX * nx + relVelZ * nz;\n          if (relVelDotN > 0) {\n            const e = PHYSICS.objectWallSlamBounce;\n            const impulse = (1 + e) * relVelDotN / totalMass;\n\n            a.vel.x -= impulse * b.mass * nx;\n            a.vel.z -= impulse * b.mass * nz;\n            b.vel.x += impulse * a.mass * nx;\n            b.vel.z += impulse * a.mass * nz;\n          }\n        }\n\n        // Sync meshes\n        if (a.mesh) a.mesh.position.set(a.pos.x, 0, a.pos.z);\n        if (b.mesh) b.mesh.position.set(b.pos.x, 0, b.pos.z);\n      }\n    }\n  }\n\n  // Object-Enemy collisions\n  for (const obj of objects) {\n    if (obj.destroyed) continue;\n\n    for (const enemy of enemies) {\n      if (enemy.health <= 0) continue;\n      if ((enemy as any).isLeaping) continue;\n\n      const dx = enemy.pos.x - obj.pos.x;\n      const dz = enemy.pos.z - obj.pos.z;\n      const distSq = dx * dx + dz * dz;\n      const radObj = obj.radius;\n      const radEnemy = enemy.config.size.radius;\n      const minDist = radObj + radEnemy;\n\n      if (distSq >= minDist * minDist) continue;\n\n      const dist = Math.sqrt(distSq);\n      if (dist < 0.01) continue;\n\n      const overlap = minDist - dist;\n      const nx = dx / dist;\n      const nz = dz / dist;\n\n      const massObj = obj.mass;\n      const massEnemy = enemy.config.mass ?? 1.0;\n      const totalMass = massObj + massEnemy;\n      const ratioObj = massEnemy / totalMass;\n      const ratioEnemy = massObj / totalMass;\n\n      // Separate\n      obj.pos.x -= nx * overlap * ratioObj;\n      obj.pos.z -= nz * overlap * ratioObj;\n      enemy.pos.x += nx * overlap * ratioEnemy;\n      enemy.pos.z += nz * overlap * ratioEnemy;\n\n      // Momentum transfer\n      const velEnemy = (enemy as any).vel;\n      if (!velEnemy) continue;\n\n      const relVelX = obj.vel.x - velEnemy.x;\n      const relVelZ = obj.vel.z - velEnemy.z;\n      const relVelDotN = relVelX * nx + relVelZ * nz;\n      if (relVelDotN <= 0) continue;\n\n      const e = obj.restitution ?? PHYSICS.enemyBounce;\n      const impulse = (1 + e) * relVelDotN / totalMass;\n\n      obj.vel.x -= impulse * massEnemy * nx;\n      obj.vel.z -= impulse * massEnemy * nz;\n      velEnemy.x += impulse * massObj * nx;\n      velEnemy.z += impulse * massObj * nz;\n\n      // Impact damage to enemy (if relative speed high enough)\n      const relSpeed = Math.sqrt(relVelX * relVelX + relVelZ * relVelZ);\n      if (relSpeed > PHYSICS.objectImpactMinSpeed) {\n        const dmg = Math.round((relSpeed - PHYSICS.objectImpactMinSpeed) * PHYSICS.objectImpactDamage);\n        if (dmg > 0) {\n          applyDamageToEnemy(enemy, dmg, gameState);\n          enemy.flashTimer = 100;\n          if ((enemy as any).bodyMesh) (enemy as any).bodyMesh.material.emissive.setHex(0xffaa44);\n          if ((enemy as any).headMesh) (enemy as any).headMesh.material.emissive.setHex(0xffaa44);\n          spawnDamageNumber(enemy.pos.x, enemy.pos.z, dmg, '#ffaa44');\n          screenShake(2, 80);\n\n          emit({\n            type: 'objectImpact',\n            objectA: obj, objectB: enemy,\n            speed: relSpeed, damage: dmg,\n            position: { x: (obj.pos.x + enemy.pos.x) / 2, z: (obj.pos.z + enemy.pos.z) / 2 }\n          });\n        }\n      }\n\n      // Sync mesh positions\n      if (obj.mesh) obj.mesh.position.set(obj.pos.x, 0, obj.pos.z);\n      (enemy as any).mesh.position.copy(enemy.pos);\n    }\n  }\n}\n\n// \u2500\u2500\u2500 Physics Object Body Collisions \u2500\u2500\u2500\n// Prevents player and enemies from walking through physics objects.\n// Objects act as solid cylindrical blockers. The entity is always the one\n// pushed out (objects only move via force push velocity, not body collision).\n\nexport function resolvePhysicsObjectBodyCollisions(gameState: GameState): void {\n  const objects = gameState.physicsObjects;\n  const playerPos = getPlayerPos();\n  const playerR = PLAYER.size.radius;\n\n  for (const obj of objects) {\n    if (obj.destroyed) continue;\n\n    // \u2500\u2500\u2500 Player vs Object \u2500\u2500\u2500\n    const pdx = playerPos.x - obj.pos.x;\n    const pdz = playerPos.z - obj.pos.z;\n    const pDistSq = pdx * pdx + pdz * pdz;\n    const pMinDist = playerR + obj.radius;\n\n    if (pDistSq < pMinDist * pMinDist && pDistSq > 0.0001) {\n      const pDist = Math.sqrt(pDistSq);\n      const pOverlap = pMinDist - pDist;\n      // Push player out entirely (object stays put)\n      playerPos.x += (pdx / pDist) * pOverlap;\n      playerPos.z += (pdz / pDist) * pOverlap;\n    }\n\n    // \u2500\u2500\u2500 Enemy vs Object \u2500\u2500\u2500\n    for (const enemy of gameState.enemies) {\n      if (enemy.health <= 0) continue;\n      if ((enemy as any).isLeaping) continue;\n\n      const edx = enemy.pos.x - obj.pos.x;\n      const edz = enemy.pos.z - obj.pos.z;\n      const eDistSq = edx * edx + edz * edz;\n      const eRadEnemy = enemy.config.size.radius;\n      const eMinDist = eRadEnemy + obj.radius;\n\n      if (eDistSq < eMinDist * eMinDist && eDistSq > 0.0001) {\n        const eDist = Math.sqrt(eDistSq);\n        const eOverlap = eMinDist - eDist;\n        // Push enemy out entirely (object stays put)\n        enemy.pos.x += (edx / eDist) * eOverlap;\n        enemy.pos.z += (edz / eDist) * eOverlap;\n      }\n    }\n  }\n}\n\n// \u2500\u2500\u2500 Destructible Obstacle Collisions \u2500\u2500\u2500\n\n// Track obstacles to destroy at end of frame (deferred removal)\nconst pendingObstacleDestructions: number[] = [];\n\nexport function resolveObjectObstacleCollisions(gameState: GameState): void {\n  const objects = gameState.physicsObjects;\n\n  for (const obj of objects) {\n    if (obj.destroyed) continue;\n    const speed = Math.sqrt(obj.vel.x * obj.vel.x + obj.vel.z * obj.vel.z);\n    if (speed < PHYSICS.objectImpactMinSpeed) continue; // only check fast-moving objects\n\n    for (let i = 0; i < OBSTACLES.length; i++) {\n      const obs = OBSTACLES[i];\n      if (!obs.destructible || !obs.health || obs.health <= 0) continue;\n\n      // Circle vs AABB\n      const aabb: AABB = {\n        minX: obs.x - obs.w / 2,\n        maxX: obs.x + obs.w / 2,\n        minZ: obs.z - obs.d / 2,\n        maxZ: obs.z + obs.d / 2,\n      };\n\n      const push = circleVsAABB(obj.pos.x, obj.pos.z, obj.radius, aabb);\n      if (!push) continue;\n\n      // Impact! Damage the obstacle proportional to object speed\n      const dmg = Math.round((speed - PHYSICS.objectImpactMinSpeed) * PHYSICS.objectImpactDamage);\n      if (dmg <= 0) continue;\n\n      obs.health -= dmg;\n      spawnDamageNumber(obs.x, obs.z, dmg, '#ff8844');\n      screenShake(2, 80);\n\n      if (obs.health <= 0) {\n        obs.health = 0;\n        pendingObstacleDestructions.push(i);\n        emit({ type: 'obstacleDestroyed', obstacleIndex: i, position: { x: obs.x, z: obs.z } });\n      }\n    }\n  }\n}\n\nexport function processDestroyedObstacles(): void {\n  if (pendingObstacleDestructions.length === 0) return;\n\n  // Sort descending so splice doesn't shift earlier indices\n  pendingObstacleDestructions.sort((a, b) => b - a);\n\n  for (const idx of pendingObstacleDestructions) {\n    if (idx < OBSTACLES.length) {\n      OBSTACLES.splice(idx, 1);\n    }\n  }\n  pendingObstacleDestructions.length = 0;\n\n  invalidateCollisionBounds();\n  rebuildArenaVisuals();\n}\n\nexport function pointInPit(px: number, pz: number): boolean {\n  const pits = getPits();\n  for (const pit of pits) {\n    if (px >= pit.minX && px <= pit.maxX && pz >= pit.minZ && pz <= pit.maxZ) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function checkPitFalls(gameState: GameState): void {\n  const playerPos = getPlayerPos();\n\n  if (!isPlayerDashing() && !isPlayerInvincible()) {\n    if (pointInPit(playerPos.x, playerPos.z)) {\n      gameState.playerHealth = 0;\n      gameState.phase = 'gameOver';\n      screenShake(5, 200);\n      emit({ type: 'pitFall', position: { x: playerPos.x, z: playerPos.z }, isPlayer: true });\n      spawnDamageNumber(playerPos.x, playerPos.z, 'FELL!', '#ff4466');\n    }\n  }\n\n  for (const enemy of gameState.enemies) {\n    if (enemy.health <= 0) continue;\n    if ((enemy as any).isLeaping) continue;\n    if (pointInPit(enemy.pos.x, enemy.pos.z)) {\n      spawnPitFallGhost(enemy);\n      emit({ type: 'pitFall', position: { x: enemy.pos.x, z: enemy.pos.z }, isPlayer: false });\n      createAoeRing(enemy.pos.x, enemy.pos.z, 2.5, 500, 0x8844ff);\n\n      enemy.health = 0;\n      (enemy as any).fellInPit = true;\n      enemy.stunTimer = 9999;\n      spawnDamageNumber(enemy.pos.x, enemy.pos.z, 'FELL!', '#8844ff');\n      screenShake(4, 200);\n    }\n  }\n\n  // PhysicsObject pit falls (safety net \u2014 non-velocity check)\n  for (const obj of gameState.physicsObjects) {\n    if (obj.destroyed) continue;\n    if (pointInPit(obj.pos.x, obj.pos.z)) {\n      obj.destroyed = true;\n      obj.fellInPit = true;\n      emit({ type: 'objectPitFall', object: obj, position: { x: obj.pos.x, z: obj.pos.z } });\n      if (obj.mesh) obj.mesh.visible = false;\n    }\n  }\n}\n\nfunction applyDamageToEnemy(enemy: Enemy, damage: number, gameState: GameState): void {\n  if ((enemy as any).shieldActive && (enemy as any).shieldHealth > 0) {\n    (enemy as any).shieldHealth -= damage;\n    if ((enemy as any).shieldHealth <= 0) {\n      const overkill = -(enemy as any).shieldHealth;\n      (enemy as any).shieldHealth = 0;\n      (enemy as any).shieldActive = false;\n      onShieldBreak(enemy, gameState);\n      if (overkill > 0) {\n        enemy.health -= overkill;\n      }\n    }\n  } else {\n    enemy.health -= damage;\n  }\n  // Trigger squash/bounce hit reaction\n  if ((enemy as any).hitReaction) {\n    triggerHitReaction((enemy as any).hitReaction);\n  }\n}\n\nfunction onShieldBreak(enemy: Enemy, gameState: GameState): void {\n  const shieldCfg = enemy.config.shield;\n  if (!shieldCfg) return;\n\n  if ((enemy as any).shieldMesh) {\n    (enemy as any).shieldMesh.visible = false;\n    (enemy as any).mesh.remove((enemy as any).shieldMesh);\n    (enemy as any).shieldMesh.material.dispose();\n    (enemy as any).shieldMesh = null;\n  }\n\n  stunEnemy(enemy, shieldCfg.stunDuration);\n  spawnDamageNumber(enemy.pos.x, enemy.pos.z, 'BREAK', '#88eeff');\n\n  applyAoeEffect({\n    x: enemy.pos.x,\n    z: enemy.pos.z,\n    radius: shieldCfg.stunRadius,\n    durationMs: shieldCfg.breakRingDuration || 400,\n    color: 0x88eeff,\n    label: 'STUNNED',\n    effectFn: (e) => stunEnemy(e, shieldCfg.stunDuration),\n    gameState,\n    excludeEnemy: enemy,\n  });\n\n  emit({ type: 'shieldBreak', enemy, position: { x: enemy.pos.x, z: enemy.pos.z } });\n\n  (enemy as any).knockbackResist = 0;\n\n  if ((enemy as any).bodyMesh) {\n    (enemy as any).bodyMesh.material.transparent = true;\n    (enemy as any).bodyMesh.material.opacity = 0.5;\n  }\n  if ((enemy as any).headMesh) {\n    (enemy as any).headMesh.material.transparent = true;\n    (enemy as any).headMesh.material.opacity = 0.5;\n  }\n\n  screenShake(4, 200);\n}\n\nfunction checkMeleeHits(gameState: GameState): void {\n  if (!isMeleeSwinging()) return;\n\n  const playerPos = getPlayerPos();\n  const swingDir = getMeleeSwingDir();\n  const hitEnemies = getMeleeHitEnemies();\n\n  for (const enemy of gameState.enemies) {\n    if (enemy.health <= 0) continue;\n    if ((enemy as any).fellInPit) continue;\n    if (hitEnemies.has(enemy)) continue; // already hit this swing\n\n    if (!isInMeleeArc(playerPos.x, playerPos.z, swingDir, enemy.pos.x, enemy.pos.z, MELEE.range, MELEE.arc)) {\n      continue;\n    }\n\n    // Hit!\n    hitEnemies.add(enemy);\n\n    const wasShielded = (enemy as any).shieldActive;\n    applyDamageToEnemy(enemy, MELEE.damage, gameState);\n\n    // No melee knockback \u2014 force push handles displacement.\n    // Hit stun, flash, and screen shake remain for feedback.\n\n    // Feedback\n    emit({ type: 'enemyHit', enemy, damage: MELEE.damage, position: { x: enemy.pos.x, z: enemy.pos.z }, wasShielded });\n    emit({ type: 'meleeHit', enemy, damage: MELEE.damage, position: { x: enemy.pos.x, z: enemy.pos.z } });\n\n    const dmgColor = wasShielded ? '#88eeff' : '#ff8844';\n    spawnDamageNumber(enemy.pos.x, enemy.pos.z, MELEE.damage, dmgColor);\n\n    enemy.flashTimer = 100;\n    (enemy as any).bodyMesh.material.emissive.setHex(0xffffff);\n    if ((enemy as any).headMesh) (enemy as any).headMesh.material.emissive.setHex(0xffffff);\n\n    screenShake(MELEE.screenShake, 80);\n  }\n\n}\n\nexport function checkCollisions(gameState: GameState): void {\n  const playerPos = getPlayerPos();\n  const playerR = PLAYER.size.radius;\n\n  if (!isPlayerDashing()) {\n    const resolved = resolveMovementCollision(playerPos.x, playerPos.z, playerR);\n    playerPos.x = resolved.x;\n    playerPos.z = resolved.z;\n  }\n\n  for (const enemy of gameState.enemies) {\n    if ((enemy as any).isLeaping) continue;\n    if ((enemy as any).fellInPit) continue; // Don't push dead-in-pit enemies back out\n\n    // Enemies with active velocity skip pit collision \u2014 they're allowed to be\n    // knocked into pits. The pit fall is detected in applyVelocities().\n    // Enemies walking under AI control still collide with pits as a safety net.\n    const vel = (enemy as any).vel;\n    const hasVelocity = vel && (vel.x * vel.x + vel.z * vel.z) > PHYSICS.minVelocity * PHYSICS.minVelocity;\n    const bounds = hasVelocity ? getBounds() : getMoveBounds();\n    let rx = enemy.pos.x, rz = enemy.pos.z;\n    let wasDeflected = false;\n    for (const box of bounds) {\n      const push = circleVsAABB(rx, rz, enemy.config.size.radius, box);\n      if (push) {\n        rx += push.x;\n        rz += push.z;\n        wasDeflected = true;\n      }\n    }\n    enemy.pos.x = rx;\n    enemy.pos.z = rz;\n    (enemy as any).wasDeflected = wasDeflected;\n    (enemy as any).mesh.position.copy(enemy.pos);\n  }\n\n  const playerProj = getPlayerProjectiles();\n  for (let i = playerProj.length - 1; i >= 0; i--) {\n    const p = playerProj[i];\n    if (!p.mesh.visible) continue;\n\n    if (pointHitsTerrain(p.mesh.position.x, p.mesh.position.z)) {\n      releaseProjectile(p);\n      continue;\n    }\n\n    for (const enemy of gameState.enemies) {\n      const dx = p.mesh.position.x - enemy.pos.x;\n      const dz = p.mesh.position.z - enemy.pos.z;\n      const distSq = dx * dx + dz * dz;\n      const hitR = enemy.config.size.radius + PLAYER.projectile.size;\n\n      if (distSq < hitR * hitR) {\n        const wasShielded = (enemy as any).shieldActive;\n        applyDamageToEnemy(enemy, p.damage, gameState);\n        releaseProjectile(p);\n\n        emit({ type: 'enemyHit', enemy, damage: p.damage, position: { x: enemy.pos.x, z: enemy.pos.z }, wasShielded });\n\n        const dmgColor = wasShielded ? '#88eeff' : '#44ff88';\n        spawnDamageNumber(enemy.pos.x, enemy.pos.z, p.damage, dmgColor);\n\n        enemy.flashTimer = 80;\n        (enemy as any).bodyMesh.material.emissive.setHex(0xffffff);\n        if ((enemy as any).headMesh) (enemy as any).headMesh.material.emissive.setHex(0xffffff);\n\n        break;\n      }\n    }\n  }\n\n  const enemyProj = getEnemyProjectiles();\n  for (let i = enemyProj.length - 1; i >= 0; i--) {\n    const p = enemyProj[i];\n    if (!p.mesh.visible) continue;\n\n    if (pointHitsTerrain(p.mesh.position.x, p.mesh.position.z)) {\n      releaseProjectile(p);\n      continue;\n    }\n\n    if (!isPlayerInvincible()) {\n      const dx = p.mesh.position.x - playerPos.x;\n      const dz = p.mesh.position.z - playerPos.z;\n      const distSq = dx * dx + dz * dz;\n      const hitR = playerR + 0.1;\n\n      if (distSq < hitR * hitR) {\n        gameState.playerHealth -= p.damage;\n        releaseProjectile(p);\n        screenShake(3, 100);\n\n        emit({ type: 'playerHit', damage: p.damage, position: { x: playerPos.x, z: playerPos.z } });\n        spawnDamageNumber(playerPos.x, playerPos.z, p.damage, '#ff4466');\n\n        if (gameState.playerHealth <= 0) {\n          gameState.playerHealth = 0;\n          gameState.phase = 'gameOver';\n        }\n        break;\n      }\n    }\n  }\n\n  if (!isPlayerInvincible()) {\n    const now = performance.now();\n    for (const enemy of gameState.enemies) {\n      if (enemy.behavior === 'kite') continue;\n      if (enemy.config.melee) continue; // melee enemies use state machine, not contact damage\n      if (enemy.stunTimer > 0) continue;\n\n      const dx = enemy.pos.x - playerPos.x;\n      const dz = enemy.pos.z - playerPos.z;\n      const distSq = dx * dx + dz * dz;\n      const hitR = playerR + enemy.config.size.radius;\n\n      if (distSq < hitR * hitR) {\n        const attackCooldown = enemy.config.attackRate || 1000;\n        if (now - (enemy as any).lastAttackTime > attackCooldown) {\n          const chargeMult = (enemy.config.tank && enemy.config.tank.chargeDamageMult) || 1.5;\n          const dmg = (enemy as any).isCharging ? enemy.config.damage * chargeMult : enemy.config.damage;\n          gameState.playerHealth -= dmg;\n          (enemy as any).lastAttackTime = now;\n          screenShake((enemy as any).isCharging ? 5 : 2, (enemy as any).isCharging ? 150 : 80);\n\n          emit({ type: 'playerHit', damage: dmg, position: { x: playerPos.x, z: playerPos.z } });\n          spawnDamageNumber(playerPos.x, playerPos.z, dmg, '#ff4466');\n\n          if (gameState.playerHealth <= 0) {\n            gameState.playerHealth = 0;\n            gameState.phase = 'gameOver';\n          }\n        }\n      }\n    }\n  }\n\n  // Melee hit detection\n  checkMeleeHits(gameState);\n\n  const pushEvt = consumePushEvent();\n  if (pushEvt) {\n    const dirX = pushEvt.dirX;\n    const dirZ = pushEvt.dirZ;\n    // Perpendicular direction (lateral axis in push-local space)\n    const perpX = -dirZ;\n    const perpZ = dirX;\n    // Player position = rectangle center minus half-length along push direction\n    const halfLen = pushEvt.length / 2;\n    const playerX = pushEvt.x - dirX * halfLen;\n    const playerZ = pushEvt.z - dirZ * halfLen;\n\n    // 1. Collect all enemies AND physics objects in push rectangle\n    const candidates: { enemy: any; obj: any; forward: number; lateral: number }[] = [];\n\n    // Enemies\n    for (const enemy of gameState.enemies) {\n      if (enemy.health <= 0) continue;\n      if ((enemy as any).isLeaping) continue;\n      const enemyRadius = enemy.config.size.radius;\n      if (isInRotatedRect(enemy.pos.x, enemy.pos.z, pushEvt.x, pushEvt.z,\n                           pushEvt.width, pushEvt.length, pushEvt.rotation, enemyRadius)) {\n        const dx = enemy.pos.x - playerX;\n        const dz = enemy.pos.z - playerZ;\n        const forward = dx * dirX + dz * dirZ;\n        const lateral = dx * perpX + dz * perpZ;\n        candidates.push({ enemy, obj: null, forward, lateral });\n      }\n    }\n\n    // Physics objects\n    for (const obj of gameState.physicsObjects) {\n      if (obj.destroyed) continue;\n      if (isInRotatedRect(obj.pos.x, obj.pos.z, pushEvt.x, pushEvt.z,\n                           pushEvt.width, pushEvt.length, pushEvt.rotation, obj.radius)) {\n        const dx = obj.pos.x - playerX;\n        const dz = obj.pos.z - playerZ;\n        const forward = dx * dirX + dz * dirZ;\n        const lateral = dx * perpX + dz * perpZ;\n        candidates.push({ enemy: null, obj, forward, lateral });\n      }\n    }\n\n    // 2. Sort by forward distance (nearest to player first)\n    candidates.sort((a, b) => a.forward - b.forward);\n\n    // 3. Apply knockback with wave occlusion\n    const pushedLaterals: number[] = [];\n    const blockRadius = PHYSICS.pushWaveBlockRadius;\n\n    for (const { enemy, obj, lateral } of candidates) {\n      // Check if blocked by any already-pushed target\n      let blocked = false;\n      for (const pushedLat of pushedLaterals) {\n        if (Math.abs(lateral - pushedLat) < blockRadius) {\n          blocked = true;\n          break;\n        }\n      }\n      if (blocked) continue;\n\n      if (enemy) {\n        // Enemy push (existing behavior)\n        const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n        const kbMult = 1 - ((enemy as any).knockbackResist ?? enemy.config.knockbackResist ?? 0);\n        const kbDist = pushEvt.force * kbMult * iceEffects.knockbackMult;\n\n        if (kbDist > 0) {\n          const v0 = Math.sqrt(2 * PHYSICS.friction * kbDist);\n          (enemy as any).vel.x = dirX * v0;\n          (enemy as any).vel.z = dirZ * v0;\n        }\n        emit({ type: 'enemyPushed', enemy, position: { x: enemy.pos.x, z: enemy.pos.z } });\n\n        enemy.flashTimer = 100;\n        (enemy as any).bodyMesh.material.emissive.setHex(0x44ffaa);\n        if ((enemy as any).headMesh) (enemy as any).headMesh.material.emissive.setHex(0x44ffaa);\n\n        spawnDamageNumber(enemy.pos.x, enemy.pos.z, 'PUSH', '#44ffaa');\n      } else if (obj) {\n        // Object push: velocity = sqrt(2 * friction * (force / mass))\n        const kbDist = pushEvt.force / obj.mass;\n        if (kbDist > 0) {\n          const v0 = Math.sqrt(2 * PHYSICS.objectFriction * kbDist);\n          obj.vel.x = dirX * v0;\n          obj.vel.z = dirZ * v0;\n\n          // Nudge object away from any touching wall before velocity is applied.\n          // Uses wall normal to push outward, ensuring the first movement step\n          // clears the collision boundary regardless of push direction.\n          const nudgeResult = resolveTerrainCollisionEx(obj.pos.x, obj.pos.z, obj.radius);\n          if (nudgeResult.hitWall) {\n            obj.pos.x = nudgeResult.x + nudgeResult.normalX * 0.1;\n            obj.pos.z = nudgeResult.z + nudgeResult.normalZ * 0.1;\n            if (obj.mesh) {\n              obj.mesh.position.set(obj.pos.x, 0, obj.pos.z);\n            }\n          }\n        }\n        emit({ type: 'objectPushed', object: obj, position: { x: obj.pos.x, z: obj.pos.z } });\n        spawnDamageNumber(obj.pos.x, obj.pos.z, 'PUSH', '#44ffaa');\n      }\n\n      pushedLaterals.push(lateral);\n    }\n  }\n\n}\n", "// Particle System \u2014 lightweight pool-based emitter for game effects\n// Config-driven bursts: hit sparks, death puffs, dash trails, etc.\n// Pre-allocates a fixed pool of mesh particles. No runtime allocation.\n// Subscribes to event bus for automatic particle spawning.\n\nimport { on } from './events';\nimport type { GameEvent } from './events';\nimport { MELEE } from '../config/player';\n\n// \u2500\u2500\u2500 Config Types \u2500\u2500\u2500\n\nexport interface ParticleConfig {\n  count: number;       // particles per burst (4-12 typical)\n  lifetime: number;    // seconds\n  speed: number;       // initial velocity (world units/sec)\n  spread: number;      // cone half-angle in radians (Math.PI = sphere)\n  size: number;        // world units\n  color: number;       // hex color\n  fadeOut: boolean;     // alpha decay over lifetime\n  gravity: number;     // downward acceleration (0 = floaty, 9.8 = heavy)\n  shape: 'box' | 'sphere';\n}\n\n// \u2500\u2500\u2500 Pre-defined Presets \u2500\u2500\u2500\n\nexport const HIT_SPARK: ParticleConfig = {\n  count: 5,\n  lifetime: 0.25,\n  speed: 6,\n  spread: Math.PI * 0.8,\n  size: 0.06,\n  color: 0xffffaa,\n  fadeOut: true,\n  gravity: 4,\n  shape: 'box',\n};\n\nexport const DEATH_PUFF: ParticleConfig = {\n  count: 8,\n  lifetime: 0.4,\n  speed: 3,\n  spread: Math.PI,\n  size: 0.08,\n  color: 0xffffff, // will be overridden with enemy color\n  fadeOut: true,\n  gravity: 1,\n  shape: 'sphere',\n};\n\nexport const DASH_TRAIL: ParticleConfig = {\n  count: 3,\n  lifetime: 0.3,\n  speed: 1.5,\n  spread: Math.PI * 0.3,\n  size: 0.05,\n  color: 0x44ff88,\n  fadeOut: true,\n  gravity: 0,\n  shape: 'box',\n};\n\nexport const SHIELD_BREAK_BURST: ParticleConfig = {\n  count: 10,\n  lifetime: 0.35,\n  speed: 8,\n  spread: Math.PI,\n  size: 0.07,\n  color: 0x88eeff,\n  fadeOut: true,\n  gravity: 3,\n  shape: 'box',\n};\n\nexport const PUSH_BURST: ParticleConfig = {\n  count: 4,\n  lifetime: 0.2,\n  speed: 5,\n  spread: Math.PI * 0.5,\n  size: 0.05,\n  color: 0x44ffaa,\n  fadeOut: true,\n  gravity: 2,\n  shape: 'box',\n};\n\nexport const CHARGE_BLAST: ParticleConfig = {\n  count: 12,\n  lifetime: 0.3,\n  speed: 10,\n  spread: Math.PI * 0.4,\n  size: 0.08,\n  color: 0x44ffaa,\n  fadeOut: true,\n  gravity: 2,\n  shape: 'sphere',\n};\n\nexport const ENEMY_IMPACT_SPARK: ParticleConfig = {\n  count: 6,\n  lifetime: 0.25,\n  speed: 5,\n  spread: Math.PI,\n  size: 0.06,\n  color: 0xffaa44,\n  fadeOut: true,\n  gravity: 4,\n  shape: 'sphere',\n};\n\nexport const WALL_SLAM_SPARK: ParticleConfig = {\n  count: 8,\n  lifetime: 0.3,\n  speed: 7,\n  spread: Math.PI * 0.6,\n  size: 0.07,\n  color: 0xff8844,\n  fadeOut: true,\n  gravity: 5,\n  shape: 'box',\n};\n\nexport const OBSTACLE_BREAK_BURST: ParticleConfig = {\n  count: 12,\n  lifetime: 0.6,\n  speed: 4,\n  spread: Math.PI * 2,\n  size: 0.15,\n  color: 0x887766,\n  fadeOut: true,\n  gravity: 8,\n  shape: 'box',\n};\n\nexport const BEND_APPLY_BURST: ParticleConfig = {\n  count: 10,\n  lifetime: 0.4,\n  speed: 3,\n  spread: Math.PI,\n  size: 0.1,\n  color: 0x4488ff,  // will be overridden per-bend\n  fadeOut: true,\n  gravity: -2,      // float upward\n  shape: 'sphere',\n};\n\nexport const DOOR_UNLOCK_BURST: ParticleConfig = {\n  count: 12,\n  lifetime: 0.5,\n  speed: 6,\n  spread: Math.PI * 0.5,\n  size: 0.08,\n  color: 0x88bbff,\n  fadeOut: true,\n  gravity: -2,   // float upward\n  shape: 'sphere',\n};\n\n// \u2500\u2500\u2500 Pool \u2500\u2500\u2500\n\nconst POOL_SIZE = 80;\n\ninterface Particle {\n  mesh: any;       // THREE.Mesh\n  active: boolean;\n  life: number;    // seconds elapsed\n  maxLife: number;\n  vx: number;\n  vy: number;\n  vz: number;\n  gravity: number;\n  fadeOut: boolean;\n  material: any;   // THREE.MeshBasicMaterial (for opacity)\n  baseScale: number; // initial size for non-cumulative shrink\n}\n\nconst pool: Particle[] = [];\nlet sceneRef: any = null;\n\n// Shared geometries\nlet boxGeo: any = null;\nlet sphereGeo: any = null;\n\nexport function initParticles(scene: any): void {\n  sceneRef = scene;\n\n  // Create shared geometries\n  boxGeo = new THREE.BoxGeometry(1, 1, 1);\n  sphereGeo = new THREE.SphereGeometry(0.5, 4, 3);\n\n  // Pre-allocate pool\n  for (let i = 0; i < POOL_SIZE; i++) {\n    const mat = new THREE.MeshBasicMaterial({\n      color: 0xffffff,\n      transparent: true,\n      opacity: 1,\n      depthWrite: false,\n    });\n    const mesh = new THREE.Mesh(boxGeo, mat);\n    mesh.visible = false;\n    scene.add(mesh);\n\n    pool.push({\n      mesh,\n      active: false,\n      life: 0,\n      maxLife: 1,\n      vx: 0, vy: 0, vz: 0,\n      gravity: 0,\n      fadeOut: true,\n      material: mat,\n      baseScale: 1,\n    });\n  }\n\n  // Init arc decal pools\n  initArcDecals(scene);\n  initEnemyArcDecals(scene);\n\n  // Subscribe to events\n  wireEventBus();\n}\n\n// \u2500\u2500\u2500 Melee Arc Decal Pool \u2500\u2500\u2500\n\nconst ARC_DECAL_POOL_SIZE = 3;\nconst ARC_DECAL_LIFETIME = 0.25; // seconds\n\ninterface ArcDecal {\n  mesh: any;       // THREE.Mesh\n  active: boolean;\n  life: number;    // seconds elapsed\n}\n\nconst arcDecalPool: ArcDecal[] = [];\nlet arcDecalGeo: any = null;\n\nfunction initArcDecals(scene: any): void {\n  // CircleGeometry(radius, segments, thetaStart, thetaLength) creates a sector\n  // thetaStart is in the XY plane. After rotateX(-PI/2), XY\u2192XZ.\n  // Default arc center at thetaStart=0 points along +X. We offset by +PI/2\n  // so the arc center points along +Y (pre-rotation) = +Z (post-rotation),\n  // which aligns with Three.js rotation.y convention.\n  arcDecalGeo = new THREE.CircleGeometry(1, 24, Math.PI / 2 - MELEE.arc / 2, MELEE.arc);\n  arcDecalGeo.rotateX(-Math.PI / 2); // lay flat on ground\n\n  for (let i = 0; i < ARC_DECAL_POOL_SIZE; i++) {\n    const mat = new THREE.MeshBasicMaterial({\n      color: 0xffffff,\n      transparent: true,\n      opacity: 0,\n      side: THREE.DoubleSide,\n      depthWrite: false,\n    });\n    const mesh = new THREE.Mesh(arcDecalGeo, mat);\n    mesh.visible = false;\n    scene.add(mesh);\n\n    arcDecalPool.push({ mesh, active: false, life: 0 });\n  }\n}\n\nfunction spawnArcDecal(x: number, z: number, dirX: number, dirZ: number): void {\n  // Find inactive decal in pool\n  let decal: ArcDecal | null = null;\n  for (const d of arcDecalPool) {\n    if (!d.active) { decal = d; break; }\n  }\n  if (!decal) return; // pool exhausted\n\n  decal.active = true;\n  decal.life = 0;\n  decal.mesh.visible = true;\n  decal.mesh.position.set(x, 0.05, z);\n\n  // Scale to match current melee range\n  const r = MELEE.range;\n  decal.mesh.scale.set(r * 0.3, 1, r * 0.3); // start small, will grow\n\n  // Rotate to face swing direction\n  // direction = { -sin(angle), -cos(angle) } from player.ts\n  // Recover the original rotation.y angle: atan2(-dirX, -dirZ)\n  // Arc geometry is pre-rotated so its center aligns with +Z (rotation.y = 0)\n  decal.mesh.rotation.y = Math.atan2(-dirX, -dirZ);\n\n  decal.mesh.material.opacity = 0.4;\n}\n\nfunction updateArcDecals(dt: number): void {\n  for (const d of arcDecalPool) {\n    if (!d.active) continue;\n\n    d.life += dt;\n    if (d.life >= ARC_DECAL_LIFETIME) {\n      d.active = false;\n      d.mesh.visible = false;\n      continue;\n    }\n\n    const t = d.life / ARC_DECAL_LIFETIME;\n    // easeOutQuad\n    const ease = 1 - (1 - t) * (1 - t);\n\n    // Scale: 0.3 \u2192 1.0 of melee range\n    const r = MELEE.range;\n    const s = r * (0.3 + 0.7 * ease);\n    d.mesh.scale.set(s, 1, s);\n\n    // Opacity: 0.4 \u2192 0\n    d.mesh.material.opacity = 0.4 * (1 - ease);\n  }\n}\n\nfunction clearArcDecals(): void {\n  for (const d of arcDecalPool) {\n    d.active = false;\n    d.mesh.visible = false;\n  }\n}\n\n// \u2500\u2500\u2500 Enemy Telegraph Arc Decal Pool \u2500\u2500\u2500\n\nconst ENEMY_ARC_POOL_SIZE = 6;  // up to 6 simultaneous enemy telegraphs\n\ninterface EnemyArcDecal {\n  mesh: any;       // THREE.Mesh\n  active: boolean;\n  life: number;    // seconds elapsed\n  maxLife: number;  // total duration (telegraph + attack)\n}\n\nconst enemyArcPool: EnemyArcDecal[] = [];\n\nfunction initEnemyArcDecals(scene: any): void {\n  for (let i = 0; i < ENEMY_ARC_POOL_SIZE; i++) {\n    // Start with a placeholder geometry \u2014 replaced per-spawn with correct arc/range\n    const geo = new THREE.CircleGeometry(1, 24, 0, Math.PI);\n    geo.rotateX(-Math.PI / 2);\n    const mat = new THREE.MeshBasicMaterial({\n      color: 0xff4400,\n      transparent: true,\n      opacity: 0,\n      side: THREE.DoubleSide,\n      depthWrite: false,\n    });\n    const mesh = new THREE.Mesh(geo, mat);\n    mesh.visible = false;\n    scene.add(mesh);\n\n    enemyArcPool.push({ mesh, active: false, life: 0, maxLife: 1 });\n  }\n}\n\nfunction spawnEnemyArcDecal(x: number, z: number, facingAngle: number, hitArc: number, hitRange: number, durationMs: number): void {\n  // Find inactive decal in pool\n  let decal: EnemyArcDecal | null = null;\n  for (const d of enemyArcPool) {\n    if (!d.active) { decal = d; break; }\n  }\n  if (!decal) return;\n\n  // Replace geometry with correct arc shape for this enemy\n  // CircleGeometry arc is in XY plane, centered on +X axis\n  // Offset by PI/2 so arc center aligns with +Z (matches rotation.y convention)\n  const newGeo = new THREE.CircleGeometry(hitRange, 24, Math.PI / 2 - hitArc / 2, hitArc);\n  newGeo.rotateX(-Math.PI / 2);\n  decal.mesh.geometry.dispose();\n  decal.mesh.geometry = newGeo;\n\n  decal.active = true;\n  decal.life = 0;\n  decal.maxLife = durationMs / 1000;\n  decal.mesh.visible = true;\n  decal.mesh.position.set(x, 0.05, z);\n  decal.mesh.scale.set(1, 1, 1);\n  decal.mesh.rotation.set(0, facingAngle, 0);\n  decal.mesh.material.opacity = 0.35;\n}\n\nfunction updateEnemyArcDecals(dt: number): void {\n  for (const d of enemyArcPool) {\n    if (!d.active) continue;\n\n    d.life += dt;\n    if (d.life >= d.maxLife) {\n      d.active = false;\n      d.mesh.visible = false;\n      continue;\n    }\n\n    const t = d.life / d.maxLife;\n\n    // Pulsing opacity during telegraph, then fade in last 20%\n    if (t < 0.8) {\n      // Pulse between 0.2 and 0.35\n      const pulse = 0.275 + 0.075 * Math.sin(d.life * 12);\n      d.mesh.material.opacity = pulse;\n    } else {\n      // Fade out in last 20%\n      const fadeT = (t - 0.8) / 0.2;\n      d.mesh.material.opacity = 0.35 * (1 - fadeT);\n    }\n  }\n}\n\nfunction clearEnemyArcDecals(): void {\n  for (const d of enemyArcPool) {\n    d.active = false;\n    d.mesh.visible = false;\n  }\n}\n\n// \u2500\u2500\u2500 Burst API \u2500\u2500\u2500\n\nexport function burst(\n  position: { x: number; y?: number; z: number },\n  config: ParticleConfig,\n  direction?: { x: number; z: number }\n): void {\n  if (!sceneRef) return;\n\n  const y = position.y ?? 0.5; // default to waist height\n\n  for (let i = 0; i < config.count; i++) {\n    const p = acquireParticle();\n    if (!p) break; // pool exhausted\n\n    // Set geometry based on shape\n    p.mesh.geometry = config.shape === 'sphere' ? sphereGeo : boxGeo;\n\n    // Size\n    const s = config.size * (0.7 + Math.random() * 0.6); // slight variation\n    p.mesh.scale.set(s, s, s);\n    p.baseScale = s;\n\n    // Color\n    p.material.color.setHex(config.color);\n    p.material.opacity = 1;\n\n    // Position\n    p.mesh.position.set(\n      position.x + (Math.random() - 0.5) * 0.1,\n      y + (Math.random() - 0.5) * 0.1,\n      position.z + (Math.random() - 0.5) * 0.1\n    );\n\n    // Velocity \u2014 spread around direction (or random sphere)\n    let vx: number, vy: number, vz: number;\n    if (direction) {\n      // Spread around given direction\n      const angle = Math.atan2(direction.x, direction.z) + (Math.random() - 0.5) * config.spread;\n      const elevAngle = (Math.random() - 0.3) * config.spread * 0.5;\n      vx = Math.sin(angle) * Math.cos(elevAngle);\n      vy = Math.sin(elevAngle) + Math.random() * 0.3;\n      vz = Math.cos(angle) * Math.cos(elevAngle);\n    } else {\n      // Random sphere\n      const theta = Math.random() * Math.PI * 2;\n      const phi = Math.random() * config.spread;\n      vx = Math.sin(phi) * Math.cos(theta);\n      vy = Math.cos(phi) * 0.5 + Math.random() * 0.5;\n      vz = Math.sin(phi) * Math.sin(theta);\n    }\n\n    const speed = config.speed * (0.6 + Math.random() * 0.8);\n    p.vx = vx * speed;\n    p.vy = vy * speed;\n    p.vz = vz * speed;\n\n    p.gravity = config.gravity;\n    p.fadeOut = config.fadeOut;\n    p.life = 0;\n    p.maxLife = config.lifetime * (0.7 + Math.random() * 0.6);\n    p.active = true;\n    p.mesh.visible = true;\n  }\n}\n\n// \u2500\u2500\u2500 Update \u2500\u2500\u2500\n\nexport function updateParticles(dt: number): void {\n  updateArcDecals(dt);\n  updateEnemyArcDecals(dt);\n\n  for (const p of pool) {\n    if (!p.active) continue;\n\n    p.life += dt;\n    if (p.life >= p.maxLife) {\n      p.active = false;\n      p.mesh.visible = false;\n      continue;\n    }\n\n    // Physics\n    p.vy -= p.gravity * dt;\n    p.mesh.position.x += p.vx * dt;\n    p.mesh.position.y += p.vy * dt;\n    p.mesh.position.z += p.vz * dt;\n\n    // Floor collision\n    if (p.mesh.position.y < 0.02) {\n      p.mesh.position.y = 0.02;\n      p.vy = 0;\n      p.vx *= 0.8; // friction\n      p.vz *= 0.8;\n    }\n\n    // Fade\n    if (p.fadeOut) {\n      const t = p.life / p.maxLife;\n      p.material.opacity = 1 - t * t; // quadratic fade\n    }\n\n    // Shrink slightly near end of life (absolute, not cumulative)\n    const lifeRatio = p.life / p.maxLife;\n    if (lifeRatio > 0.7) {\n      const shrink = 1 - (lifeRatio - 0.7) / 0.3;\n      p.mesh.scale.setScalar(p.baseScale * shrink);\n    }\n  }\n}\n\n// \u2500\u2500\u2500 Pool Management \u2500\u2500\u2500\n\nfunction acquireParticle(): Particle | null {\n  for (const p of pool) {\n    if (!p.active) return p;\n  }\n  return null; // pool exhausted \u2014 just skip\n}\n\nexport function clearParticles(): void {\n  for (const p of pool) {\n    p.active = false;\n    p.mesh.visible = false;\n  }\n  clearArcDecals();\n  clearEnemyArcDecals();\n}\n\n// \u2500\u2500\u2500 Event Bus Integration \u2500\u2500\u2500\n\nfunction wireEventBus(): void {\n  on('enemyHit', (e: GameEvent) => {\n    if (e.type === 'enemyHit') {\n      burst(\n        { x: e.position.x, y: 0.5, z: e.position.z },\n        HIT_SPARK\n      );\n    }\n  });\n\n  on('enemyDied', (e: GameEvent) => {\n    if (e.type === 'enemyDied') {\n      // Use enemy color for death puff\n      const color = e.enemy.config?.color ?? DEATH_PUFF.color;\n      burst(\n        { x: e.position.x, y: 0.4, z: e.position.z },\n        { ...DEATH_PUFF, color }\n      );\n    }\n  });\n\n  on('playerDash', (e: GameEvent) => {\n    if (e.type === 'playerDash') {\n      burst(\n        { x: e.position.x, y: 0.4, z: e.position.z },\n        DASH_TRAIL,\n        { x: -e.direction.x, z: -e.direction.z }\n      );\n    }\n  });\n\n  on('shieldBreak', (e: GameEvent) => {\n    if (e.type === 'shieldBreak') {\n      burst(\n        { x: e.position.x, y: 0.6, z: e.position.z },\n        SHIELD_BREAK_BURST\n      );\n    }\n  });\n\n  on('chargeFired', (e: GameEvent) => {\n    if (e.type === 'chargeFired') {\n      burst(\n        { x: e.position.x, y: 0.5, z: e.position.z },\n        { ...CHARGE_BLAST, count: Math.round(6 + e.chargeT * 6) },\n        { x: e.direction.x, z: e.direction.z }\n      );\n    }\n  });\n\n  on('enemyPushed', (e: GameEvent) => {\n    if (e.type === 'enemyPushed') {\n      burst(\n        { x: e.position.x, y: 0.3, z: e.position.z },\n        PUSH_BURST\n      );\n    }\n  });\n\n  on('meleeSwing', (e: GameEvent) => {\n    if (e.type === 'meleeSwing') {\n      burst(\n        { x: e.position.x, y: 0.6, z: e.position.z },\n        { ...DASH_TRAIL, count: 2, speed: 3, lifetime: 0.15, color: 0xffffff },\n        { x: e.direction.x, z: e.direction.z }\n      );\n      // Ground arc decal showing melee hit area\n      spawnArcDecal(e.position.x, e.position.z, e.direction.x, e.direction.z);\n    }\n  });\n\n  on('wallSlam', (e: GameEvent) => {\n    if (e.type === 'wallSlam') {\n      burst(\n        { x: e.position.x, y: 0.3, z: e.position.z },\n        { ...WALL_SLAM_SPARK, count: Math.round(4 + (e.speed / 5) * 4) }\n      );\n    }\n  });\n\n  on('enemyImpact', (e: GameEvent) => {\n    if (e.type === 'enemyImpact') {\n      burst(\n        { x: e.position.x, y: 0.4, z: e.position.z },\n        { ...ENEMY_IMPACT_SPARK, count: Math.round(3 + (e.speed / 5) * 3) }\n      );\n    }\n  });\n\n  on('enemyMeleeTelegraph', (e: GameEvent) => {\n    if (e.type === 'enemyMeleeTelegraph') {\n      spawnEnemyArcDecal(\n        e.position.x, e.position.z,\n        e.facingAngle, e.hitArc, e.hitRange,\n        e.duration\n      );\n    }\n  });\n\n  on('doorUnlocked', (e: GameEvent) => {\n    if (e.type === 'doorUnlocked') {\n      // Burst particles at the door location (top of far wall)\n      // We don't have the exact position here, so emit upward from center-far\n      burst({ x: 0, y: 2, z: 0 }, DOOR_UNLOCK_BURST);\n    }\n  });\n\n  on('obstacleDestroyed', (e: GameEvent) => {\n    if (e.type === 'obstacleDestroyed') {\n      burst(\n        { x: e.position.x, y: 0.5, z: e.position.z },\n        OBSTACLE_BREAK_BURST\n      );\n    }\n  });\n\n  on('objectWallSlam', (e: GameEvent) => {\n    if (e.type === 'objectWallSlam') {\n      burst(\n        { x: e.position.x, y: 0.3, z: e.position.z },\n        { ...WALL_SLAM_SPARK, count: Math.round(3 + (e.speed / 6) * 3), color: 0x888888 }\n      );\n    }\n  });\n\n  on('objectImpact', (e: GameEvent) => {\n    if (e.type === 'objectImpact') {\n      burst(\n        { x: e.position.x, y: 0.4, z: e.position.z },\n        { ...ENEMY_IMPACT_SPARK, count: Math.round(3 + (e.speed / 5) * 3) }\n      );\n    }\n  });\n\n  on('bendApplied', (e: GameEvent) => {\n    if (e.type === 'bendApplied') {\n      const color = e.bendId === 'enlarge' ? 0x4488ff : 0xffcc44;\n      burst(\n        { x: e.position.x, y: 0.5, z: e.position.z },\n        { ...BEND_APPLY_BURST, color }\n      );\n    }\n  });\n}\n", "// Telegraph system \u2014 visual warnings before enemies spawn\n// Ground ring + fill circle + type indicator per spawn point\n\nimport { ENEMY_TYPES } from '../config/enemies';\n\nlet sceneRef: any;\n\n// Shared geometries (created once, reused across all telegraphs)\nlet ringGeo: any, fillGeo: any;\nconst typeGeos: Record<string, any> = {};  // keyed by enemy type name\n\n// Type indicator shapes\nconst TYPE_LABELS: Record<string, string> = {\n  goblin: 'G',\n  skeletonArcher: 'A',\n  stoneGolem: 'T',\n  iceMortarImp: 'I',\n};\n\nexport function initTelegraph(scene: any) {\n  sceneRef = scene;\n\n  // Ring: inner 0.6, outer 0.8, flat on ground\n  ringGeo = new THREE.RingGeometry(0.6, 0.8, 24);\n  ringGeo.rotateX(-Math.PI / 2);\n\n  // Fill circle: radius 0.6\n  fillGeo = new THREE.CircleGeometry(0.6, 24);\n  fillGeo.rotateX(-Math.PI / 2);\n\n  // Type indicators \u2014 small shapes\n  // Goblin: triangle (cone 3 sides)\n  typeGeos.goblin = new THREE.ConeGeometry(0.2, 0.4, 3);\n  // Archer: diamond (box rotated)\n  typeGeos.skeletonArcher = new THREE.BoxGeometry(0.25, 0.25, 0.25);\n  // Golem: hexagon (cylinder 6 sides, flat)\n  typeGeos.stoneGolem = new THREE.CylinderGeometry(0.25, 0.25, 0.1, 6);\n  // Imp: sphere (mortar projectile shape)\n  typeGeos.iceMortarImp = new THREE.SphereGeometry(0.2, 8, 8);\n}\n\nexport function createTelegraph(x: number, z: number, typeName: string) {\n  const color = ENEMY_TYPES[typeName] ? ENEMY_TYPES[typeName].color : 0xffffff;\n  const group = new THREE.Group();\n  group.position.set(x, 0, z);\n\n  // Ground ring\n  const ringMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.6,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const ring = new THREE.Mesh(ringGeo, ringMat);\n  ring.position.y = 0.03;\n  group.add(ring);\n\n  // Fill circle\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const fill = new THREE.Mesh(fillGeo, fillMat);\n  fill.position.y = 0.02;\n  group.add(fill);\n\n  // Type indicator \u2014 floating shape\n  const typeGeo = typeGeos[typeName] || typeGeos.goblin;\n  const typeMat = new THREE.MeshStandardMaterial({\n    color: color,\n    emissive: color,\n    emissiveIntensity: 0.6,\n    transparent: true,\n    opacity: 0.8,\n  });\n  const typeIndicator = new THREE.Mesh(typeGeo, typeMat);\n  typeIndicator.position.y = 1.2;\n  if (typeName === 'skeletonArcher') {\n    typeIndicator.rotation.y = Math.PI / 4; // diamond rotation\n  }\n  group.add(typeIndicator);\n\n  sceneRef.add(group);\n\n  return {\n    group,\n    ring,\n    ringMat,\n    fill,\n    fillMat,\n    typeIndicator,\n    typeMat,\n    baseColor: color,\n    time: 0,\n  };\n}\n\n// progress: 0 = just appeared, 1 = about to spawn\nexport function updateTelegraph(telegraph: any, progress: number, dt: number) {\n  telegraph.time += dt;\n\n  // Fill circle: opacity ramps up with progress\n  telegraph.fillMat.opacity = progress * 0.4;\n\n  // Ring: pulse frequency increases with progress (2Hz \u2192 10Hz)\n  const freq = 2 + progress * 8;\n  const pulse = 0.5 + 0.5 * Math.sin(telegraph.time * freq * Math.PI * 2);\n\n  // Ring opacity: base 0.3 + pulse\n  telegraph.ringMat.opacity = 0.3 + pulse * 0.5;\n\n  // Ring scale: gentle breathing\n  const scale = 1.0 + 0.1 * Math.sin(telegraph.time * freq * Math.PI * 2);\n  telegraph.ring.scale.set(scale, 1, scale);\n\n  // Flash white when close to spawning (>80%)\n  if (progress > 0.8) {\n    const flash = Math.sin(telegraph.time * 20) > 0.5;\n    telegraph.ringMat.color.setHex(flash ? 0xffffff : telegraph.baseColor);\n    telegraph.fillMat.color.setHex(flash ? 0xffffff : telegraph.baseColor);\n  }\n\n  // Type indicator: gentle bob\n  telegraph.typeIndicator.position.y = 1.2 + 0.15 * Math.sin(telegraph.time * 2);\n  telegraph.typeIndicator.rotation.y += dt * 1.5;\n}\n\nexport function removeTelegraph(telegraph: any) {\n  if (telegraph.group.parent) {\n    sceneRef.remove(telegraph.group);\n  }\n  // Dispose cloned materials\n  telegraph.ringMat.dispose();\n  telegraph.fillMat.dispose();\n  telegraph.typeMat.dispose();\n}\n", "// Door config \u2014 tunable at runtime via tuning panel\n\nexport const DOOR_CONFIG = {\n  unlockDuration: 1000,    // ms \u2014 door unlock animation duration\n  interactRadius: 3.5,     // units \u2014 how close player must be to interact with door\n                           // (door is at wall edge, player clamps ~0.5u away, so needs generous radius)\n  restPause: 2000,         // ms \u2014 how long before rest room door opens\n};\n", "// Door System \u2014 visual door at the far end of each room (-Z wall)\n// States: locked \u2192 unlocking \u2192 open\n// Player must be near the open door AND press interact (F/Enter) or dash through\n\nimport { DOOR_CONFIG } from '../config/door';\nimport { emit } from './events';\n\n// Door state\ntype DoorState = 'locked' | 'unlocking' | 'open' | 'none';\n\nlet doorState: DoorState = 'none';\nlet doorGroup: any = null;\nlet doorFrameMesh: any = null;\nlet doorPanelMesh: any = null;\nlet doorGlowMesh: any = null;\nlet doorAnimTimer = 0;\nlet doorRoomIndex = 0;\nlet sceneRef: any = null;\n\n// Door position (centered on far wall at -Z)\nlet doorX = 0;\nlet doorZ = 0;\n\n// Prompt UI element\nlet promptEl: HTMLElement | null = null;\nlet promptVisible = false;\n\nexport function initDoor(scene: any) {\n  sceneRef = scene;\n\n  // Create or find the door prompt element\n  promptEl = document.getElementById('door-prompt');\n  if (!promptEl) {\n    promptEl = document.createElement('div');\n    promptEl.id = 'door-prompt';\n    promptEl.style.cssText = `\n      position: fixed;\n      bottom: 25%;\n      left: 50%;\n      transform: translateX(-50%);\n      color: #88bbff;\n      font-family: 'Courier New', monospace;\n      font-size: 16px;\n      font-weight: bold;\n      text-align: center;\n      pointer-events: none;\n      opacity: 0;\n      transition: opacity 0.2s ease;\n      text-shadow: 0 0 10px rgba(136, 187, 255, 0.6);\n      z-index: 50;\n    `;\n    promptEl.textContent = 'Press F to enter';\n    document.body.appendChild(promptEl);\n  }\n}\n\nexport function createDoor(arenaHalfX: number, arenaHalfZ: number, roomIndex: number) {\n  removeDoor();\n\n  doorState = 'locked';\n  doorRoomIndex = roomIndex;\n  doorAnimTimer = 0;\n\n  // Door is centered near the far wall (-Z = top-right in iso)\n  // Offset 1 unit inward so the door frame is visible in front of the wall\n  doorX = 0;\n  doorZ = -arenaHalfZ + 1;\n\n  doorGroup = new THREE.Group();\n  doorGroup.position.set(doorX, 0, doorZ);\n\n  // Door frame \u2014 two pillars and a lintel (contrasting color from arena walls)\n  const frameMat = new THREE.MeshStandardMaterial({\n    color: 0x4a4a6a,\n    emissive: 0x4466aa,\n    emissiveIntensity: 0.5,\n    roughness: 0.5,\n  });\n\n  // Left pillar \u2014 thicker and taller than walls so it reads as a doorway\n  const leftPillar = new THREE.Mesh(\n    new THREE.BoxGeometry(0.6, 4, 0.6),\n    frameMat\n  );\n  leftPillar.position.set(-2, 2, 0);\n  doorGroup.add(leftPillar);\n\n  // Right pillar\n  const rightPillar = new THREE.Mesh(\n    new THREE.BoxGeometry(0.6, 4, 0.6),\n    frameMat\n  );\n  rightPillar.position.set(2, 2, 0);\n  doorGroup.add(rightPillar);\n\n  // Lintel (top bar)\n  const lintel = new THREE.Mesh(\n    new THREE.BoxGeometry(4.6, 0.5, 0.6),\n    frameMat\n  );\n  lintel.position.set(0, 4.25, 0);\n  doorGroup.add(lintel);\n\n  doorFrameMesh = doorGroup; // for reference\n\n  // Door panel \u2014 the part that animates (wider to fill frame)\n  const panelMat = new THREE.MeshStandardMaterial({\n    color: 0x1a1a2e,\n    emissive: 0x334466,\n    emissiveIntensity: 0.2,\n    transparent: true,\n    opacity: 0.9,\n    roughness: 0.5,\n  });\n  doorPanelMesh = new THREE.Mesh(\n    new THREE.BoxGeometry(3.4, 3.6, 0.25),\n    panelMat\n  );\n  doorPanelMesh.position.set(0, 1.8, 0);\n  doorGroup.add(doorPanelMesh);\n\n  // Glow plane \u2014 behind the door, visible when open (on the +Z side facing player)\n  const glowMat = new THREE.MeshBasicMaterial({\n    color: 0x88bbff,\n    transparent: true,\n    opacity: 0,\n    side: THREE.DoubleSide,\n  });\n  doorGlowMesh = new THREE.Mesh(\n    new THREE.PlaneGeometry(3.4, 3.6),\n    glowMat\n  );\n  doorGlowMesh.position.set(0, 1.8, 0.2); // glow on the +Z side (facing player approach)\n  doorGroup.add(doorGlowMesh);\n\n  sceneRef.add(doorGroup);\n}\n\nexport function unlockDoor() {\n  if (doorState !== 'locked') return;\n  doorState = 'unlocking';\n  doorAnimTimer = 0;\n}\n\n/**\n * Update door state and check for interaction.\n * @param interact - true if the player pressed the interact key this frame\n * @param playerDashing - true if the player is currently dashing\n * @returns true if the player entered the door (trigger room transition)\n */\nexport function updateDoor(dt: number, playerPos: any, interact: boolean, playerDashing: boolean): boolean {\n  if (doorState === 'none' || !doorGroup) return false;\n\n  if (doorState === 'unlocking') {\n    doorAnimTimer += dt * 1000;\n    const progress = Math.min(doorAnimTimer / DOOR_CONFIG.unlockDuration, 1);\n\n    // Door panel slides up\n    doorPanelMesh.position.y = 1.8 + progress * 4;\n    doorPanelMesh.material.opacity = 0.9 * (1 - progress);\n\n    // Glow appears\n    doorGlowMesh.material.opacity = progress * 0.6;\n\n    // Frame emissive ramps up\n    doorGroup.children.forEach((child: any) => {\n      if (child.material && child !== doorPanelMesh && child !== doorGlowMesh) {\n        child.material.emissiveIntensity = 0.5 + progress * 0.8;\n      }\n    });\n\n    if (progress >= 1) {\n      doorState = 'open';\n      emit({ type: 'doorUnlocked', roomIndex: doorRoomIndex });\n    }\n  }\n\n  if (doorState === 'open') {\n    // Pulsing glow\n    doorAnimTimer += dt * 1000;\n    const pulse = 0.4 + 0.2 * Math.sin(doorAnimTimer * 0.003 * Math.PI * 2);\n    doorGlowMesh.material.opacity = pulse;\n\n    // Check player proximity \u2014 use a generous radius since the door is at the wall\n    // Player is clamped to \u00B1(arenaHalfZ - 0.5), door is at -arenaHalfZ\n    // So we check with a larger interact radius that accounts for the wall gap\n    if (playerPos) {\n      const dx = playerPos.x - doorX;\n      const dz = playerPos.z - doorZ;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n\n      const nearDoor = dist < DOOR_CONFIG.interactRadius;\n\n      if (nearDoor) {\n        // Show prompt\n        showPrompt();\n\n        // Enter on interact key press OR dashing into the door\n        if (interact || playerDashing) {\n          hidePrompt();\n          emit({ type: 'doorEntered', roomIndex: doorRoomIndex });\n          doorState = 'none';\n          return true; // trigger room transition\n        }\n      } else {\n        hidePrompt();\n      }\n    }\n  } else {\n    hidePrompt();\n  }\n\n  return false;\n}\n\nfunction showPrompt() {\n  if (promptEl && !promptVisible) {\n    promptVisible = true;\n    promptEl.style.opacity = '1';\n  }\n}\n\nfunction hidePrompt() {\n  if (promptEl && promptVisible) {\n    promptVisible = false;\n    promptEl.style.opacity = '0';\n  }\n}\n\nexport function removeDoor() {\n  hidePrompt();\n  if (doorGroup && sceneRef) {\n    sceneRef.remove(doorGroup);\n    // Dispose geometries and materials\n    doorGroup.traverse((child: any) => {\n      if (child.geometry) child.geometry.dispose();\n      if (child.material) child.material.dispose();\n    });\n  }\n  doorGroup = null;\n  doorPanelMesh = null;\n  doorGlowMesh = null;\n  doorFrameMesh = null;\n  doorState = 'none';\n}\n\nexport function getDoorState(): DoorState {\n  return doorState;\n}\n\nexport function isDoorOpen(): boolean {\n  return doorState === 'open';\n}\n", "import { PhysicsObject, PhysicsObjectPlacement } from '../types/index';\n\nlet nextId = 1;\n\nexport function resetPhysicsObjectIds(): void {\n  nextId = 1;\n}\n\nexport function createPhysicsObject(placement: PhysicsObjectPlacement): PhysicsObject {\n  return {\n    id: nextId++,\n    pos: { x: placement.x, z: placement.z },\n    vel: { x: 0, z: 0 },\n    radius: placement.radius,\n    mass: placement.mass,\n    health: placement.health,\n    maxHealth: placement.health,\n    material: placement.material,\n    meshType: placement.meshType,\n    scale: placement.scale ?? 1,\n    restitution: undefined,\n    mesh: null,\n    destroyed: false,\n    fellInPit: false,\n  };\n}\n\n// \u2500\u2500\u2500 Mesh Creation \u2500\u2500\u2500\n\nconst MATERIAL_COLORS: Record<string, { color: number; emissive: number }> = {\n  stone: { color: 0x888899, emissive: 0x334455 },\n  wood:  { color: 0x8B6914, emissive: 0x443322 },\n  metal: { color: 0xaaaacc, emissive: 0x556677 },\n  ice:   { color: 0x88ccff, emissive: 0x4488aa },\n};\n\nexport function createPhysicsObjectMesh(obj: PhysicsObject, scene: any): void {\n  const group = new THREE.Group();\n  const colors = MATERIAL_COLORS[obj.material] || MATERIAL_COLORS.stone;\n  const mat = new THREE.MeshStandardMaterial({\n    color: colors.color,\n    emissive: colors.emissive,\n    emissiveIntensity: 0.3,\n    roughness: 0.7,\n  });\n\n  let geo;\n  switch (obj.meshType) {\n    case 'rock':\n      geo = new THREE.SphereGeometry(obj.radius * obj.scale, 8, 6);\n      break;\n    case 'crate': {\n      // Squat cylinder with 6 sides \u2014 reads as a chunky crate/drum shape\n      // while having a circular footprint that exactly matches circle collision.\n      // No corner-beyond-radius mismatch possible.\n      const r = obj.radius * obj.scale;\n      geo = new THREE.CylinderGeometry(r, r, r * 1.4, 6);\n      break;\n    }\n    case 'barrel':\n      // Max ground-plane radius = bottom radius = obj.radius * obj.scale\n      geo = new THREE.CylinderGeometry(\n        obj.radius * obj.scale * 0.8,\n        obj.radius * obj.scale,\n        obj.radius * obj.scale * 1.5,\n        8\n      );\n      break;\n    case 'pillar':\n      // Max ground-plane radius = bottom radius = obj.radius * obj.scale\n      geo = new THREE.CylinderGeometry(\n        obj.radius * obj.scale * 0.6,\n        obj.radius * obj.scale,\n        obj.radius * obj.scale * 2.5,\n        6\n      );\n      break;\n  }\n\n  const mesh = new THREE.Mesh(geo, mat);\n  mesh.position.y = obj.radius * obj.scale * 0.5; // sit on ground\n  group.add(mesh);\n\n  group.position.set(obj.pos.x, 0, obj.pos.z);\n  // Store the base geometry size so bend visuals can scale relative to it\n  group.userData._baseGeoSize = obj.radius * obj.scale;\n  scene.add(group);\n  obj.mesh = group;\n}\n\nexport function applyBendVisuals(obj: PhysicsObject, tintColor: number): void {\n  if (!obj.mesh) return;\n  // Scale mesh so visual matches collision radius.\n  // Geometry was built at baseGeoSize = originalRadius * originalScale.\n  // We want the visual to reflect the new radius.\n  const base = obj.mesh.userData._baseGeoSize || 1;\n  const s = obj.radius / base;\n  obj.mesh.scale.set(s, s, s);\n  obj.mesh.traverse((child: any) => {\n    if (child.isMesh && child.material) {\n      child.material.emissive.setHex(tintColor);\n      child.material.emissiveIntensity = 0.6;\n    }\n  });\n}\n\nexport function clearBendVisuals(obj: PhysicsObject): void {\n  if (!obj.mesh) return;\n  obj.mesh.scale.set(1, 1, 1);\n  const colors = MATERIAL_COLORS[obj.material] || MATERIAL_COLORS.stone;\n  obj.mesh.traverse((child: any) => {\n    if (child.isMesh && child.material) {\n      child.material.emissive.setHex(colors.emissive);\n      child.material.emissiveIntensity = 0.3;\n    }\n  });\n}\n\nexport function clearPhysicsObjects(gameState: any, scene: any): void {\n  for (const obj of gameState.physicsObjects) {\n    if (obj.mesh) {\n      scene.remove(obj.mesh);\n      obj.mesh.traverse((child: any) => {\n        if (child.geometry) child.geometry.dispose();\n        if (child.material) child.material.dispose();\n      });\n    }\n  }\n  gameState.physicsObjects = [];\n}\n", "export interface BendEffect {\n  param: 'scale' | 'mass' | 'radius';\n  operation: 'multiply' | 'set';\n  value: number;\n}\n\nexport interface RuleBend {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  property: 'size' | 'adhesion' | 'durability';\n  pole: 'positive' | 'negative';\n  effects: BendEffect[];\n  tintColor: number;\n}\n\nexport const BENDS: RuleBend[] = [\n  {\n    id: 'enlarge',\n    name: 'Enlarge',\n    description: 'Scale up \u2014 bigger, heavier, more impact',\n    icon: '\u2B06',\n    property: 'size',\n    pole: 'positive',\n    effects: [\n      { param: 'scale', operation: 'multiply', value: 2.5 },\n      { param: 'mass', operation: 'multiply', value: 2 },\n      { param: 'radius', operation: 'multiply', value: 2 },\n    ],\n    tintColor: 0x4488ff,\n  },\n  {\n    id: 'shrink',\n    name: 'Shrink',\n    description: 'Scale down \u2014 tiny, light, flies on any push',\n    icon: '\u2B07',\n    property: 'size',\n    pole: 'negative',\n    effects: [\n      { param: 'scale', operation: 'multiply', value: 0.3 },\n      { param: 'mass', operation: 'multiply', value: 0.3 },\n      { param: 'radius', operation: 'multiply', value: 0.3 },\n    ],\n    tintColor: 0xffcc44,\n  },\n];\n\nexport function getBendById(id: string): RuleBend | undefined {\n  return BENDS.find(b => b.id === id);\n}\n", "import { getBendById } from '../config/bends';\n\nexport interface ActiveBend {\n  bendId: string;\n  targetType: 'physicsObject' | 'obstacle';\n  targetId: number;\n  target: any;\n  originalValues: Record<string, number>;\n}\n\nexport interface ApplyResult {\n  success: boolean;\n  reason?: 'no_bends_remaining' | 'opposite_pole' | 'already_applied' | 'invalid_bend' | 'invalid_target';\n}\n\nexport function createBendSystem(maxBends: number) {\n  let activeBends: ActiveBend[] = [];\n  let remaining = maxBends;\n  const max = maxBends;\n\n  function applyBend(bendId: string, targetType: 'physicsObject' | 'obstacle', target: any): ApplyResult {\n    const bend = getBendById(bendId);\n    if (!bend) return { success: false, reason: 'invalid_bend' };\n\n    if (remaining <= 0) return { success: false, reason: 'no_bends_remaining' };\n\n    const targetId = target.id ?? 0;\n\n    // Check if same bend already applied to this target\n    const existing = activeBends.find(ab => ab.targetId === targetId && ab.targetType === targetType);\n    if (existing) {\n      if (existing.bendId === bendId) {\n        return { success: false, reason: 'already_applied' };\n      }\n      // Check opposite pole\n      const existingBend = getBendById(existing.bendId);\n      if (existingBend && existingBend.property === bend.property) {\n        return { success: false, reason: 'opposite_pole' };\n      }\n    }\n\n    // Save original values before mutation\n    const originalValues: Record<string, number> = {};\n    for (const fx of bend.effects) {\n      originalValues[fx.param] = target[fx.param];\n    }\n\n    // Apply effects\n    for (const fx of bend.effects) {\n      if (fx.operation === 'multiply') {\n        target[fx.param] *= fx.value;\n      } else if (fx.operation === 'set') {\n        target[fx.param] = fx.value;\n      }\n    }\n\n    activeBends.push({\n      bendId,\n      targetType,\n      targetId,\n      target,\n      originalValues,\n    });\n\n    remaining--;\n    return { success: true };\n  }\n\n  function resetAll(): void {\n    for (const ab of activeBends) {\n      for (const [param, value] of Object.entries(ab.originalValues)) {\n        ab.target[param] = value;\n      }\n    }\n    activeBends = [];\n    remaining = max;\n  }\n\n  function getActiveBends(): ActiveBend[] {\n    return [...activeBends];\n  }\n\n  function bendsRemaining(): number {\n    return remaining;\n  }\n\n  function hasBendOnTarget(targetType: string, targetId: number): string | null {\n    const found = activeBends.find(ab => ab.targetType === targetType && ab.targetId === targetId);\n    return found ? found.bendId : null;\n  }\n\n  return { applyBend, resetAll, getActiveBends, bendsRemaining, hasBendOnTarget };\n}\n", "// Bullet Time \u2014 player-triggered slow-mo\n// Press Q to toggle. Resource bar drains while active, enemy kills refill it.\n// Player moves at normal speed; everything else slows down.\n\nimport { emit, on } from './events';\n\nexport const BULLET_TIME = {\n  timeScale: 0.25,          // how slow the world runs (0.25 = 25% speed)\n  maxResource: 3000,         // ms of bullet time available at full bar\n  drainRate: 1000,           // resource drained per real second while active\n  killRefill: 600,           // resource refilled per enemy kill\n  activationMinimum: 300,    // minimum resource required to activate\n  infinite: 1,               // 1 = infinite resource (skip drain), 0 = normal drain\n};\n\nlet resource = BULLET_TIME.maxResource;\nlet active = false;\nlet initialized = false;\n\nexport function initBulletTime() {\n  if (initialized) return;\n  initialized = true;\n\n  // Kill refill \u2014 subscribe to enemyDied event\n  on('enemyDied', () => {\n    refillBulletTime(BULLET_TIME.killRefill);\n  });\n}\n\n/** Activate bullet time (no-op if already active). */\nexport function activateBulletTime() {\n  if (active) return;\n  if (resource >= BULLET_TIME.activationMinimum) {\n    active = true;\n    emit({ type: 'bulletTimeActivated' });\n  }\n}\n\nexport function toggleBulletTime() {\n  if (active) {\n    // Deactivate\n    active = false;\n    emit({ type: 'bulletTimeDeactivated' });\n  } else {\n    activateBulletTime();\n  }\n}\n\nexport function updateBulletTime(realDt: number) {\n  if (!active) return;\n\n  // Skip drain when infinite mode is on\n  if (BULLET_TIME.infinite >= 1) return;\n\n  // Drain resource\n  resource -= BULLET_TIME.drainRate * realDt;\n\n  if (resource <= 0) {\n    resource = 0;\n    active = false;\n    emit({ type: 'bulletTimeDeactivated' });\n  }\n}\n\nexport function getBulletTimeScale(): number {\n  return active ? BULLET_TIME.timeScale : 1;\n}\n\nexport function refillBulletTime(amount: number) {\n  resource = Math.min(resource + amount, BULLET_TIME.maxResource);\n}\n\nexport function resetBulletTime() {\n  resource = BULLET_TIME.maxResource;\n  active = false;\n}\n\nexport function isBulletTimeActive(): boolean {\n  return active;\n}\n\nexport function getBulletTimeResource(): number {\n  return resource;\n}\n\nexport function getBulletTimeMax(): number {\n  return BULLET_TIME.maxResource;\n}\n", "import { BENDS, RuleBend } from '../config/bends';\n\n// \u2500\u2500\u2500 State \u2500\u2500\u2500\n\nlet containerEl: HTMLDivElement | null = null;\nlet optionEls: HTMLDivElement[] = [];\nlet visible = false;\nlet selectedBendId: string | null = null;\nlet onBendSelectedCallback: ((bendId: string) => void) | null = null;\n\n// \u2500\u2500\u2500 Constants \u2500\u2500\u2500\n\nconst MENU_SIZE = 200;       // overall container size\nconst OPTION_SIZE = 72;      // each option circle\nconst OPTION_DISTANCE = 60;  // distance from center\n\n// \u2500\u2500\u2500 Init \u2500\u2500\u2500\n\nexport function initRadialMenu(): void {\n  // Container \u2014 centered overlay, hidden by default\n  containerEl = document.createElement('div');\n  containerEl.id = 'radial-menu';\n  containerEl.style.cssText = `\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    width: ${MENU_SIZE}px;\n    height: ${MENU_SIZE}px;\n    margin-left: ${-MENU_SIZE / 2}px;\n    margin-top: ${-MENU_SIZE / 2}px;\n    pointer-events: none;\n    z-index: 200;\n    display: none;\n  `;\n\n  // Center label\n  const centerLabel = document.createElement('div');\n  centerLabel.style.cssText = `\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-family: 'Courier New', monospace;\n    font-size: 10px;\n    color: rgba(200, 200, 220, 0.7);\n    letter-spacing: 2px;\n    text-transform: uppercase;\n    pointer-events: none;\n    white-space: nowrap;\n  `;\n  centerLabel.textContent = 'BEND';\n  containerEl.appendChild(centerLabel);\n\n  // Build option circles arranged in a line (2 options = left and right)\n  const angleStep = (2 * Math.PI) / BENDS.length;\n  const startAngle = Math.PI; // left \u2014 so 2 options go left/right\n\n  for (let i = 0; i < BENDS.length; i++) {\n    const bend = BENDS[i];\n    const angle = startAngle + i * angleStep;\n    const x = Math.cos(angle) * OPTION_DISTANCE;\n    const y = Math.sin(angle) * OPTION_DISTANCE;\n\n    const optEl = createOptionElement(bend, x, y);\n    containerEl.appendChild(optEl);\n    optionEls.push(optEl);\n  }\n\n  document.body.appendChild(containerEl);\n}\n\nfunction createOptionElement(bend: RuleBend, offsetX: number, offsetY: number): HTMLDivElement {\n  const el = document.createElement('div');\n  el.dataset.bendId = bend.id;\n  const colorHex = '#' + bend.tintColor.toString(16).padStart(6, '0');\n\n  el.style.cssText = `\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: ${OPTION_SIZE}px;\n    height: ${OPTION_SIZE}px;\n    margin-left: ${-OPTION_SIZE / 2 + offsetX}px;\n    margin-top: ${-OPTION_SIZE / 2 + offsetY}px;\n    border-radius: 50%;\n    background: rgba(20, 20, 40, 0.9);\n    border: 2px solid ${colorHex}44;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    pointer-events: auto;\n    transition: transform 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;\n    user-select: none;\n  `;\n\n  // Icon\n  const iconEl = document.createElement('div');\n  iconEl.style.cssText = `\n    font-size: 20px;\n    line-height: 1;\n    pointer-events: none;\n  `;\n  iconEl.textContent = bend.icon;\n  el.appendChild(iconEl);\n\n  // Name\n  const nameEl = document.createElement('div');\n  nameEl.style.cssText = `\n    font-family: 'Courier New', monospace;\n    font-size: 9px;\n    color: ${colorHex};\n    letter-spacing: 1px;\n    text-transform: uppercase;\n    margin-top: 4px;\n    pointer-events: none;\n  `;\n  nameEl.textContent = bend.name;\n  el.appendChild(nameEl);\n\n  // Hover\n  el.addEventListener('mouseenter', () => {\n    if (selectedBendId === bend.id) return;\n    el.style.borderColor = colorHex + 'aa';\n    el.style.transform = 'scale(1.1)';\n  });\n  el.addEventListener('mouseleave', () => {\n    if (selectedBendId === bend.id) return;\n    el.style.borderColor = colorHex + '44';\n    el.style.transform = 'scale(1)';\n  });\n\n  // Click = select (mousedown to prevent attack input from firing)\n  el.addEventListener('mousedown', (e) => {\n    e.stopPropagation();\n    e.preventDefault();\n    selectBend(bend.id);\n  });\n\n  return el;\n}\n\nfunction selectBend(bendId: string): void {\n  selectedBendId = bendId;\n\n  // Update visual state\n  for (const optEl of optionEls) {\n    const id = optEl.dataset.bendId || '';\n    const bend = BENDS.find(b => b.id === id);\n    if (!bend) continue;\n    const colorHex = '#' + bend.tintColor.toString(16).padStart(6, '0');\n\n    if (id === bendId) {\n      optEl.style.borderColor = colorHex;\n      optEl.style.boxShadow = `0 0 16px ${colorHex}88, inset 0 0 8px ${colorHex}44`;\n      optEl.style.transform = 'scale(1.15)';\n    } else {\n      optEl.style.borderColor = colorHex + '22';\n      optEl.style.boxShadow = 'none';\n      optEl.style.transform = 'scale(0.9)';\n      optEl.style.opacity = '0.5';\n    }\n  }\n\n  if (onBendSelectedCallback) {\n    onBendSelectedCallback(bendId);\n  }\n}\n\n// \u2500\u2500\u2500 Public API \u2500\u2500\u2500\n\nexport function showRadialMenu(): void {\n  if (!containerEl) return;\n  visible = true;\n  selectedBendId = null;\n  containerEl.style.display = 'block';\n\n  // Reset option visuals\n  for (const optEl of optionEls) {\n    const id = optEl.dataset.bendId || '';\n    const bend = BENDS.find(b => b.id === id);\n    if (!bend) continue;\n    const colorHex = '#' + bend.tintColor.toString(16).padStart(6, '0');\n    optEl.style.borderColor = colorHex + '44';\n    optEl.style.boxShadow = 'none';\n    optEl.style.transform = 'scale(1)';\n    optEl.style.opacity = '1';\n  }\n}\n\nexport function hideRadialMenu(): void {\n  if (!containerEl) return;\n  visible = false;\n  // NOTE: do NOT clear selectedBendId here \u2014 targeting mode needs it after menu hides\n  containerEl.style.display = 'none';\n}\n\nexport function isRadialMenuVisible(): boolean {\n  return visible;\n}\n\nexport function getSelectedBendId(): string | null {\n  return selectedBendId;\n}\n\nexport function setOnBendSelected(callback: (bendId: string) => void): void {\n  onBendSelectedCallback = callback;\n}\n\nexport function clearSelectedBend(): void {\n  selectedBendId = null;\n\n  // Reset option visuals\n  for (const optEl of optionEls) {\n    const id = optEl.dataset.bendId || '';\n    const bend = BENDS.find(b => b.id === id);\n    if (!bend) continue;\n    const colorHex = '#' + bend.tintColor.toString(16).padStart(6, '0');\n    optEl.style.borderColor = colorHex + '44';\n    optEl.style.boxShadow = 'none';\n    optEl.style.transform = 'scale(1)';\n    optEl.style.opacity = '1';\n  }\n}\n", "// Bend Mode \u2014 player-triggered rule-bending targeting mode\n// Press Q to toggle. Shows radial menu for bend selection,\n// then click a physics object to apply the bend.\n\nimport { createBendSystem } from './bendSystem';\nimport { getBendById } from '../config/bends';\nimport { activateBulletTime, isBulletTimeActive, toggleBulletTime } from './bulletTime';\nimport { showRadialMenu, hideRadialMenu, isRadialMenuVisible, getSelectedBendId, clearSelectedBend } from '../ui/radialMenu';\nimport { applyBendVisuals, clearBendVisuals } from '../entities/physicsObject';\nimport { getCamera } from './renderer';\nimport { emit } from './events';\n\n// \u2500\u2500\u2500 State \u2500\u2500\u2500\n\nlet bendSystem = createBendSystem(3);\nlet active = false;\nlet targeting = false;     // bend selected, waiting for click on target\nlet maxBends = 3;\n\n// \u2500\u2500\u2500 Highlight State \u2500\u2500\u2500\n// Tracks which objects are currently highlighted so we can restore them\n\nlet highlightedObjects: Set<any> = new Set();\nlet hoveredObject: any = null;\nlet highlightPulseTime = 0;  // accumulates for pulsing animation\n\n// \u2500\u2500\u2500 Init \u2500\u2500\u2500\n\nexport function initBendMode(): void {\n  maxBends = 3;\n  bendSystem = createBendSystem(maxBends);\n}\n\n// \u2500\u2500\u2500 Toggle \u2500\u2500\u2500\n\nexport function toggleBendMode(): void {\n  if (active) {\n    deactivateBendMode();\n  } else {\n    activateBendMode();\n  }\n}\n\nfunction activateBendMode(): void {\n  if (bendSystem.bendsRemaining() <= 0) return;\n  active = true;\n  targeting = false;\n\n  // Activate bullet time for slow-mo\n  if (!isBulletTimeActive()) {\n    activateBulletTime();\n  }\n\n  showRadialMenu();\n  updateTargetingCursor();\n  emit({ type: 'bendModeActivated' });\n}\n\nfunction deactivateBendMode(): void {\n  active = false;\n  targeting = false;\n  hideRadialMenu();\n  clearSelectedBend();\n  unhighlightAllObjects();\n  updateTargetingCursor();\n\n  // Deactivate bullet time\n  if (isBulletTimeActive()) {\n    toggleBulletTime();\n  }\n\n  emit({ type: 'bendModeDeactivated' });\n}\n\n// \u2500\u2500\u2500 Targeting \u2500\u2500\u2500\n\nexport function enterTargeting(): void {\n  if (!active) return;\n  targeting = true;\n  // Hide radial menu \u2014 bend is selected, now click a target\n  hideRadialMenu();\n  updateTargetingCursor();\n}\n\n// \u2500\u2500\u2500 Targeting Cursor \u2500\u2500\u2500\n// Shows a visible \"click a target\" indicator when in targeting mode\n\nlet targetingIndicator: HTMLDivElement | null = null;\n\nfunction ensureTargetingIndicator(): void {\n  if (targetingIndicator) return;\n  targetingIndicator = document.createElement('div');\n  targetingIndicator.id = 'bend-targeting';\n  targetingIndicator.style.cssText = `\n    position: fixed;\n    top: 55%;\n    left: 50%;\n    transform: translateX(-50%);\n    font-family: 'Courier New', monospace;\n    font-size: 12px;\n    color: rgba(100, 180, 255, 0.9);\n    letter-spacing: 3px;\n    text-transform: uppercase;\n    text-shadow: 0 0 10px rgba(100, 140, 255, 0.6);\n    pointer-events: none;\n    z-index: 200;\n    display: none;\n  `;\n  document.body.appendChild(targetingIndicator);\n}\n\nfunction updateTargetingCursor(): void {\n  ensureTargetingIndicator();\n  if (!targetingIndicator) return;\n\n  if (active && targeting) {\n    const bendId = getSelectedBendId();\n    const label = bendId === 'enlarge' ? 'ENLARGE' : bendId === 'shrink' ? 'SHRINK' : 'BEND';\n    targetingIndicator.textContent = `[ ${label} ] click target`;\n    targetingIndicator.style.display = 'block';\n    document.body.style.cursor = 'crosshair';\n  } else if (active && !targeting) {\n    targetingIndicator.style.display = 'none';\n    document.body.style.cursor = 'default';\n  } else {\n    targetingIndicator.style.display = 'none';\n    document.body.style.cursor = 'default';\n  }\n}\n\nexport function isBendModeActive(): boolean {\n  return active;\n}\n\nexport function isBendTargeting(): boolean {\n  return targeting;\n}\n\n// \u2500\u2500\u2500 Object Highlights \u2500\u2500\u2500\n// When bend mode is active, all targetable objects pulse with an outline glow.\n// The hovered object gets a brighter highlight.\n\nfunction highlightTargetableObjects(gameState: any): void {\n  for (const obj of gameState.physicsObjects) {\n    if (obj.destroyed || obj.fellInPit || !obj.mesh) continue;\n    if (highlightedObjects.has(obj)) continue;\n\n    // Store original emissive values before highlight\n    obj.mesh.traverse((child: any) => {\n      if (child.isMesh && child.material) {\n        if (!child.userData._origEmissiveHex) {\n          child.userData._origEmissiveHex = child.material.emissive.getHex();\n          child.userData._origEmissiveIntensity = child.material.emissiveIntensity;\n        }\n      }\n    });\n\n    highlightedObjects.add(obj);\n  }\n}\n\nfunction unhighlightAllObjects(): void {\n  for (const obj of highlightedObjects) {\n    if (!obj.mesh) continue;\n    obj.mesh.traverse((child: any) => {\n      if (child.isMesh && child.material && child.userData._origEmissiveHex !== undefined) {\n        child.material.emissive.setHex(child.userData._origEmissiveHex);\n        child.material.emissiveIntensity = child.userData._origEmissiveIntensity;\n        delete child.userData._origEmissiveHex;\n        delete child.userData._origEmissiveIntensity;\n      }\n    });\n  }\n  highlightedObjects.clear();\n  hoveredObject = null;\n}\n\nfunction updateHighlightPulse(dt: number): void {\n  highlightPulseTime += dt;\n  // Pulse intensity: sine wave between 0.5 and 1.0\n  const pulse = 0.5 + 0.5 * Math.sin(highlightPulseTime * 4);\n  const baseIntensity = 0.3 + pulse * 0.5;     // 0.3 \u2192 0.8\n  const hoverIntensity = 0.6 + pulse * 0.6;    // 0.6 \u2192 1.2\n  const highlightColor = 0x6699ff; // soft blue\n\n  for (const obj of highlightedObjects) {\n    if (!obj.mesh) continue;\n    const isHovered = obj === hoveredObject;\n    obj.mesh.traverse((child: any) => {\n      if (child.isMesh && child.material) {\n        child.material.emissive.setHex(isHovered ? 0x88ccff : highlightColor);\n        child.material.emissiveIntensity = isHovered ? hoverIntensity : baseIntensity;\n      }\n    });\n  }\n}\n\n// \u2500\u2500\u2500 Hover Detection \u2500\u2500\u2500\n// Called each frame during targeting to detect which object the cursor is over\n\nexport function updateBendHover(mouseNDC: { x: number; y: number }, gameState: any): void {\n  if (!active || !targeting) {\n    if (hoveredObject) hoveredObject = null;\n    return;\n  }\n\n  const camera = getCamera();\n  const raycaster = new THREE.Raycaster();\n  raycaster.setFromCamera(new THREE.Vector2(mouseNDC.x, mouseNDC.y), camera);\n\n  const meshes: any[] = [];\n  const meshToObj: Map<any, any> = new Map();\n\n  for (const obj of gameState.physicsObjects) {\n    if (obj.destroyed || obj.fellInPit || !obj.mesh) continue;\n    meshes.push(obj.mesh);\n    meshToObj.set(obj.mesh, obj);\n  }\n\n  const intersects = raycaster.intersectObjects(meshes, true);\n  let newHovered: any = null;\n\n  if (intersects.length > 0) {\n    for (const hit of intersects) {\n      let current = hit.object;\n      while (current) {\n        if (meshToObj.has(current)) {\n          newHovered = meshToObj.get(current);\n          break;\n        }\n        current = current.parent;\n      }\n      if (newHovered) break;\n    }\n  }\n\n  hoveredObject = newHovered;\n}\n\n// \u2500\u2500\u2500 Per-Frame Update \u2500\u2500\u2500\n// Call from game loop to update highlights and hover\n\nexport function updateBendMode(dt: number, gameState: any): void {\n  if (active) {\n    highlightTargetableObjects(gameState);\n    updateHighlightPulse(dt);\n  }\n}\n\n// \u2500\u2500\u2500 Click-to-Apply \u2500\u2500\u2500\n\nexport function handleBendClick(mouseNDC: { x: number; y: number }, gameState: any): void {\n  if (!active || !targeting) return;\n\n  const selectedBend = getSelectedBendId();\n  if (!selectedBend) return;\n\n  // Raycast against physics object meshes\n  const camera = getCamera();\n  const raycaster = new THREE.Raycaster();\n  raycaster.setFromCamera(new THREE.Vector2(mouseNDC.x, mouseNDC.y), camera);\n\n  // Collect all physics object meshes\n  const meshes: any[] = [];\n  const meshToObj: Map<any, any> = new Map();\n\n  for (const obj of gameState.physicsObjects) {\n    if (obj.destroyed || obj.fellInPit || !obj.mesh) continue;\n    meshes.push(obj.mesh);\n    meshToObj.set(obj.mesh, obj);\n  }\n\n  // Test all meshes (recursive for groups)\n  const intersects = raycaster.intersectObjects(meshes, true);\n\n  if (intersects.length > 0) {\n    // Find which physics object was hit\n    let hitObj: any = null;\n    for (const hit of intersects) {\n      // Walk up to find the group that's in our map\n      let current = hit.object;\n      while (current) {\n        if (meshToObj.has(current)) {\n          hitObj = meshToObj.get(current);\n          break;\n        }\n        current = current.parent;\n      }\n      if (hitObj) break;\n    }\n\n    if (hitObj) {\n      tryApplyBendToTarget(hitObj, 'physicsObject');\n    }\n  }\n}\n\nexport function tryApplyBendToTarget(target: any, targetType: 'physicsObject' | 'obstacle'): void {\n  const selectedBend = getSelectedBendId();\n  if (!selectedBend) return;\n\n  const result = bendSystem.applyBend(selectedBend, targetType, target);\n\n  if (result.success) {\n    // Remove from highlight set so highlight pulse doesn't overwrite bend visuals\n    highlightedObjects.delete(target);\n    // Clean up stored originals (bend visuals now own the emissive)\n    if (target.mesh) {\n      target.mesh.traverse((child: any) => {\n        if (child.isMesh) {\n          delete child.userData._origEmissiveHex;\n          delete child.userData._origEmissiveIntensity;\n        }\n      });\n    }\n\n    // Apply visuals\n    const bend = getBendById(selectedBend);\n    if (bend) {\n      applyBendVisuals(target, bend.tintColor);\n    }\n\n    // Emit event\n    emit({\n      type: 'bendApplied',\n      bendId: selectedBend,\n      targetType,\n      targetId: target.id ?? 0,\n      position: { x: target.pos.x, z: target.pos.z },\n    });\n\n    // Exit targeting \u2014 go back to radial menu if bends remaining\n    targeting = false;\n    clearSelectedBend();\n\n    if (bendSystem.bendsRemaining() > 0) {\n      showRadialMenu();\n    } else {\n      deactivateBendMode();\n    }\n  } else {\n    emit({\n      type: 'bendFailed',\n      bendId: selectedBend,\n      reason: result.reason || 'unknown',\n    });\n  }\n}\n\n// \u2500\u2500\u2500 Queries \u2500\u2500\u2500\n\nexport function getBendsRemaining(): number {\n  return bendSystem.bendsRemaining();\n}\n\nexport function getActiveBends() {\n  return bendSystem.getActiveBends();\n}\n\nexport function getMaxBends(): number {\n  return maxBends;\n}\n\n// \u2500\u2500\u2500 Reset \u2500\u2500\u2500\n\nexport function resetBendMode(): void {\n  // Restore all bent objects to original values + visuals\n  const activeBends = bendSystem.getActiveBends();\n  for (const ab of activeBends) {\n    if (ab.target && ab.target.mesh) {\n      clearBendVisuals(ab.target);\n    }\n  }\n\n  bendSystem.resetAll();\n  active = false;\n  targeting = false;\n  unhighlightAllObjects();\n  highlightPulseTime = 0;\n  hideRadialMenu();\n  clearSelectedBend();\n}\n", "// Room Manager \u2014 loads rooms, incremental pack spawning, door integration\n// Replaces the old wave-based system with escalating pack dispatch\n// Player enters from +Z (bottom-left in iso), progresses toward -Z (top-right)\n// Door is at -Z end; unlocks when room is cleared, requires interact to enter\n\nimport { ROOMS, RoomDefinition } from '../config/rooms';\nimport { setArenaConfig, ARENA_HALF_X, ARENA_HALF_Z } from '../config/arena';\nimport { SPAWN_CONFIG } from '../config/spawn';\nimport { spawnEnemy, clearEnemies } from '../entities/enemy';\nimport { getPlayerPos, isPlayerDashing } from '../entities/player';\nimport { setPlayerPosition } from '../entities/player';\nimport { getInputState } from './input';\nimport { releaseAllProjectiles } from '../entities/projectile';\nimport { clearMortarProjectiles, clearIcePatches } from '../entities/mortarProjectile';\nimport { clearAoeTelegraphs } from './aoeTelegraph';\nimport { clearDamageNumbers } from '../ui/damageNumbers';\nimport { clearEffectGhosts } from './physics';\nimport { clearParticles } from './particles';\nimport { invalidateCollisionBounds, getBounds, getPits } from './physics';\nimport { rebuildArenaVisuals } from './renderer';\nimport { emit, on } from './events';\nimport { createTelegraph, updateTelegraph, removeTelegraph, initTelegraph } from './telegraph';\nimport { initDoor, createDoor, unlockDoor, updateDoor, removeDoor } from './door';\nimport { DOOR_CONFIG } from '../config/door';\nimport { SpawnPack } from '../types/index';\nimport { createPhysicsObject, clearPhysicsObjects, resetPhysicsObjectIds, createPhysicsObjectMesh } from '../entities/physicsObject';\nimport { resetBendMode } from './bendMode';\n\n// \u2500\u2500\u2500 State \u2500\u2500\u2500\n\nlet currentRoomIndex = 0;\nlet packIndex = 0;           // next pack to dispatch\nlet totalKills = 0;          // enemies killed in this room\nlet roomBudgetTotal = 0;     // total enemies in all packs for this room\nlet roomCleared = false;\nlet spawnCooldownTimer = 0;  // ms remaining before next pack can dispatch\nlet finalWaveAnnounced = false;\nlet restRoomTimer = 0;       // timer for rest room door auto-open\n\n// Active telegraphs \u2014 packs being telegraphed before enemies materialize\ninterface ActiveTelegraphGroup {\n  telegraphs: any[];          // telegraph visual objects (one per enemy)\n  pack: SpawnPack;\n  positions: { x: number; z: number }[];\n  timer: number;              // ms remaining\n  duration: number;           // total telegraph duration\n  packIdx: number;\n}\nlet activeTelegraphs: ActiveTelegraphGroup[] = [];\n\nlet announceEl: HTMLElement | null = null;\nlet sceneRef: any = null;\n\n// \u2500\u2500\u2500 Public API \u2500\u2500\u2500\n\nexport function initRoomManager(scene: any) {\n  sceneRef = scene;\n  announceEl = document.getElementById('wave-announce');\n  initTelegraph(scene);\n  initDoor(scene);\n\n  // Track enemy deaths for spawn dispatch\n  on('enemyDied', () => {\n    totalKills++;\n  });\n}\n\nexport function loadRoom(index: number, gameState: any) {\n  if (index >= ROOMS.length) {\n    showAnnounce('VICTORY!');\n    return;\n  }\n\n  const room = ROOMS[index];\n  currentRoomIndex = index;\n  packIndex = 0;\n  totalKills = 0;\n  roomCleared = false;\n  spawnCooldownTimer = 0;\n  finalWaveAnnounced = false;\n  activeTelegraphs = [];\n\n  // Count total enemies in budget\n  roomBudgetTotal = room.spawnBudget.packs.reduce(\n    (sum, p) => sum + p.enemies.length, 0\n  );\n\n  restRoomTimer = 0;\n\n  // Clear everything from previous room\n  clearEnemies(gameState);\n  clearPhysicsObjects(gameState, sceneRef);\n  resetBendMode();\n  releaseAllProjectiles();\n  clearMortarProjectiles();\n  clearIcePatches();\n  clearAoeTelegraphs();\n  clearDamageNumbers();\n  clearEffectGhosts();\n  clearParticles();\n  removeDoor();\n\n  // Swap arena layout\n  setArenaConfig(room.obstacles, room.pits, room.arenaHalfX, room.arenaHalfZ);\n  invalidateCollisionBounds();\n  rebuildArenaVisuals();\n\n  // Spawn physics objects for this room\n  resetPhysicsObjectIds();\n  if (room.physicsObjects) {\n    for (const placement of room.physicsObjects) {\n      const obj = createPhysicsObject(placement);\n      createPhysicsObjectMesh(obj, sceneRef);\n      gameState.physicsObjects.push(obj);\n    }\n  }\n\n  // Set player position\n  setPlayerPosition(room.playerStart.x, room.playerStart.z);\n\n  // Update game state\n  gameState.currentWave = index + 1;\n\n  // Show room announce\n  showAnnounce(room.name);\n  setTimeout(hideAnnounce, 2000);\n\n  // Handle special rooms\n  if (room.isRestRoom) {\n    // Heal player\n    gameState.playerHealth = gameState.playerMaxHealth;\n    emit({ type: 'playerHealed', amount: gameState.playerMaxHealth, position: { x: room.playerStart.x, z: room.playerStart.z } });\n    emit({ type: 'restRoomEntered', roomIndex: index });\n    roomCleared = true; // no enemies to fight\n    // Create door that auto-opens after a delay\n    if (index + 1 < ROOMS.length) {\n      createDoor(room.arenaHalfX, room.arenaHalfZ, index);\n      restRoomTimer = DOOR_CONFIG.restPause;\n    }\n    return;\n  }\n\n  if (room.isVictoryRoom) {\n    showAnnounce('VICTORY!');\n    emit({ type: 'roomCleared', roomIndex: index });\n    roomCleared = true;\n    // No door \u2014 victory room is the end\n    return;\n  }\n\n  // Combat room \u2014 create locked door at far end\n  if (index + 1 < ROOMS.length) {\n    createDoor(room.arenaHalfX, room.arenaHalfZ, index);\n  }\n}\n\nexport function updateRoomManager(dt: number, gameState: any) {\n  if (gameState.phase !== 'playing') return;\n\n  const room = ROOMS[currentRoomIndex];\n  if (!room) return;\n\n  // \u2500\u2500\u2500 Handle rest room door auto-open \u2500\u2500\u2500\n  if (room.isRestRoom && restRoomTimer > 0) {\n    restRoomTimer -= dt * 1000;\n    if (restRoomTimer <= 0) {\n      unlockDoor();\n    }\n  }\n\n  // \u2500\u2500\u2500 Update door + check for room transition \u2500\u2500\u2500\n  const playerPos = getPlayerPos();\n  const input = getInputState();\n  const doorTriggered = updateDoor(dt, playerPos, input.interact, isPlayerDashing());\n  if (doorTriggered) {\n    loadRoom(currentRoomIndex + 1, gameState);\n    return;\n  }\n\n  // \u2500\u2500\u2500 Update active telegraphs \u2500\u2500\u2500\n  for (let i = activeTelegraphs.length - 1; i >= 0; i--) {\n    const tg = activeTelegraphs[i];\n    tg.timer -= dt * 1000;\n    const progress = 1 - (tg.timer / tg.duration);\n\n    // Update telegraph visuals\n    for (const tel of tg.telegraphs) {\n      updateTelegraph(tel, Math.min(progress, 1), dt);\n    }\n\n    // Telegraph expired \u2014 spawn enemies\n    if (tg.timer <= 0) {\n      for (const tel of tg.telegraphs) {\n        removeTelegraph(tel);\n      }\n      // Spawn enemies at resolved positions\n      for (let j = 0; j < tg.pack.enemies.length; j++) {\n        const enemy = tg.pack.enemies[j];\n        const pos = tg.positions[j];\n        const spawnPos = new THREE.Vector3(pos.x, 0, pos.z);\n        spawnEnemy(enemy.type, spawnPos, gameState);\n      }\n      emit({ type: 'spawnPackSpawned', packIndex: tg.packIdx, roomIndex: currentRoomIndex });\n      activeTelegraphs.splice(i, 1);\n    }\n  }\n\n  // \u2500\u2500\u2500 Skip dispatch logic for special rooms \u2500\u2500\u2500\n  if (room.isRestRoom || room.isVictoryRoom) return;\n\n  // \u2500\u2500\u2500 Count alive enemies \u2500\u2500\u2500\n  const aliveCount = gameState.enemies.length;\n  const budget = room.spawnBudget;\n  const effectiveMaxConcurrent = Math.round(budget.maxConcurrent * SPAWN_CONFIG.maxConcurrentMult);\n\n  // \u2500\u2500\u2500 Announce final wave \u2500\u2500\u2500\n  if (!finalWaveAnnounced && packIndex >= budget.packs.length && activeTelegraphs.length === 0 && aliveCount > 0) {\n    finalWaveAnnounced = true;\n    showAnnounce('FINAL WAVE');\n    setTimeout(hideAnnounce, 1500);\n  }\n\n  // \u2500\u2500\u2500 Dispatch new packs \u2500\u2500\u2500\n  spawnCooldownTimer -= dt * 1000;\n\n  if (packIndex < budget.packs.length && spawnCooldownTimer <= 0) {\n    const nextPack = budget.packs[packIndex];\n    // Count enemies being telegraphed (not yet spawned)\n    const telegraphingCount = activeTelegraphs.reduce(\n      (sum, tg) => sum + tg.pack.enemies.length, 0\n    );\n    const totalActive = aliveCount + telegraphingCount;\n\n    if (totalActive + nextPack.enemies.length <= effectiveMaxConcurrent + 1) {\n      // Dispatch this pack: resolve positions, create telegraphs\n      const positions = resolveSpawnPositions(nextPack, room);\n      const telegraphs = positions.map((pos, idx) =>\n        createTelegraph(pos.x, pos.z, nextPack.enemies[idx].type)\n      );\n\n      const duration = budget.telegraphDuration || SPAWN_CONFIG.telegraphDuration;\n      activeTelegraphs.push({\n        telegraphs,\n        pack: nextPack,\n        positions,\n        timer: duration,\n        duration,\n        packIdx: packIndex,\n      });\n\n      emit({ type: 'spawnPackTelegraph', packIndex, roomIndex: currentRoomIndex });\n      packIndex++;\n      spawnCooldownTimer = SPAWN_CONFIG.spawnCooldown;\n    }\n  }\n\n  // \u2500\u2500\u2500 Check room cleared \u2500\u2500\u2500\n  if (!roomCleared && packIndex >= budget.packs.length && activeTelegraphs.length === 0 && aliveCount === 0) {\n    roomCleared = true;\n    emit({ type: 'roomCleared', roomIndex: currentRoomIndex });\n    emit({ type: 'roomClearComplete', roomIndex: currentRoomIndex });\n\n    if (currentRoomIndex + 1 >= ROOMS.length) {\n      // Last combat room cleared \u2014 victory\n      showAnnounce('VICTORY!');\n    } else {\n      showAnnounce('Room Cleared!');\n      setTimeout(hideAnnounce, 1500);\n      // Unlock the door \u2014 player walks through to proceed\n      unlockDoor();\n    }\n  }\n}\n\n// \u2500\u2500\u2500 Spawn Position Resolution \u2500\u2500\u2500\n\nfunction resolveSpawnPositions(pack: SpawnPack, room: RoomDefinition): { x: number; z: number }[] {\n  const playerPos = getPlayerPos();\n  const playerZ = playerPos ? playerPos.z : room.playerStart.z;\n  const playerX = playerPos ? playerPos.x : room.playerStart.x;\n\n  const hx = room.arenaHalfX - 1.5;  // margin from walls\n  const hz = room.arenaHalfZ - 1.5;\n\n  return pack.enemies.map(() => {\n    let x: number, z: number;\n\n    for (let attempt = 0; attempt < 10; attempt++) {\n      switch (pack.spawnZone) {\n        case 'ahead': {\n          // Ahead = toward -Z (the exit / top-right in iso)\n          const aheadMin = SPAWN_CONFIG.spawnAheadMin;\n          const aheadMax = SPAWN_CONFIG.spawnAheadMax;\n          x = (Math.random() * 2 - 1) * hx;\n          z = playerZ - aheadMin - Math.random() * (aheadMax - aheadMin);\n          break;\n        }\n        case 'sides': {\n          // Near the X walls, slightly ahead (-Z) of player\n          const side = Math.random() < 0.5 ? -1 : 1;\n          x = side * (hx * 0.6 + Math.random() * hx * 0.3);\n          z = playerZ - 3 - Math.random() * 10;\n          break;\n        }\n        case 'far': {\n          // Near the far end of the room (-Z exit wall)\n          x = (Math.random() * 2 - 1) * hx;\n          z = -hz + 2 + Math.random() * 5;\n          break;\n        }\n        case 'behind': {\n          // Behind = toward +Z (entrance / bottom-left in iso)\n          x = (Math.random() * 2 - 1) * hx;\n          z = playerZ + 5 + Math.random() * 5;\n          break;\n        }\n        default: {\n          x = (Math.random() * 2 - 1) * hx;\n          z = playerZ - 5 - Math.random() * 10;\n        }\n      }\n\n      // Clamp to arena bounds\n      x = Math.max(-hx, Math.min(hx, x));\n      z = Math.max(-hz, Math.min(hz, z));\n\n      // Validate: not inside obstacle or pit\n      if (!isInsideObstacle(x, z) && !isInsidePit(x, z)) {\n        return { x, z };\n      }\n    }\n\n    // Fallback: spawn at room center-ish\n    return { x: (Math.random() * 2 - 1) * 3, z: 0 };\n  });\n}\n\nfunction isInsideObstacle(x: number, z: number): boolean {\n  const bounds = getBounds();\n  // Only check obstacle bounds, not walls (first N entries before the 4 wall entries)\n  const obstacleCount = bounds.length - 4;\n  for (let i = 0; i < obstacleCount; i++) {\n    const b = bounds[i];\n    if (x >= b.minX - 1 && x <= b.maxX + 1 && z >= b.minZ - 1 && z <= b.maxZ + 1) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isInsidePit(x: number, z: number): boolean {\n  const pits = getPits();\n  for (const p of pits) {\n    if (x >= p.minX - 0.5 && x <= p.maxX + 0.5 && z >= p.minZ - 0.5 && z <= p.maxZ + 0.5) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// \u2500\u2500\u2500 Public Getters \u2500\u2500\u2500\n\nexport function getCurrentRoomIndex(): number {\n  return currentRoomIndex;\n}\n\nexport function getRoomCount(): number {\n  return ROOMS.length;\n}\n\nexport function isRoomCleared(): boolean {\n  return roomCleared;\n}\n\nexport function resetRoomManager() {\n  currentRoomIndex = 0;\n  packIndex = 0;\n  totalKills = 0;\n  roomBudgetTotal = 0;\n  roomCleared = false;\n  spawnCooldownTimer = 0;\n  finalWaveAnnounced = false;\n  restRoomTimer = 0;\n  activeTelegraphs = [];\n  removeDoor();\n}\n\n// \u2500\u2500\u2500 Announce UI \u2500\u2500\u2500\n\nfunction showAnnounce(text: string) {\n  if (!announceEl) return;\n  announceEl.textContent = text;\n  announceEl.classList.add('visible');\n}\n\nfunction hideAnnounce() {\n  if (!announceEl) return;\n  announceEl.classList.remove('visible');\n}\n", "import { ABILITIES } from '../config/abilities';\nimport { PLAYER } from '../config/player';\nimport {\n  triggerDash, triggerUltimate, setUltimateHeld,\n  setAimFromScreenDrag, setAbilityDirOverride, clearAbilityDirOverride\n} from '../engine/input';\nimport { isBulletTimeActive, getBulletTimeResource, getBulletTimeMax } from '../engine/bulletTime';\nimport { getBendsRemaining, getMaxBends } from '../engine/bendMode';\nimport { on } from '../engine/events';\n\nlet healthBar: any, healthText: any, waveIndicator: any, currencyCount: any, abilityBar: any;\nlet bulletTimeMeter: any, bulletTimeFill: any;\nlet btVignette: any, btCeremony: any;\nlet btCeremonyTimeout: any = null;\nlet bendCounter: any = null;\n\n// Mobile action button refs\nlet mobileBtnDash: any, mobileBtnUlt: any;\n\nexport function initHUD() {\n  healthBar = document.getElementById('health-bar');\n  healthText = document.getElementById('health-text');\n  waveIndicator = document.getElementById('wave-indicator');\n  currencyCount = document.getElementById('currency-count');\n  abilityBar = document.getElementById('ability-bar');\n\n  // Build desktop ability slots (keyboard labels)\n  for (const [key, ability] of Object.entries(ABILITIES)) {\n    const el = document.createElement('div');\n    el.className = 'ability-slot ready';\n    el.id = `ability-${key}`;\n    el.innerHTML =\n      `<div class=\"ability-key\">${(ability as any).key}</div>` +\n      `<div class=\"ability-name\">${(ability as any).name}</div>` +\n      `<div class=\"ability-cooldown-text\"></div>` +\n      `<div class=\"ability-cooldown-overlay\"></div>`;\n    abilityBar.appendChild(el);\n  }\n\n  // Mobile action buttons \u2014 wire up touch handlers\n  const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n  if (hasTouch) {\n    initMobileButtons();\n  }\n\n  // Bullet time meter bar \u2014 positioned top-left below health bar\n  bulletTimeMeter = document.createElement('div');\n  bulletTimeMeter.id = 'bullet-time-meter';\n  bulletTimeMeter.style.cssText = `\n    position: fixed;\n    top: 44px;\n    left: 20px;\n    width: 220px;\n    height: 6px;\n    background: rgba(20, 20, 40, 0.7);\n    border: 1px solid rgba(100, 140, 255, 0.3);\n    border-radius: 3px;\n    z-index: 50;\n    overflow: hidden;\n  `;\n  bulletTimeFill = document.createElement('div');\n  bulletTimeFill.style.cssText = `\n    width: 100%;\n    height: 100%;\n    background: #6688ff;\n    border-radius: 2px;\n    transition: background-color 0.15s ease;\n  `;\n  bulletTimeMeter.appendChild(bulletTimeFill);\n\n  // Label \u2014 right side\n  const btLabel = document.createElement('div');\n  btLabel.style.cssText = `\n    position: absolute;\n    top: -1px;\n    right: -50px;\n    font-size: 8px;\n    color: rgba(100, 140, 255, 0.6);\n    letter-spacing: 1px;\n    font-family: 'Courier New', monospace;\n    pointer-events: none;\n  `;\n  btLabel.textContent = 'Q \\u2014 SLOW';\n  bulletTimeMeter.appendChild(btLabel);\n\n  document.body.appendChild(bulletTimeMeter);\n\n  // Bullet time vignette overlay\n  btVignette = document.createElement('div');\n  btVignette.id = 'bt-vignette';\n  btVignette.style.cssText = `\n    position: fixed;\n    top: 0; left: 0; right: 0; bottom: 0;\n    pointer-events: none;\n    z-index: 40;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    background: radial-gradient(ellipse at center, transparent 50%, rgba(100, 140, 255, 0.15) 100%);\n    box-shadow: inset 0 0 80px rgba(100, 140, 255, 0.2);\n  `;\n  document.body.appendChild(btVignette);\n\n  // Bullet time ceremony text\n  btCeremony = document.createElement('div');\n  btCeremony.id = 'bt-ceremony';\n  btCeremony.style.cssText = `\n    position: fixed;\n    top: 18%;\n    left: 50%;\n    transform: translateX(-50%);\n    font-size: 14px;\n    font-family: 'Courier New', monospace;\n    color: rgba(100, 160, 255, 0.9);\n    letter-spacing: 6px;\n    text-transform: uppercase;\n    text-shadow: 0 0 12px rgba(100, 140, 255, 0.6), 0 0 30px rgba(100, 140, 255, 0.3);\n    pointer-events: none;\n    z-index: 55;\n    opacity: 0;\n    transition: opacity 0.2s ease;\n  `;\n  document.body.appendChild(btCeremony);\n\n  // Bend counter \u2014 top right, below BT meter area\n  bendCounter = document.createElement('div');\n  bendCounter.id = 'bend-counter';\n  bendCounter.style.cssText = `\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    font-family: 'Courier New', monospace;\n    font-size: 12px;\n    color: rgba(100, 160, 255, 0.9);\n    letter-spacing: 1px;\n    text-shadow: 0 0 6px rgba(100, 140, 255, 0.4);\n    z-index: 50;\n    pointer-events: none;\n  `;\n  bendCounter.textContent = 'Bends: 3/3';\n  document.body.appendChild(bendCounter);\n\n  // Subscribe to bullet time events for vignette + ceremony\n  on('bulletTimeActivated', () => {\n    if (btVignette) btVignette.style.opacity = '1';\n    showBTCeremony('BULLET TIME ENGAGED', 1200);\n  });\n  on('bulletTimeDeactivated', () => {\n    if (btVignette) btVignette.style.opacity = '0';\n    showBTCeremony('BULLET TIME ENDED', 800);\n  });\n}\n\nfunction showBTCeremony(text: string, durationMs: number) {\n  if (!btCeremony) return;\n  if (btCeremonyTimeout) clearTimeout(btCeremonyTimeout);\n  btCeremony.textContent = text;\n  btCeremony.style.opacity = '1';\n  btCeremonyTimeout = setTimeout(() => {\n    btCeremony.style.opacity = '0';\n    btCeremonyTimeout = null;\n  }, durationMs);\n}\n\n// Drag-to-aim constants\nconst DRAG_THRESHOLD = 15;  // px \u2014 distinguish tap from drag\nconst DRAG_MAX_RADIUS = 80; // px \u2014 full deflection range\n\n// Isometric basis vectors (duplicated from input.js for screen\u2192world mapping)\nconst INV_SQRT2 = 1 / Math.SQRT2;\nconst ISO_RIGHT_X = INV_SQRT2;\nconst ISO_RIGHT_Z = -INV_SQRT2;\nconst ISO_UP_X = -INV_SQRT2;\nconst ISO_UP_Z = -INV_SQRT2;\n\nfunction initMobileButtons() {\n  mobileBtnDash = document.getElementById('mobile-btn-dash');\n  mobileBtnUlt = document.getElementById('mobile-btn-ultimate');\n  if (!mobileBtnDash || !mobileBtnUlt) return;\n\n  // --- Dash: drag-to-aim, release to fire ---\n  setupDragToAim(mobileBtnDash, {\n    onDragStart: () => { /* don't trigger yet \u2014 wait for release */ },\n    onDragMove: (normX: number, normY: number) => {\n      // Compute isometric world direction from screen drag\n      const isoX = normX * ISO_RIGHT_X + normY * ISO_UP_X;\n      const isoZ = normX * ISO_RIGHT_Z + normY * ISO_UP_Z;\n      setAbilityDirOverride(isoX, isoZ);\n      setAimFromScreenDrag(normX, normY);\n    },\n    onRelease: (wasDrag: boolean) => {\n      triggerDash();\n      if (!wasDrag) clearAbilityDirOverride();\n      // If wasDrag, override is already set and startDash will consume it\n    },\n    onCancel: () => {\n      clearAbilityDirOverride();\n    },\n  });\n\n  // --- Ultimate: drag-to-aim, charge while held ---\n  setupDragToAim(mobileBtnUlt, {\n    onDragStart: () => {\n      triggerUltimate();\n      setUltimateHeld(true);\n    },\n    onDragMove: (normX: number, normY: number) => {\n      setAimFromScreenDrag(normX, normY);\n    },\n    onRelease: () => {\n      setUltimateHeld(false);\n      clearAbilityDirOverride();\n    },\n    onCancel: () => {\n      setUltimateHeld(false);\n      clearAbilityDirOverride();\n    },\n  });\n}\n\n/**\n * Generic drag-to-aim handler for a mobile ability button.\n * Touch down \u2192 drag to aim \u2192 release to fire.\n * Callbacks:\n *   onDragStart() \u2014 called once when touch begins\n *   onDragMove(normX, normY) \u2014 called each touchmove when past threshold\n *     normX: -1..1 screen-right, normY: -1..1 screen-up\n *   onRelease(wasDrag) \u2014 called on touchend (wasDrag = true if threshold exceeded)\n *   onCancel() \u2014 called on touchcancel\n */\nfunction setupDragToAim(btnEl: any, { onDragStart, onDragMove, onRelease, onCancel }: any) {\n  let touchId: number | null = null;\n  let startX = 0, startY = 0;\n  let isDragging = false;\n\n  btnEl.addEventListener('touchstart', (e: any) => {\n    e.preventDefault();\n    if (touchId !== null) return; // already tracking a touch\n    const touch = e.changedTouches[0];\n    touchId = touch.identifier;\n    startX = touch.clientX;\n    startY = touch.clientY;\n    isDragging = false;\n    onDragStart();\n  });\n\n  // Listen on window so drag can extend beyond button bounds\n  window.addEventListener('touchmove', (e: any) => {\n    if (touchId === null) return;\n    const touch = findTouch(e.changedTouches, touchId);\n    if (!touch) return;\n\n    const dx = touch.clientX - startX;\n    const dy = touch.clientY - startY;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    if (dist > DRAG_THRESHOLD) {\n      isDragging = true;\n      // Normalize to -1..1 range, clamped by max radius\n      const clampedDist = Math.min(dist, DRAG_MAX_RADIUS);\n      const normX = (dx / dist) * (clampedDist / DRAG_MAX_RADIUS);\n      const normY = (-dy / dist) * (clampedDist / DRAG_MAX_RADIUS); // invert Y (screen down = negative)\n      onDragMove(normX, normY);\n    }\n  }, { passive: true });\n\n  window.addEventListener('touchend', (e: any) => {\n    if (touchId === null) return;\n    const touch = findTouch(e.changedTouches, touchId);\n    if (!touch) return;\n    touchId = null;\n    onRelease(isDragging);\n  });\n\n  window.addEventListener('touchcancel', (e: any) => {\n    if (touchId === null) return;\n    const touch = findTouch(e.changedTouches, touchId);\n    if (!touch) return;\n    touchId = null;\n    onCancel();\n  });\n}\n\nfunction findTouch(touchList: any, id: number) {\n  for (let i = 0; i < touchList.length; i++) {\n    if (touchList[i].identifier === id) return touchList[i];\n  }\n  return null;\n}\n\nexport function updateHUD(gameState: any) {\n  // Bend counter\n  if (bendCounter) {\n    const remaining = getBendsRemaining();\n    const max = getMaxBends();\n    bendCounter.textContent = `Bends: ${remaining}/${max}`;\n    bendCounter.style.display = gameState.phase === 'playing' ? 'block' : 'none';\n  }\n\n  // Health bar\n  const pct = Math.max(0, gameState.playerHealth / gameState.playerMaxHealth);\n  healthBar.style.width = (pct * 100) + '%';\n\n  if (pct > 0.5) {\n    healthBar.style.backgroundColor = '#44ff88';\n  } else if (pct > 0.25) {\n    healthBar.style.backgroundColor = '#ffcc44';\n  } else {\n    healthBar.style.backgroundColor = '#ff4444';\n  }\n\n  healthText.textContent = Math.ceil(gameState.playerHealth) + ' / ' + gameState.playerMaxHealth;\n\n  // Wave indicator\n  waveIndicator.textContent = 'Wave ' + gameState.currentWave;\n\n  // Currency\n  currencyCount.textContent = gameState.currency;\n\n  // Bullet time meter\n  if (bulletTimeFill) {\n    const btPct = getBulletTimeResource() / getBulletTimeMax();\n    bulletTimeFill.style.width = (btPct * 100) + '%';\n    const btActive = isBulletTimeActive();\n    bulletTimeFill.style.backgroundColor = btActive ? '#ffcc44' : '#6688ff';\n    if (bulletTimeMeter) {\n      bulletTimeMeter.style.borderColor = btActive\n        ? 'rgba(255, 204, 68, 0.6)'\n        : 'rgba(100, 140, 255, 0.3)';\n    }\n  }\n\n  // Ability cooldowns \u2014 update both desktop slots and mobile buttons\n  for (const [key, state] of Object.entries(gameState.abilities)) {\n    if (!(ABILITIES as any)[key]) continue;\n    const cfg = (ABILITIES as any)[key];\n\n    // --- Desktop ability slot ---\n    const slot = document.getElementById(`ability-${key}`);\n    if (slot) {\n      const overlay = slot.querySelector('.ability-cooldown-overlay') as any;\n      const cdText = slot.querySelector('.ability-cooldown-text') as any;\n\n      if ((state as any).cooldownRemaining > 0) {\n        const pctRemaining = Math.max(0, (state as any).cooldownRemaining / cfg.cooldown);\n        overlay.style.height = (pctRemaining * 100) + '%';\n        slot.classList.remove('ready');\n        const secs = Math.ceil((state as any).cooldownRemaining / 1000);\n        cdText.textContent = secs;\n        cdText.style.display = 'flex';\n      } else {\n        overlay.style.height = '0%';\n        slot.classList.add('ready');\n        cdText.style.display = 'none';\n      }\n\n      // Show charging state for ultimate (Force Push)\n      if (key === 'ultimate' && (state as any).charging) {\n        const chargePct = Math.round((state as any).chargeT * 100);\n        slot.style.borderColor = 'rgba(68, 255, 170, 0.8)';\n        slot.style.boxShadow = '0 0 12px rgba(68, 255, 170, 0.4)';\n        cdText.textContent = chargePct + '%';\n        cdText.style.display = 'flex';\n        cdText.style.color = '#44ffaa';\n        overlay.style.height = ((1 - (state as any).chargeT) * 100) + '%';\n        overlay.style.backgroundColor = 'rgba(68, 255, 170, 0.3)';\n      } else {\n        if (slot.style.borderColor) slot.style.borderColor = '';\n        if (slot.style.boxShadow) slot.style.boxShadow = '';\n        cdText.style.color = '';\n        overlay.style.backgroundColor = '';\n      }\n    }\n\n    // --- Mobile action button ---\n    const mBtn = key === 'dash' ? mobileBtnDash : key === 'ultimate' ? mobileBtnUlt : null;\n    if (mBtn) {\n      const mOverlay = mBtn.querySelector('.mobile-btn-cd-overlay');\n      const mCdText = mBtn.querySelector('.mobile-btn-cd-text');\n\n      if ((state as any).cooldownRemaining > 0) {\n        const pctRemaining = Math.max(0, (state as any).cooldownRemaining / cfg.cooldown);\n        mOverlay.style.height = (pctRemaining * 100) + '%';\n        mBtn.classList.remove('ready');\n        const secs = Math.ceil((state as any).cooldownRemaining / 1000);\n        mCdText.textContent = secs;\n        mCdText.style.display = 'flex';\n      } else {\n        mOverlay.style.height = '0%';\n        mBtn.classList.add('ready');\n        mCdText.style.display = 'none';\n      }\n\n      // Charging state for ultimate\n      if (key === 'ultimate' && (state as any).charging) {\n        const chargePct = Math.round((state as any).chargeT * 100);\n        mBtn.style.borderColor = 'rgba(68, 255, 170, 0.9)';\n        mBtn.style.boxShadow = '0 0 16px rgba(68, 255, 170, 0.5)';\n        mCdText.textContent = chargePct + '%';\n        mCdText.style.display = 'flex';\n        mCdText.style.color = '#44ffaa';\n        mOverlay.style.height = ((1 - (state as any).chargeT) * 100) + '%';\n        mOverlay.style.backgroundColor = 'rgba(68, 255, 170, 0.3)';\n      } else if (key === 'ultimate') {\n        if (mBtn.style.borderColor) mBtn.style.borderColor = '';\n        if (mBtn.style.boxShadow) mBtn.style.boxShadow = '';\n        mCdText.style.color = '';\n        mOverlay.style.backgroundColor = '';\n      }\n    }\n  }\n}\n", "let startScreen: any, startBtn: any;\nlet gameOverScreen: any, restartBtn: any, gameOverStats: any;\n\nexport function initScreens(onRestart: () => void, onStart: () => void) {\n  // Start screen\n  startScreen = document.getElementById('start-screen');\n  startBtn = document.getElementById('start-btn');\n\n  const handleStart = () => {\n    hideStartScreen();\n    onStart();\n  };\n  startBtn.addEventListener('click', handleStart);\n  startBtn.addEventListener('touchend', (e: any) => {\n    e.preventDefault();\n    handleStart();\n  });\n\n  // Game over screen\n  gameOverScreen = document.getElementById('game-over-screen');\n  restartBtn = document.getElementById('restart-btn');\n  gameOverStats = document.getElementById('game-over-stats');\n\n  restartBtn.addEventListener('click', () => {\n    hideScreens();\n    onRestart();\n  });\n}\n\nexport function hideStartScreen() {\n  startScreen.classList.add('hidden');\n}\n\nexport function showGameOver(gameState: any) {\n  gameOverStats.textContent = `Enemies defeated: ${gameState.currency} gold earned`;\n  gameOverScreen.classList.remove('hidden');\n}\n\nexport function hideScreens() {\n  gameOverScreen.classList.add('hidden');\n}\n", "// Audio Foundation \u2014 synthesized sound effects via Web Audio API\n// No audio files, no asset pipeline. Each sound is a procedurally generated\n// burst of oscillators and noise. Matches the primitive art philosophy.\n//\n// Call initAudio() after first user gesture (click/key) to create AudioContext.\n// Then subscribe to event bus for automatic sound playback.\n\nimport { on } from './events';\nimport type { GameEvent } from './events';\n\n// \u2500\u2500\u2500 Config (tunable) \u2500\u2500\u2500\n\nexport const AUDIO_CONFIG = {\n  masterVolume: 0.3,\n  hitVolume: 0.4,\n  deathVolume: 0.5,\n  dashVolume: 0.25,\n  shieldBreakVolume: 0.6,\n  chargeVolume: 0.35,\n  waveClearVolume: 0.4,\n  playerHitVolume: 0.5,\n  meleeSwingVolume: 0.3,\n  meleeHitVolume: 0.45,\n  wallSlamVolume: 0.5,\n  enemyImpactVolume: 0.4,\n  objectImpactVolume: 0.4,\n  obstacleBreakVolume: 0.5,\n  bendApplyVolume: 0.3,\n  enabled: true,\n};\n\n// \u2500\u2500\u2500 State \u2500\u2500\u2500\n\nlet ctx: AudioContext | null = null;\nlet masterGain: GainNode | null = null;\nlet initialized = false;\n\n// \u2500\u2500\u2500 Init \u2500\u2500\u2500\n\nexport function initAudio(): void {\n  if (initialized) return;\n\n  try {\n    ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n    masterGain = ctx.createGain();\n    masterGain.gain.value = AUDIO_CONFIG.masterVolume;\n    masterGain.connect(ctx.destination);\n    initialized = true;\n\n    // Subscribe to game events\n    wireEventBus();\n\n    // Wire mute button\n    const muteBtn = document.getElementById('mute-btn');\n    if (muteBtn) {\n      muteBtn.addEventListener('click', () => {\n        AUDIO_CONFIG.enabled = !AUDIO_CONFIG.enabled;\n        if (masterGain) {\n          masterGain.gain.value = AUDIO_CONFIG.enabled ? AUDIO_CONFIG.masterVolume : 0;\n        }\n        muteBtn.textContent = AUDIO_CONFIG.enabled ? '\\u{1F50A}' : '\\u{1F507}';\n        muteBtn.classList.toggle('muted', !AUDIO_CONFIG.enabled);\n      });\n    }\n  } catch (e) {\n    console.warn('[audio] Web Audio API not available:', e);\n  }\n}\n\n// Resume context on user interaction (required by browsers)\nexport function resumeAudio(): void {\n  if (ctx && ctx.state === 'suspended') {\n    ctx.resume();\n  }\n}\n\nexport function setMasterVolume(v: number): void {\n  AUDIO_CONFIG.masterVolume = v;\n  if (masterGain) {\n    masterGain.gain.value = v;\n  }\n}\n\n// \u2500\u2500\u2500 Sound Generators \u2500\u2500\u2500\n\n// Utility: create white noise buffer\nfunction createNoiseBuffer(duration: number): AudioBuffer {\n  if (!ctx) return new AudioBuffer({ length: 1, sampleRate: 44100 });\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i++) {\n    data[i] = Math.random() * 2 - 1;\n  }\n  return buffer;\n}\n\n// Hit: short noise burst + descending pitch sweep\nexport function playHit(intensity: number = 1): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const vol = AUDIO_CONFIG.hitVolume * Math.min(intensity, 2);\n  const duration = 0.06 + intensity * 0.02;\n\n  // Noise burst\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration);\n  const noiseGain = ctx.createGain();\n  noiseGain.gain.setValueAtTime(vol * 0.6, now);\n  noiseGain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  const noiseFilter = ctx.createBiquadFilter();\n  noiseFilter.type = 'highpass';\n  noiseFilter.frequency.value = 2000 + intensity * 500;\n  noise.connect(noiseFilter);\n  noiseFilter.connect(noiseGain);\n  noiseGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n\n  // Impact tone\n  const osc = ctx.createOscillator();\n  osc.type = 'square';\n  osc.frequency.setValueAtTime(200 + intensity * 80, now);\n  osc.frequency.exponentialRampToValueAtTime(80, now + duration);\n  const oscGain = ctx.createGain();\n  oscGain.gain.setValueAtTime(vol * 0.3, now);\n  oscGain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc.connect(oscGain);\n  oscGain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n}\n\n// Death: descending tone + noise fade\nexport function playDeath(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.2;\n\n  const osc = ctx.createOscillator();\n  osc.type = 'sawtooth';\n  osc.frequency.setValueAtTime(400, now);\n  osc.frequency.exponentialRampToValueAtTime(60, now + duration);\n  const gain = ctx.createGain();\n  gain.gain.setValueAtTime(AUDIO_CONFIG.deathVolume * 0.4, now);\n  gain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc.connect(gain);\n  gain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n\n  // Noise component\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration * 0.7);\n  const nGain = ctx.createGain();\n  nGain.gain.setValueAtTime(AUDIO_CONFIG.deathVolume * 0.2, now);\n  nGain.gain.exponentialRampToValueAtTime(0.001, now + duration * 0.7);\n  noise.connect(nGain);\n  nGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Dash: whoosh \u2014 bandpass-filtered noise sweep\nexport function playDash(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.15;\n\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration);\n  const filter = ctx.createBiquadFilter();\n  filter.type = 'bandpass';\n  filter.frequency.setValueAtTime(800, now);\n  filter.frequency.exponentialRampToValueAtTime(3000, now + duration * 0.3);\n  filter.frequency.exponentialRampToValueAtTime(400, now + duration);\n  filter.Q.value = 2;\n  const gain = ctx.createGain();\n  gain.gain.setValueAtTime(AUDIO_CONFIG.dashVolume, now);\n  gain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  noise.connect(filter);\n  filter.connect(gain);\n  gain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Shield break: metallic crash \u2014 resonant noise + ring\nexport function playShieldBreak(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.3;\n\n  // Crash noise\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration);\n  const filter = ctx.createBiquadFilter();\n  filter.type = 'bandpass';\n  filter.frequency.value = 1200;\n  filter.Q.value = 8;\n  const nGain = ctx.createGain();\n  nGain.gain.setValueAtTime(AUDIO_CONFIG.shieldBreakVolume * 0.5, now);\n  nGain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  noise.connect(filter);\n  filter.connect(nGain);\n  nGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n\n  // Metallic ring\n  const osc = ctx.createOscillator();\n  osc.type = 'triangle';\n  osc.frequency.value = 880;\n  const oscGain = ctx.createGain();\n  oscGain.gain.setValueAtTime(AUDIO_CONFIG.shieldBreakVolume * 0.3, now);\n  oscGain.gain.exponentialRampToValueAtTime(0.001, now + duration * 0.8);\n  osc.connect(oscGain);\n  oscGain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n}\n\n// Charge fired: impact boom \u2014 low thump + noise\nexport function playChargeFire(chargeT: number): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.15 + chargeT * 0.1;\n\n  // Low thump\n  const osc = ctx.createOscillator();\n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(80 + chargeT * 40, now);\n  osc.frequency.exponentialRampToValueAtTime(30, now + duration);\n  const gain = ctx.createGain();\n  gain.gain.setValueAtTime(AUDIO_CONFIG.chargeVolume * (0.5 + chargeT * 0.5), now);\n  gain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc.connect(gain);\n  gain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n\n  // Noise burst\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration * 0.6);\n  const nGain = ctx.createGain();\n  nGain.gain.setValueAtTime(AUDIO_CONFIG.chargeVolume * 0.3 * chargeT, now);\n  nGain.gain.exponentialRampToValueAtTime(0.001, now + duration * 0.6);\n  noise.connect(nGain);\n  nGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Wave clear: ascending 3-note chime\nexport function playWaveClear(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const notes = [523, 659, 784]; // C5, E5, G5\n  const noteLen = 0.12;\n\n  notes.forEach((freq, i) => {\n    const osc = ctx!.createOscillator();\n    osc.type = 'sine';\n    osc.frequency.value = freq;\n    const gain = ctx!.createGain();\n    const start = now + i * 0.08;\n    gain.gain.setValueAtTime(0, start);\n    gain.gain.linearRampToValueAtTime(AUDIO_CONFIG.waveClearVolume * 0.3, start + 0.01);\n    gain.gain.exponentialRampToValueAtTime(0.001, start + noteLen);\n    osc.connect(gain);\n    gain.connect(masterGain!);\n    osc.start(start);\n    osc.stop(start + noteLen);\n  });\n}\n\n// Player hit: short harsh buzz\nexport function playPlayerHit(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.08;\n\n  const osc = ctx.createOscillator();\n  osc.type = 'square';\n  osc.frequency.value = 150;\n  const gain = ctx.createGain();\n  gain.gain.setValueAtTime(AUDIO_CONFIG.playerHitVolume * 0.3, now);\n  gain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc.connect(gain);\n  gain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n\n  // Noise\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration);\n  const nGain = ctx.createGain();\n  nGain.gain.setValueAtTime(AUDIO_CONFIG.playerHitVolume * 0.4, now);\n  nGain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  noise.connect(nGain);\n  nGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Melee swing: short ascending whoosh\nexport function playMeleeSwing(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.12;\n\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration);\n  const filter = ctx.createBiquadFilter();\n  filter.type = 'highpass';\n  filter.frequency.setValueAtTime(1500, now);\n  filter.frequency.exponentialRampToValueAtTime(5000, now + duration);\n  const gain = ctx.createGain();\n  gain.gain.setValueAtTime(AUDIO_CONFIG.meleeSwingVolume, now);\n  gain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  noise.connect(filter);\n  filter.connect(gain);\n  gain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Melee hit: punchy thump + bright noise\nexport function playMeleeHit(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.08;\n\n  // Low thump\n  const osc = ctx.createOscillator();\n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(120, now);\n  osc.frequency.exponentialRampToValueAtTime(50, now + duration);\n  const oscGain = ctx.createGain();\n  oscGain.gain.setValueAtTime(AUDIO_CONFIG.meleeHitVolume * 0.5, now);\n  oscGain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc.connect(oscGain);\n  oscGain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n\n  // Bright noise snap\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration * 0.6);\n  const filter = ctx.createBiquadFilter();\n  filter.type = 'bandpass';\n  filter.frequency.value = 3000;\n  filter.Q.value = 3;\n  const nGain = ctx.createGain();\n  nGain.gain.setValueAtTime(AUDIO_CONFIG.meleeHitVolume * 0.4, now);\n  nGain.gain.exponentialRampToValueAtTime(0.001, now + duration * 0.6);\n  noise.connect(filter);\n  filter.connect(nGain);\n  nGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Wall slam: heavy impact thud with low rumble\nexport function playWallSlam(intensity: number = 1): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.15;\n  const vol = AUDIO_CONFIG.wallSlamVolume * Math.min(intensity, 2);\n\n  // Deep thud \u2014 lower pitch than melee hit\n  const osc = ctx.createOscillator();\n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(80, now);\n  osc.frequency.exponentialRampToValueAtTime(30, now + duration);\n  const oscGain = ctx.createGain();\n  oscGain.gain.setValueAtTime(vol * 0.6, now);\n  oscGain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc.connect(oscGain);\n  oscGain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n\n  // Crunch noise\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration * 0.5);\n  const filter = ctx.createBiquadFilter();\n  filter.type = 'lowpass';\n  filter.frequency.value = 2000;\n  filter.Q.value = 2;\n  const nGain = ctx.createGain();\n  nGain.gain.setValueAtTime(vol * 0.4, now);\n  nGain.gain.exponentialRampToValueAtTime(0.001, now + duration * 0.5);\n  noise.connect(filter);\n  filter.connect(nGain);\n  nGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Enemy impact: mid-pitched collision thud \u2014 distinct from wall slam\nexport function playEnemyImpact(intensity: number = 1): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.1;\n  const vol = AUDIO_CONFIG.enemyImpactVolume * Math.min(intensity, 2);\n\n  // Mid-pitched thump (higher than wall slam, lower than melee hit)\n  const osc = ctx.createOscillator();\n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(150, now);\n  osc.frequency.exponentialRampToValueAtTime(60, now + duration);\n  const oscGain = ctx.createGain();\n  oscGain.gain.setValueAtTime(vol * 0.5, now);\n  oscGain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc.connect(oscGain);\n  oscGain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n\n  // Short noise pop\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration * 0.4);\n  const filter = ctx.createBiquadFilter();\n  filter.type = 'bandpass';\n  filter.frequency.value = 1500;\n  filter.Q.value = 3;\n  const nGain = ctx.createGain();\n  nGain.gain.setValueAtTime(vol * 0.3, now);\n  nGain.gain.exponentialRampToValueAtTime(0.001, now + duration * 0.4);\n  noise.connect(filter);\n  filter.connect(nGain);\n  nGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Door unlock: ascending 4-note arpeggio (more dramatic than wave clear)\nexport function playDoorUnlock(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const notes = [392, 523, 659, 784]; // G4, C5, E5, G5\n  const noteLen = 0.18;\n\n  notes.forEach((freq, i) => {\n    const osc = ctx!.createOscillator();\n    osc.type = 'sine';\n    osc.frequency.value = freq;\n    const gain = ctx!.createGain();\n    const start = now + i * 0.1;\n    gain.gain.setValueAtTime(0, start);\n    gain.gain.linearRampToValueAtTime(AUDIO_CONFIG.waveClearVolume * 0.35, start + 0.01);\n    gain.gain.exponentialRampToValueAtTime(0.001, start + noteLen);\n    osc.connect(gain);\n    gain.connect(masterGain!);\n    osc.start(start);\n    osc.stop(start + noteLen);\n  });\n}\n\n// Player healed: warm ascending tone\nexport function playHeal(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const osc = ctx.createOscillator();\n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(330, now);\n  osc.frequency.linearRampToValueAtTime(660, now + 0.4);\n  const gain = ctx.createGain();\n  gain.gain.setValueAtTime(0, now);\n  gain.gain.linearRampToValueAtTime(0.2, now + 0.05);\n  gain.gain.exponentialRampToValueAtTime(0.001, now + 0.5);\n  osc.connect(gain);\n  gain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + 0.5);\n}\n\n// Object impact: deep thud \u2014 lower pitch than enemy impact\nexport function playObjectImpact(intensity: number = 1): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.12;\n  const vol = AUDIO_CONFIG.objectImpactVolume * Math.min(intensity, 2);\n\n  // Deep thud\n  const osc = ctx.createOscillator();\n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(100, now);\n  osc.frequency.exponentialRampToValueAtTime(40, now + duration);\n  const oscGain = ctx.createGain();\n  oscGain.gain.setValueAtTime(vol * 0.5, now);\n  oscGain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc.connect(oscGain);\n  oscGain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n\n  // Short noise crunch\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration * 0.4);\n  const filter = ctx.createBiquadFilter();\n  filter.type = 'lowpass';\n  filter.frequency.value = 1500;\n  filter.Q.value = 2;\n  const nGain = ctx.createGain();\n  nGain.gain.setValueAtTime(vol * 0.3, now);\n  nGain.gain.exponentialRampToValueAtTime(0.001, now + duration * 0.4);\n  noise.connect(filter);\n  filter.connect(nGain);\n  nGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Obstacle break: shattering crack \u2014 noise burst + descending tone\nexport function playObstacleBreak(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.25;\n  const vol = AUDIO_CONFIG.obstacleBreakVolume;\n\n  // Descending crack tone\n  const osc = ctx.createOscillator();\n  osc.type = 'sawtooth';\n  osc.frequency.setValueAtTime(300, now);\n  osc.frequency.exponentialRampToValueAtTime(50, now + duration);\n  const oscGain = ctx.createGain();\n  oscGain.gain.setValueAtTime(vol * 0.4, now);\n  oscGain.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc.connect(oscGain);\n  oscGain.connect(masterGain);\n  osc.start(now);\n  osc.stop(now + duration);\n\n  // Noise burst \u2014 debris\n  const noise = ctx.createBufferSource();\n  noise.buffer = createNoiseBuffer(duration * 0.6);\n  const filter = ctx.createBiquadFilter();\n  filter.type = 'bandpass';\n  filter.frequency.value = 1800;\n  filter.Q.value = 4;\n  const nGain = ctx.createGain();\n  nGain.gain.setValueAtTime(vol * 0.5, now);\n  nGain.gain.exponentialRampToValueAtTime(0.001, now + duration * 0.6);\n  noise.connect(filter);\n  filter.connect(nGain);\n  nGain.connect(masterGain);\n  noise.start(now);\n  noise.stop(now + duration);\n}\n\n// Bend apply: rising shimmer \u2014 two detuned sine oscillators, quick frequency ramp\nexport function playBendApply(): void {\n  if (!ctx || !masterGain || !AUDIO_CONFIG.enabled) return;\n  const now = ctx.currentTime;\n  const duration = 0.3;\n  const vol = AUDIO_CONFIG.bendApplyVolume;\n\n  // Oscillator 1 \u2014 sine, ramp 400\u2192800Hz\n  const osc1 = ctx.createOscillator();\n  osc1.type = 'sine';\n  osc1.frequency.setValueAtTime(400, now);\n  osc1.frequency.exponentialRampToValueAtTime(800, now + duration * 0.6);\n  const gain1 = ctx.createGain();\n  gain1.gain.setValueAtTime(vol * 0.4, now);\n  gain1.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc1.connect(gain1);\n  gain1.connect(masterGain);\n  osc1.start(now);\n  osc1.stop(now + duration);\n\n  // Oscillator 2 \u2014 detuned sine, slight shimmer\n  const osc2 = ctx.createOscillator();\n  osc2.type = 'sine';\n  osc2.frequency.setValueAtTime(406, now); // +6Hz detuning for shimmer\n  osc2.frequency.exponentialRampToValueAtTime(812, now + duration * 0.6);\n  const gain2 = ctx.createGain();\n  gain2.gain.setValueAtTime(vol * 0.3, now);\n  gain2.gain.exponentialRampToValueAtTime(0.001, now + duration);\n  osc2.connect(gain2);\n  gain2.connect(masterGain);\n  osc2.start(now);\n  osc2.stop(now + duration);\n}\n\n// \u2500\u2500\u2500 Event Bus Integration \u2500\u2500\u2500\n\nfunction wireEventBus(): void {\n  on('enemyHit', (e: GameEvent) => {\n    if (e.type === 'enemyHit') playHit(e.damage / 15); // normalize around 15 dmg\n  });\n\n  on('enemyDied', () => playDeath());\n\n  on('playerHit', () => playPlayerHit());\n\n  on('playerDash', () => playDash());\n\n  on('shieldBreak', () => playShieldBreak());\n\n  on('chargeFired', (e: GameEvent) => {\n    if (e.type === 'chargeFired') playChargeFire(e.chargeT);\n  });\n\n  on('waveCleared', () => playWaveClear());\n\n  on('roomCleared', () => playWaveClear());\n\n  on('roomClearComplete', () => playDoorUnlock());\n\n  on('playerHealed', () => playHeal());\n\n  on('meleeSwing', () => playMeleeSwing());\n\n  on('meleeHit', () => playMeleeHit());\n\n  on('wallSlam', (e: GameEvent) => {\n    if (e.type === 'wallSlam') playWallSlam(e.speed / 5); // normalize around speed 5\n  });\n\n  on('enemyImpact', (e: GameEvent) => {\n    if (e.type === 'enemyImpact') playEnemyImpact(e.speed / 5);\n  });\n\n  on('objectWallSlam', (e: GameEvent) => {\n    if (e.type === 'objectWallSlam') playWallSlam(Math.min(e.speed / 8, 1));\n  });\n\n  on('objectImpact', (e: GameEvent) => {\n    if (e.type === 'objectImpact') playObjectImpact(Math.min(e.speed / 8, 1));\n  });\n\n  on('obstacleDestroyed', () => playObstacleBreak());\n\n  on('objectPitFall', () => playDeath()); // reuse pit fall sound\n\n  on('bendApplied', () => playBendApply());\n}\n", "import { BossConfig } from '../types/index';\n\nexport const BOSS: BossConfig = {\n  name: 'The Warden',\n  health: 300,\n  speed: 2.0,\n  damage: 30,\n  size: { radius: 0.8, height: 2.0 },\n  color: 0xff8800,\n  emissive: 0xff4400,\n  phases: [\n    { healthThreshold: 1.0, behavior: 'chase', attackRate: 1000 },\n    { healthThreshold: 0.5, behavior: 'enrage', attackRate: 600, speed: 3.0, spawnMinions: { type: 'goblin', count: 3 } },\n  ]\n};\n", "// URL query parameter overrides \u2014 apply gameplay config from URL\n// Format: ?player.speed=10&goblin.health=50&dash.cooldown=500\n//\n// First segment = config root, rest = nested dot-path within that object.\n// Values are auto-parsed as number, boolean, hex (0x...), or string.\n\nimport { PLAYER } from '../config/player';\nimport { ENEMY_TYPES } from '../config/enemies';\nimport { ABILITIES } from '../config/abilities';\nimport { BOSS } from '../config/boss';\n\n// Registry: first segment of param key \u2192 config object\nconst CONFIG_ROOTS: Record<string, any> = {\n  player:          PLAYER,\n  goblin:          ENEMY_TYPES.goblin,\n  skeletonArcher:  ENEMY_TYPES.skeletonArcher,\n  iceMortarImp:    ENEMY_TYPES.iceMortarImp,\n  stoneGolem:      ENEMY_TYPES.stoneGolem,\n  dash:            ABILITIES.dash,\n  ultimate:        ABILITIES.ultimate,\n  boss:            BOSS,\n};\n\nfunction getNestedValue(obj: any, path: string) {\n  const parts = path.split('.');\n  let cur = obj;\n  for (const p of parts) {\n    if (cur == null) return undefined;\n    cur = cur[p];\n  }\n  return cur;\n}\n\nfunction setNestedValue(obj: any, path: string, value: any) {\n  const parts = path.split('.');\n  let cur = obj;\n  for (let i = 0; i < parts.length - 1; i++) {\n    if (cur[parts[i]] == null) cur[parts[i]] = {};\n    cur = cur[parts[i]];\n  }\n  cur[parts[parts.length - 1]] = value;\n}\n\nfunction parseValue(raw: string) {\n  if (raw === 'true') return true;\n  if (raw === 'false') return false;\n  if (raw.startsWith('0x') || raw.startsWith('0X')) {\n    const hex = parseInt(raw, 16);\n    if (!isNaN(hex)) return hex;\n  }\n  const num = Number(raw);\n  return isNaN(num) ? raw : num;\n}\n\n/**\n * Parse URL search params and apply overrides to config objects.\n * Returns the count of params applied.\n */\nexport function applyUrlParams() {\n  const params = new URLSearchParams(window.location.search);\n  let applied = 0;\n\n  for (const [key, rawValue] of params) {\n    const dotIdx = key.indexOf('.');\n    if (dotIdx === -1) continue; // no prefix, skip\n\n    const prefix = key.slice(0, dotIdx);\n    const path = key.slice(dotIdx + 1);\n    if (!path) continue;\n\n    const root = CONFIG_ROOTS[prefix];\n    if (!root) {\n      console.warn(`[urlParams] Unknown prefix: \"${prefix}\" (from \"${key}\")`);\n      continue;\n    }\n\n    // Validate property exists (prevent typos from creating junk keys)\n    const existing = getNestedValue(root, path);\n    if (existing === undefined) {\n      console.warn(`[urlParams] Unknown path: \"${key}\" \u2014 no such property`);\n      continue;\n    }\n\n    const value = parseValue(rawValue);\n    setNestedValue(root, path, value);\n    applied++;\n    console.log(`[urlParams] ${key} = ${value}`);\n  }\n\n  if (applied > 0) {\n    console.log(`[urlParams] Applied ${applied} override(s) from URL`);\n  }\n  return applied;\n}\n\n/**\n * Snapshot current config values (call BEFORE applyUrlParams to capture defaults).\n */\nexport function snapshotDefaults() {\n  const snap: Record<string, any> = {};\n  for (const [prefix, root] of Object.entries(CONFIG_ROOTS)) {\n    snap[prefix] = JSON.parse(JSON.stringify(root));\n  }\n  return snap;\n}\n\n/**\n * Build a share URL containing only parameters that differ from defaults.\n */\nexport function buildShareUrl(defaults: Record<string, any>) {\n  const params = new URLSearchParams();\n\n  for (const [prefix, root] of Object.entries(CONFIG_ROOTS)) {\n    const defRoot = defaults[prefix];\n    if (!defRoot) continue;\n    collectDiffs(params, prefix, defRoot, root, '');\n  }\n\n  const base = window.location.origin + window.location.pathname;\n  const qs = params.toString();\n  return qs ? base + '?' + qs : base;\n}\n\nfunction collectDiffs(params: URLSearchParams, prefix: string, defObj: any, curObj: any, pathPrefix: string) {\n  for (const key of Object.keys(curObj)) {\n    const fullPath = pathPrefix ? pathPrefix + '.' + key : key;\n    const curVal = curObj[key];\n    const defVal = getNestedValue(defObj, fullPath);\n\n    if (curVal != null && typeof curVal === 'object' && !Array.isArray(curVal)) {\n      collectDiffs(params, prefix, defObj, curVal, fullPath);\n    } else if (curVal !== defVal) {\n      params.set(prefix + '.' + fullPath, String(curVal));\n    }\n  }\n}\n", "// Live tuning panel \u2014 designer can adjust values without touching code\n// Mutates config objects directly; game reads them each frame so changes are instant\n// Sections are collapsible so you can focus on what you're tuning\n\nimport { PLAYER, MELEE } from '../config/player';\nimport { ENEMY_TYPES, MOB_GLOBAL } from '../config/enemies';\nimport { ABILITIES } from '../config/abilities';\nimport { PHYSICS } from '../config/physics';\nimport { C as ANIM } from '../entities/playerAnimator';\nimport { AUDIO_CONFIG, setMasterVolume } from '../engine/audio';\nimport { SPAWN_CONFIG } from '../config/spawn';\nimport { DOOR_CONFIG } from '../config/door';\nimport { BULLET_TIME } from '../engine/bulletTime';\nimport { buildShareUrl } from '../engine/urlParams';\n\n// \u2500\u2500\u2500 Slider Section Definitions \u2500\u2500\u2500\n// Each section has a title and items. Sections are collapsible.\n// config() returns the object to mutate; key is the property name.\n\ninterface SliderItem {\n  label: string;\n  config: () => any;\n  key: string;\n  min: number;\n  max: number;\n  step: number;\n  suffix?: string;\n  unit?: string;\n  tip?: string;\n  custom?: string;\n  invert?: boolean;\n}\n\ninterface SliderSection {\n  section: string;         // collapsible header title\n  collapsed?: boolean;     // start collapsed? (default false)\n  items: SliderItem[];\n}\n\nconst SECTIONS: SliderSection[] = [\n  // \u2500\u2500 Combat \u2500\u2500\n  {\n    section: 'Projectiles',\n    items: [\n      { label: 'Fire Rate',  config: () => PLAYER,            key: 'fireRate',   min: 50,   max: 1000, step: 10,  invert: true,\n        unit: 'ms', tip: 'Time between player auto-shots. Lower = faster firing.' },\n      { label: 'Speed',      config: () => PLAYER.projectile,  key: 'speed',     min: 4,    max: 40,   step: 1,\n        unit: 'u/s', tip: 'Player projectile travel speed in units per second.' },\n      { label: 'Size',       config: () => PLAYER.projectile,  key: 'size',      min: 0.04, max: 0.5,  step: 0.02,\n        unit: 'u', tip: 'Player projectile collision radius in world units.' },\n    ]\n  },\n  {\n    section: 'Player',\n    items: [\n      { label: 'Move Speed', config: () => PLAYER,  key: 'speed',  min: 2,  max: 16,  step: 0.5,\n        unit: 'u/s', tip: 'Player movement speed in units per second.' },\n    ]\n  },\n  {\n    section: 'Melee',\n    collapsed: true,\n    items: [\n      { label: 'Damage',       config: () => MELEE,  key: 'damage',          min: 5,    max: 60,   step: 1,\n        unit: '', tip: 'Melee swing damage per hit.' },\n      { label: 'Range',        config: () => MELEE,  key: 'range',           min: 1,    max: 4,    step: 0.2,\n        unit: 'u', tip: 'How far the swing reaches from player center.' },\n      { label: 'Arc',          config: () => MELEE,  key: 'arc',             min: 1,    max: 3.5,  step: 0.1,\n        unit: 'rad', tip: 'Hit cone width in radians (~2.4 = 137\\u00b0).' },\n      { label: 'Cooldown',     config: () => MELEE,  key: 'cooldown',        min: 100,  max: 800,  step: 10,\n        unit: 'ms', tip: 'Time between swings.' },\n      { label: 'Knockback',    config: () => MELEE,  key: 'knockback',       min: 0,    max: 4,    step: 0.25,\n        unit: 'u', tip: 'Distance enemies are pushed on hit.' },\n      { label: 'Auto Range',   config: () => MELEE,  key: 'autoTargetRange', min: 1,    max: 6,    step: 0.5,\n        unit: 'u', tip: 'Radius to search for auto-targeting snap.' },\n      { label: 'Auto Arc',     config: () => MELEE,  key: 'autoTargetArc',   min: 1,    max: 3.5,  step: 0.1,\n        unit: 'rad', tip: 'Cone width for auto-targeting snap.' },\n      { label: 'Shake',        config: () => MELEE,  key: 'screenShake',     min: 0,    max: 4,    step: 0.25,\n        unit: '', tip: 'Screen shake intensity on melee hit.' },\n      { label: 'Hit Pause',    config: () => MELEE,  key: 'hitPause',        min: 0,    max: 100,  step: 5,\n        unit: 'ms', tip: 'Freeze-frame duration on melee hit (juice).' },\n    ]\n  },\n  {\n    section: 'Mob Global',\n    items: [\n      { label: 'Speed Mult',     config: () => MOB_GLOBAL,  key: 'speedMult',     min: 0.2,  max: 3,  step: 0.1,\n        unit: 'x', tip: 'Global speed multiplier for all enemies.' },\n      { label: 'Damage Mult',    config: () => MOB_GLOBAL,  key: 'damageMult',    min: 0.2,  max: 3,  step: 0.1,\n        unit: 'x', tip: 'Global damage multiplier for all enemies.' },\n      { label: 'Health Mult',    config: () => MOB_GLOBAL,  key: 'healthMult',    min: 0.2,  max: 3,  step: 0.1,\n        unit: 'x', tip: 'Global health multiplier for all enemies.' },\n      { label: 'Telegraph Mult', config: () => MOB_GLOBAL,  key: 'telegraphMult', min: 0.2,  max: 3,  step: 0.1,\n        unit: 'x', tip: 'Global telegraph duration multiplier. Higher = more reaction time.' },\n      { label: 'Recovery Mult',  config: () => MOB_GLOBAL,  key: 'recoveryMult',  min: 0.2,  max: 3,  step: 0.1,\n        unit: 'x', tip: 'Global recovery duration multiplier. Higher = bigger punish windows.' },\n    ]\n  },\n\n  // \u2500\u2500 Dash / Abilities \u2500\u2500\n  {\n    section: 'Dash',\n    collapsed: true,\n    items: [\n      { label: 'Cooldown',     config: () => ABILITIES.dash,  key: 'cooldown',             min: 500,  max: 10000, step: 100,\n        unit: 'ms', tip: 'Dash cooldown in milliseconds.' },\n      { label: 'Duration',     config: () => ABILITIES.dash,  key: 'duration',             min: 50,   max: 500,   step: 10,\n        unit: 'ms', tip: 'How long the dash lasts.' },\n      { label: 'Distance',     config: () => ABILITIES.dash,  key: 'distance',             min: 1,    max: 15,    step: 0.5,\n        unit: 'u', tip: 'Total distance covered by dash.' },\n      { label: 'End Lag',      config: () => ABILITIES.dash,  key: 'endLag',               min: 0,    max: 300,   step: 10,\n        unit: 'ms', tip: 'Recovery time after dash where movement is locked.' },\n      { label: 'Afterimages',  config: () => ABILITIES.dash,  key: 'afterimageCount',      min: 0,    max: 8,     step: 1,\n        unit: '', tip: 'Number of ghost afterimages spawned during dash.' },\n      { label: 'Ghost Fade',   config: () => ABILITIES.dash,  key: 'afterimageFadeDuration', min: 50, max: 1000, step: 25,\n        unit: 'ms', tip: 'How long afterimage ghosts take to fade out.' },\n      { label: 'Shake',        config: () => ABILITIES.dash,  key: 'screenShakeOnStart',   min: 0,    max: 8,     step: 0.5,\n        unit: '', tip: 'Screen shake intensity on dash start.' },\n    ]\n  },\n\n  // \u2500\u2500 Force Push \u2500\u2500\n  {\n    section: 'Force Push',\n    collapsed: true,\n    items: [\n      { label: 'Cooldown',     config: () => ABILITIES.ultimate,  key: 'cooldown',          min: 100,  max: 15000, step: 100,\n        unit: 'ms', tip: 'Force push cooldown.' },\n      { label: 'Charge Time',  config: () => ABILITIES.ultimate,  key: 'chargeTimeMs',      min: 200,   max: 5000,  step: 100,\n        unit: 'ms', tip: 'Time to fully charge.' },\n      { label: 'Min Length',   config: () => ABILITIES.ultimate,  key: 'minLength',         min: 1,     max: 8,     step: 0.5,\n        unit: 'u', tip: 'Uncharged push range.' },\n      { label: 'Max Length',   config: () => ABILITIES.ultimate,  key: 'maxLength',         min: 4,     max: 25,    step: 1,\n        unit: 'u', tip: 'Fully charged push range.' },\n      { label: 'Width',        config: () => ABILITIES.ultimate,  key: 'width',             min: 1,     max: 10,    step: 0.5,\n        unit: 'u', tip: 'Push zone width.' },\n      { label: 'Min Knockback',config: () => ABILITIES.ultimate,  key: 'minKnockback',      min: 0.5,   max: 5,     step: 0.25,\n        unit: 'u', tip: 'Knockback force at minimum charge.' },\n      { label: 'Max Knockback',config: () => ABILITIES.ultimate,  key: 'maxKnockback',      min: 2,     max: 15,    step: 0.5,\n        unit: 'u', tip: 'Knockback force at full charge.' },\n      { label: 'Move Mult',    config: () => ABILITIES.ultimate,  key: 'chargeMoveSpeedMult', min: 0,   max: 1,     step: 0.05,\n        unit: 'x', tip: 'Movement speed multiplier while charging.' },\n    ]\n  },\n\n  // \u2500\u2500 Bullet Time \u2500\u2500\n  {\n    section: 'Bullet Time',\n    collapsed: true,\n    items: [\n      { label: 'Time Scale',   config: () => BULLET_TIME, key: 'timeScale',          min: 0.05, max: 0.8,  step: 0.05,\n        unit: 'x', tip: 'How slow the world runs during bullet time (0.25 = 25% speed).' },\n      { label: 'Max Resource',  config: () => BULLET_TIME, key: 'maxResource',        min: 500,  max: 10000, step: 500,\n        unit: 'ms', tip: 'Total bullet time available at full bar.' },\n      { label: 'Drain Rate',    config: () => BULLET_TIME, key: 'drainRate',          min: 200,  max: 3000,  step: 100,\n        unit: 'ms/s', tip: 'How fast the bar drains per real second.' },\n      { label: 'Kill Refill',   config: () => BULLET_TIME, key: 'killRefill',         min: 100,  max: 2000,  step: 100,\n        unit: 'ms', tip: 'Resource refilled per enemy kill.' },\n      { label: 'Min Activate',  config: () => BULLET_TIME, key: 'activationMinimum',  min: 0,    max: 1000,  step: 50,\n        unit: 'ms', tip: 'Minimum resource required to activate bullet time.' },\n      { label: 'Infinite',      config: () => BULLET_TIME, key: 'infinite',           min: 0,    max: 1,     step: 1,\n        unit: '', tip: '1 = infinite bullet time (no drain). 0 = normal drain.' },\n    ]\n  },\n\n  // \u2500\u2500 Physics \u2500\u2500\n  {\n    section: 'Physics',\n    collapsed: true,\n    items: [\n      { label: 'Friction',       config: () => PHYSICS,  key: 'friction',         min: 2,    max: 30,   step: 1,\n        unit: 'u/s\u00B2', tip: 'Knockback deceleration. Higher = snappier stop.' },\n      { label: 'Push Instant %', config: () => PHYSICS,  key: 'pushInstantRatio', min: 0,    max: 1,    step: 0.05,\n        unit: '', tip: 'Fraction of knockback applied as instant offset. 1.0 = old instant feel.' },\n      { label: 'Wave Block Rad', config: () => PHYSICS,  key: 'pushWaveBlockRadius', min: 0,  max: 2,    step: 0.1,\n        unit: 'u', tip: 'Lateral distance for enemy occlusion. Nearer enemies block push to those behind. 0 = no blocking.' },\n      { label: 'Slam Min Speed', config: () => PHYSICS,  key: 'wallSlamMinSpeed', min: 0,    max: 10,   step: 0.5,\n        unit: 'u/s', tip: 'Minimum impact speed for wall slam damage.' },\n      { label: 'Slam Damage',    config: () => PHYSICS,  key: 'wallSlamDamage',   min: 1,    max: 20,   step: 1,\n        unit: '/unit', tip: 'Damage per unit of speed above slam threshold.' },\n      { label: 'Slam Stun',      config: () => PHYSICS,  key: 'wallSlamStun',     min: 0,    max: 1000, step: 50,\n        unit: 'ms', tip: 'Stun duration on wall slam.' },\n      { label: 'Slam Bounce',    config: () => PHYSICS,  key: 'wallSlamBounce',   min: 0,    max: 1,    step: 0.05,\n        unit: '', tip: 'Velocity reflection on wall hit. 0 = dead stop, 1 = perfect bounce.' },\n      { label: 'Slam Shake',     config: () => PHYSICS,  key: 'wallSlamShake',    min: 0,    max: 8,    step: 0.5,\n        unit: '', tip: 'Screen shake intensity on wall slam.' },\n      { label: 'Enemy Bounce',   config: () => PHYSICS,  key: 'enemyBounce',     min: 0,    max: 1,    step: 0.05,\n        unit: '', tip: 'Enemy-enemy collision restitution. 0 = stick, 1 = full bounce.' },\n      { label: 'Impact Min Spd', config: () => PHYSICS,  key: 'impactMinSpeed',  min: 0,    max: 10,   step: 0.5,\n        unit: 'u/s', tip: 'Minimum relative speed for enemy-enemy impact damage.' },\n      { label: 'Impact Damage',  config: () => PHYSICS,  key: 'impactDamage',    min: 1,    max: 20,   step: 1,\n        unit: '/unit', tip: 'Damage per unit of speed above impact threshold.' },\n      { label: 'Impact Stun',    config: () => PHYSICS,  key: 'impactStun',      min: 0,    max: 1000, step: 50,\n        unit: 'ms', tip: 'Stun duration when enemies collide at speed.' },\n    ]\n  },\n\n  // \u2500\u2500 Animation \u2500\u2500\n  {\n    section: 'Animation \u2014 Run',\n    collapsed: true,\n    items: [\n      { label: 'Cycle Rate',   config: () => ANIM,  key: 'runCycleRate',      min: 0.1,  max: 1.0,  step: 0.05,\n        unit: '', tip: 'Full leg cycles per world unit traveled.' },\n      { label: 'Stride Angle', config: () => ANIM,  key: 'strideAngle',      min: 0.1,  max: 1.5,  step: 0.05,\n        unit: 'rad', tip: 'Thigh swing amplitude in radians.' },\n      { label: 'Knee Bend',    config: () => ANIM,  key: 'kneeBendMax',      min: 0.1,  max: 1.5,  step: 0.05,\n        unit: 'rad', tip: 'Maximum forward knee bend.' },\n      { label: 'Arm Swing',    config: () => ANIM,  key: 'armSwingRatio',    min: 0.0,  max: 1.5,  step: 0.05,\n        unit: 'x', tip: 'Arm swing as fraction of leg amplitude.' },\n      { label: 'Body Bounce',  config: () => ANIM,  key: 'bodyBounceHeight', min: 0.0,  max: 0.1,  step: 0.005,\n        unit: 'u', tip: 'Vertical bounce per step in world units.' },\n      { label: 'Lean',         config: () => ANIM,  key: 'forwardLean',      min: 0.0,  max: 0.3,  step: 0.01,\n        unit: 'rad', tip: 'Forward lean into movement direction.' },\n      { label: 'Lean Speed',   config: () => ANIM,  key: 'forwardLeanSpeed', min: 1,    max: 20,   step: 1,\n        unit: '/s', tip: 'How fast lean blends in/out per second.' },\n      { label: 'Hip Turn',     config: () => ANIM,  key: 'hipTurnSpeed',     min: 2,    max: 30,   step: 1,\n        unit: 'rad/s', tip: 'How fast legs reorient to movement direction.' },\n    ]\n  },\n  {\n    section: 'Animation \u2014 Idle',\n    collapsed: true,\n    items: [\n      { label: 'Breath Rate',   config: () => ANIM,  key: 'breathRate',        min: 0.5,  max: 5,    step: 0.1,\n        unit: 'Hz', tip: 'Breathing oscillation speed.' },\n      { label: 'Breath Amp',    config: () => ANIM,  key: 'breathAmplitude',   min: 0.0,  max: 0.06, step: 0.005,\n        unit: 'u', tip: 'Vertical breathing displacement.' },\n      { label: 'Weight Shift',  config: () => ANIM,  key: 'weightShiftRate',   min: 0.1,  max: 2,    step: 0.1,\n        unit: 'Hz', tip: 'Side-to-side weight shift speed.' },\n      { label: 'Shift Angle',   config: () => ANIM,  key: 'weightShiftAngle',  min: 0.0,  max: 0.15, step: 0.005,\n        unit: 'rad', tip: 'Weight shift lean angle.' },\n      { label: 'Head Drift',    config: () => ANIM,  key: 'headDriftRate',     min: 0.1,  max: 2,    step: 0.1,\n        unit: 'Hz', tip: 'Head drift oscillation speed.' },\n      { label: 'Head Angle',    config: () => ANIM,  key: 'headDriftAngle',    min: 0.0,  max: 0.1,  step: 0.005,\n        unit: 'rad', tip: 'Head drift max rotation.' },\n      { label: 'Arm Droop',     config: () => ANIM,  key: 'idleArmDroop',      min: 0.0,  max: 0.5,  step: 0.01,\n        unit: 'rad', tip: 'Slight outward arm droop at idle.' },\n    ]\n  },\n  {\n    section: 'Animation \u2014 Dash',\n    collapsed: true,\n    items: [\n      { label: 'Squash Y',      config: () => ANIM,  key: 'squashScaleY',     min: 0.5,  max: 1.0,  step: 0.05,\n        unit: '', tip: 'Y scale during dash wind-up (< 1 = squash).' },\n      { label: 'Squash XZ',     config: () => ANIM,  key: 'squashScaleXZ',    min: 1.0,  max: 1.5,  step: 0.05,\n        unit: '', tip: 'XZ scale during dash wind-up (> 1 = widen).' },\n      { label: 'Stretch Y',     config: () => ANIM,  key: 'stretchScaleY',    min: 1.0,  max: 1.5,  step: 0.05,\n        unit: '', tip: 'Y scale mid-dash (> 1 = elongate).' },\n      { label: 'Stretch XZ',    config: () => ANIM,  key: 'stretchScaleXZ',   min: 0.5,  max: 1.0,  step: 0.05,\n        unit: '', tip: 'XZ scale mid-dash (< 1 = narrow).' },\n      { label: 'Lean Angle',    config: () => ANIM,  key: 'dashLeanAngle',    min: 0.0,  max: 0.8,  step: 0.02,\n        unit: 'rad', tip: 'Aggressive forward lean during dash.' },\n      { label: 'Arm Sweep',     config: () => ANIM,  key: 'dashArmSweep',     min: -1.5, max: 0,    step: 0.05,\n        unit: 'rad', tip: 'Arms swept back during dash.' },\n      { label: 'Leg Lunge',     config: () => ANIM,  key: 'dashLegLunge',     min: 0.0,  max: 1.5,  step: 0.05,\n        unit: 'rad', tip: 'Front leg forward extension during dash.' },\n      { label: 'Leg Trail',     config: () => ANIM,  key: 'dashLegTrail',     min: -1.5, max: 0,    step: 0.05,\n        unit: 'rad', tip: 'Back leg trailing behind during dash.' },\n    ]\n  },\n  {\n    section: 'Animation \u2014 Blends',\n    collapsed: true,\n    items: [\n      { label: 'Idle to Run',   config: () => ANIM,  key: 'idleToRunBlend',       min: 20,  max: 300, step: 10,\n        unit: 'ms', tip: 'Blend duration from idle to run state.' },\n      { label: 'Run to Idle',   config: () => ANIM,  key: 'runToIdleBlend',       min: 20,  max: 300, step: 10,\n        unit: 'ms', tip: 'Blend duration from run to idle state.' },\n      { label: 'End Lag Blend', config: () => ANIM,  key: 'endLagToNormalBlend',  min: 20,  max: 300, step: 10,\n        unit: 'ms', tip: 'Blend out of dash end-lag state.' },\n    ]\n  },\n\n  // \u2500\u2500 Audio \u2500\u2500\n  {\n    section: 'Audio',\n    collapsed: true,\n    items: [\n      { label: 'Master Vol',    config: () => AUDIO_CONFIG,  key: 'masterVolume',       min: 0,    max: 1,   step: 0.05,  custom: 'masterVolume',\n        unit: '', tip: 'Overall volume. Applied to AudioContext gain node.' },\n      { label: 'Hit Vol',       config: () => AUDIO_CONFIG,  key: 'hitVolume',          min: 0,    max: 1,   step: 0.05,\n        unit: '', tip: 'Enemy hit sound volume.' },\n      { label: 'Death Vol',     config: () => AUDIO_CONFIG,  key: 'deathVolume',        min: 0,    max: 1,   step: 0.05,\n        unit: '', tip: 'Enemy death sound volume.' },\n      { label: 'Dash Vol',      config: () => AUDIO_CONFIG,  key: 'dashVolume',         min: 0,    max: 1,   step: 0.05,\n        unit: '', tip: 'Dash whoosh volume.' },\n      { label: 'Shield Vol',    config: () => AUDIO_CONFIG,  key: 'shieldBreakVolume',  min: 0,    max: 1,   step: 0.05,\n        unit: '', tip: 'Shield break crash volume.' },\n      { label: 'Charge Vol',    config: () => AUDIO_CONFIG,  key: 'chargeVolume',       min: 0,    max: 1,   step: 0.05,\n        unit: '', tip: 'Charge fire burst volume.' },\n      { label: 'Wave Clear',    config: () => AUDIO_CONFIG,  key: 'waveClearVolume',    min: 0,    max: 1,   step: 0.05,\n        unit: '', tip: 'Wave clear chime volume.' },\n      { label: 'Player Hit',    config: () => AUDIO_CONFIG,  key: 'playerHitVolume',    min: 0,    max: 1,   step: 0.05,\n        unit: '', tip: 'Player damage taken sound volume.' },\n      { label: 'Melee Swing',   config: () => AUDIO_CONFIG,  key: 'meleeSwingVolume',   min: 0,    max: 1,   step: 0.05,\n        unit: '', tip: 'Melee swing whoosh volume.' },\n      { label: 'Melee Hit',     config: () => AUDIO_CONFIG,  key: 'meleeHitVolume',     min: 0,    max: 1,   step: 0.05,\n        unit: '', tip: 'Melee hit thump volume.' },\n    ]\n  },\n  {\n    section: 'Spawn Pacing',\n    collapsed: true,\n    items: [\n      { label: 'Telegraph Dur',     config: () => SPAWN_CONFIG, key: 'telegraphDuration',  min: 500,  max: 3000, step: 100,\n        unit: 'ms', tip: 'How long spawn warnings show before enemies appear.' },\n      { label: 'Spawn Cooldown',    config: () => SPAWN_CONFIG, key: 'spawnCooldown',      min: 200,  max: 2000, step: 100,\n        unit: 'ms', tip: 'Minimum delay between consecutive pack dispatches.' },\n      { label: 'Max Conc. Mult',    config: () => SPAWN_CONFIG, key: 'maxConcurrentMult',  min: 0.5,  max: 2,    step: 0.1,\n        unit: '', tip: 'Multiplier on max concurrent enemies (affects all rooms).' },\n      { label: 'Ahead Dist Min',    config: () => SPAWN_CONFIG, key: 'spawnAheadMin',      min: 3,    max: 15,   step: 1,\n        unit: 'u', tip: 'Min distance ahead of player to spawn enemies.' },\n      { label: 'Ahead Dist Max',    config: () => SPAWN_CONFIG, key: 'spawnAheadMax',      min: 8,    max: 25,   step: 1,\n        unit: 'u', tip: 'Max distance ahead of player to spawn enemies.' },\n    ]\n  },\n  {\n    section: 'Door',\n    collapsed: true,\n    items: [\n      { label: 'Unlock Duration',   config: () => DOOR_CONFIG,  key: 'unlockDuration',     min: 300,  max: 2000, step: 100,\n        unit: 'ms', tip: 'Door unlock animation duration.' },\n      { label: 'Interact Radius',   config: () => DOOR_CONFIG,  key: 'interactRadius',     min: 1,    max: 4,    step: 0.5,\n        unit: 'u', tip: 'How close player must be to enter door.' },\n      { label: 'Rest Pause',        config: () => DOOR_CONFIG,  key: 'restPause',          min: 500,  max: 5000, step: 500,\n        unit: 'ms', tip: 'How long before rest room door opens.' },\n    ]\n  },\n  {\n    section: 'Physics Objects',\n    collapsed: true,\n    items: [\n      { label: 'Object Friction',       config: () => PHYSICS,  key: 'objectFriction',          min: 1,   max: 50,  step: 1,\n        tip: 'Deceleration rate for physics objects.' },\n      { label: 'Wall Slam Min Speed',   config: () => PHYSICS,  key: 'objectWallSlamMinSpeed',  min: 0,   max: 10,  step: 0.5,\n        tip: 'Min speed for wall slam damage.' },\n      { label: 'Wall Slam Damage',      config: () => PHYSICS,  key: 'objectWallSlamDamage',    min: 1,   max: 20,  step: 1,\n        tip: 'Damage per unit speed above threshold.' },\n      { label: 'Wall Slam Bounce',      config: () => PHYSICS,  key: 'objectWallSlamBounce',    min: 0,   max: 1,   step: 0.05,\n        tip: 'Velocity reflection coefficient (0 = dead stop, 1 = perfect bounce).' },\n      { label: 'Impact Min Speed',      config: () => PHYSICS,  key: 'objectImpactMinSpeed',    min: 0,   max: 10,  step: 0.5,\n        tip: 'Min relative speed for impact damage.' },\n      { label: 'Impact Damage',         config: () => PHYSICS,  key: 'objectImpactDamage',      min: 1,   max: 20,  step: 1,\n        tip: 'Damage per unit speed above impact threshold.' },\n    ]\n  },\n];\n\n// \u2500\u2500\u2500 Enemy Speed Multiplier \u2500\u2500\u2500\n\nlet enemySpeedMultiplier = 1.0;\nconst originalSpeeds: any = {};\n\nfunction captureOriginalSpeeds() {\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    originalSpeeds[name] = (cfg as any).speed;\n  }\n}\n\nfunction applyEnemySpeedMultiplier(mult: number) {\n  enemySpeedMultiplier = mult;\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    (cfg as any).speed = originalSpeeds[name] * mult;\n  }\n}\n\n// \u2500\u2500\u2500 Master Volume Update \u2500\u2500\u2500\n// Audio master volume needs to also update the GainNode, not just the config value\n\nfunction applyMasterVolume(val: number) {\n  setMasterVolume(val);\n}\n\n// \u2500\u2500\u2500 Panel State \u2500\u2500\u2500\n\nlet panel: any, isCollapsed = true;\n\n// Track which sections are collapsed\nconst sectionCollapsedState: Map<string, boolean> = new Map();\n\nexport function initTuningPanel() {\n  captureOriginalSpeeds();\n\n  // Initialize section collapsed states from config\n  for (const sec of SECTIONS) {\n    sectionCollapsedState.set(sec.section, sec.collapsed ?? false);\n  }\n\n  // Container\n  panel = document.createElement('div');\n  panel.id = 'tuning-panel';\n  panel.innerHTML = '';\n\n  // Toggle button\n  const toggle = document.createElement('div');\n  toggle.id = 'tuning-toggle';\n  toggle.textContent = 'Tune';\n  toggle.addEventListener('click', () => {\n    isCollapsed = !isCollapsed;\n    panel.classList.toggle('collapsed', isCollapsed);\n    toggle.textContent = isCollapsed ? 'Tune' : '\\u00d7';\n  });\n  panel.appendChild(toggle);\n\n  // Content wrapper (scrollable)\n  const content = document.createElement('div');\n  content.id = 'tuning-content';\n  panel.appendChild(content);\n\n  // Build collapsible sections\n  for (const section of SECTIONS) {\n    const sectionEl = document.createElement('div');\n    sectionEl.className = 'tuning-section';\n\n    // Collapsible header\n    const header = document.createElement('div');\n    header.className = 'tuning-section-header';\n    const isSecCollapsed = sectionCollapsedState.get(section.section) ?? false;\n    header.innerHTML = `<span class=\"tuning-section-arrow\">${isSecCollapsed ? '\\u25b6' : '\\u25bc'}</span> ${section.section}`;\n\n    const itemsContainer = document.createElement('div');\n    itemsContainer.className = 'tuning-section-items';\n    if (isSecCollapsed) {\n      itemsContainer.style.display = 'none';\n    }\n\n    header.addEventListener('click', () => {\n      const collapsed = sectionCollapsedState.get(section.section) ?? false;\n      const newState = !collapsed;\n      sectionCollapsedState.set(section.section, newState);\n      itemsContainer.style.display = newState ? 'none' : '';\n      const arrow = header.querySelector('.tuning-section-arrow')!;\n      arrow.textContent = newState ? '\\u25b6' : '\\u25bc';\n    });\n\n    sectionEl.appendChild(header);\n\n    // Build slider rows\n    for (const item of section.items) {\n      const row = document.createElement('div');\n      row.className = 'tuning-row';\n\n      const label = document.createElement('span');\n      label.className = 'tuning-label';\n      label.textContent = item.label;\n      if (item.tip) {\n        label.setAttribute('data-tip', item.tip);\n        label.classList.add('has-tooltip');\n      }\n\n      const slider = document.createElement('input');\n      slider.type = 'range';\n      slider.className = 'tuning-slider';\n      slider.min = String(item.min);\n      slider.max = String(item.max);\n      slider.step = String(item.step);\n\n      // Get current value\n      let currentVal;\n      if (item.custom === 'enemySpeed') {\n        currentVal = enemySpeedMultiplier;\n      } else {\n        currentVal = item.config()[item.key];\n      }\n      slider.value = String(currentVal);\n\n      const valueDisplay = document.createElement('span');\n      valueDisplay.className = 'tuning-value';\n      valueDisplay.textContent = formatValue(currentVal, item);\n\n      slider.addEventListener('input', () => {\n        const val = parseFloat(slider.value);\n        if (item.custom === 'enemySpeed') {\n          applyEnemySpeedMultiplier(val);\n        } else if (item.custom === 'masterVolume') {\n          applyMasterVolume(val);\n        } else {\n          item.config()[item.key] = val;\n        }\n        valueDisplay.textContent = formatValue(val, item);\n      });\n\n      row.appendChild(label);\n      row.appendChild(slider);\n      row.appendChild(valueDisplay);\n      itemsContainer.appendChild(row);\n    }\n\n    sectionEl.appendChild(itemsContainer);\n    content.appendChild(sectionEl);\n  }\n\n  // Copy button\n  const copyBtn = document.createElement('div');\n  copyBtn.id = 'tuning-copy';\n  copyBtn.textContent = 'Copy Values';\n  copyBtn.addEventListener('click', () => {\n    const text = buildCopyText();\n    navigator.clipboard.writeText(text).then(() => {\n      copyBtn.textContent = 'Copied!';\n      copyBtn.classList.add('copied');\n      setTimeout(() => {\n        copyBtn.textContent = 'Copy Values';\n        copyBtn.classList.remove('copied');\n      }, 1200);\n    });\n  });\n  content.appendChild(copyBtn);\n\n  // Share URL button\n  const shareBtn = document.createElement('div');\n  shareBtn.id = 'tuning-share';\n  shareBtn.textContent = 'Share URL';\n  shareBtn.addEventListener('click', () => {\n    const url = buildShareUrl((window as any).__configDefaults || {});\n    navigator.clipboard.writeText(url).then(() => {\n      shareBtn.textContent = 'Copied URL!';\n      shareBtn.classList.add('copied');\n      setTimeout(() => {\n        shareBtn.textContent = 'Share URL';\n        shareBtn.classList.remove('copied');\n      }, 1200);\n    });\n  });\n  content.appendChild(shareBtn);\n\n  // Custom tooltip\n  const tooltipEl = document.createElement('div');\n  tooltipEl.id = 'tuning-tooltip';\n  document.body.appendChild(tooltipEl);\n\n  let tuningTipTarget: any = null;\n  panel.addEventListener('mouseover', (e: any) => {\n    const el = e.target.closest('.has-tooltip');\n    if (el && el.getAttribute('data-tip')) {\n      tuningTipTarget = el;\n      tooltipEl.textContent = el.getAttribute('data-tip');\n      tooltipEl.classList.add('visible');\n      const rect = el.getBoundingClientRect();\n      let left = rect.left - tooltipEl.offsetWidth - 8;\n      let top = rect.top + rect.height / 2 - tooltipEl.offsetHeight / 2;\n      if (left < 4) { left = rect.right + 8; }\n      top = Math.max(4, Math.min(window.innerHeight - tooltipEl.offsetHeight - 4, top));\n      tooltipEl.style.left = left + 'px';\n      tooltipEl.style.top = top + 'px';\n    }\n  });\n  panel.addEventListener('mouseout', (e: any) => {\n    const el = e.target.closest('.has-tooltip');\n    if (el === tuningTipTarget) {\n      tuningTipTarget = null;\n      tooltipEl.classList.remove('visible');\n    }\n  });\n\n  // Start collapsed\n  panel.classList.add('collapsed');\n  document.body.appendChild(panel);\n  injectStyles();\n}\n\nfunction buildCopyText() {\n  const lines: string[] = [];\n  for (const section of SECTIONS) {\n    lines.push(`${section.section}:`);\n    for (const item of section.items) {\n      let val;\n      if (item.custom === 'enemySpeed') {\n        val = enemySpeedMultiplier;\n      } else {\n        val = item.config()[item.key];\n      }\n      const display = Number.isInteger(val) ? val : parseFloat(val.toFixed(4));\n      const suffix = item.suffix ? ' ' + item.suffix : '';\n      lines.push(`  ${item.label}: ${display}${suffix}`);\n    }\n  }\n  return lines.join('\\n');\n}\n\nfunction formatValue(val: number, item: any) {\n  const display = Number.isInteger(val) ? val : val.toFixed(2);\n  const unitStr = item.unit || item.suffix || '';\n  return display + (unitStr ? ' ' + unitStr : '');\n}\n\nfunction injectStyles() {\n  const style = document.createElement('style');\n  style.textContent = `\n    #tuning-panel {\n      position: fixed;\n      top: 60px;\n      right: 20px;\n      width: 300px;\n      z-index: 200;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      pointer-events: all;\n      transition: transform 0.25s ease;\n    }\n\n    #tuning-panel.collapsed #tuning-content {\n      display: none;\n    }\n\n    #tuning-toggle {\n      position: absolute;\n      top: 0;\n      right: 0;\n      width: 48px;\n      height: 28px;\n      background: rgba(20, 20, 40, 0.85);\n      border: 1px solid rgba(68, 255, 136, 0.3);\n      border-radius: 4px;\n      color: rgba(68, 255, 136, 0.8);\n      font-family: inherit;\n      font-size: 11px;\n      letter-spacing: 1px;\n      text-transform: uppercase;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      user-select: none;\n      transition: all 0.15s ease;\n    }\n\n    #tuning-toggle:hover {\n      background: rgba(68, 255, 136, 0.1);\n      border-color: rgba(68, 255, 136, 0.6);\n    }\n\n    #tuning-content {\n      margin-top: 36px;\n      background: rgba(10, 10, 26, 0.94);\n      border: 1px solid rgba(68, 255, 136, 0.2);\n      border-radius: 6px;\n      padding: 12px;\n      backdrop-filter: blur(8px);\n      max-height: calc(100vh - 120px);\n      overflow-y: auto;\n      scrollbar-width: thin;\n      scrollbar-color: rgba(68, 255, 136, 0.3) transparent;\n    }\n\n    #tuning-content::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    #tuning-content::-webkit-scrollbar-track {\n      background: transparent;\n    }\n\n    #tuning-content::-webkit-scrollbar-thumb {\n      background: rgba(68, 255, 136, 0.3);\n      border-radius: 3px;\n    }\n\n    .tuning-section {\n      margin-bottom: 4px;\n    }\n\n    .tuning-section:last-of-type {\n      margin-bottom: 0;\n    }\n\n    .tuning-section-header {\n      font-size: 9px;\n      color: rgba(68, 255, 136, 0.7);\n      letter-spacing: 2px;\n      text-transform: uppercase;\n      padding: 6px 4px;\n      cursor: pointer;\n      user-select: none;\n      border-bottom: 1px solid rgba(68, 255, 136, 0.1);\n      transition: color 0.15s ease;\n    }\n\n    .tuning-section-header:hover {\n      color: rgba(68, 255, 136, 1);\n    }\n\n    .tuning-section-arrow {\n      font-size: 7px;\n      margin-right: 4px;\n      display: inline-block;\n      width: 10px;\n    }\n\n    .tuning-section-items {\n      padding: 6px 0 4px 0;\n    }\n\n    .tuning-row {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 6px;\n    }\n\n    .tuning-row:last-child {\n      margin-bottom: 0;\n    }\n\n    .tuning-label {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.55);\n      width: 80px;\n      flex-shrink: 0;\n    }\n\n    .tuning-label.has-tooltip {\n      cursor: help;\n      text-decoration: underline dotted rgba(255, 255, 255, 0.2);\n      text-underline-offset: 2px;\n    }\n\n    .tuning-slider {\n      flex: 1;\n      height: 3px;\n      -webkit-appearance: none;\n      appearance: none;\n      background: rgba(100, 100, 160, 0.3);\n      border-radius: 2px;\n      outline: none;\n      cursor: pointer;\n    }\n\n    .tuning-slider::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      appearance: none;\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background: #44ff88;\n      cursor: pointer;\n      border: none;\n      box-shadow: 0 0 4px rgba(68, 255, 136, 0.4);\n    }\n\n    .tuning-slider::-moz-range-thumb {\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background: #44ff88;\n      cursor: pointer;\n      border: none;\n      box-shadow: 0 0 4px rgba(68, 255, 136, 0.4);\n    }\n\n    .tuning-value {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.7);\n      width: 54px;\n      text-align: right;\n      flex-shrink: 0;\n    }\n\n    #tuning-copy, #tuning-share {\n      margin-top: 10px;\n      padding: 5px 0;\n      text-align: center;\n      font-size: 9px;\n      letter-spacing: 1px;\n      text-transform: uppercase;\n      color: rgba(68, 255, 136, 0.7);\n      background: rgba(68, 255, 136, 0.06);\n      border: 1px solid rgba(68, 255, 136, 0.2);\n      border-radius: 4px;\n      cursor: pointer;\n      user-select: none;\n      transition: all 0.15s ease;\n    }\n\n    #tuning-share {\n      margin-top: 4px;\n    }\n\n    #tuning-copy:hover, #tuning-share:hover {\n      background: rgba(68, 255, 136, 0.12);\n      border-color: rgba(68, 255, 136, 0.5);\n      color: rgba(68, 255, 136, 1);\n    }\n\n    #tuning-copy.copied, #tuning-share.copied {\n      color: #ffcc44;\n      border-color: rgba(255, 204, 68, 0.4);\n      background: rgba(255, 204, 68, 0.08);\n    }\n\n    #tuning-tooltip {\n      position: fixed;\n      z-index: 300;\n      max-width: 220px;\n      padding: 6px 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      font-size: 10px;\n      line-height: 1.4;\n      color: rgba(255, 255, 255, 0.9);\n      background: rgba(10, 10, 30, 0.95);\n      border: 1px solid rgba(68, 255, 136, 0.4);\n      border-radius: 4px;\n      pointer-events: none;\n      opacity: 0;\n      transition: opacity 0.12s ease;\n      backdrop-filter: blur(6px);\n    }\n\n    #tuning-tooltip.visible {\n      opacity: 1;\n    }\n  `;\n  document.head.appendChild(style);\n}\n", "import { WaveDefinition } from '../types/index';\n\nexport const WAVES: WaveDefinition[] = [\n  {\n    wave: 1,\n    message: 'Wave 1 \u2014 The dungeon stirs...',\n    groups: [\n      {\n        id: 'w1g1',\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 200,\n        spawns: [\n          { type: 'goblin', x: 5, z: 2 },\n          { type: 'goblin', x: 11, z: 0 },\n          { type: 'goblin', x: 0, z: 5 },\n          { type: 'iceMortarImp', x: 7, z: -11 },\n          { type: 'iceMortarImp', x: -10, z: 9 },\n        ],\n      },\n      {\n        id: 'w1g2',\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 200,\n        spawns: [\n          { type: 'goblin', x: -2, z: -9 },\n          { type: 'goblin', x: -10, z: -3 },\n          { type: 'goblin', x: -10, z: 0 },\n        ],\n      },\n    ]\n  },\n  {\n    wave: 2,\n    message: 'Wave 2 \u2014 Watch the big ones',\n    groups: [\n      {\n        id: 'w2g1',\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 150,\n        spawns: [\n          { type: 'goblin', x: 14, z: 0 },\n          { type: 'stoneGolem', x: 12, z: 2 },\n          { type: 'goblin', x: 12, z: -2 },\n          { type: 'goblin', x: -14, z: 0 },\n          { type: 'goblin', x: -12, z: 2 },\n          { type: 'stoneGolem', x: -12, z: -1 },\n          { type: 'goblin', x: 6, z: -7 },\n          { type: 'goblin', x: -6, z: 6 },\n        ],\n      },\n      {\n        id: 'w2g2',\n        triggerDelay: 3000,\n        telegraphDuration: 2000,\n        stagger: 400,\n        spawns: [\n          { type: 'skeletonArcher', x: 12, z: 12 },\n          { type: 'skeletonArcher', x: -12, z: -12 },\n          { type: 'skeletonArcher', x: -12, z: 12 },\n        ],\n      },\n    ]\n  },\n  {\n    wave: 3,\n    message: 'Wave 3 \u2014 Final wave?',\n    groups: [\n      {\n        id: 'w3g1',\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 100,\n        spawns: [\n          { type: 'goblin', x: 15, z: 5 },\n          { type: 'goblin', x: 15, z: -5 },\n          { type: 'goblin', x: -15, z: 5 },\n          { type: 'goblin', x: -15, z: -5 },\n          { type: 'goblin', x: 5, z: 15 },\n          { type: 'goblin', x: -5, z: 15 },\n        ],\n      },\n      {\n        id: 'w3g2',\n        triggerDelay: 2000,\n        telegraphDuration: 2000,\n        stagger: 300,\n        spawns: [\n          { type: 'skeletonArcher', x: 14, z: 10 },\n          { type: 'skeletonArcher', x: -14, z: 10 },\n          { type: 'skeletonArcher', x: 0, z: -16 },\n          { type: 'skeletonArcher', x: 14, z: -10 },\n        ],\n      },\n      {\n        id: 'w3g3',\n        triggerDelay: 6000,\n        telegraphDuration: 2500,\n        stagger: 500,\n        spawns: [\n          { type: 'stoneGolem', x: 0, z: 15 },\n          { type: 'stoneGolem', x: -15, z: -5 },\n          { type: 'stoneGolem', x: 15, z: -5 },\n        ],\n      },\n      {\n        id: 'w3g4',\n        triggerDelay: 7000,\n        telegraphDuration: 1500,\n        stagger: 200,\n        spawns: [\n          { type: 'iceMortarImp', x: -13, z: 0 },\n          { type: 'iceMortarImp', x: -3, z: -12 },\n          { type: 'iceMortarImp', x: 12, z: 1 },\n          { type: 'iceMortarImp', x: -5, z: 11 },\n        ],\n      },\n    ]\n  },\n];\n", "// Wave runner \u2014 state machine that drives wave progression\n// idle \u2192 announce \u2192 running \u2192 cleared \u2192 next wave / victory\n\nimport { WAVES } from '../config/waves';\nimport { spawnEnemy } from '../entities/enemy';\nimport { initTelegraph, createTelegraph, updateTelegraph, removeTelegraph } from './telegraph';\nimport { emit } from './events';\n\nlet sceneRef: any;\n\nconst waveState = {\n  status: 'idle' as string,          // 'idle' | 'announce' | 'running' | 'cleared' | 'victory'\n  waveIndex: 0,\n  elapsedMs: 0,            // ms since wave entered 'running'\n  announceTimer: 0,\n  clearPauseTimer: 0,\n  groups: [] as any[],              // runtime state per group\n};\n\n// Announce UI element\nlet announceEl: HTMLElement | null;\n\nexport function initWaveRunner(scene: any) {\n  sceneRef = scene;\n  initTelegraph(scene);\n\n  // Get or create announce element\n  announceEl = document.getElementById('wave-announce');\n}\n\nexport function startWave(index: number, gameState: any) {\n  if (index >= WAVES.length) {\n    waveState.status = 'victory';\n    showAnnounce('VICTORY');\n    return;\n  }\n\n  waveState.waveIndex = index;\n  waveState.status = 'announce';\n  waveState.announceTimer = 2000;\n  waveState.elapsedMs = 0;\n  waveState.groups = [];\n\n  gameState.currentWave = WAVES[index].wave;\n\n  // Show wave announcement\n  showAnnounce(WAVES[index].message);\n}\n\nexport function updateWaveRunner(dt: number, gameState: any) {\n  const dtMs = dt * 1000;\n\n  switch (waveState.status) {\n    case 'idle':\n    case 'victory':\n      return;\n\n    case 'announce':\n      waveState.announceTimer -= dtMs;\n      if (waveState.announceTimer <= 0) {\n        hideAnnounce();\n        waveState.status = 'running';\n        emit({ type: 'waveBegan', waveIndex: waveState.waveIndex });\n        initGroupRuntimes();\n      }\n      break;\n\n    case 'running':\n      waveState.elapsedMs += dtMs;\n      let allGroupsDone = true;\n\n      for (const g of waveState.groups) {\n        updateGroup(g, dt, dtMs, gameState);\n        if (g.phase !== 'done') allGroupsDone = false;\n      }\n\n      // Wave cleared: all groups spawned AND no enemies alive\n      if (allGroupsDone && gameState.enemies.length === 0) {\n        waveState.status = 'cleared';\n        waveState.clearPauseTimer = 2000;\n        emit({ type: 'waveCleared', waveIndex: waveState.waveIndex });\n        showAnnounce('Wave cleared!');\n      }\n      break;\n\n    case 'cleared':\n      waveState.clearPauseTimer -= dtMs;\n      if (waveState.clearPauseTimer <= 0) {\n        hideAnnounce();\n        startWave(waveState.waveIndex + 1, gameState);\n      }\n      break;\n  }\n}\n\nfunction initGroupRuntimes() {\n  const waveCfg = WAVES[waveState.waveIndex];\n  waveState.groups = waveCfg.groups.map((groupCfg: any) => ({\n    config: groupCfg,\n    phase: 'waiting',    // 'waiting' | 'telegraphing' | 'spawning' | 'done'\n    timer: 0,\n    spawnIndex: 0,\n    staggerTimer: 0,\n    telegraphs: [] as any[],\n  }));\n}\n\nfunction updateGroup(g: any, dt: number, dtMs: number, gameState: any) {\n  switch (g.phase) {\n    case 'waiting':\n      if (waveState.elapsedMs >= g.config.triggerDelay) {\n        g.phase = 'telegraphing';\n        g.timer = g.config.telegraphDuration;\n\n        // Create telegraph markers for each spawn in this group\n        for (const s of g.config.spawns) {\n          const t = createTelegraph(s.x, s.z, s.type);\n          g.telegraphs.push(t);\n        }\n      }\n      break;\n\n    case 'telegraphing':\n      g.timer -= dtMs;\n      const progress = 1.0 - Math.max(0, g.timer / g.config.telegraphDuration);\n\n      // Update all telegraph animations\n      for (const t of g.telegraphs) {\n        updateTelegraph(t, progress, dt);\n      }\n\n      if (g.timer <= 0) {\n        // Remove telegraphs\n        for (const t of g.telegraphs) {\n          removeTelegraph(t);\n        }\n        g.telegraphs = [];\n\n        // Transition to spawning\n        g.phase = 'spawning';\n        g.spawnIndex = 0;\n        g.staggerTimer = 0;\n      }\n      break;\n\n    case 'spawning':\n      g.staggerTimer -= dtMs;\n      while (g.staggerTimer <= 0 && g.spawnIndex < g.config.spawns.length) {\n        const s = g.config.spawns[g.spawnIndex];\n        spawnEnemy(s.type, new THREE.Vector3(s.x, 0, s.z), gameState);\n        g.spawnIndex++;\n        if (g.spawnIndex < g.config.spawns.length) {\n          g.staggerTimer += g.config.stagger;\n        }\n      }\n      if (g.spawnIndex >= g.config.spawns.length) {\n        g.phase = 'done';\n      }\n      break;\n  }\n}\n\nexport function resetWaveRunner() {\n  // Clean up any active telegraphs\n  for (const g of waveState.groups) {\n    for (const t of g.telegraphs) {\n      removeTelegraph(t);\n    }\n  }\n  waveState.status = 'idle';\n  waveState.waveIndex = 0;\n  waveState.elapsedMs = 0;\n  waveState.groups = [];\n  hideAnnounce();\n}\n\nexport function getWaveState() {\n  return waveState;\n}\n\nexport function isWaveRunnerActive() {\n  return waveState.status === 'running' || waveState.status === 'announce';\n}\n\n// Announce text overlay\nfunction showAnnounce(text: string) {\n  if (!announceEl) return;\n  announceEl.textContent = text;\n  announceEl.classList.add('visible');\n}\n\nfunction hideAnnounce() {\n  if (!announceEl) return;\n  announceEl.classList.remove('visible');\n}\n", "// Editor Handles \u2014 draggable resize cubes for obstacles and pits\n// Shows colored cubes at edges of selected object. Drag to resize.\n\nimport { getCamera } from '../engine/renderer';\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// TYPES\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport interface HandleData {\n  axis: 'x' | 'z' | 'y';\n  sign: 1 | -1;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// STATE\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nlet sceneRef: any = null;\nlet handleMeshes: any[] = [];\nlet grabbedHandle: HandleData | null = null;\n\nlet handleSize = 0.3;\nconst HANDLE_SIZE_NORMAL = 0.3;\nconst HANDLE_SIZE_RESIZE = 0.6;\nconst HANDLE_COLORS: Record<string, number> = {\n  x: 0xff4444,   // red\n  z: 0x4444ff,   // blue\n  y: 0x44ff44,   // green\n};\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PUBLIC API\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport function initHandles(scene: any): void {\n  sceneRef = scene;\n}\n\nexport function setResizeMode(on: boolean): void {\n  handleSize = on ? HANDLE_SIZE_RESIZE : HANDLE_SIZE_NORMAL;\n}\n\nexport function showHandles(entity: any, type: 'obstacle' | 'pit'): void {\n  clearHandles();\n  if (!sceneRef) return;\n  addHandlesForEntity(entity, type);\n}\n\n/** Show handles on ALL obstacles and pits at once (dimmed), so everything looks editable */\nexport function showAllHandles(obstacles: any[], pits: any[]): void {\n  clearHandles();\n  if (!sceneRef) return;\n  for (const o of obstacles) addHandlesForEntity(o, 'obstacle', 0.35);\n  for (const p of pits) addHandlesForEntity(p, 'pit', 0.35);\n}\n\nfunction addHandlesForEntity(entity: any, type: 'obstacle' | 'pit', opacity = 0.8): void {\n  const x = entity.x as number;\n  const z = entity.z as number;\n  const w = entity.w as number;\n  const d = entity.d as number;\n  const h = type === 'obstacle' ? (entity.h as number) : 0;\n  const baseY = type === 'obstacle' ? h / 2 : 0.15;\n\n  // +X, -X edge handles\n  addHandle(x + w / 2, baseY, z, 'x', 1, opacity);\n  addHandle(x - w / 2, baseY, z, 'x', -1, opacity);\n\n  // +Z, -Z edge handles\n  addHandle(x, baseY, z + d / 2, 'z', 1, opacity);\n  addHandle(x, baseY, z - d / 2, 'z', -1, opacity);\n\n  // +Y handle (height) \u2014 only for obstacles\n  if (type === 'obstacle') {\n    addHandle(x, h, z, 'y', 1, opacity);\n  }\n}\n\nexport function clearHandles(): void {\n  for (const mesh of handleMeshes) {\n    if (sceneRef) sceneRef.remove(mesh);\n    if (mesh.geometry) mesh.geometry.dispose();\n    if (mesh.material) mesh.material.dispose();\n  }\n  handleMeshes = [];\n}\n\nexport function raycastHandles(ndc: { x: number; y: number }): boolean {\n  if (handleMeshes.length === 0) return false;\n\n  const camera = getCamera();\n  const raycaster = new THREE.Raycaster();\n  raycaster.setFromCamera(new THREE.Vector2(ndc.x, ndc.y), camera);\n\n  const intersects = raycaster.intersectObjects(handleMeshes, false);\n  if (intersects.length > 0) {\n    const hitMesh = intersects[0].object;\n    grabbedHandle = hitMesh.userData.handleData as HandleData;\n    return true;\n  }\n  return false;\n}\n\nexport function getGrabbedHandle(): HandleData | null {\n  return grabbedHandle;\n}\n\nexport function releaseHandle(): void {\n  grabbedHandle = null;\n}\n\n/** In resize mode, pick the nearest handle to the given world position */\nexport function grabNearestHandle(worldX: number, worldZ: number): boolean {\n  if (handleMeshes.length === 0) return false;\n  let bestDist = Infinity;\n  let bestHandle: HandleData | null = null;\n  for (const mesh of handleMeshes) {\n    const dx = mesh.position.x - worldX;\n    const dz = mesh.position.z - worldZ;\n    const dist = dx * dx + dz * dz;\n    if (dist < bestDist) {\n      bestDist = dist;\n      bestHandle = mesh.userData.handleData as HandleData;\n    }\n  }\n  if (bestHandle) {\n    grabbedHandle = bestHandle;\n    return true;\n  }\n  return false;\n}\n\nexport function updateHandlePositions(entity: any, type: 'obstacle' | 'pit'): void {\n  // Faster to just rebuild \u2014 only 4-5 meshes\n  const savedGrab = grabbedHandle;\n  showHandles(entity, type);\n  grabbedHandle = savedGrab; // preserve grab state across rebuild\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// INTERNALS\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction addHandle(px: number, py: number, pz: number, axis: 'x' | 'z' | 'y', sign: 1 | -1, opacity = 0.8): void {\n  const geo = new THREE.BoxGeometry(handleSize, handleSize, handleSize);\n  const mat = new THREE.MeshBasicMaterial({\n    color: HANDLE_COLORS[axis],\n    transparent: true,\n    opacity,\n  });\n  const mesh = new THREE.Mesh(geo, mat);\n  mesh.position.set(px, py, pz);\n  mesh.userData.handleData = { axis, sign } as HandleData;\n\n  sceneRef.add(mesh);\n  handleMeshes.push(mesh);\n}\n", "// Level Editor \u2014 visual tool for placing obstacles, physics objects, and pits\n// Toggle with Shift+` (Shift+Backquote). Pauses gameplay while editing.\n// Tasks 8 (core), 9 (click/drag/place), 10 (property panel).\n\nimport { getScene, getCamera, rebuildArenaVisuals } from '../engine/renderer';\nimport { OBSTACLES, PITS, ARENA_HALF_X, ARENA_HALF_Z } from '../config/arena';\nimport { invalidateCollisionBounds } from '../engine/physics';\nimport { createPhysicsObject, createPhysicsObjectMesh, clearPhysicsObjects, applyBendVisuals, clearBendVisuals } from '../entities/physicsObject';\nimport { isEditorActive as isSpawnEditorActive } from './spawnEditor';\nimport { initHandles, showHandles, showAllHandles, clearHandles, raycastHandles, getGrabbedHandle, releaseHandle, updateHandlePositions, setResizeMode, grabNearestHandle } from './editorHandles';\nimport { createBendSystem } from '../engine/bendSystem';\nimport { BENDS, getBendById } from '../config/bends';\nimport type { Obstacle, Pit, PhysicsObject, PhysicsObjectPlacement } from '../types/index';\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// MODULE STATE\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nlet sceneRef: any;\nlet gameStateRef: any;\n\nlet active = false;\nlet previousPhase = 'playing';\n\n// Editor mode and selection\nlet mode: 'obstacle' | 'physics' | 'pit' = 'obstacle';\nlet selectedType: 'obstacle' | 'physics' | 'pit' | null = null;\nlet selectedIdx = -1;\n\n// Drag state\nlet isDragging = false;\nlet dragStarted = false;\nlet dragStartWorld: { x: number; z: number } | null = null;\nlet dragUndoPushed = false;\n\n// Handle resize state\nlet handleUndoPushed = false;\nlet resizeMode = false;\n\n// Track mouse position for hotkeys (B = quick-place block)\nlet lastMouseNDC: { x: number; y: number } = { x: 0, y: 0 };\n\n// Bend preview state\nlet bendPreviewActive = false;\nlet bendPreviewSystem: ReturnType<typeof createBendSystem> | null = null;\nlet selectedBendId: string = BENDS[0]?.id ?? 'enlarge';\nlet bendPreviewBtn: HTMLButtonElement;\nlet bendSelectorEl: HTMLDivElement;\n\n// DOM elements\nlet barEl: HTMLDivElement;\nlet panelEl: HTMLDivElement;\nlet panelContent: HTMLDivElement;\nlet modeBtns: HTMLButtonElement[] = [];\n\n// Selection visual (THREE.js object in scene)\nlet selectionVisual: any = null;\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// UNDO / REDO\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nconst undoStack: any[] = [];\nconst redoStack: any[] = [];\nconst MAX_UNDO = 50;\n\nfunction snapshotState() {\n  return {\n    obstacles: JSON.parse(JSON.stringify(OBSTACLES)),\n    pits: JSON.parse(JSON.stringify(PITS)),\n    physicsObjects: gameStateRef.physicsObjects.map((o: PhysicsObject) => ({\n      meshType: o.meshType,\n      material: o.material,\n      x: o.pos.x,\n      z: o.pos.z,\n      mass: o.mass,\n      health: o.health,\n      radius: o.radius,\n      scale: o.scale,\n    })),\n    selectedType,\n    selectedIdx,\n  };\n}\n\nfunction pushUndo() {\n  undoStack.push(snapshotState());\n  if (undoStack.length > MAX_UNDO) undoStack.shift();\n  redoStack.length = 0;\n}\n\nfunction applySnapshot(snap: any) {\n  OBSTACLES.length = 0;\n  for (const o of snap.obstacles) OBSTACLES.push(o);\n  PITS.length = 0;\n  for (const p of snap.pits) PITS.push(p);\n  // Rebuild physics objects from snapshot\n  clearPhysicsObjects(gameStateRef, sceneRef);\n  for (const p of snap.physicsObjects) {\n    const obj = createPhysicsObject(p);\n    createPhysicsObjectMesh(obj, sceneRef);\n    gameStateRef.physicsObjects.push(obj);\n  }\n  selectedType = snap.selectedType;\n  selectedIdx = snap.selectedIdx;\n  onArenaChanged();\n  updateSelectionVisuals();\n  updatePropertyPanel();\n}\n\nfunction undo() {\n  if (undoStack.length === 0) return;\n  redoStack.push(snapshotState());\n  applySnapshot(undoStack.pop());\n}\n\nfunction redo() {\n  if (redoStack.length === 0) return;\n  undoStack.push(snapshotState());\n  applySnapshot(redoStack.pop());\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// EXPORT / IMPORT\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction exportRoomJSON(): void {\n  const room = {\n    name: 'Exported Room',\n    arenaHalfX: ARENA_HALF_X,\n    arenaHalfZ: ARENA_HALF_Z,\n    obstacles: OBSTACLES.map(o => ({ ...o })),\n    pits: PITS.map(p => ({ ...p })),\n    physicsObjects: gameStateRef.physicsObjects.map((obj: any) => ({\n      meshType: obj.meshType,\n      material: obj.material,\n      x: obj.pos.x,\n      z: obj.pos.z,\n      mass: obj.mass,\n      health: obj.maxHealth,\n      radius: obj.radius,\n      scale: obj.scale,\n    })),\n    spawnBudget: { packs: [] },\n    playerStart: { x: 0, z: 0 },\n  };\n\n  const json = JSON.stringify(room, null, 2);\n  navigator.clipboard.writeText(json).then(() => {\n    // Brief confirmation flash in the title bar\n    const titleSpan = barEl.querySelector('span');\n    if (titleSpan) {\n      const original = titleSpan.textContent;\n      titleSpan.textContent = 'COPIED! \u2014 ';\n      setTimeout(() => { titleSpan.textContent = original; }, 1200);\n    }\n  });\n}\n\nfunction importRoomJSON(): void {\n  const json = window.prompt('Paste room JSON:');\n  if (!json) return;\n\n  let room: any;\n  try {\n    room = JSON.parse(json);\n  } catch {\n    window.alert('Invalid JSON');\n    return;\n  }\n\n  pushUndo();\n\n  // Replace obstacles\n  OBSTACLES.length = 0;\n  if (Array.isArray(room.obstacles)) {\n    for (const o of room.obstacles) OBSTACLES.push(o);\n  }\n\n  // Replace pits\n  PITS.length = 0;\n  if (Array.isArray(room.pits)) {\n    for (const p of room.pits) PITS.push(p);\n  }\n\n  // Replace physics objects\n  clearPhysicsObjects(gameStateRef, sceneRef);\n  if (Array.isArray(room.physicsObjects)) {\n    for (const p of room.physicsObjects) {\n      const obj = createPhysicsObject(p);\n      createPhysicsObjectMesh(obj, sceneRef);\n      gameStateRef.physicsObjects.push(obj);\n    }\n  }\n\n  selectedType = null;\n  selectedIdx = -1;\n  onArenaChanged();\n  updateSelectionVisuals();\n  updatePropertyPanel();\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// BEND PREVIEW\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction updateBendSelectorHighlight(): void {\n  const btns = bendSelectorEl.querySelectorAll('button');\n  btns.forEach((btn: any) => {\n    btn.style.background = btn.dataset.bendId === selectedBendId ? '#336699' : '';\n  });\n}\n\nfunction toggleBendPreview(): void {\n  bendPreviewActive = !bendPreviewActive;\n  if (bendPreviewActive) {\n    bendPreviewSystem = createBendSystem(99);\n    bendPreviewBtn.textContent = 'Preview ON';\n    bendPreviewBtn.style.background = '#228844';\n    bendSelectorEl.style.display = 'flex';\n    updateBendSelectorHighlight();\n  } else {\n    // Reset all preview bends\n    if (bendPreviewSystem) {\n      bendPreviewSystem.resetAll();\n      // Restore visuals on all physics objects\n      for (const obj of gameStateRef.physicsObjects) {\n        clearBendVisuals(obj);\n      }\n      bendPreviewSystem = null;\n    }\n    bendPreviewBtn.textContent = 'Preview Bends';\n    bendPreviewBtn.style.background = '';\n    bendSelectorEl.style.display = 'none';\n  }\n}\n\nfunction applyBendPreviewToTarget(ndc: { x: number; y: number }): boolean {\n  if (!bendPreviewActive || !bendPreviewSystem) return false;\n\n  // Only apply to physics objects \u2014 raycast scene to find one\n  const camera = getCamera();\n  const raycaster = new THREE.Raycaster();\n  raycaster.setFromCamera(new THREE.Vector2(ndc.x, ndc.y), camera);\n\n  for (const obj of gameStateRef.physicsObjects) {\n    if (!obj.mesh || obj.destroyed) continue;\n    const intersects = raycaster.intersectObject(obj.mesh, true);\n    if (intersects.length > 0) {\n      const bend = getBendById(selectedBendId);\n      if (!bend) return false;\n      const result = bendPreviewSystem.applyBend(selectedBendId, 'physicsObject', obj);\n      if (result.success) {\n        applyBendVisuals(obj, bend.tintColor);\n      }\n      return true; // consumed the click\n    }\n  }\n  return false;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// HELPERS\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction onArenaChanged() {\n  rebuildArenaVisuals();\n  invalidateCollisionBounds();\n}\n\nfunction snap(v: number): number {\n  return Math.round(v * 2) / 2;\n}\n\nfunction mouseToWorld(mouseNDC: { x: number; y: number }): { x: number; z: number } {\n  const raycaster = new THREE.Raycaster();\n  const ndc = new THREE.Vector2(mouseNDC.x, mouseNDC.y);\n  raycaster.setFromCamera(ndc, getCamera());\n  const plane = new THREE.Plane(new THREE.Vector3(0, 1, 0), 0);\n  const target = new THREE.Vector3();\n  raycaster.ray.intersectPlane(plane, target);\n  return { x: target.x, z: target.z };\n}\n\nfunction clientToNDC(e: MouseEvent): { x: number; y: number } {\n  return {\n    x: (e.clientX / window.innerWidth) * 2 - 1,\n    y: -(e.clientY / window.innerHeight) * 2 + 1,\n  };\n}\n\nfunction clearChildren(el: HTMLElement) {\n  while (el.firstChild) el.removeChild(el.firstChild);\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// SELECTION VISUALS\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction clearSelectionVisual() {\n  if (selectionVisual) {\n    sceneRef.remove(selectionVisual);\n    selectionVisual.traverse((child: any) => {\n      if (child.geometry) child.geometry.dispose();\n      if (child.material) child.material.dispose();\n    });\n    selectionVisual = null;\n  }\n}\n\nfunction updateSelectionVisuals() {\n  clearSelectionVisual();\n  clearHandles();\n\n  // Orange outline in resize mode, green in normal mode\n  const outlineColor = resizeMode ? 0xff8844 : 0x44ff44;\n\n  if (selectedType === 'obstacle' && selectedIdx >= 0 && selectedIdx < OBSTACLES.length) {\n    const o = OBSTACLES[selectedIdx];\n    const geo = new THREE.BoxGeometry(o.w, o.h, o.d);\n    const edges = new THREE.EdgesGeometry(geo);\n    const mat = new THREE.LineBasicMaterial({ color: outlineColor });\n    const lines = new THREE.LineSegments(edges, mat);\n    lines.position.set(o.x, o.h / 2, o.z);\n    sceneRef.add(lines);\n    selectionVisual = lines;\n    geo.dispose();\n    showHandles(o, 'obstacle');\n  } else if (selectedType === 'physics' && selectedIdx >= 0 && selectedIdx < gameStateRef.physicsObjects.length) {\n    const obj = gameStateRef.physicsObjects[selectedIdx];\n    const r = obj.radius;\n    const ringGeo = new THREE.RingGeometry(r - 0.05, r + 0.05, 32);\n    const mat = new THREE.LineBasicMaterial({ color: outlineColor });\n    const ring = new THREE.Mesh(ringGeo, mat);\n    ring.rotation.x = -Math.PI / 2;\n    ring.position.set(obj.pos.x, 0.05, obj.pos.z);\n    sceneRef.add(ring);\n    selectionVisual = ring;\n  } else if (selectedType === 'pit' && selectedIdx >= 0 && selectedIdx < PITS.length) {\n    const p = PITS[selectedIdx];\n    const geo = new THREE.BoxGeometry(p.w, 0.2, p.d);\n    const edges = new THREE.EdgesGeometry(geo);\n    const mat = new THREE.LineBasicMaterial({ color: outlineColor });\n    const lines = new THREE.LineSegments(edges, mat);\n    lines.position.set(p.x, 0.1, p.z);\n    sceneRef.add(lines);\n    selectionVisual = lines;\n    geo.dispose();\n    showHandles(p, 'pit');\n  } else {\n    // Nothing selected \u2014 show dimmed handles on ALL terrain so it's clear they're editable\n    showAllHandles(OBSTACLES, PITS);\n  }\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PROPERTY PANEL (Task 10)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction addNumberField(\n  container: HTMLElement, label: string, value: number,\n  onChange: (v: number) => void, min?: number, max?: number, step?: number\n): void {\n  const row = document.createElement('div');\n  row.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin:4px 0';\n  const lbl = document.createElement('label');\n  lbl.textContent = label;\n  lbl.style.cssText = 'color:#ccc;font-size:12px';\n  const inp = document.createElement('input');\n  inp.type = 'number';\n  inp.value = String(value);\n  inp.style.cssText = 'width:70px;background:#333;color:#fff;border:1px solid #555;padding:2px 4px;font-size:12px';\n  if (min !== undefined) inp.min = String(min);\n  if (max !== undefined) inp.max = String(max);\n  if (step !== undefined) inp.step = String(step);\n  inp.addEventListener('change', () => {\n    pushUndo();\n    onChange(parseFloat(inp.value));\n    updateSelectionVisuals();\n  });\n  row.appendChild(lbl);\n  row.appendChild(inp);\n  container.appendChild(row);\n}\n\nfunction addDropdown(\n  container: HTMLElement, label: string, value: string,\n  options: string[], onChange: (v: string) => void\n): void {\n  const row = document.createElement('div');\n  row.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin:4px 0';\n  const lbl = document.createElement('label');\n  lbl.textContent = label;\n  lbl.style.cssText = 'color:#ccc;font-size:12px';\n  const sel = document.createElement('select');\n  sel.style.cssText = 'width:80px;background:#333;color:#fff;border:1px solid #555;padding:2px 4px;font-size:12px';\n  for (const opt of options) {\n    const o = document.createElement('option');\n    o.value = opt;\n    o.textContent = opt;\n    if (opt === value) o.selected = true;\n    sel.appendChild(o);\n  }\n  sel.addEventListener('change', () => {\n    pushUndo();\n    onChange(sel.value);\n    updateSelectionVisuals();\n  });\n  row.appendChild(lbl);\n  row.appendChild(sel);\n  container.appendChild(row);\n}\n\nfunction addCheckbox(\n  container: HTMLElement, label: string, checked: boolean,\n  onChange: (v: boolean) => void\n): void {\n  const row = document.createElement('div');\n  row.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin:4px 0';\n  const lbl = document.createElement('label');\n  lbl.textContent = label;\n  lbl.style.cssText = 'color:#ccc;font-size:12px';\n  const inp = document.createElement('input');\n  inp.type = 'checkbox';\n  inp.checked = checked;\n  inp.style.cssText = 'accent-color:#4f4';\n  inp.addEventListener('change', () => {\n    pushUndo();\n    onChange(inp.checked);\n    // Rebuild panel to show/hide conditional fields\n    updatePropertyPanel();\n    updateSelectionVisuals();\n  });\n  row.appendChild(lbl);\n  row.appendChild(inp);\n  container.appendChild(row);\n}\n\nfunction addSectionHeader(container: HTMLElement, text: string): void {\n  const h = document.createElement('div');\n  h.textContent = text;\n  h.style.cssText = 'color:#4f4;font-size:13px;font-weight:bold;margin:8px 0 4px;border-bottom:1px solid #444;padding-bottom:2px';\n  container.appendChild(h);\n}\n\nfunction rebuildPhysicsObjectMesh(obj: PhysicsObject) {\n  if (obj.mesh) {\n    sceneRef.remove(obj.mesh);\n    obj.mesh.traverse((child: any) => {\n      if (child.geometry) child.geometry.dispose();\n      if (child.material) child.material.dispose();\n    });\n    obj.mesh = null;\n  }\n  createPhysicsObjectMesh(obj, sceneRef);\n}\n\nfunction updatePropertyPanel() {\n  clearChildren(panelContent);\n\n  if (selectedType === 'obstacle' && selectedIdx >= 0 && selectedIdx < OBSTACLES.length) {\n    const o = OBSTACLES[selectedIdx];\n    addSectionHeader(panelContent, 'Obstacle');\n\n    addNumberField(panelContent, 'X', o.x, (v) => { o.x = v; onArenaChanged(); }, undefined, undefined, 0.5);\n    addNumberField(panelContent, 'Z', o.z, (v) => { o.z = v; onArenaChanged(); }, undefined, undefined, 0.5);\n    addNumberField(panelContent, 'Width', o.w, (v) => { o.w = v; onArenaChanged(); }, 0.5, undefined, 0.5);\n    addNumberField(panelContent, 'Height', o.h, (v) => { o.h = v; onArenaChanged(); }, 0.5, undefined, 0.5);\n    addNumberField(panelContent, 'Depth', o.d, (v) => { o.d = v; onArenaChanged(); }, 0.5, undefined, 0.5);\n\n    addCheckbox(panelContent, 'Destructible', !!o.destructible, (v) => {\n      o.destructible = v;\n      if (v && !o.health) {\n        o.health = 50;\n        o.maxHealth = 50;\n      }\n      onArenaChanged();\n    });\n\n    if (o.destructible) {\n      addNumberField(panelContent, 'Health', o.health ?? 50, (v) => {\n        o.health = v;\n        o.maxHealth = v;\n        onArenaChanged();\n      }, 1, undefined, 1);\n    }\n\n    addDropdown(panelContent, 'Material', o.material || 'stone', ['stone', 'wood', 'metal', 'ice'], (v) => {\n      o.material = v as any;\n      onArenaChanged();\n    });\n\n  } else if (selectedType === 'physics' && selectedIdx >= 0 && selectedIdx < gameStateRef.physicsObjects.length) {\n    const obj: PhysicsObject = gameStateRef.physicsObjects[selectedIdx];\n    addSectionHeader(panelContent, 'Physics Object');\n\n    addNumberField(panelContent, 'X', obj.pos.x, (v) => {\n      obj.pos.x = v;\n      if (obj.mesh) obj.mesh.position.x = v;\n    }, undefined, undefined, 0.5);\n    addNumberField(panelContent, 'Z', obj.pos.z, (v) => {\n      obj.pos.z = v;\n      if (obj.mesh) obj.mesh.position.z = v;\n    }, undefined, undefined, 0.5);\n\n    addDropdown(panelContent, 'Mesh Type', obj.meshType, ['rock', 'crate', 'barrel', 'pillar'], (v) => {\n      obj.meshType = v as any;\n      rebuildPhysicsObjectMesh(obj);\n    });\n    addDropdown(panelContent, 'Material', obj.material, ['stone', 'wood', 'metal', 'ice'], (v) => {\n      obj.material = v as any;\n      rebuildPhysicsObjectMesh(obj);\n    });\n\n    addNumberField(panelContent, 'Mass', obj.mass, (v) => { obj.mass = v; }, 0.1, 50, 0.1);\n    addNumberField(panelContent, 'Health', obj.health, (v) => {\n      obj.health = v;\n      obj.maxHealth = v;\n    }, 1, 9999, 1);\n    addNumberField(panelContent, 'Radius', obj.radius, (v) => {\n      obj.radius = v;\n      rebuildPhysicsObjectMesh(obj);\n    }, 0.1, 5, 0.1);\n\n  } else if (selectedType === 'pit' && selectedIdx >= 0 && selectedIdx < PITS.length) {\n    const p = PITS[selectedIdx];\n    addSectionHeader(panelContent, 'Pit');\n\n    addNumberField(panelContent, 'X', p.x, (v) => { p.x = v; onArenaChanged(); }, undefined, undefined, 0.5);\n    addNumberField(panelContent, 'Z', p.z, (v) => { p.z = v; onArenaChanged(); }, undefined, undefined, 0.5);\n    addNumberField(panelContent, 'Width', p.w, (v) => { p.w = v; onArenaChanged(); }, 0.5, undefined, 0.5);\n    addNumberField(panelContent, 'Depth', p.d, (v) => { p.d = v; onArenaChanged(); }, 0.5, undefined, 0.5);\n\n  } else {\n    const hint = document.createElement('div');\n    hint.textContent = 'Click to place or select';\n    hint.style.cssText = 'color:#666;font-size:11px;text-align:center;margin-top:20px';\n    panelContent.appendChild(hint);\n  }\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// HIT TESTING (Task 9)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction hitTestPhysics(wx: number, wz: number): number {\n  for (let i = 0; i < gameStateRef.physicsObjects.length; i++) {\n    const obj = gameStateRef.physicsObjects[i];\n    if (obj.destroyed) continue;\n    const dx = wx - obj.pos.x;\n    const dz = wz - obj.pos.z;\n    if (dx * dx + dz * dz < obj.radius * obj.radius) return i;\n  }\n  return -1;\n}\n\nfunction hitTestObstacle(wx: number, wz: number): number {\n  for (let i = 0; i < OBSTACLES.length; i++) {\n    const o = OBSTACLES[i];\n    if (Math.abs(wx - o.x) < o.w / 2 && Math.abs(wz - o.z) < o.d / 2) return i;\n  }\n  return -1;\n}\n\n/** 3D ray-box hit test for obstacles \u2014 works regardless of which face you click */\nfunction hitTestObstacle3D(ndc: { x: number; y: number }): number {\n  const camera = getCamera();\n  const raycaster = new THREE.Raycaster();\n  raycaster.setFromCamera(new THREE.Vector2(ndc.x, ndc.y), camera);\n  const ray = raycaster.ray;\n\n  let bestDist = Infinity;\n  let bestIdx = -1;\n\n  for (let i = 0; i < OBSTACLES.length; i++) {\n    const o = OBSTACLES[i];\n    const box = new THREE.Box3(\n      new THREE.Vector3(o.x - o.w / 2, 0, o.z - o.d / 2),\n      new THREE.Vector3(o.x + o.w / 2, o.h, o.z + o.d / 2),\n    );\n    const hit = ray.intersectBox(box, new THREE.Vector3());\n    if (hit) {\n      const dist = hit.distanceTo(ray.origin);\n      if (dist < bestDist) {\n        bestDist = dist;\n        bestIdx = i;\n      }\n    }\n  }\n  return bestIdx;\n}\n\nfunction hitTestPit(wx: number, wz: number): number {\n  for (let i = 0; i < PITS.length; i++) {\n    const p = PITS[i];\n    if (Math.abs(wx - p.x) < p.w / 2 && Math.abs(wz - p.z) < p.d / 2) return i;\n  }\n  return -1;\n}\n\ninterface HitResult { type: 'obstacle' | 'physics' | 'pit'; idx: number }\n\nfunction hitTestAll3D(ndc: { x: number; y: number }, wx: number, wz: number): HitResult | null {\n  // Search current mode first, then others\n  const order: Array<'obstacle' | 'physics' | 'pit'> =\n    mode === 'obstacle' ? ['obstacle', 'physics', 'pit'] :\n    mode === 'physics'  ? ['physics', 'obstacle', 'pit'] :\n                          ['pit', 'obstacle', 'physics'];\n\n  for (const t of order) {\n    let idx = -1;\n    if (t === 'obstacle') idx = hitTestObstacle3D(ndc);\n    else if (t === 'physics') idx = hitTestPhysics(wx, wz);\n    else idx = hitTestPit(wx, wz);\n    if (idx >= 0) return { type: t, idx };\n  }\n  return null;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PLACEMENT (Task 9)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction placeNewObject(wx: number, wz: number) {\n  const sx = snap(wx);\n  const sz = snap(wz);\n\n  if (mode === 'obstacle') {\n    pushUndo();\n    OBSTACLES.push({ x: sx, z: sz, w: 2, h: 2, d: 2 });\n    selectedType = 'obstacle';\n    selectedIdx = OBSTACLES.length - 1;\n    onArenaChanged();\n  } else if (mode === 'physics') {\n    pushUndo();\n    const placement: PhysicsObjectPlacement = {\n      meshType: 'rock', material: 'stone',\n      x: sx, z: sz,\n      mass: 2.0, health: 9999, radius: 0.8,\n    };\n    const obj = createPhysicsObject(placement);\n    createPhysicsObjectMesh(obj, sceneRef);\n    gameStateRef.physicsObjects.push(obj);\n    selectedType = 'physics';\n    selectedIdx = gameStateRef.physicsObjects.length - 1;\n  } else if (mode === 'pit') {\n    pushUndo();\n    PITS.push({ x: sx, z: sz, w: 3, d: 3 });\n    selectedType = 'pit';\n    selectedIdx = PITS.length - 1;\n    onArenaChanged();\n  }\n\n  updateSelectionVisuals();\n  updatePropertyPanel();\n}\n\nfunction deleteSelected() {\n  if (selectedType === null || selectedIdx < 0) return;\n  pushUndo();\n\n  if (selectedType === 'obstacle' && selectedIdx < OBSTACLES.length) {\n    OBSTACLES.splice(selectedIdx, 1);\n    onArenaChanged();\n  } else if (selectedType === 'physics' && selectedIdx < gameStateRef.physicsObjects.length) {\n    const obj = gameStateRef.physicsObjects[selectedIdx];\n    if (obj.mesh) {\n      sceneRef.remove(obj.mesh);\n      obj.mesh.traverse((child: any) => {\n        if (child.geometry) child.geometry.dispose();\n        if (child.material) child.material.dispose();\n      });\n    }\n    gameStateRef.physicsObjects.splice(selectedIdx, 1);\n  } else if (selectedType === 'pit' && selectedIdx < PITS.length) {\n    PITS.splice(selectedIdx, 1);\n    onArenaChanged();\n  }\n\n  selectedType = null;\n  selectedIdx = -1;\n  updateSelectionVisuals();\n  updatePropertyPanel();\n}\n\nfunction deleteNearest(wx: number, wz: number) {\n  let bestDist = 3.0;\n  let bestType: 'obstacle' | 'physics' | 'pit' | null = null;\n  let bestIdx = -1;\n\n  for (let i = 0; i < OBSTACLES.length; i++) {\n    const o = OBSTACLES[i];\n    const d = Math.sqrt((wx - o.x) ** 2 + (wz - o.z) ** 2);\n    if (d < bestDist) { bestDist = d; bestType = 'obstacle'; bestIdx = i; }\n  }\n  for (let i = 0; i < gameStateRef.physicsObjects.length; i++) {\n    const o = gameStateRef.physicsObjects[i];\n    if (o.destroyed) continue;\n    const d = Math.sqrt((wx - o.pos.x) ** 2 + (wz - o.pos.z) ** 2);\n    if (d < bestDist) { bestDist = d; bestType = 'physics'; bestIdx = i; }\n  }\n  for (let i = 0; i < PITS.length; i++) {\n    const p = PITS[i];\n    const d = Math.sqrt((wx - p.x) ** 2 + (wz - p.z) ** 2);\n    if (d < bestDist) { bestDist = d; bestType = 'pit'; bestIdx = i; }\n  }\n\n  if (bestType === null) return;\n\n  // Select, then delete\n  selectedType = bestType;\n  selectedIdx = bestIdx;\n  deleteSelected();\n}\n\nfunction duplicateSelected() {\n  if (selectedType === null || selectedIdx < 0) return;\n  pushUndo();\n\n  if (selectedType === 'obstacle' && selectedIdx < OBSTACLES.length) {\n    const src = OBSTACLES[selectedIdx];\n    const copy: Obstacle = { ...src, x: src.x + 1 };\n    if (copy.health !== undefined) copy.maxHealth = copy.health;\n    OBSTACLES.push(copy);\n    selectedIdx = OBSTACLES.length - 1;\n    onArenaChanged();\n  } else if (selectedType === 'physics' && selectedIdx < gameStateRef.physicsObjects.length) {\n    const src = gameStateRef.physicsObjects[selectedIdx];\n    const placement: PhysicsObjectPlacement = {\n      meshType: src.meshType, material: src.material,\n      x: src.pos.x + 1, z: src.pos.z,\n      mass: src.mass, health: src.health, radius: src.radius,\n      scale: src.scale,\n    };\n    const obj = createPhysicsObject(placement);\n    createPhysicsObjectMesh(obj, sceneRef);\n    gameStateRef.physicsObjects.push(obj);\n    selectedIdx = gameStateRef.physicsObjects.length - 1;\n  } else if (selectedType === 'pit' && selectedIdx < PITS.length) {\n    const src = PITS[selectedIdx];\n    PITS.push({ ...src, x: src.x + 1 });\n    selectedIdx = PITS.length - 1;\n    onArenaChanged();\n  }\n\n  updateSelectionVisuals();\n  updatePropertyPanel();\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// HANDLE RESIZE (Task 11)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nconst MIN_DIM = 0.5;\n\nfunction resizeWithHandle(handle: { axis: 'x' | 'z' | 'y'; sign: 1 | -1 }, ndc: { x: number; y: number }): void {\n  if (handle.axis === 'x' || handle.axis === 'z') {\n    // Ground-plane raycasting for X/Z resize\n    const w = mouseToWorld(ndc);\n\n    if (handle.axis === 'x') {\n      if (selectedType === 'obstacle' && selectedIdx >= 0 && selectedIdx < OBSTACLES.length) {\n        const o = OBSTACLES[selectedIdx];\n        const fixedEdge = o.x - handle.sign * o.w / 2;\n        const rawEdge = snap(w.x);\n        // Clamp so dragged edge can't cross the fixed edge\n        const newEdge = handle.sign > 0 ? Math.max(fixedEdge + MIN_DIM, rawEdge) : Math.min(fixedEdge - MIN_DIM, rawEdge);\n        const newW = Math.abs(newEdge - fixedEdge);\n        o.x = fixedEdge + handle.sign * newW / 2;\n        o.w = newW;\n        onArenaChanged();\n        updateHandlePositions(o, 'obstacle');\n      } else if (selectedType === 'pit' && selectedIdx >= 0 && selectedIdx < PITS.length) {\n        const p = PITS[selectedIdx];\n        const fixedEdge = p.x - handle.sign * p.w / 2;\n        const rawEdge = snap(w.x);\n        const newEdge = handle.sign > 0 ? Math.max(fixedEdge + MIN_DIM, rawEdge) : Math.min(fixedEdge - MIN_DIM, rawEdge);\n        const newW = Math.abs(newEdge - fixedEdge);\n        p.x = fixedEdge + handle.sign * newW / 2;\n        p.w = newW;\n        onArenaChanged();\n        updateHandlePositions(p, 'pit');\n      }\n    } else {\n      // axis === 'z'\n      if (selectedType === 'obstacle' && selectedIdx >= 0 && selectedIdx < OBSTACLES.length) {\n        const o = OBSTACLES[selectedIdx];\n        const fixedEdge = o.z - handle.sign * o.d / 2;\n        const rawEdge = snap(w.z);\n        const newEdge = handle.sign > 0 ? Math.max(fixedEdge + MIN_DIM, rawEdge) : Math.min(fixedEdge - MIN_DIM, rawEdge);\n        const newD = Math.abs(newEdge - fixedEdge);\n        o.z = fixedEdge + handle.sign * newD / 2;\n        o.d = newD;\n        onArenaChanged();\n        updateHandlePositions(o, 'obstacle');\n      } else if (selectedType === 'pit' && selectedIdx >= 0 && selectedIdx < PITS.length) {\n        const p = PITS[selectedIdx];\n        const fixedEdge = p.z - handle.sign * p.d / 2;\n        const rawEdge = snap(w.z);\n        const newEdge = handle.sign > 0 ? Math.max(fixedEdge + MIN_DIM, rawEdge) : Math.min(fixedEdge - MIN_DIM, rawEdge);\n        const newD = Math.abs(newEdge - fixedEdge);\n        p.z = fixedEdge + handle.sign * newD / 2;\n        p.d = newD;\n        onArenaChanged();\n        updateHandlePositions(p, 'pit');\n      }\n    }\n  } else if (handle.axis === 'y' && selectedType === 'obstacle') {\n    // Camera-facing vertical plane for height resize\n    const o = OBSTACLES[selectedIdx];\n    const camera = getCamera();\n    const cameraDir = new THREE.Vector3(0, 0, -1).applyQuaternion(camera.quaternion).normalize();\n    const handlePos = new THREE.Vector3(o.x, o.h, o.z);\n    const plane = new THREE.Plane().setFromNormalAndCoplanarPoint(cameraDir, handlePos);\n\n    const raycaster = new THREE.Raycaster();\n    raycaster.setFromCamera(new THREE.Vector2(ndc.x, ndc.y), camera);\n    const intersection = new THREE.Vector3();\n    if (raycaster.ray.intersectPlane(plane, intersection)) {\n      const newH = Math.max(MIN_DIM, snap(intersection.y));\n      o.h = newH;\n      onArenaChanged();\n      updateHandlePositions(o, 'obstacle');\n    }\n  }\n\n  // Update green selection outline to match new size\n  clearSelectionVisual();\n  if (selectedType === 'obstacle' && selectedIdx >= 0 && selectedIdx < OBSTACLES.length) {\n    const o = OBSTACLES[selectedIdx];\n    const geo = new THREE.BoxGeometry(o.w, o.h, o.d);\n    const edges = new THREE.EdgesGeometry(geo);\n    const mat = new THREE.LineBasicMaterial({ color: 0x44ff44 });\n    const lines = new THREE.LineSegments(edges, mat);\n    lines.position.set(o.x, o.h / 2, o.z);\n    sceneRef.add(lines);\n    selectionVisual = lines;\n    geo.dispose();\n  } else if (selectedType === 'pit' && selectedIdx >= 0 && selectedIdx < PITS.length) {\n    const p = PITS[selectedIdx];\n    const geo = new THREE.BoxGeometry(p.w, 0.2, p.d);\n    const edges = new THREE.EdgesGeometry(geo);\n    const mat = new THREE.LineBasicMaterial({ color: 0x44ff44 });\n    const lines = new THREE.LineSegments(edges, mat);\n    lines.position.set(p.x, 0.1, p.z);\n    sceneRef.add(lines);\n    selectionVisual = lines;\n    geo.dispose();\n  }\n\n  updatePropertyPanel();\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// MOUSE HANDLERS (Task 9)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction onMouseDown(e: MouseEvent) {\n  if (!active) return;\n\n  const ndc = clientToNDC(e);\n  const w = mouseToWorld(ndc);\n\n  // Right-click or shift+click: delete nearest\n  if (e.button === 2 || (e.button === 0 && e.shiftKey)) {\n    e.preventDefault();\n    deleteNearest(w.x, w.z);\n    return;\n  }\n\n  if (e.button !== 0) return;\n\n  // Check resize handles first (before normal selection)\n  if (raycastHandles(ndc)) {\n    handleUndoPushed = false;\n    return;\n  }\n\n  // Bend preview mode \u2014 click to apply bend to physics object\n  if (applyBendPreviewToTarget(ndc)) {\n    return;\n  }\n\n  // Try to select existing object (3D ray-box for obstacles \u2014 click any visible face)\n  const hit = hitTestAll3D(ndc, w.x, w.z);\n  if (hit) {\n    // In resize mode: if clicking the already-selected obstacle/pit, grab nearest handle\n    if (resizeMode && hit.type === selectedType && hit.idx === selectedIdx\n        && (hit.type === 'obstacle' || hit.type === 'pit')) {\n      if (grabNearestHandle(w.x, w.z)) {\n        handleUndoPushed = false;\n        return;\n      }\n    }\n    selectedType = hit.type;\n    selectedIdx = hit.idx;\n    isDragging = true;\n    dragStarted = false;\n    dragUndoPushed = false;\n    dragStartWorld = { x: w.x, z: w.z };\n    updateSelectionVisuals();\n    updatePropertyPanel();\n  } else {\n    // Click on empty space \u2014 deselect and show all handles\n    selectedType = null;\n    selectedIdx = -1;\n    updateSelectionVisuals();\n    updatePropertyPanel();\n  }\n}\n\nfunction onMouseMove(e: MouseEvent) {\n  if (!active) return;\n\n  const ndc = clientToNDC(e);\n  lastMouseNDC.x = ndc.x;\n  lastMouseNDC.y = ndc.y;\n\n  // Handle resize drag\n  const handle = getGrabbedHandle();\n  if (handle) {\n    if (!handleUndoPushed) {\n      pushUndo();\n      handleUndoPushed = true;\n    }\n    resizeWithHandle(handle, ndc);\n    return;\n  }\n\n  if (!isDragging) return;\n\n  const w = mouseToWorld(ndc);\n\n  if (!dragStarted && dragStartWorld) {\n    const dx = w.x - dragStartWorld.x;\n    const dz = w.z - dragStartWorld.z;\n    if (Math.sqrt(dx * dx + dz * dz) < 0.5) return;\n    dragStarted = true;\n  }\n\n  if (!dragStarted) return;\n\n  // Push undo on first real drag movement\n  if (!dragUndoPushed) {\n    pushUndo();\n    dragUndoPushed = true;\n  }\n\n  const sx = snap(w.x);\n  const sz = snap(w.z);\n\n  if (selectedType === 'obstacle' && selectedIdx >= 0 && selectedIdx < OBSTACLES.length) {\n    OBSTACLES[selectedIdx].x = sx;\n    OBSTACLES[selectedIdx].z = sz;\n    onArenaChanged();\n  } else if (selectedType === 'physics' && selectedIdx >= 0 && selectedIdx < gameStateRef.physicsObjects.length) {\n    const obj = gameStateRef.physicsObjects[selectedIdx];\n    obj.pos.x = sx;\n    obj.pos.z = sz;\n    if (obj.mesh) {\n      obj.mesh.position.x = sx;\n      obj.mesh.position.z = sz;\n    }\n  } else if (selectedType === 'pit' && selectedIdx >= 0 && selectedIdx < PITS.length) {\n    PITS[selectedIdx].x = sx;\n    PITS[selectedIdx].z = sz;\n    onArenaChanged();\n  }\n\n  updateSelectionVisuals();\n  updatePropertyPanel();\n}\n\nfunction onMouseUp(_e: MouseEvent) {\n  if (!active) return;\n\n  // Finalize handle resize\n  if (getGrabbedHandle()) {\n    releaseHandle();\n    onArenaChanged();\n    updateSelectionVisuals();\n    updatePropertyPanel();\n  }\n\n  isDragging = false;\n  dragStarted = false;\n  dragStartWorld = null;\n  dragUndoPushed = false;\n}\n\nfunction onContextMenu(e: MouseEvent) {\n  if (active) e.preventDefault();\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// KEYBOARD HANDLER\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction onKeyDown(e: KeyboardEvent) {\n  if (!active) return;\n\n  // Toggle off with Shift+Backquote\n  if (e.code === 'Backquote' && e.shiftKey) {\n    e.preventDefault();\n    toggleLevelEditor();\n    return;\n  }\n\n  // Mode switching\n  if (e.code === 'Digit1') { setMode('obstacle'); return; }\n  if (e.code === 'Digit2') { setMode('physics'); return; }\n  if (e.code === 'Digit3') { setMode('pit'); return; }\n\n  // Delete selected\n  if (e.code === 'Delete' || e.code === 'Backspace') {\n    e.preventDefault();\n    deleteSelected();\n    return;\n  }\n\n  // Duplicate\n  if (e.code === 'KeyD' && !e.ctrlKey && !e.metaKey) {\n    duplicateSelected();\n    return;\n  }\n\n  // Undo/Redo\n  if ((e.ctrlKey || e.metaKey) && e.code === 'KeyZ' && !e.shiftKey) {\n    e.preventDefault();\n    undo();\n    return;\n  }\n  if ((e.ctrlKey || e.metaKey) && (e.code === 'KeyY' || (e.code === 'KeyZ' && e.shiftKey))) {\n    e.preventDefault();\n    redo();\n    return;\n  }\n\n  // R \u2014 toggle resize mode\n  if (e.code === 'KeyR') {\n    resizeMode = !resizeMode;\n    setResizeMode(resizeMode);\n    updateSelectionVisuals();\n    return;\n  }\n\n  // Quick-place 1\u00D71\u00D71 block at cursor position\n  if (e.code === 'KeyB') {\n    pushUndo();\n    const w = mouseToWorld(lastMouseNDC);\n    OBSTACLES.push({ x: snap(w.x), z: snap(w.z), w: 1, h: 1, d: 1 });\n    selectedType = 'obstacle';\n    selectedIdx = OBSTACLES.length - 1;\n    onArenaChanged();\n    updateSelectionVisuals();\n    updatePropertyPanel();\n    return;\n  }\n\n  // Escape \u2014 deselect\n  if (e.code === 'Escape') {\n    selectedType = null;\n    selectedIdx = -1;\n    updateSelectionVisuals();\n    updatePropertyPanel();\n    return;\n  }\n}\n\n// Global listener for Shift+Backquote to toggle editor ON (even when inactive)\nfunction onGlobalKeyDown(e: KeyboardEvent) {\n  if (e.code === 'Backquote' && e.shiftKey) {\n    e.preventDefault();\n    toggleLevelEditor();\n  }\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// MODE SWITCHING\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction setMode(m: 'obstacle' | 'physics' | 'pit') {\n  mode = m;\n  updateModeBar();\n}\n\nfunction updateModeBar() {\n  const labels = ['obstacle', 'physics', 'pit'];\n  for (let i = 0; i < modeBtns.length; i++) {\n    if (labels[i] === mode) {\n      modeBtns[i].classList.add('active');\n    } else {\n      modeBtns[i].classList.remove('active');\n    }\n  }\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// ACTIVATE / DEACTIVATE\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction enterEditor() {\n  active = true;\n  previousPhase = gameStateRef.phase;\n  gameStateRef.phase = 'editorPaused';\n\n  // Reset selection \u2014 show all handles on entry\n  selectedType = null;\n  selectedIdx = -1;\n\n  barEl.style.display = 'block';\n  panelEl.style.display = 'block';\n  updateModeBar();\n  updateSelectionVisuals();\n  updatePropertyPanel();\n\n  window.addEventListener('mousedown', onMouseDown);\n  window.addEventListener('mousemove', onMouseMove);\n  window.addEventListener('mouseup', onMouseUp);\n  window.addEventListener('contextmenu', onContextMenu);\n  window.addEventListener('keydown', onKeyDown);\n}\n\nfunction exitEditor() {\n  active = false;\n  gameStateRef.phase = previousPhase;\n\n  barEl.style.display = 'none';\n  panelEl.style.display = 'none';\n\n  clearSelectionVisual();\n  clearHandles();\n  // Turn off resize mode if active\n  if (resizeMode) {\n    resizeMode = false;\n    setResizeMode(false);\n  }\n  // Turn off bend preview if active\n  if (bendPreviewActive) {\n    toggleBendPreview();\n  }\n  selectedType = null;\n  selectedIdx = -1;\n\n  window.removeEventListener('mousedown', onMouseDown);\n  window.removeEventListener('mousemove', onMouseMove);\n  window.removeEventListener('mouseup', onMouseUp);\n  window.removeEventListener('contextmenu', onContextMenu);\n  window.removeEventListener('keydown', onKeyDown);\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// DOM SETUP\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction injectCSS() {\n  const style = document.createElement('style');\n  style.textContent = [\n    '.level-editor-panel {',\n    '  position: fixed; right: 10px; top: 60px; width: 220px;',\n    '  background: rgba(0,0,0,0.85); color: #fff; font-family: monospace; font-size: 12px;',\n    '  padding: 10px; border-radius: 4px; z-index: 9999;',\n    '  max-height: calc(100vh - 80px); overflow-y: auto;',\n    '}',\n    '.level-editor-bar {',\n    '  position: fixed; top: 10px; left: 50%; transform: translateX(-50%);',\n    '  background: rgba(0,0,0,0.85); color: #fff; font-family: monospace; font-size: 14px;',\n    '  padding: 6px 16px; border-radius: 4px; z-index: 9999; white-space: nowrap;',\n    '}',\n    '.level-editor-bar .mode-btn {',\n    '  background: none; border: 1px solid #555; color: #888;',\n    '  padding: 2px 8px; margin: 0 2px; cursor: pointer;',\n    '  font-family: monospace; font-size: 13px; border-radius: 3px;',\n    '}',\n    '.level-editor-bar .mode-btn.active {',\n    '  border-color: #4f4; color: #4f4;',\n    '}',\n  ].join('\\n');\n  document.head.appendChild(style);\n}\n\nfunction createDOM() {\n  // Mode bar (top center)\n  barEl = document.createElement('div');\n  barEl.className = 'level-editor-bar';\n  barEl.style.display = 'none';\n\n  const titleSpan = document.createElement('span');\n  titleSpan.textContent = 'LEVEL EDITOR \\u2014 ';\n  barEl.appendChild(titleSpan);\n\n  const modeLabels = [\n    { key: '1', label: 'Obstacle', mode: 'obstacle' as const },\n    { key: '2', label: 'Physics', mode: 'physics' as const },\n    { key: '3', label: 'Pit', mode: 'pit' as const },\n  ];\n\n  modeBtns = [];\n  for (const m of modeLabels) {\n    const btn = document.createElement('button');\n    btn.className = 'mode-btn';\n    btn.textContent = m.key + ': ' + m.label;\n    btn.addEventListener('click', () => setMode(m.mode));\n    barEl.appendChild(btn);\n    modeBtns.push(btn);\n  }\n\n  // Separator + Export/Import buttons\n  const sep = document.createElement('span');\n  sep.textContent = '  |  ';\n  sep.style.opacity = '0.5';\n  barEl.appendChild(sep);\n\n  const exportBtn = document.createElement('button');\n  exportBtn.className = 'mode-btn';\n  exportBtn.textContent = 'Copy JSON';\n  exportBtn.addEventListener('click', exportRoomJSON);\n  barEl.appendChild(exportBtn);\n\n  const importBtn = document.createElement('button');\n  importBtn.className = 'mode-btn';\n  importBtn.textContent = 'Load JSON';\n  importBtn.addEventListener('click', importRoomJSON);\n  barEl.appendChild(importBtn);\n\n  // Bend preview button\n  const sep2 = document.createElement('span');\n  sep2.textContent = '  |  ';\n  sep2.style.opacity = '0.5';\n  barEl.appendChild(sep2);\n\n  bendPreviewBtn = document.createElement('button');\n  bendPreviewBtn.className = 'mode-btn';\n  bendPreviewBtn.textContent = 'Preview Bends';\n  bendPreviewBtn.addEventListener('click', toggleBendPreview);\n  barEl.appendChild(bendPreviewBtn);\n\n  // Bend selector (hidden until preview is active)\n  bendSelectorEl = document.createElement('div');\n  bendSelectorEl.style.display = 'none';\n  bendSelectorEl.style.gap = '4px';\n  for (const bend of BENDS) {\n    const btn = document.createElement('button');\n    btn.className = 'mode-btn';\n    btn.textContent = bend.icon + ' ' + bend.name;\n    btn.dataset.bendId = bend.id;\n    btn.addEventListener('click', () => {\n      selectedBendId = bend.id;\n      updateBendSelectorHighlight();\n    });\n    bendSelectorEl.appendChild(btn);\n  }\n  barEl.appendChild(bendSelectorEl);\n\n  document.body.appendChild(barEl);\n\n  // Property panel (right side)\n  panelEl = document.createElement('div');\n  panelEl.className = 'level-editor-panel';\n  panelEl.style.display = 'none';\n\n  panelContent = document.createElement('div');\n  panelEl.appendChild(panelContent);\n\n  document.body.appendChild(panelEl);\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PUBLIC API\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport function initLevelEditor(scene: any, gameState: any): void {\n  console.log('[levelEditor] initLevelEditor called');\n  sceneRef = scene;\n  gameStateRef = gameState;\n  injectCSS();\n  createDOM();\n  initHandles(scene);\n\n  // Global listener for Shift+Backquote toggle (always active)\n  window.addEventListener('keydown', onGlobalKeyDown);\n  console.log('[levelEditor] init complete \u2014 Shift+` to toggle');\n}\n\nexport function toggleLevelEditor(): void {\n  if (active) {\n    exitEditor();\n  } else {\n    // Don't open level editor while spawn editor is active\n    if (isSpawnEditorActive()) return;\n    enterEditor();\n  }\n}\n\nexport function isLevelEditorActive(): boolean {\n  return active;\n}\n\nexport function updateLevelEditor(): void {\n  // Called each frame when editor is active \u2014 used for visual updates only.\n  // Selection visuals are updated on state change, nothing needed per-frame currently.\n}\n", "// Spawn Editor \u2014 visual dev tool for placing and configuring wave spawners\n// Toggle with backtick (`) key. Pauses gameplay, click to place spawners on arena.\n// Follows tuning.js pattern: DOM panel + injected CSS, copy-to-clipboard export.\n// Two tabs: Spawn (wave/enemy editing) and Level (obstacles/pits editing).\nconsole.log('[spawnEditor] v2 loaded \u2014 tabs enabled');\n\nimport { WAVES } from '../config/waves';\nimport { ENEMY_TYPES } from '../config/enemies';\nimport { screenToWorld, getScene, setZoom, resetZoom, getCurrentFrustum, rebuildArenaVisuals } from '../engine/renderer';\nimport { getInputState, consumeInput } from '../engine/input';\nimport { startWave, resetWaveRunner } from '../engine/waveRunner';\nimport { clearEnemies } from '../entities/enemy';\nimport { releaseAllProjectiles } from '../entities/projectile';\nimport { ARENA_HALF_X, ARENA_HALF_Z, OBSTACLES, PITS } from '../config/arena';\nimport { invalidateCollisionBounds } from '../engine/physics';\nimport { toggleLevelEditor } from './levelEditor';\n\nlet sceneRef: any;\nlet gameStateRef: any;\nlet panel: any;\nlet active = false;\nlet previousPhase = 'playing';\n\n// Current tab: 'spawn' or 'level'\nlet currentTab = 'spawn';\n\n// Editor state (Spawn tab)\nconst editorState = {\n  waveIndex: 0,\n  groupIndex: 0,\n  enemyType: 'goblin',\n  selectedSpawnIdx: -1,  // index into current group's spawns, -1 = none\n};\n\n// Level editor state\nconst levelState = {\n  selectedType: null as string | null,   // 'obstacle' or 'pit'\n  selectedIdx: -1,      // index into OBSTACLES or PITS\n};\n\n// Arena preset state\nlet currentPresetName: string | null = null; // name of loaded preset, or null\n\n// Drag state\nlet isDragging = false;\nlet dragStarted = false; // true once mouse moves beyond threshold\nlet dragStartWorld: any = null;\n\n// Undo/redo stacks \u2014 stores snapshots of { waveIndex, groupIndex, spawns (deep copy) }\nconst undoStack: any[] = [];\nconst redoStack: any[] = [];\nconst MAX_UNDO = 50;\n\nfunction snapshotGroup() {\n  const wave = WAVES[editorState.waveIndex];\n  if (!wave) return null;\n  const group = wave.groups[editorState.groupIndex];\n  if (!group) return null;\n  return {\n    tab: 'spawn',\n    waveIndex: editorState.waveIndex,\n    groupIndex: editorState.groupIndex,\n    spawns: JSON.parse(JSON.stringify(group.spawns)),\n    triggerDelay: group.triggerDelay,\n    telegraphDuration: group.telegraphDuration,\n    stagger: group.stagger,\n  };\n}\n\nfunction snapshotLevel() {\n  return {\n    tab: 'level',\n    obstacles: JSON.parse(JSON.stringify(OBSTACLES)),\n    pits: JSON.parse(JSON.stringify(PITS)),\n    selectedType: levelState.selectedType,\n    selectedIdx: levelState.selectedIdx,\n  };\n}\n\nfunction pushUndo() {\n  const snap = currentTab === 'level' ? snapshotLevel() : snapshotGroup();\n  if (!snap) return;\n  undoStack.push(snap);\n  if (undoStack.length > MAX_UNDO) undoStack.shift();\n  redoStack.length = 0; // new action clears redo\n}\n\nfunction applySnapshot(snap: any) {\n  if (snap.tab === 'level') {\n    // Restore obstacle/pit arrays in place\n    OBSTACLES.length = 0;\n    for (const o of snap.obstacles) OBSTACLES.push(o);\n    PITS.length = 0;\n    for (const p of snap.pits) PITS.push(p);\n    levelState.selectedType = snap.selectedType;\n    levelState.selectedIdx = snap.selectedIdx;\n    onArenaChanged();\n    rebuildLevelMarkers();\n    refreshUI();\n  } else {\n    editorState.waveIndex = snap.waveIndex;\n    editorState.groupIndex = snap.groupIndex;\n    const wave = WAVES[snap.waveIndex];\n    if (!wave) return;\n    const group = wave.groups[snap.groupIndex];\n    if (!group) return;\n    group.spawns = snap.spawns;\n    group.triggerDelay = snap.triggerDelay;\n    group.telegraphDuration = snap.telegraphDuration;\n    group.stagger = snap.stagger;\n    rebuildMarkers();\n    refreshUI();\n  }\n}\n\nfunction popUndo() {\n  if (undoStack.length === 0) return;\n  // Save current state to redo before restoring\n  const current = currentTab === 'level' ? snapshotLevel() : snapshotGroup();\n  if (current) redoStack.push(current);\n  applySnapshot(undoStack.pop());\n}\n\nfunction popRedo() {\n  if (redoStack.length === 0) return;\n  // Save current state to undo before restoring\n  const current = currentTab === 'level' ? snapshotLevel() : snapshotGroup();\n  if (current) undoStack.push(current);\n  applySnapshot(redoStack.pop());\n}\n\n// 3D markers in scene (spawn tab)\nlet markers: any[] = []; // { mesh, waveIdx, groupIdx, spawnIdx }\n\n// 3D markers for level tab\nlet levelMarkers: any[] = []; // { mesh, type: 'obstacle'|'pit', idx }\n\n// Shared geometry/materials for markers\nlet markerGeo: any;\nconst markerMats: any = {};\n\n// DOM references\nlet waveLabel: any, groupLabel: any, spawnCountLabel: any;\nlet bannerEl: any;\nlet spawnTabContent: any, levelTabContent: any;\n\n// Enemy type shortnames for marker labels\nconst TYPE_SHORT: any = {\n  goblin: 'G',\n  skeletonArcher: 'A',\n  iceMortarImp: 'M',\n  stoneGolem: 'T',\n};\n\nconst ENEMY_TYPE_KEYS = Object.keys(ENEMY_TYPES);\n\n// \u2500\u2500\u2500 Per-Enemy Tuning Slider Definitions \u2500\u2500\u2500\n\nconst ENEMY_TUNING_SLIDERS: any = {\n  goblin: [\n    { label: 'Health',       key: 'health',             min: 5,   max: 200,  step: 5,   suffix: '', unit: 'HP',  tip: 'Hit points before death.' },\n    { label: 'Speed',        key: 'speed',              min: 0.5, max: 6,    step: 0.1, suffix: '', unit: 'u/s', tip: 'Movement speed in units per second.' },\n    { label: 'Damage',       key: 'damage',             min: 1,   max: 50,   step: 1,   suffix: '', unit: 'HP',  tip: 'Melee damage per hit.' },\n    { label: 'Attack Rate',  key: 'attackRate',          min: 200, max: 3000, step: 50,  suffix: 'ms', unit: 'ms', tip: 'Minimum time between melee attacks.' },\n    { label: 'KB Resist',    key: 'knockbackResist',     min: 0,   max: 1,    step: 0.05,suffix: '', unit: '',    tip: 'Resistance to knockback. 0 = full knockback, 1 = immune.' },\n    { label: 'Stop Dist',    key: 'rush.stopDistance',   min: 0.1, max: 3,    step: 0.1, suffix: '', unit: 'u',   tip: 'How close to the player before the goblin stops moving.' },\n    { label: 'Leap Edge',    key: 'pitLeap.edgeTimeRequired', min: 200,  max: 4000, step: 100, suffix: 'ms', unit: 'ms', tip: 'How long a goblin must hug a pit edge before leaping.' },\n    { label: 'Leap Speed',   key: 'pitLeap.leapSpeed',        min: 2,    max: 20,   step: 0.5, suffix: '', unit: 'u/s', tip: 'Travel speed along the arc. Lower = slower, more dramatic.' },\n    { label: 'Leap Height',  key: 'pitLeap.arcHeight',        min: 1,    max: 12,   step: 0.5, suffix: '', unit: 'u',   tip: 'Peak height of the parabolic leap arc.' },\n    { label: 'Leap CD',      key: 'pitLeap.cooldown',         min: 500,  max: 10000,step: 250, suffix: 'ms', unit: 'ms', tip: 'Cooldown before a goblin can leap again.' },\n  ],\n  skeletonArcher: [\n    { label: 'Health',           key: 'health',                     min: 5,   max: 200,  step: 5,    suffix: '', unit: 'HP',  tip: 'Hit points before death.' },\n    { label: 'Speed',            key: 'speed',                      min: 0.5, max: 6,    step: 0.1,  suffix: '', unit: 'u/s', tip: 'Movement speed in units per second.' },\n    { label: 'Damage',           key: 'damage',                     min: 1,   max: 50,   step: 1,    suffix: '', unit: 'HP',  tip: 'Base damage value.' },\n    { label: 'Attack Rate',      key: 'attackRate',                  min: 500, max: 5000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'Cooldown between sniper shots (includes telegraph time).' },\n    { label: 'Attack Range',     key: 'attackRange',                 min: 3,   max: 20,   step: 0.5,  suffix: '', unit: 'u',   tip: 'Maximum distance to initiate a sniper shot.' },\n    { label: 'KB Resist',        key: 'knockbackResist',             min: 0,   max: 1,    step: 0.05, suffix: '', unit: '',    tip: 'Resistance to knockback. 0 = full knockback, 1 = immune.' },\n    { label: 'Sniper Telegraph', key: 'sniper.telegraphDuration',    min: 200, max: 2000, step: 50,   suffix: 'ms', unit: 'ms', tip: 'How long the laser sight shows before firing. This is the player\\'s dodge window.' },\n    { label: 'Shot Width',       key: 'sniper.shotWidth',            min: 0.5, max: 4,    step: 0.1,  suffix: '', unit: 'u',   tip: 'Width of the damage corridor (perpendicular to aim).' },\n    { label: 'Shot Length',      key: 'sniper.shotLength',           min: 4,   max: 25,   step: 1,    suffix: '', unit: 'u',   tip: 'Length of the damage corridor (along aim direction).' },\n    { label: 'Sniper Dmg',       key: 'sniper.damage',               min: 1,   max: 50,   step: 1,    suffix: '', unit: 'HP',  tip: 'Damage dealt to everything in the corridor (player + enemies).' },\n    { label: 'Slow Dur',         key: 'sniper.slowDuration',          min: 200, max: 3000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'How long enemies hit by sniper are slowed.' },\n    { label: 'Slow Mult',        key: 'sniper.slowMult',              min: 0.1, max: 1.0,  step: 0.05, suffix: '', unit: 'x',   tip: 'Speed multiplier while slowed. 0.5 = half speed.' },\n    { label: 'Pref Range %',     key: 'kite.preferredRangeMult',     min: 0.3, max: 1.0,  step: 0.05, suffix: '', unit: 'x',   tip: 'Multiplier on attackRange for ideal distance. Lower = fights closer.' },\n    { label: 'Retreat Buf',      key: 'kite.retreatBuffer',          min: 0,   max: 5,    step: 0.5,  suffix: '', unit: 'u',   tip: 'How far inside preferred range before retreating.' },\n    { label: 'Advance Buf',      key: 'kite.advanceBuffer',          min: 0,   max: 8,    step: 0.5,  suffix: '', unit: 'u',   tip: 'How far outside preferred range before advancing.' },\n  ],\n  iceMortarImp: [\n    { label: 'Health',         key: 'health',                    min: 5,   max: 200,  step: 5,    suffix: '', unit: 'HP',  tip: 'Hit points before death.' },\n    { label: 'Speed',          key: 'speed',                     min: 0.5, max: 6,    step: 0.1,  suffix: '', unit: 'u/s', tip: 'Movement speed in units per second.' },\n    { label: 'Damage',         key: 'damage',                    min: 1,   max: 50,   step: 1,    suffix: '', unit: 'HP',  tip: 'Base damage value.' },\n    { label: 'Attack Rate',    key: 'attackRate',                  min: 1000,max: 8000, step: 250,  suffix: 'ms', unit: 'ms', tip: 'Cooldown between mortar shots (includes aim time).' },\n    { label: 'Attack Range',   key: 'attackRange',                 min: 5,   max: 25,   step: 0.5,  suffix: '', unit: 'u',   tip: 'Maximum distance to initiate a mortar shot.' },\n    { label: 'KB Resist',      key: 'knockbackResist',             min: 0,   max: 1,    step: 0.05, suffix: '', unit: '',    tip: 'Resistance to knockback.' },\n    { label: 'Aim Duration',   key: 'mortar.aimDuration',          min: 400, max: 3000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'How long the aim arc + ground circle telegraph shows. This is the dodge window.' },\n    { label: 'Proj Speed',     key: 'mortar.projectileSpeed',      min: 3,   max: 20,   step: 0.5,  suffix: '', unit: 'u/s', tip: 'Projectile travel speed along the arc.' },\n    { label: 'Arc Height',     key: 'mortar.arcHeight',            min: 2,   max: 15,   step: 0.5,  suffix: '', unit: 'u',   tip: 'Peak height of the parabolic arc.' },\n    { label: 'Blast Radius',   key: 'mortar.blastRadius',          min: 1,   max: 8,    step: 0.5,  suffix: '', unit: 'u',   tip: 'AoE damage radius on impact.' },\n    { label: 'Mortar Dmg',     key: 'mortar.damage',               min: 1,   max: 50,   step: 1,    suffix: '', unit: 'HP',  tip: 'Damage dealt to everything in the blast radius.' },\n    { label: 'Inaccuracy',     key: 'mortar.inaccuracy',           min: 0,   max: 5,    step: 0.25, suffix: '', unit: 'u',   tip: 'Random offset from player position. Higher = less accurate.' },\n    { label: 'Slow Dur',       key: 'mortar.slowDuration',          min: 200, max: 3000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'How long targets hit by mortar are slowed.' },\n    { label: 'Slow Mult',      key: 'mortar.slowMult',              min: 0.1, max: 1.0,  step: 0.05, suffix: '', unit: 'x',   tip: 'Speed multiplier while slowed.' },\n    { label: 'Circle Start',   key: 'mortar.circleStartScale',     min: 0.05, max: 1.0, step: 0.05, suffix: '', unit: 'x',   tip: 'Initial scale of ground circle on aim lock (0.25 = starts at 25% size).' },\n    { label: 'Circle Scale',   key: 'mortar.circleScaleTime',      min: 50,  max: 1000, step: 50,   suffix: 'ms', unit: 'ms', tip: 'How long the ground circle takes to scale from start size to full size.' },\n    { label: 'Pref Range %',   key: 'kite.preferredRangeMult',     min: 0.3, max: 1.0,  step: 0.05, suffix: '', unit: 'x',   tip: 'Multiplier on attackRange for ideal distance.' },\n    { label: 'Retreat Buf',    key: 'kite.retreatBuffer',          min: 0,   max: 5,    step: 0.5,  suffix: '', unit: 'u',   tip: 'How far inside preferred range before retreating.' },\n    { label: 'Advance Buf',    key: 'kite.advanceBuffer',          min: 0,   max: 8,    step: 0.5,  suffix: '', unit: 'u',   tip: 'How far outside preferred range before advancing.' },\n  ],\n  stoneGolem: [\n    { label: 'Health',          key: 'health',                     min: 20,   max: 500,  step: 10,   suffix: '', unit: 'HP',  tip: 'Hit points after shield is broken.' },\n    { label: 'Speed',           key: 'speed',                      min: 0.3,  max: 4,    step: 0.05, suffix: '', unit: 'u/s', tip: 'Base movement speed in units per second.' },\n    { label: 'Damage',          key: 'damage',                     min: 5,    max: 80,   step: 5,    suffix: '', unit: 'HP',  tip: 'Base melee damage per hit.' },\n    { label: 'Attack Rate',     key: 'attackRate',                  min: 200,  max: 5000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'Minimum time between melee hits.' },\n    { label: 'KB Resist',       key: 'knockbackResist',             min: 0,    max: 1,    step: 0.05, suffix: '', unit: '',    tip: 'Knockback resistance. Golem barely moves when hit.' },\n    { label: 'Charge Speed',    key: 'tank.chargeSpeedMult',        min: 1,    max: 6,    step: 0.5,  suffix: 'x', unit: 'x',  tip: 'Speed multiplier during charge attack.' },\n    { label: 'Charge Dur',      key: 'tank.chargeDuration',         min: 100,  max: 2000, step: 50,   suffix: 'ms', unit: 'ms', tip: 'How long the charge lasts.' },\n    { label: 'Charge CD Min',   key: 'tank.chargeCooldownMin',      min: 1000, max: 10000,step: 500,  suffix: 'ms', unit: 'ms', tip: 'Minimum cooldown between charges.' },\n    { label: 'Charge CD Max',   key: 'tank.chargeCooldownMax',      min: 1000, max: 15000,step: 500,  suffix: 'ms', unit: 'ms', tip: 'Maximum cooldown between charges (random in range).' },\n    { label: 'Charge Dmg',      key: 'tank.chargeDamageMult',       min: 1,    max: 4,    step: 0.25, suffix: 'x', unit: 'x',  tip: 'Damage multiplier when hitting player during charge.' },\n    { label: 'Shield HP',       key: 'shield.maxHealth',            min: 0,    max: 200,  step: 5,    suffix: '', unit: 'HP',  tip: 'Shield hit points. Set to 0 to disable shield.' },\n    { label: 'Stun Radius',     key: 'shield.stunRadius',           min: 1,    max: 15,   step: 0.5,  suffix: '', unit: 'u',   tip: 'AoE stun radius when shield breaks.' },\n    { label: 'Stun Dur',        key: 'shield.stunDuration',         min: 500,  max: 5000, step: 250,  suffix: 'ms', unit: 'ms', tip: 'How long the golem + nearby enemies are stunned after shield break.' },\n    { label: 'Explode Rad',    key: 'deathExplosion.radius',       min: 1,    max: 10,   step: 0.5,  suffix: '', unit: 'u',   tip: 'AoE radius of the death explosion. Damages nearby enemies and player.' },\n    { label: 'Explode Dmg',    key: 'deathExplosion.damage',       min: 5,    max: 80,   step: 5,    suffix: '', unit: 'HP',  tip: 'Damage dealt by the death explosion.' },\n    { label: 'Explode Stun',   key: 'deathExplosion.stunDuration', min: 0,    max: 3000, step: 250,  suffix: 'ms', unit: 'ms', tip: 'Stun duration applied to enemies caught in death explosion. 0 = no stun.' },\n    { label: 'Explode Delay',  key: 'deathExplosion.telegraphDuration', min: 0, max: 3000, step: 100, suffix: 'ms', unit: 'ms', tip: 'Telegraph delay before explosion. Golem can be pushed during this window. 0 = instant.' },\n  ],\n};\n\n// Nested key helpers\nfunction getNestedValue(obj: any, path: string) {\n  const parts = path.split('.');\n  let cur = obj;\n  for (const p of parts) {\n    if (cur == null) return undefined;\n    cur = cur[p];\n  }\n  return cur;\n}\n\nfunction setNestedValue(obj: any, path: string, value: any) {\n  const parts = path.split('.');\n  let cur = obj;\n  for (let i = 0; i < parts.length - 1; i++) {\n    if (cur[parts[i]] == null) cur[parts[i]] = {};\n    cur = cur[parts[i]];\n  }\n  cur[parts[parts.length - 1]] = value;\n}\n\nlet lastBuiltTuningType: string | null = null;\n\nexport function initSpawnEditor(scene: any, gameState: any) {\n  sceneRef = scene;\n  gameStateRef = gameState;\n\n  // Marker geometry \u2014 small cylinder\n  markerGeo = new THREE.CylinderGeometry(0.35, 0.35, 0.8, 8);\n\n  // Materials per enemy type\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    markerMats[name] = new THREE.MeshStandardMaterial({\n      color: (cfg as any).color,\n      emissive: (cfg as any).color,\n      emissiveIntensity: 0.5,\n      transparent: true,\n      opacity: 0.8,\n    });\n  }\n\n  buildPanel();\n  injectStyles();\n\n  // Mouse handlers\n  window.addEventListener('mousedown', onMouseDown);\n  window.addEventListener('mousemove', onMouseMove);\n  window.addEventListener('mouseup', onMouseUp);\n\n  // Keyboard shortcuts in editor\n  window.addEventListener('keydown', onEditorKey);\n}\n\nexport function updateSpawnEditor(dt: number) {\n  const input = getInputState();\n\n  // Check for toggle\n  if (input.toggleEditor) {\n    toggleEditor();\n    consumeInput();\n    return;\n  }\n}\n\n// Also check toggle from main game loop (called even when not in editor)\nexport function checkEditorToggle() {\n  const input = getInputState();\n  if (input.toggleEditor) {\n    toggleEditor();\n  }\n}\n\nfunction toggleEditor() {\n  if (active) {\n    exitEditor();\n  } else {\n    enterEditor();\n  }\n}\n\nfunction onEditorWheel(e: any) {\n  e.preventDefault();\n  const delta = e.deltaY > 0 ? 1 : -1; // scroll down = zoom out (+frustum)\n  setZoom(getCurrentFrustum() + delta);\n}\n\nfunction enterEditor() {\n  active = true;\n  previousPhase = gameStateRef.phase;\n  gameStateRef.phase = 'editorPaused';\n  panel.classList.remove('hidden');\n  bannerEl.classList.add('visible');\n  window.addEventListener('wheel', onEditorWheel, { passive: false });\n  if (currentTab === 'spawn') {\n    rebuildMarkers();\n  } else {\n    rebuildLevelMarkers();\n  }\n  refreshUI();\n}\n\nfunction exitEditor() {\n  active = false;\n  gameStateRef.phase = previousPhase;\n  panel.classList.add('hidden');\n  bannerEl.classList.remove('visible');\n  window.removeEventListener('wheel', onEditorWheel);\n  resetZoom();\n  clearMarkers();\n  clearLevelMarkers();\n}\n\nexport function isEditorActive() {\n  return active;\n}\n\n// \u2500\u2500\u2500 Tab Switching \u2500\u2500\u2500\n\nfunction switchTab(tab: string) {\n  if (tab === currentTab) return;\n  currentTab = tab;\n\n  // Clear old markers\n  clearMarkers();\n  clearLevelMarkers();\n\n  // Reset selections\n  editorState.selectedSpawnIdx = -1;\n  levelState.selectedType = null;\n  levelState.selectedIdx = -1;\n  isDragging = false;\n  dragStarted = false;\n\n  // Show/hide tab contents\n  if (spawnTabContent && levelTabContent) {\n    spawnTabContent.style.display = tab === 'spawn' ? 'block' : 'none';\n    levelTabContent.style.display = tab === 'level' ? 'block' : 'none';\n  }\n\n  // Update tab buttons\n  const tabs = panel.querySelectorAll('.se-tab');\n  tabs.forEach((t: any) => t.classList.toggle('active', t.dataset.tab === tab));\n\n  // Rebuild appropriate markers\n  if (tab === 'spawn') {\n    rebuildMarkers();\n  } else {\n    rebuildLevelMarkers();\n  }\n  refreshUI();\n}\n\n// \u2500\u2500\u2500 Mouse \u2192 Select / Drag / Place \u2500\u2500\u2500\n\nfunction mouseToWorld(e: any) {\n  const ndcX = (e.clientX / window.innerWidth) * 2 - 1;\n  const ndcY = -(e.clientY / window.innerHeight) * 2 + 1;\n  return screenToWorld(ndcX, ndcY);\n}\n\nfunction clampToArena(x: number, z: number) {\n  const cx = ARENA_HALF_X - 1.5;\n  const cz = ARENA_HALF_Z - 1.5;\n  return {\n    x: Math.round(Math.max(-cx, Math.min(cx, x))),\n    z: Math.round(Math.max(-cz, Math.min(cz, z))),\n  };\n}\n\n// Find nearest spawn in current group within radius\nfunction findNearestSpawn(worldX: number, worldZ: number, radius: number) {\n  const group = getCurrentGroup();\n  if (!group) return -1;\n  let bestIdx = -1, bestDist = radius * radius;\n  for (let i = 0; i < group.spawns.length; i++) {\n    const s = group.spawns[i];\n    const dx = s.x - worldX;\n    const dz = s.z - worldZ;\n    const distSq = dx * dx + dz * dz;\n    if (distSq < bestDist) {\n      bestDist = distSq;\n      bestIdx = i;\n    }\n  }\n  return bestIdx;\n}\n\n// Find nearest spawn across ALL groups in the current wave within radius.\n// Returns { groupIdx, spawnIdx } or null if nothing found.\nfunction findNearestSpawnAcrossGroups(worldX: number, worldZ: number, radius: number) {\n  const wave = WAVES[editorState.waveIndex];\n  if (!wave) return null;\n  let bestGroupIdx = -1, bestSpawnIdx = -1, bestDist = radius * radius;\n  for (let gi = 0; gi < wave.groups.length; gi++) {\n    const group = wave.groups[gi];\n    for (let si = 0; si < group.spawns.length; si++) {\n      const s = group.spawns[si];\n      const dx = s.x - worldX;\n      const dz = s.z - worldZ;\n      const distSq = dx * dx + dz * dz;\n      if (distSq < bestDist) {\n        bestDist = distSq;\n        bestGroupIdx = gi;\n        bestSpawnIdx = si;\n      }\n    }\n  }\n  if (bestGroupIdx < 0) return null;\n  return { groupIdx: bestGroupIdx, spawnIdx: bestSpawnIdx };\n}\n\n// \u2500\u2500\u2500 Level Tab Mouse Helpers \u2500\u2500\u2500\n\nfunction findNearestLevelObject(worldX: number, worldZ: number, radius: number) {\n  let bestType: string | null = null, bestIdx = -1, bestDist = radius * radius;\n\n  for (let i = 0; i < OBSTACLES.length; i++) {\n    const o = OBSTACLES[i];\n    const dx = o.x - worldX;\n    const dz = o.z - worldZ;\n    const distSq = dx * dx + dz * dz;\n    if (distSq < bestDist) {\n      bestDist = distSq;\n      bestType = 'obstacle';\n      bestIdx = i;\n    }\n  }\n\n  for (let i = 0; i < PITS.length; i++) {\n    const p = PITS[i];\n    const dx = p.x - worldX;\n    const dz = p.z - worldZ;\n    const distSq = dx * dx + dz * dz;\n    if (distSq < bestDist) {\n      bestDist = distSq;\n      bestType = 'pit';\n      bestIdx = i;\n    }\n  }\n\n  if (bestType === null) return null;\n  return { type: bestType, idx: bestIdx };\n}\n\nfunction onMouseDown(e: any) {\n  if (!active) return;\n  if (e.target.closest('#spawn-editor')) return;\n\n  if (currentTab === 'level') {\n    onLevelMouseDown(e);\n    return;\n  }\n\n  const worldPos = mouseToWorld(e);\n  const group = getCurrentGroup();\n  if (!group) return;\n\n  // Right-click or shift-click: delete nearest spawn (search across groups)\n  if (e.button === 2 || e.shiftKey) {\n    // Try current group first\n    let idx = findNearestSpawn(worldPos.x, worldPos.z, 1.5);\n    if (idx >= 0) {\n      pushUndo();\n      group.spawns.splice(idx, 1);\n      if (editorState.selectedSpawnIdx === idx) editorState.selectedSpawnIdx = -1;\n      else if (editorState.selectedSpawnIdx > idx) editorState.selectedSpawnIdx--;\n      rebuildMarkers();\n      refreshUI();\n    } else {\n      // Check other groups\n      const hit = findNearestSpawnAcrossGroups(worldPos.x, worldPos.z, 1.5);\n      if (hit) {\n        // Switch to that group and delete the spawn\n        editorState.groupIndex = hit.groupIdx;\n        editorState.selectedSpawnIdx = -1;\n        const targetGroup = WAVES[editorState.waveIndex].groups[hit.groupIdx];\n        pushUndo();\n        targetGroup.spawns.splice(hit.spawnIdx, 1);\n        rebuildMarkers();\n        refreshUI();\n      }\n    }\n    return;\n  }\n\n  // Left click: check if clicking on existing spawn in current group first\n  const hitIdx = findNearestSpawn(worldPos.x, worldPos.z, 1.5);\n\n  if (hitIdx >= 0) {\n    // Select it and start potential drag\n    editorState.selectedSpawnIdx = hitIdx;\n    isDragging = true;\n    dragStarted = false;\n    dragStartWorld = { x: worldPos.x, z: worldPos.z };\n    rebuildMarkers();\n    refreshUI();\n  } else {\n    // Check other groups \u2014 only auto-switch if click is very close to an existing spawn\n    // (tighter radius prevents accidental group switches when placing new spawns)\n    const hit = findNearestSpawnAcrossGroups(worldPos.x, worldPos.z, 0.8);\n\n    if (hit) {\n      // Auto-switch to that group and select the spawn\n      editorState.groupIndex = hit.groupIdx;\n      editorState.selectedSpawnIdx = hit.spawnIdx;\n      isDragging = true;\n      dragStarted = false;\n      dragStartWorld = { x: worldPos.x, z: worldPos.z };\n      rebuildMarkers();\n      refreshUI();\n    } else {\n      // Place new spawn in current group\n      pushUndo();\n      const clamped = clampToArena(worldPos.x, worldPos.z);\n      group.spawns.push({ type: editorState.enemyType, x: clamped.x, z: clamped.z });\n      editorState.selectedSpawnIdx = group.spawns.length - 1;\n      rebuildMarkers();\n      refreshUI();\n    }\n  }\n}\n\nfunction onLevelMouseDown(e: any) {\n  const worldPos = mouseToWorld(e);\n\n  // Right-click or shift-click: delete nearest object\n  if (e.button === 2 || e.shiftKey) {\n    const hit = findNearestLevelObject(worldPos.x, worldPos.z, 3);\n    if (hit) {\n      pushUndo();\n      if (hit.type === 'obstacle') {\n        OBSTACLES.splice(hit.idx, 1);\n      } else {\n        PITS.splice(hit.idx, 1);\n      }\n      // Clear selection if the deleted item was selected\n      if (levelState.selectedType === hit.type && levelState.selectedIdx === hit.idx) {\n        levelState.selectedType = null;\n        levelState.selectedIdx = -1;\n      } else if (levelState.selectedType === hit.type && levelState.selectedIdx > hit.idx) {\n        levelState.selectedIdx--;\n      }\n      onArenaChanged();\n      rebuildLevelMarkers();\n      refreshUI();\n    }\n    return;\n  }\n\n  // Left click: select or add\n  const hit = findNearestLevelObject(worldPos.x, worldPos.z, 3);\n\n  if (hit) {\n    levelState.selectedType = hit.type;\n    levelState.selectedIdx = hit.idx;\n    isDragging = true;\n    dragStarted = false;\n    dragStartWorld = { x: worldPos.x, z: worldPos.z };\n    rebuildLevelMarkers();\n    refreshUI();\n  } else {\n    // Click on empty space: deselect\n    levelState.selectedType = null;\n    levelState.selectedIdx = -1;\n    rebuildLevelMarkers();\n    refreshUI();\n  }\n}\n\nfunction onMouseMove(e: any) {\n  if (!active || !isDragging) return;\n\n  if (currentTab === 'level') {\n    onLevelMouseMove(e);\n    return;\n  }\n\n  const worldPos = mouseToWorld(e);\n  const group = getCurrentGroup();\n  if (!group || editorState.selectedSpawnIdx < 0) return;\n\n  // Check drag threshold (0.5 world units) before committing\n  if (!dragStarted) {\n    const dx = worldPos.x - dragStartWorld.x;\n    const dz = worldPos.z - dragStartWorld.z;\n    if (dx * dx + dz * dz < 0.25) return; // below threshold\n    dragStarted = true;\n    pushUndo(); // snapshot before drag begins\n  }\n\n  // Move the selected spawn\n  const clamped = clampToArena(worldPos.x, worldPos.z);\n  const spawn = group.spawns[editorState.selectedSpawnIdx];\n  spawn.x = clamped.x;\n  spawn.z = clamped.z;\n\n  // Update marker position directly (avoid full rebuild every frame)\n  const marker = markers.find((m: any) =>\n    m.groupIdx === editorState.groupIndex && m.spawnIdx === editorState.selectedSpawnIdx\n  );\n  if (marker) {\n    marker.mesh.position.set(clamped.x, 0, clamped.z);\n  }\n}\n\nfunction onLevelMouseMove(e: any) {\n  if (levelState.selectedType === null || levelState.selectedIdx < 0) return;\n\n  const worldPos = mouseToWorld(e);\n\n  // Check drag threshold\n  if (!dragStarted) {\n    const dx = worldPos.x - dragStartWorld.x;\n    const dz = worldPos.z - dragStartWorld.z;\n    if (dx * dx + dz * dz < 0.25) return;\n    dragStarted = true;\n    pushUndo();\n  }\n\n  // Move the selected object\n  const arr = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n  const obj = arr[levelState.selectedIdx];\n  if (!obj) return;\n  obj.x = Math.round(worldPos.x * 2) / 2; // snap to 0.5\n  obj.z = Math.round(worldPos.z * 2) / 2;\n\n  // Update marker position\n  const marker = levelMarkers.find((m: any) =>\n    m.type === levelState.selectedType && m.idx === levelState.selectedIdx\n  );\n  if (marker) {\n    marker.mesh.position.set(obj.x, marker.mesh.position.y, obj.z);\n  }\n}\n\nfunction onMouseUp(e: any) {\n  if (!active) return;\n\n  if (currentTab === 'level') {\n    if (isDragging && dragStarted) {\n      onArenaChanged();\n      rebuildLevelMarkers();\n      refreshUI();\n    }\n    isDragging = false;\n    dragStarted = false;\n    dragStartWorld = null;\n    return;\n  }\n\n  if (isDragging && dragStarted) {\n    // Drag finished \u2014 rebuild markers for clean state\n    rebuildMarkers();\n    refreshUI();\n  }\n  isDragging = false;\n  dragStarted = false;\n  dragStartWorld = null;\n}\n\n// \u2500\u2500\u2500 Arena Changed (rebuild visuals + invalidate physics) \u2500\u2500\u2500\n\nfunction onArenaChanged() {\n  rebuildArenaVisuals();\n  invalidateCollisionBounds();\n}\n\n// \u2500\u2500\u2500 Arena Presets \u2500\u2500\u2500\n// Note: Arena save/load requires a backend server. On static hosting (GitHub Pages,\n// npx serve), these functions no-op silently. Set window.ARENA_BACKEND = true if\n// you're running a backend that supports /arenas endpoints.\n\nconst hasArenaBackend = () => (window as any).ARENA_BACKEND === true;\n\nasync function fetchPresetList() {\n  if (!hasArenaBackend()) return [];\n  try {\n    const res = await fetch('/arenas');\n    if (!res.ok) return [];\n    return await res.json();\n  } catch (e) {\n    console.warn('[spawnEditor] Could not fetch preset list:', e);\n    return [];\n  }\n}\n\nasync function refreshPresetDropdown() {\n  const select = document.getElementById('se-preset-select') as any;\n  if (!select) return;\n  const list = await fetchPresetList();\n  let html = '<option value=\"\">(unsaved)</option>';\n  for (const name of list) {\n    const sel = name === currentPresetName ? ' selected' : '';\n    html += `<option value=\"${name}\"${sel}>${name}</option>`;\n  }\n  select.innerHTML = html;\n}\n\nasync function loadPreset(name: string) {\n  if (!name || !hasArenaBackend()) return;\n  try {\n    const res = await fetch(`/arenas/load?name=${encodeURIComponent(name)}`);\n    if (!res.ok) throw new Error(res.statusText);\n    const data = await res.json();\n\n    pushUndo();\n\n    // Replace arrays in-place (same pattern as undo/redo)\n    OBSTACLES.length = 0;\n    for (const o of data.obstacles) OBSTACLES.push(o);\n    PITS.length = 0;\n    for (const p of data.pits) PITS.push(p);\n\n    currentPresetName = name;\n    levelState.selectedType = null;\n    levelState.selectedIdx = -1;\n\n    onArenaChanged();\n    rebuildLevelMarkers();\n    refreshLevelUI();\n    refreshPresetDropdown();\n  } catch (e) {\n    console.error('[spawnEditor] Load preset failed:', e);\n  }\n}\n\nasync function savePreset(name: string) {\n  if (!name || !hasArenaBackend()) return;\n  try {\n    const res = await fetch('/arenas/save', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name, obstacles: OBSTACLES, pits: PITS }),\n    });\n    if (!res.ok) throw new Error(res.statusText);\n    currentPresetName = name;\n    refreshPresetDropdown();\n  } catch (e) {\n    console.error('[spawnEditor] Save preset failed:', e);\n  }\n}\n\nasync function deletePreset(name: string) {\n  if (!name || !hasArenaBackend()) return;\n  try {\n    const res = await fetch('/arenas/delete', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name }),\n    });\n    if (!res.ok) throw new Error(res.statusText);\n    if (currentPresetName === name) currentPresetName = null;\n    refreshPresetDropdown();\n  } catch (e) {\n    console.error('[spawnEditor] Delete preset failed:', e);\n  }\n}\n\n// \u2500\u2500\u2500 Keyboard Shortcuts \u2500\u2500\u2500\n\nfunction onEditorKey(e: any) {\n  if (!active) return;\n\n  // Cmd/Ctrl+Z: undo\n  if (e.code === 'KeyZ' && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n    e.preventDefault();\n    popUndo();\n    return;\n  }\n\n  // Ctrl+Y or Cmd+Shift+Z: redo\n  if ((e.code === 'KeyY' && (e.metaKey || e.ctrlKey)) ||\n      (e.code === 'KeyZ' && (e.metaKey || e.ctrlKey) && e.shiftKey)) {\n    e.preventDefault();\n    popRedo();\n    return;\n  }\n\n  // Escape: deselect\n  if (e.code === 'Escape') {\n    if (currentTab === 'level') {\n      levelState.selectedType = null;\n      levelState.selectedIdx = -1;\n      rebuildLevelMarkers();\n    } else {\n      editorState.selectedSpawnIdx = -1;\n      rebuildMarkers();\n    }\n    refreshUI();\n    return;\n  }\n\n  // Tab-specific shortcuts\n  if (currentTab === 'level') {\n    onLevelKey(e);\n    return;\n  }\n\n  // Spawn tab shortcuts below\n\n  // 1/2/3/4 to select enemy type \u2014 also changes selected spawn's type\n  const typeKeyMap: any = { 'Digit1': 0, 'Digit2': 1, 'Digit3': 2, 'Digit4': 3 };\n  if (e.code in typeKeyMap) {\n    const idx = typeKeyMap[e.code];\n    if (idx < ENEMY_TYPE_KEYS.length) {\n      editorState.enemyType = ENEMY_TYPE_KEYS[idx];\n      // If a spawn is selected, change its type too\n      if (editorState.selectedSpawnIdx >= 0) {\n        const group = getCurrentGroup();\n        if (group && group.spawns[editorState.selectedSpawnIdx]) {\n          pushUndo();\n          group.spawns[editorState.selectedSpawnIdx].type = ENEMY_TYPE_KEYS[idx];\n          rebuildMarkers();\n        }\n      }\n      refreshUI();\n    }\n  }\n\n  // Delete/Backspace: remove selected spawn, or clear group if none selected\n  if (e.code === 'Delete' || e.code === 'Backspace') {\n    if (e.target.tagName === 'INPUT') return; // don't intercept slider input\n    const group = getCurrentGroup();\n    if (!group) return;\n\n    if (editorState.selectedSpawnIdx >= 0 && editorState.selectedSpawnIdx < group.spawns.length) {\n      // Delete just the selected spawn\n      pushUndo();\n      group.spawns.splice(editorState.selectedSpawnIdx, 1);\n      editorState.selectedSpawnIdx = -1;\n      rebuildMarkers();\n      refreshUI();\n    } else {\n      // No selection \u2014 clear all spawns in group\n      pushUndo();\n      group.spawns = [];\n      rebuildMarkers();\n      refreshUI();\n    }\n  }\n\n  // P: play current wave\n  if (e.code === 'KeyP') {\n    playCurrentWave();\n  }\n}\n\nfunction onLevelKey(e: any) {\n  // Delete/Backspace: delete selected level object\n  if (e.code === 'Delete' || e.code === 'Backspace') {\n    if (e.target.tagName === 'INPUT') return;\n    if (levelState.selectedType && levelState.selectedIdx >= 0) {\n      pushUndo();\n      if (levelState.selectedType === 'obstacle') {\n        OBSTACLES.splice(levelState.selectedIdx, 1);\n      } else {\n        PITS.splice(levelState.selectedIdx, 1);\n      }\n      levelState.selectedType = null;\n      levelState.selectedIdx = -1;\n      onArenaChanged();\n      rebuildLevelMarkers();\n      refreshUI();\n    }\n  }\n}\n\n// \u2500\u2500\u2500 3D Markers (Spawn Tab) \u2500\u2500\u2500\n\nfunction clearMarkers() {\n  for (const m of markers) {\n    sceneRef.remove(m.mesh);\n    // dispose cloned materials\n    m.mesh.children.forEach((c: any) => {\n      if (c.material && c.material !== markerMats[m.type]) c.material.dispose();\n    });\n  }\n  markers = [];\n}\n\nfunction rebuildMarkers() {\n  clearMarkers();\n\n  for (let wi = 0; wi < WAVES.length; wi++) {\n    const wave = WAVES[wi];\n    if (wi !== editorState.waveIndex) continue; // only show current wave\n\n    for (let gi = 0; gi < wave.groups.length; gi++) {\n      const group = wave.groups[gi];\n      const isCurrent = (gi === editorState.groupIndex);\n\n      for (let si = 0; si < group.spawns.length; si++) {\n        const spawn = group.spawns[si];\n        const mat = markerMats[spawn.type] || markerMats.goblin;\n        const isSelected = isCurrent && si === editorState.selectedSpawnIdx;\n\n        // Clone material for opacity control\n        const clonedMat = mat.clone();\n        clonedMat.opacity = isCurrent ? 0.85 : 0.25;\n        if (isSelected) {\n          clonedMat.emissiveIntensity = 1.0;\n        }\n\n        const mesh = new THREE.Group();\n\n        // Cylinder body\n        const body = new THREE.Mesh(markerGeo, clonedMat);\n        body.position.y = 0.4;\n        mesh.add(body);\n\n        // Ground ring \u2014 white if selected, enemy color otherwise\n        const ringColor = isSelected ? 0xffffff\n          : ((ENEMY_TYPES as any)[spawn.type] ? (ENEMY_TYPES as any)[spawn.type].color : 0xffffff);\n        const ringGeo = new THREE.RingGeometry(\n          isSelected ? 0.55 : 0.5,\n          isSelected ? 0.75 : 0.65,\n          16\n        );\n        ringGeo.rotateX(-Math.PI / 2);\n        const ringMat = new THREE.MeshBasicMaterial({\n          color: ringColor,\n          transparent: true,\n          opacity: isSelected ? 0.9 : (isCurrent ? 0.5 : 0.15),\n          side: THREE.DoubleSide,\n          depthWrite: false,\n        });\n        const ring = new THREE.Mesh(ringGeo, ringMat);\n        ring.position.y = 0.02;\n        mesh.add(ring);\n\n        mesh.position.set(spawn.x, 0, spawn.z);\n        sceneRef.add(mesh);\n\n        markers.push({\n          mesh,\n          type: spawn.type,\n          waveIdx: wi,\n          groupIdx: gi,\n          spawnIdx: si,\n        });\n      }\n    }\n  }\n}\n\n// \u2500\u2500\u2500 3D Markers (Level Tab) \u2500\u2500\u2500\n\nfunction clearLevelMarkers() {\n  for (const m of levelMarkers) {\n    sceneRef.remove(m.mesh);\n    m.mesh.children.forEach((c: any) => {\n      if (c.material) c.material.dispose();\n      if (c.geometry) c.geometry.dispose();\n    });\n  }\n  levelMarkers = [];\n}\n\nfunction rebuildLevelMarkers() {\n  clearLevelMarkers();\n\n  const isObsSelected = levelState.selectedType === 'obstacle';\n  const isPitSelected = levelState.selectedType === 'pit';\n\n  // Obstacle markers \u2014 wireframe boxes at obstacle positions\n  for (let i = 0; i < OBSTACLES.length; i++) {\n    const o = OBSTACLES[i];\n    const selected = isObsSelected && levelState.selectedIdx === i;\n\n    const group = new THREE.Group();\n\n    // Wireframe outline\n    const boxGeo = new THREE.BoxGeometry(o.w, o.h, o.d);\n    const edgesGeo = new THREE.EdgesGeometry(boxGeo);\n    const lineMat = new THREE.LineBasicMaterial({\n      color: selected ? 0x44ff88 : 0x66aaff,\n      linewidth: 1,\n    });\n    const wireframe = new THREE.LineSegments(edgesGeo, lineMat);\n    wireframe.position.y = o.h / 2;\n    group.add(wireframe);\n\n    // Ground ring\n    const ringGeo = new THREE.RingGeometry(\n      selected ? 0.6 : 0.5,\n      selected ? 0.85 : 0.7,\n      16\n    );\n    ringGeo.rotateX(-Math.PI / 2);\n    const ringMat = new THREE.MeshBasicMaterial({\n      color: selected ? 0x44ff88 : 0x66aaff,\n      transparent: true,\n      opacity: selected ? 0.8 : 0.4,\n      side: THREE.DoubleSide,\n      depthWrite: false,\n    });\n    const ring = new THREE.Mesh(ringGeo, ringMat);\n    ring.position.y = 0.03;\n    group.add(ring);\n\n    group.position.set(o.x, 0, o.z);\n    sceneRef.add(group);\n\n    levelMarkers.push({ mesh: group, type: 'obstacle', idx: i });\n  }\n\n  // Pit markers \u2014 wireframe rectangles on ground\n  for (let i = 0; i < PITS.length; i++) {\n    const p = PITS[i];\n    const selected = isPitSelected && levelState.selectedIdx === i;\n\n    const group = new THREE.Group();\n\n    // Wireframe rectangle at ground level\n    const planeGeo = new THREE.PlaneGeometry(p.w, p.d);\n    const edgesGeo = new THREE.EdgesGeometry(planeGeo);\n    const lineMat = new THREE.LineBasicMaterial({\n      color: selected ? 0xff44aa : 0xff4466,\n      linewidth: 1,\n    });\n    const wireframe = new THREE.LineSegments(edgesGeo, lineMat);\n    wireframe.rotation.x = -Math.PI / 2;\n    wireframe.position.y = 0.1;\n    group.add(wireframe);\n\n    // Ground ring\n    const ringGeo = new THREE.RingGeometry(\n      selected ? 0.6 : 0.5,\n      selected ? 0.85 : 0.7,\n      16\n    );\n    ringGeo.rotateX(-Math.PI / 2);\n    const ringMat = new THREE.MeshBasicMaterial({\n      color: selected ? 0xff44aa : 0xff4466,\n      transparent: true,\n      opacity: selected ? 0.8 : 0.4,\n      side: THREE.DoubleSide,\n      depthWrite: false,\n    });\n    const ring = new THREE.Mesh(ringGeo, ringMat);\n    ring.position.y = 0.03;\n    group.add(ring);\n\n    group.position.set(p.x, 0, p.z);\n    sceneRef.add(group);\n\n    levelMarkers.push({ mesh: group, type: 'pit', idx: i });\n  }\n}\n\n// \u2500\u2500\u2500 UI Panel \u2500\u2500\u2500\n\nfunction buildPanel() {\n  panel = document.createElement('div');\n  panel.id = 'spawn-editor';\n  panel.className = 'hidden';\n\n  // Prevent context menu on panel\n  panel.addEventListener('contextmenu', (e: any) => e.preventDefault());\n\n  // Banner\n  bannerEl = document.createElement('div');\n  bannerEl.id = 'editor-banner';\n  document.body.appendChild(bannerEl);\n  bannerEl.textContent = 'EDITOR MODE \u2014 press ` to exit';\n\n  let html = '';\n\n  // Tab bar\n  html += '<div class=\"se-tabs\">';\n  html += '<div class=\"se-tab active\" data-tab=\"spawn\">Spawn</div>';\n  html += '<div class=\"se-tab\" data-tab=\"level\">Level</div>';\n  html += '</div>';\n\n  // \u2500\u2500\u2500 Spawn Tab Content \u2500\u2500\u2500\n  html += '<div id=\"se-spawn-content\">';\n\n  // Wave selector\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Wave</div>';\n  html += '<div class=\"se-selector\">';\n  html += '<div class=\"se-btn\" id=\"se-wave-prev\">&lt;</div>';\n  html += '<span id=\"se-wave-label\">1</span>';\n  html += '<div class=\"se-btn\" id=\"se-wave-next\">&gt;</div>';\n  html += '<div class=\"se-btn se-add\" id=\"se-wave-add\">+</div>';\n  html += '</div>';\n  html += '<input type=\"text\" id=\"se-wave-msg\" class=\"se-wave-msg\" placeholder=\"Wave announcement message...\">';\n  html += '</div>';\n\n  // Group selector\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Group</div>';\n  html += '<div class=\"se-selector\">';\n  html += '<div class=\"se-btn\" id=\"se-group-prev\">&lt;</div>';\n  html += '<span id=\"se-group-label\">g1</span>';\n  html += '<div class=\"se-btn\" id=\"se-group-next\">&gt;</div>';\n  html += '<div class=\"se-btn se-add\" id=\"se-group-add\">+</div>';\n  html += '<div class=\"se-btn se-del\" id=\"se-group-del\">\\u00d7</div>';\n  html += '</div></div>';\n\n  // Timing sliders\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Timing</div>';\n  html += '<div class=\"se-slider-row\"><span class=\"has-tooltip\" data-tip=\"Time after wave starts before this group\\'s telegraph begins. Use to stagger multiple groups.\">Trigger Delay</span><input type=\"range\" id=\"se-trigger\" min=\"0\" max=\"10000\" step=\"250\" value=\"0\"><input type=\"text\" class=\"se-timing-val\" id=\"se-trigger-val\" value=\"0 ms\"></div>';\n  html += '<div class=\"se-slider-row\"><span class=\"has-tooltip\" data-tip=\"How long the pulsing warning circles appear on the ground before enemies materialize. This is the player\\'s reaction window.\">Telegraph Time</span><input type=\"range\" id=\"se-telegraph\" min=\"500\" max=\"5000\" step=\"250\" value=\"1500\"><input type=\"text\" class=\"se-timing-val\" id=\"se-telegraph-val\" value=\"1500 ms\"></div>';\n  html += '<div class=\"se-slider-row\"><span class=\"has-tooltip\" data-tip=\"Time between each individual enemy spawning within a group. 0 = all spawn simultaneously.\">Spawn Stagger</span><input type=\"range\" id=\"se-stagger\" min=\"0\" max=\"1000\" step=\"50\" value=\"200\"><input type=\"text\" class=\"se-timing-val\" id=\"se-stagger-val\" value=\"200 ms\"></div>';\n  html += '</div>';\n\n  // Enemy type picker\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Enemy Type (1/2/3/4)</div>';\n  html += '<div class=\"se-type-picker\" id=\"se-type-picker\">';\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    const short = TYPE_SHORT[name] || name[0].toUpperCase();\n    html += `<div class=\"se-type-btn\" data-type=\"${name}\" style=\"border-color: #${(cfg as any).color.toString(16).padStart(6, '0')}\">${short} ${(cfg as any).name}</div>`;\n  }\n  html += '</div></div>';\n\n  // Per-enemy tuning (collapsible)\n  html += '<div class=\"se-section\" id=\"se-enemy-tuning\">';\n  html += '<div class=\"se-group-label se-collapsible\" id=\"se-tuning-header\">Enemy Properties &#x25BC;</div>';\n  html += '<div id=\"se-tuning-body\"></div>';\n  html += '</div>';\n\n  // Spawn count\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-spawn-count\">Spawns: <span id=\"se-spawn-count\">0</span></div>';\n  html += '<div class=\"se-selected-info\" id=\"se-selected-info\"></div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-clear\">Clear Group</div>';\n  html += '</div>';\n\n  // Action buttons\n  html += '<div class=\"se-section se-actions\">';\n  html += '<div class=\"se-btn se-action se-play\" id=\"se-play\">Play Wave</div>';\n  html += '<div class=\"se-btn se-action se-save\" id=\"se-save-spawns\">Save All</div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-copy-wave\">Copy Wave</div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-copy-all\">Copy All</div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-copy-enemies\">Copy Enemy Config</div>';\n  html += '</div>';\n\n  html += '</div>'; // end se-spawn-content\n\n  // \u2500\u2500\u2500 Level Tab Content \u2500\u2500\u2500\n  html += '<div id=\"se-level-content\" style=\"display:none\">';\n\n  // Arena preset selector\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Arena Preset</div>';\n  html += '<div class=\"se-preset-row\">';\n  html += '<select id=\"se-preset-select\" class=\"se-preset-select\"><option value=\"\">(unsaved)</option></select>';\n  html += '<div class=\"se-btn se-action se-small\" id=\"se-preset-load\">Load</div>';\n  html += '</div>';\n  html += '<div class=\"se-preset-row\" style=\"margin-top:4px\">';\n  html += '<div class=\"se-btn se-action se-save se-small\" id=\"se-preset-save\">Save Preset</div>';\n  html += '<div class=\"se-btn se-action se-del se-small\" id=\"se-preset-delete\">Delete</div>';\n  html += '</div>';\n  html += '</div>';\n\n  // Obstacles section\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Obstacles</div>';\n  html += '<div id=\"se-obstacle-list\" class=\"se-item-list\"></div>';\n  html += '<div class=\"se-btn se-action se-add\" id=\"se-add-obstacle\">+ Add Obstacle</div>';\n  html += '</div>';\n\n  // Pits section\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Pits</div>';\n  html += '<div id=\"se-pit-list\" class=\"se-item-list\"></div>';\n  html += '<div class=\"se-btn se-action se-add\" id=\"se-add-pit\">+ Add Pit</div>';\n  html += '</div>';\n\n  // Selected object properties\n  html += '<div class=\"se-section\" id=\"se-level-props\" style=\"display:none\">';\n  html += '<div class=\"se-group-label\" id=\"se-level-props-label\">Properties</div>';\n  html += '<div id=\"se-level-props-body\"></div>';\n  html += '</div>';\n\n  // Level actions\n  html += '<div class=\"se-section se-actions\">';\n  html += '<div class=\"se-btn se-action se-save\" id=\"se-save-arena\">Save Arena</div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-copy-arena\">Copy Arena Config</div>';\n  html += '</div>';\n\n  html += '</div>'; // end se-level-content\n\n  panel.innerHTML = html;\n  document.body.appendChild(panel);\n\n  // Cache tab content references\n  spawnTabContent = document.getElementById('se-spawn-content');\n  levelTabContent = document.getElementById('se-level-content');\n\n  // Tooltip element\n  const tooltipEl = document.createElement('div');\n  tooltipEl.id = 'se-tooltip';\n  document.body.appendChild(tooltipEl);\n\n  // Wire up events after DOM is created\n  setTimeout(() => wireEvents(), 0);\n}\n\nfunction wireEvents() {\n  // Tab switching \u2014 \"Level\" tab hands off to the full Level Editor\n  panel.querySelectorAll('.se-tab').forEach((tab: any) => {\n    tab.addEventListener('click', () => {\n      if (tab.dataset.tab === 'level') {\n        // Close spawn editor, open the visual level editor instead\n        exitEditor();\n        toggleLevelEditor();\n      } else {\n        switchTab(tab.dataset.tab);\n      }\n    });\n  });\n\n  // Wave navigation\n  document.getElementById('se-wave-prev')!.addEventListener('click', () => {\n    editorState.waveIndex = Math.max(0, editorState.waveIndex - 1);\n    editorState.groupIndex = 0;\n    editorState.selectedSpawnIdx = -1;\n    rebuildMarkers(); refreshUI();\n  });\n  document.getElementById('se-wave-next')!.addEventListener('click', () => {\n    editorState.waveIndex = Math.min(WAVES.length - 1, editorState.waveIndex + 1);\n    editorState.groupIndex = 0;\n    editorState.selectedSpawnIdx = -1;\n    rebuildMarkers(); refreshUI();\n  });\n  document.getElementById('se-wave-add')!.addEventListener('click', () => {\n    const newWave = {\n      wave: WAVES.length + 1,\n      message: `Wave ${WAVES.length + 1}`,\n      groups: [{\n        id: `w${WAVES.length + 1}g1`,\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 200,\n        spawns: [],\n      }],\n    };\n    WAVES.push(newWave);\n    editorState.waveIndex = WAVES.length - 1;\n    editorState.groupIndex = 0;\n    editorState.selectedSpawnIdx = -1;\n    rebuildMarkers(); refreshUI();\n  });\n\n  // Wave message input\n  const waveMsgInput = document.getElementById('se-wave-msg') as any;\n  waveMsgInput.addEventListener('input', () => {\n    const wave = WAVES[editorState.waveIndex];\n    if (wave) wave.message = waveMsgInput.value;\n  });\n  waveMsgInput.addEventListener('keydown', (e: any) => {\n    e.stopPropagation();\n    if (e.key === 'Enter') waveMsgInput.blur();\n  });\n  waveMsgInput.addEventListener('focus', () => waveMsgInput.select());\n\n  // Group navigation\n  document.getElementById('se-group-prev')!.addEventListener('click', () => {\n    editorState.groupIndex = Math.max(0, editorState.groupIndex - 1);\n    editorState.selectedSpawnIdx = -1;\n    rebuildMarkers(); refreshUI();\n  });\n  document.getElementById('se-group-next')!.addEventListener('click', () => {\n    const wave = WAVES[editorState.waveIndex];\n    if (wave) {\n      editorState.groupIndex = Math.min(wave.groups.length - 1, editorState.groupIndex + 1);\n      editorState.selectedSpawnIdx = -1;\n      rebuildMarkers(); refreshUI();\n    }\n  });\n  document.getElementById('se-group-add')!.addEventListener('click', () => {\n    const wave = WAVES[editorState.waveIndex];\n    if (!wave) return;\n    const newGroup = {\n      id: `w${editorState.waveIndex + 1}g${wave.groups.length + 1}`,\n      triggerDelay: 0,\n      telegraphDuration: 1500,\n      stagger: 200,\n      spawns: [],\n    };\n    wave.groups.push(newGroup);\n    editorState.groupIndex = wave.groups.length - 1;\n    rebuildMarkers(); refreshUI();\n  });\n  document.getElementById('se-group-del')!.addEventListener('click', () => {\n    const wave = WAVES[editorState.waveIndex];\n    if (!wave || wave.groups.length <= 1) return; // keep at least 1 group\n    wave.groups.splice(editorState.groupIndex, 1);\n    editorState.groupIndex = Math.min(editorState.groupIndex, wave.groups.length - 1);\n    rebuildMarkers(); refreshUI();\n  });\n\n  // Timing sliders\n  const triggerSlider = document.getElementById('se-trigger') as any;\n  const telegraphSlider = document.getElementById('se-telegraph') as any;\n  const staggerSlider = document.getElementById('se-stagger') as any;\n\n  // Push undo on mousedown (start of drag), not on every input tick\n  const sliderUndoOnce = (slider: any) => {\n    let pushed = false;\n    slider.addEventListener('mousedown', () => { pushUndo(); pushed = true; });\n    slider.addEventListener('touchstart', () => { if (!pushed) pushUndo(); pushed = true; });\n    slider.addEventListener('mouseup', () => { pushed = false; });\n    slider.addEventListener('touchend', () => { pushed = false; });\n  };\n  sliderUndoOnce(triggerSlider);\n  sliderUndoOnce(telegraphSlider);\n  sliderUndoOnce(staggerSlider);\n\n  triggerSlider.addEventListener('input', () => {\n    const group = getCurrentGroup();\n    if (group) group.triggerDelay = parseInt(triggerSlider.value);\n    (document.getElementById('se-trigger-val') as any).value = triggerSlider.value + ' ms';\n  });\n  telegraphSlider.addEventListener('input', () => {\n    const group = getCurrentGroup();\n    if (group) group.telegraphDuration = parseInt(telegraphSlider.value);\n    (document.getElementById('se-telegraph-val') as any).value = telegraphSlider.value + ' ms';\n  });\n  staggerSlider.addEventListener('input', () => {\n    const group = getCurrentGroup();\n    if (group) group.stagger = parseInt(staggerSlider.value);\n    (document.getElementById('se-stagger-val') as any).value = staggerSlider.value + ' ms';\n  });\n\n  // Wire text input handlers for timing sliders\n  const timingInputs = [\n    { inputId: 'se-trigger-val', sliderId: 'se-trigger', prop: 'triggerDelay', min: 0, max: 10000 },\n    { inputId: 'se-telegraph-val', sliderId: 'se-telegraph', prop: 'telegraphDuration', min: 500, max: 5000 },\n    { inputId: 'se-stagger-val', sliderId: 'se-stagger', prop: 'stagger', min: 0, max: 1000 },\n  ];\n  for (const t of timingInputs) {\n    const inp = document.getElementById(t.inputId) as any;\n    const slider = document.getElementById(t.sliderId) as any;\n    const commitTimingValue = () => {\n      const parsed = parseInt(inp.value);\n      if (isNaN(parsed)) {\n        const group = getCurrentGroup();\n        inp.value = (group ? (group as any)[t.prop] : slider.value) + ' ms';\n        return;\n      }\n      const clamped = Math.max(t.min, Math.min(t.max, parsed));\n      const group = getCurrentGroup();\n      if (group) (group as any)[t.prop] = clamped;\n      slider.value = clamped;\n      inp.value = clamped + ' ms';\n    };\n    inp.addEventListener('change', commitTimingValue);\n    inp.addEventListener('blur', commitTimingValue);\n    inp.addEventListener('keydown', (e: any) => {\n      e.stopPropagation();\n      if (e.key === 'Enter') inp.blur();\n    });\n    inp.addEventListener('focus', () => inp.select());\n  }\n\n  // Enemy type picker\n  document.getElementById('se-type-picker')!.addEventListener('click', (e: any) => {\n    const btn = e.target.closest('.se-type-btn');\n    if (btn) {\n      editorState.enemyType = btn.dataset.type;\n      refreshUI();\n    }\n  });\n\n  // Clear group\n  document.getElementById('se-clear')!.addEventListener('click', () => {\n    const group = getCurrentGroup();\n    if (group) {\n      pushUndo();\n      group.spawns = [];\n      rebuildMarkers(); refreshUI();\n    }\n  });\n\n  // Play wave\n  document.getElementById('se-play')!.addEventListener('click', playCurrentWave);\n\n  // Copy wave\n  document.getElementById('se-copy-wave')!.addEventListener('click', () => {\n    const text = buildWaveText(editorState.waveIndex);\n    copyToClipboard(text, document.getElementById('se-copy-wave')!);\n  });\n\n  // Copy all\n  document.getElementById('se-copy-all')!.addEventListener('click', () => {\n    const text = buildAllWavesText();\n    copyToClipboard(text, document.getElementById('se-copy-all')!);\n  });\n\n  // Copy enemy config\n  document.getElementById('se-copy-enemies')!.addEventListener('click', () => {\n    const text = buildEnemyConfigText();\n    copyToClipboard(text, document.getElementById('se-copy-enemies')!);\n  });\n\n  // Tuning section collapse toggle\n  document.getElementById('se-tuning-header')!.addEventListener('click', () => {\n    const body = document.getElementById('se-tuning-body')!;\n    body.classList.toggle('collapsed');\n    const header = document.getElementById('se-tuning-header')!;\n    header.innerHTML = body.classList.contains('collapsed')\n      ? 'Enemy Properties &#x25B6;'\n      : 'Enemy Properties &#x25BC;';\n  });\n\n  // \u2500\u2500\u2500 Preset Events \u2500\u2500\u2500\n  document.getElementById('se-preset-load')!.addEventListener('click', () => {\n    const select = document.getElementById('se-preset-select') as any;\n    if (select.value) loadPreset(select.value);\n  });\n\n  document.getElementById('se-preset-save')!.addEventListener('click', async () => {\n    let name = currentPresetName;\n    if (!name) {\n      name = prompt('Preset name:');\n      if (!name) return;\n    }\n    const btn = document.getElementById('se-preset-save')!;\n    await savePreset(name);\n    const orig = btn.textContent;\n    btn.textContent = 'Saved \\u2713';\n    btn.classList.add('copied');\n    setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 1200);\n  });\n\n  document.getElementById('se-preset-delete')!.addEventListener('click', async () => {\n    const select = document.getElementById('se-preset-select') as any;\n    const name = select.value;\n    if (!name) return;\n    if (!confirm(`Delete preset \"${name}\"?`)) return;\n    await deletePreset(name);\n  });\n\n  // Fetch presets on startup\n  refreshPresetDropdown();\n\n  // \u2500\u2500\u2500 Level Tab Events \u2500\u2500\u2500\n  document.getElementById('se-add-obstacle')!.addEventListener('click', () => {\n    pushUndo();\n    OBSTACLES.push({ x: 0, z: 0, w: 2, h: 1.5, d: 2 });\n    levelState.selectedType = 'obstacle';\n    levelState.selectedIdx = OBSTACLES.length - 1;\n    onArenaChanged();\n    rebuildLevelMarkers();\n    refreshUI();\n  });\n\n  document.getElementById('se-add-pit')!.addEventListener('click', () => {\n    pushUndo();\n    PITS.push({ x: 0, z: 0, w: 3, d: 3 });\n    levelState.selectedType = 'pit';\n    levelState.selectedIdx = PITS.length - 1;\n    onArenaChanged();\n    rebuildLevelMarkers();\n    refreshUI();\n  });\n\n  document.getElementById('se-copy-arena')!.addEventListener('click', () => {\n    const text = buildArenaConfigText();\n    copyToClipboard(text, document.getElementById('se-copy-arena')!);\n  });\n\n  // Save buttons\n  document.getElementById('se-save-spawns')!.addEventListener('click', async () => {\n    const btn = document.getElementById('se-save-spawns')!;\n    const wavesText = buildAllWavesText();\n    const enemiesText = buildEnemyConfigText();\n    await saveToFile('config/waves.js', wavesText, btn);\n    // Save enemies too (reuse same button \u2014 brief delay so \"Saved\" shows for waves)\n    await saveToFile('config/enemies.js', enemiesText, btn);\n  });\n\n  document.getElementById('se-save-arena')!.addEventListener('click', () => {\n    const text = buildArenaConfigText();\n    saveToFile('config/arena.js', text, document.getElementById('se-save-arena')!);\n  });\n\n  // Prevent right-click context menu on canvas\n  window.addEventListener('contextmenu', (e: any) => {\n    if (active) e.preventDefault();\n  });\n\n  // Custom tooltip on hover \u2014 replaces native title for has-tooltip elements\n  const tooltipEl = document.getElementById('se-tooltip')!;\n  let tooltipTarget: any = null;\n\n  panel.addEventListener('mouseover', (e: any) => {\n    const el = e.target.closest('.has-tooltip');\n    if (el && el.getAttribute('data-tip')) {\n      tooltipTarget = el;\n      tooltipEl.textContent = el.getAttribute('data-tip');\n      tooltipEl.classList.add('visible');\n      positionTooltip(el);\n    }\n  });\n\n  panel.addEventListener('mouseout', (e: any) => {\n    const el = e.target.closest('.has-tooltip');\n    if (el === tooltipTarget) {\n      tooltipTarget = null;\n      tooltipEl.classList.remove('visible');\n    }\n  });\n\n  function positionTooltip(targetEl: any) {\n    const rect = targetEl.getBoundingClientRect();\n    const tipRect = tooltipEl.getBoundingClientRect();\n    // Position to the right of the label, vertically centered\n    let left = rect.right + 8;\n    let top = rect.top + rect.height / 2 - tipRect.height / 2;\n    // If it goes off-screen right, show below instead\n    if (left + 200 > window.innerWidth) {\n      left = rect.left;\n      top = rect.bottom + 6;\n    }\n    // Clamp to viewport\n    top = Math.max(4, Math.min(window.innerHeight - tipRect.height - 4, top));\n    tooltipEl.style.left = left + 'px';\n    tooltipEl.style.top = top + 'px';\n  }\n\n  // Cache DOM refs\n  waveLabel = document.getElementById('se-wave-label');\n  groupLabel = document.getElementById('se-group-label');\n  spawnCountLabel = document.getElementById('se-spawn-count');\n}\n\nfunction getCurrentGroup() {\n  const wave = WAVES[editorState.waveIndex];\n  if (!wave) return null;\n  return wave.groups[editorState.groupIndex] || null;\n}\n\nfunction refreshUI() {\n  if (currentTab === 'spawn') {\n    refreshSpawnUI();\n  } else {\n    refreshLevelUI();\n  }\n}\n\nfunction refreshSpawnUI() {\n  const wave = WAVES[editorState.waveIndex];\n\n  // Wave label\n  if (waveLabel) waveLabel.textContent = wave ? wave.wave : '?';\n\n  // Wave message\n  const waveMsgInput = document.getElementById('se-wave-msg') as any;\n  if (waveMsgInput) waveMsgInput.value = wave ? (wave.message || '') : '';\n\n  // Group label\n  const group = getCurrentGroup();\n  if (groupLabel) groupLabel.textContent = group ? group.id : '?';\n\n  // Spawn count\n  if (spawnCountLabel) spawnCountLabel.textContent = group ? group.spawns.length : 0;\n\n  // Timing sliders\n  const triggerSlider = document.getElementById('se-trigger') as any;\n  const telegraphSlider = document.getElementById('se-telegraph') as any;\n  const staggerSlider = document.getElementById('se-stagger') as any;\n  if (group && triggerSlider) {\n    triggerSlider.value = group.triggerDelay;\n    (document.getElementById('se-trigger-val') as any).value = group.triggerDelay + ' ms';\n    telegraphSlider.value = group.telegraphDuration;\n    (document.getElementById('se-telegraph-val') as any).value = group.telegraphDuration + ' ms';\n    staggerSlider.value = group.stagger;\n    (document.getElementById('se-stagger-val') as any).value = group.stagger + ' ms';\n  }\n\n  // Enemy type buttons\n  const btns = document.querySelectorAll('.se-type-btn');\n  btns.forEach((btn: any) => {\n    btn.classList.toggle('selected', btn.dataset.type === editorState.enemyType);\n  });\n\n  // Selected spawn info\n  const infoEl = document.getElementById('se-selected-info') as any;\n  if (infoEl) {\n    if (editorState.selectedSpawnIdx >= 0 && group && group.spawns[editorState.selectedSpawnIdx]) {\n      const s = group.spawns[editorState.selectedSpawnIdx];\n      const typeName = (ENEMY_TYPES as any)[s.type] ? (ENEMY_TYPES as any)[s.type].name : s.type;\n      infoEl.textContent = `Selected: ${typeName} (${s.x}, ${s.z})`;\n      infoEl.style.display = 'block';\n    } else {\n      infoEl.style.display = 'none';\n    }\n  }\n\n  // Per-enemy tuning sliders (rebuild only when type changes)\n  rebuildEnemyTuningSliders();\n}\n\nfunction refreshLevelUI() {\n  // Rebuild obstacle list\n  const obsList = document.getElementById('se-obstacle-list');\n  if (obsList) {\n    let html = '';\n    for (let i = 0; i < OBSTACLES.length; i++) {\n      const o = OBSTACLES[i];\n      const sel = levelState.selectedType === 'obstacle' && levelState.selectedIdx === i;\n      html += `<div class=\"se-item-row${sel ? ' selected' : ''}\" data-type=\"obstacle\" data-idx=\"${i}\">`;\n      html += `<span class=\"se-item-label\">Obs ${i + 1}</span>`;\n      html += `<span class=\"se-item-coords\">(${o.x}, ${o.z})</span>`;\n      html += `<span class=\"se-item-dims\">${o.w}\\u00d7${o.d}\\u00d7${o.h}</span>`;\n      html += '</div>';\n    }\n    obsList.innerHTML = html;\n\n    // Click handlers for list items\n    obsList.querySelectorAll('.se-item-row').forEach((row: any) => {\n      row.addEventListener('click', () => {\n        levelState.selectedType = row.dataset.type;\n        levelState.selectedIdx = parseInt(row.dataset.idx);\n        rebuildLevelMarkers();\n        refreshLevelUI();\n      });\n    });\n  }\n\n  // Rebuild pit list\n  const pitList = document.getElementById('se-pit-list');\n  if (pitList) {\n    let html = '';\n    for (let i = 0; i < PITS.length; i++) {\n      const p = PITS[i];\n      const sel = levelState.selectedType === 'pit' && levelState.selectedIdx === i;\n      html += `<div class=\"se-item-row${sel ? ' selected' : ''}\" data-type=\"pit\" data-idx=\"${i}\">`;\n      html += `<span class=\"se-item-label\">Pit ${i + 1}</span>`;\n      html += `<span class=\"se-item-coords\">(${p.x}, ${p.z})</span>`;\n      html += `<span class=\"se-item-dims\">${p.w}\\u00d7${p.d}</span>`;\n      html += '</div>';\n    }\n    pitList.innerHTML = html;\n\n    pitList.querySelectorAll('.se-item-row').forEach((row: any) => {\n      row.addEventListener('click', () => {\n        levelState.selectedType = row.dataset.type;\n        levelState.selectedIdx = parseInt(row.dataset.idx);\n        rebuildLevelMarkers();\n        refreshLevelUI();\n      });\n    });\n  }\n\n  // Properties panel for selected object\n  const propsPanel = document.getElementById('se-level-props') as any;\n  const propsLabel = document.getElementById('se-level-props-label') as any;\n  const propsBody = document.getElementById('se-level-props-body') as any;\n\n  if (propsPanel && levelState.selectedType && levelState.selectedIdx >= 0) {\n    const arr = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n    const obj = arr[levelState.selectedIdx] as any;\n    if (!obj) {\n      propsPanel.style.display = 'none';\n      return;\n    }\n\n    propsPanel.style.display = 'block';\n    const label = levelState.selectedType === 'obstacle'\n      ? `Obstacle ${levelState.selectedIdx + 1}`\n      : `Pit ${levelState.selectedIdx + 1}`;\n    propsLabel.textContent = label;\n\n    const sliders = levelState.selectedType === 'obstacle'\n      ? [\n          { label: 'X', key: 'x', min: -19, max: 19, step: 0.5, unit: '' },\n          { label: 'Z', key: 'z', min: -19, max: 19, step: 0.5, unit: '' },\n          { label: 'Width', key: 'w', min: 0.5, max: 10, step: 0.5, unit: 'u' },\n          { label: 'Depth', key: 'd', min: 0.5, max: 10, step: 0.5, unit: 'u' },\n          { label: 'Height', key: 'h', min: 0.5, max: 5, step: 0.5, unit: 'u' },\n        ]\n      : [\n          { label: 'X', key: 'x', min: -19, max: 19, step: 0.5, unit: '' },\n          { label: 'Z', key: 'z', min: -19, max: 19, step: 0.5, unit: '' },\n          { label: 'Width', key: 'w', min: 1, max: 10, step: 0.5, unit: 'u' },\n          { label: 'Depth', key: 'd', min: 1, max: 10, step: 0.5, unit: 'u' },\n        ];\n\n    let html = '';\n    for (const s of sliders) {\n      const val = obj[s.key];\n      const display = Number.isInteger(val) ? val : parseFloat(val).toFixed(1);\n      const unitDisplay = s.unit ? ' ' + s.unit : '';\n      html += `<div class=\"se-slider-row\">`;\n      html += `<span>${s.label}</span>`;\n      html += `<input type=\"range\" class=\"se-level-slider\" data-key=\"${s.key}\" min=\"${s.min}\" max=\"${s.max}\" step=\"${s.step}\" value=\"${val}\">`;\n      html += `<input type=\"text\" class=\"se-level-val\" data-key=\"${s.key}\" value=\"${display}${unitDisplay}\">`;\n      html += `</div>`;\n    }\n\n    // Delete button\n    html += `<div class=\"se-btn se-action se-del\" id=\"se-delete-level-obj\">Delete ${levelState.selectedType === 'obstacle' ? 'Obstacle' : 'Pit'}</div>`;\n\n    propsBody.innerHTML = html;\n\n    // Wire slider events\n    propsBody.querySelectorAll('.se-level-slider').forEach((el: any) => {\n      const key = el.dataset.key;\n      const sdef = sliders.find((s: any) => s.key === key)!;\n      el.addEventListener('input', () => {\n        const newVal = parseFloat(el.value);\n        const arrRef = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n        const objRef = arrRef[levelState.selectedIdx] as any;\n        if (!objRef) return;\n        objRef[key] = newVal;\n        const unitDisplay = sdef.unit ? ' ' + sdef.unit : '';\n        const display = Number.isInteger(newVal) ? newVal : parseFloat(newVal as any).toFixed(1);\n        propsBody.querySelector(`.se-level-val[data-key=\"${key}\"]`).value = display + unitDisplay;\n        onArenaChanged();\n        rebuildLevelMarkers();\n      });\n\n      // Undo on first mousedown\n      let pushed = false;\n      el.addEventListener('mousedown', () => { pushUndo(); pushed = true; });\n      el.addEventListener('mouseup', () => { pushed = false; });\n    });\n\n    // Wire text input handlers\n    propsBody.querySelectorAll('.se-level-val').forEach((inp: any) => {\n      const key = inp.dataset.key;\n      const sdef = sliders.find((s: any) => s.key === key)!;\n      const commitValue = () => {\n        const parsed = parseFloat(inp.value);\n        if (isNaN(parsed)) {\n          const arrRef = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n          const objRef = arrRef[levelState.selectedIdx] as any;\n          if (objRef) {\n            const val = objRef[key];\n            const unitDisplay = sdef.unit ? ' ' + sdef.unit : '';\n            inp.value = (Number.isInteger(val) ? val : parseFloat(val).toFixed(1)) + unitDisplay;\n          }\n          return;\n        }\n        const clamped = Math.max(sdef.min, Math.min(sdef.max, parsed));\n        const arrRef = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n        const objRef = arrRef[levelState.selectedIdx] as any;\n        if (!objRef) return;\n        pushUndo();\n        objRef[key] = clamped;\n        const rangeEl = propsBody.querySelector(`.se-level-slider[data-key=\"${key}\"]`);\n        if (rangeEl) rangeEl.value = clamped;\n        const unitDisplay = sdef.unit ? ' ' + sdef.unit : '';\n        inp.value = (Number.isInteger(clamped) ? clamped : parseFloat(clamped as any).toFixed(1)) + unitDisplay;\n        onArenaChanged();\n        rebuildLevelMarkers();\n      };\n      inp.addEventListener('change', commitValue);\n      inp.addEventListener('blur', commitValue);\n      inp.addEventListener('keydown', (e: any) => {\n        e.stopPropagation();\n        if (e.key === 'Enter') inp.blur();\n      });\n      inp.addEventListener('focus', () => inp.select());\n    });\n\n    // Delete button\n    const deleteBtn = document.getElementById('se-delete-level-obj');\n    if (deleteBtn) {\n      deleteBtn.addEventListener('click', () => {\n        pushUndo();\n        if (levelState.selectedType === 'obstacle') {\n          OBSTACLES.splice(levelState.selectedIdx, 1);\n        } else {\n          PITS.splice(levelState.selectedIdx, 1);\n        }\n        levelState.selectedType = null;\n        levelState.selectedIdx = -1;\n        onArenaChanged();\n        rebuildLevelMarkers();\n        refreshLevelUI();\n      });\n    }\n  } else if (propsPanel) {\n    propsPanel.style.display = 'none';\n  }\n}\n\n// \u2500\u2500\u2500 Per-Enemy Tuning Sliders \u2500\u2500\u2500\n\nfunction rebuildEnemyTuningSliders() {\n  const container = document.getElementById('se-tuning-body');\n  if (!container) return;\n\n  // Only rebuild if type changed\n  if (lastBuiltTuningType === editorState.enemyType) {\n    // Just update values without rebuilding DOM\n    updateTuningSliderValues();\n    return;\n  }\n  lastBuiltTuningType = editorState.enemyType;\n\n  const sliders = ENEMY_TUNING_SLIDERS[editorState.enemyType];\n  if (!sliders) {\n    container.innerHTML = '<div style=\"color:rgba(255,255,255,0.3);font-size:9px;padding:4px;\">No tuning available</div>';\n    return;\n  }\n\n  const cfg = (ENEMY_TYPES as any)[editorState.enemyType];\n  let html = '';\n  for (let i = 0; i < sliders.length; i++) {\n    const s = sliders[i];\n    const val = getNestedValue(cfg, s.key);\n    const displayVal = (val != null) ? (Number.isInteger(s.step) ? val : parseFloat(val).toFixed(2)) : '?';\n    const unitStr = s.unit || s.suffix || '';\n    const unitDisplay = unitStr ? ' ' + unitStr : '';\n    const tipAttr = s.tip ? ` data-tip=\"${s.tip.replace(/\"/g, '&quot;')}\"` : '';\n    const tipClass = s.tip ? ' has-tooltip' : '';\n    html += `<div class=\"se-slider-row\">`;\n    html += `<span class=\"${tipClass}\"${tipAttr}>${s.label}</span>`;\n    html += `<input type=\"range\" class=\"se-tuning-slider\" data-idx=\"${i}\" min=\"${s.min}\" max=\"${s.max}\" step=\"${s.step}\" value=\"${val != null ? val : s.min}\">`;\n    html += `<input type=\"text\" class=\"se-tuning-val\" data-idx=\"${i}\" value=\"${displayVal}${unitDisplay}\">`;\n    html += `</div>`;\n  }\n  container.innerHTML = html;\n\n  // Wire slider events\n  const sliderEls = container.querySelectorAll('.se-tuning-slider');\n  sliderEls.forEach((el: any) => {\n    const idx = parseInt(el.dataset.idx);\n    const s = sliders[idx];\n\n    el.addEventListener('input', () => {\n      const newVal = parseFloat(el.value);\n      setNestedValue((ENEMY_TYPES as any)[editorState.enemyType], s.key, newVal);\n      const unitStr = s.unit || s.suffix || '';\n      const unitDisplay = unitStr ? ' ' + unitStr : '';\n      const display = Number.isInteger(s.step) ? newVal : parseFloat(newVal as any).toFixed(2);\n      container.querySelector(`.se-tuning-val[data-idx=\"${idx}\"]`)!.setAttribute('value', display + unitDisplay);\n      (container.querySelector(`.se-tuning-val[data-idx=\"${idx}\"]`) as any).value = display + unitDisplay;\n    });\n  });\n\n  // Wire text input handlers for direct value entry\n  const valInputs = container.querySelectorAll('.se-tuning-val');\n  valInputs.forEach((inp: any) => {\n    const idx = parseInt(inp.dataset.idx);\n    const s = sliders[idx];\n\n    const commitValue = () => {\n      const parsed = parseFloat(inp.value);\n      if (isNaN(parsed)) {\n        // Revert to current config value\n        const cur = getNestedValue((ENEMY_TYPES as any)[editorState.enemyType], s.key);\n        const unitStr = s.unit || s.suffix || '';\n        const unitDisplay = unitStr ? ' ' + unitStr : '';\n        const display = (cur != null) ? (Number.isInteger(s.step) ? cur : parseFloat(cur).toFixed(2)) : s.min;\n        inp.value = display + unitDisplay;\n        return;\n      }\n      const clamped = Math.max(s.min, Math.min(s.max, parsed));\n      setNestedValue((ENEMY_TYPES as any)[editorState.enemyType], s.key, clamped);\n      // Sync range slider\n      const rangeEl = container.querySelector(`.se-tuning-slider[data-idx=\"${idx}\"]`) as any;\n      if (rangeEl) rangeEl.value = clamped;\n      // Re-format display\n      const unitStr = s.unit || s.suffix || '';\n      const unitDisplay = unitStr ? ' ' + unitStr : '';\n      const display = Number.isInteger(s.step) ? clamped : parseFloat(clamped as any).toFixed(2);\n      inp.value = display + unitDisplay;\n    };\n\n    inp.addEventListener('change', commitValue);\n    inp.addEventListener('blur', commitValue);\n\n    // Stop keyboard events from reaching the game while typing in inputs\n    inp.addEventListener('keydown', (e: any) => {\n      e.stopPropagation();\n      if (e.key === 'Enter') inp.blur();\n    });\n\n    // Select all text on focus for easy overwriting\n    inp.addEventListener('focus', () => inp.select());\n  });\n}\n\nfunction updateTuningSliderValues() {\n  const container = document.getElementById('se-tuning-body');\n  if (!container) return;\n  const sliders = ENEMY_TUNING_SLIDERS[editorState.enemyType];\n  if (!sliders) return;\n  const cfg = (ENEMY_TYPES as any)[editorState.enemyType];\n\n  const sliderEls = container.querySelectorAll('.se-tuning-slider');\n  sliderEls.forEach((el: any) => {\n    const idx = parseInt(el.dataset.idx);\n    const s = sliders[idx];\n    if (!s) return;\n    const val = getNestedValue(cfg, s.key);\n    if (val != null) {\n      el.value = val;\n      const unitStr = s.unit || s.suffix || '';\n      const unitDisplay = unitStr ? ' ' + unitStr : '';\n      const display = Number.isInteger(s.step) ? val : parseFloat(val).toFixed(2);\n      (container.querySelector(`.se-tuning-val[data-idx=\"${idx}\"]`) as any).value = display + unitDisplay;\n    }\n  });\n}\n\nfunction buildEnemyConfigText() {\n  let text = 'export const ENEMY_TYPES = {\\n';\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    text += `  ${name}: ${JSON.stringify(cfg, null, 4).split('\\n').map((l: string, i: number) => i === 0 ? l : '  ' + l).join('\\n')},\\n`;\n  }\n  text += '};\\n';\n  return text;\n}\n\nfunction buildArenaConfigText() {\n  let text = '// Arena layout \u2014 shared between renderer (meshes) and physics (collision)\\n';\n  text += '// All obstacles and walls defined here so designer can rearrange the arena\\n\\n';\n  text += `export let ARENA_HALF_X = ${ARENA_HALF_X};\\n`;\n  text += `export let ARENA_HALF_Z = ${ARENA_HALF_Z};\\n`;\n  text += `export let ARENA_HALF = ${ARENA_HALF_X}; // legacy alias\\n\\n`;\n  text += '// Obstacles: x, z = center position; w, d = width/depth on xz plane; h = height (visual only)\\n';\n  text += 'export const OBSTACLES = [\\n';\n  for (const o of OBSTACLES) {\n    text += `  { x: ${o.x}, z: ${o.z}, w: ${o.w}, h: ${o.h}, d: ${o.d} },\\n`;\n  }\n  text += '];\\n\\n';\n  text += '// Walls: auto-generated from ARENA_HALF\\n';\n  text += 'export const WALL_THICKNESS = 0.5;\\n';\n  text += 'export const WALL_HEIGHT = 2;\\n\\n';\n  text += '// Pits: x, z = center position; w, d = width/depth on xz plane\\n';\n  text += '// Entities that enter a pit die instantly. Enemies edge-slide around them.\\n';\n  text += 'export const PITS = [\\n';\n  for (const p of PITS) {\n    text += `  { x: ${p.x}, z: ${p.z}, w: ${p.w}, d: ${p.d} },\\n`;\n  }\n  text += '];\\n';\n  // Static helper functions \u2014 appended verbatim\n  text += ARENA_STATIC_SUFFIX;\n  return text;\n}\n\n// Static portion of arena.js (helper functions that don't change)\nconst ARENA_STATIC_SUFFIX = `\n// Convert pits to AABB format for collision\nexport function getPitBounds() {\n  return PITS.map(p => ({\n    minX: p.x - p.w / 2,\n    maxX: p.x + p.w / 2,\n    minZ: p.z - p.d / 2,\n    maxZ: p.z + p.d / 2,\n  }));\n}\n\n// Pre-computed AABB list for collision (obstacles + walls)\n// Each entry: { minX, maxX, minZ, maxZ }\nexport function getCollisionBounds() {\n  const bounds = [];\n\n  // Obstacles\n  for (const o of OBSTACLES) {\n    bounds.push({\n      minX: o.x - o.w / 2,\n      maxX: o.x + o.w / 2,\n      minZ: o.z - o.d / 2,\n      maxZ: o.z + o.d / 2,\n    });\n  }\n\n  // Walls\n  const hx = ARENA_HALF_X;\n  const hz = ARENA_HALF_Z;\n  const t = WALL_THICKNESS;\n  // North wall (far end, +Z)\n  bounds.push({ minX: -hx - t/2, maxX: hx + t/2, minZ: hz - t/2, maxZ: hz + t/2 });\n  // South wall (near end, -Z)\n  bounds.push({ minX: -hx - t/2, maxX: hx + t/2, minZ: -hz - t/2, maxZ: -hz + t/2 });\n  // East wall (+X)\n  bounds.push({ minX: hx - t/2, maxX: hx + t/2, minZ: -hz - t/2, maxZ: hz + t/2 });\n  // West wall (-X)\n  bounds.push({ minX: -hx - t/2, maxX: -hx + t/2, minZ: -hz - t/2, maxZ: hz + t/2 });\n\n  return bounds;\n}\n`;\n\n// \u2500\u2500\u2500 Play Wave \u2500\u2500\u2500\n\nfunction playCurrentWave() {\n  exitEditor();\n  // Clear enemies and projectiles, then start the wave\n  clearEnemies(gameStateRef);\n  releaseAllProjectiles();\n  resetWaveRunner();\n  gameStateRef.phase = 'playing';\n  startWave(editorState.waveIndex, gameStateRef);\n}\n\n// \u2500\u2500\u2500 Save to File (via dev server) \u2500\u2500\u2500\n\nasync function saveToFile(filename: string, content: string, btnEl: any) {\n  const orig = btnEl.textContent;\n  btnEl.textContent = 'Saving...';\n  try {\n    const res = await fetch('/save', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ file: filename, content }),\n    });\n    if (!res.ok) throw new Error(res.statusText);\n    btnEl.textContent = 'Saved \\u2713';\n    btnEl.classList.add('copied');\n  } catch (e) {\n    btnEl.textContent = 'Error!';\n    console.error('[spawnEditor] Save failed:', filename, e);\n  }\n  setTimeout(() => { btnEl.textContent = orig; btnEl.classList.remove('copied'); }, 1200);\n}\n\n// \u2500\u2500\u2500 Copy to Clipboard \u2500\u2500\u2500\n\nfunction copyToClipboard(text: string, btnEl: any) {\n  navigator.clipboard.writeText(text).then(() => {\n    const orig = btnEl.textContent;\n    btnEl.textContent = 'Copied!';\n\n    btnEl.classList.add('copied');\n    setTimeout(() => {\n      btnEl.textContent = orig;\n      btnEl.classList.remove('copied');\n    }, 1200);\n  });\n}\n\nfunction buildWaveText(waveIdx: number) {\n  const wave = WAVES[waveIdx];\n  if (!wave) return '';\n  return formatWaveObj(wave);\n}\n\nfunction buildAllWavesText() {\n  const lines = [\n    '// Wave definitions \u2014 each wave has groups of spawns with independent timing',\n    '// Designer edits this file or uses the spawn editor (backtick key) to place visually',\n    '',\n    'export const WAVES = [',\n  ];\n  for (let i = 0; i < WAVES.length; i++) {\n    lines.push('  ' + formatWaveObj(WAVES[i]).split('\\n').join('\\n  ') + ',');\n  }\n  lines.push('];');\n  lines.push('');\n  return lines.join('\\n');\n}\n\nfunction formatWaveObj(wave: any) {\n  let s = '{\\n';\n  s += `  wave: ${wave.wave},\\n`;\n  s += `  message: '${wave.message}',\\n`;\n  s += `  groups: [\\n`;\n  for (const g of wave.groups) {\n    s += `    {\\n`;\n    s += `      id: '${g.id}',\\n`;\n    s += `      triggerDelay: ${g.triggerDelay},\\n`;\n    s += `      telegraphDuration: ${g.telegraphDuration},\\n`;\n    s += `      stagger: ${g.stagger},\\n`;\n    s += `      spawns: [\\n`;\n    for (const sp of g.spawns) {\n      s += `        { type: '${sp.type}', x: ${sp.x}, z: ${sp.z} },\\n`;\n    }\n    s += `      ],\\n`;\n    s += `    },\\n`;\n  }\n  s += `  ]\\n`;\n  s += `}`;\n  return s;\n}\n\n// \u2500\u2500\u2500 Styles \u2500\u2500\u2500\n\nfunction injectStyles() {\n  const style = document.createElement('style');\n  style.textContent = `\n    #spawn-editor {\n      position: fixed;\n      top: 60px;\n      left: 20px;\n      width: 320px;\n      max-height: calc(100vh - 80px);\n      overflow-y: auto;\n      z-index: 200;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      pointer-events: all;\n      background: rgba(10, 10, 26, 0.94);\n      border: 1px solid rgba(68, 255, 136, 0.2);\n      border-radius: 6px;\n      padding: 14px;\n      backdrop-filter: blur(8px);\n    }\n\n    #spawn-editor.hidden {\n      display: none;\n    }\n\n    #spawn-editor::-webkit-scrollbar {\n      width: 4px;\n    }\n    #spawn-editor::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.2);\n    }\n    #spawn-editor::-webkit-scrollbar-thumb {\n      background: rgba(68, 255, 136, 0.3);\n      border-radius: 2px;\n    }\n\n    /* \u2500\u2500\u2500 Tabs \u2500\u2500\u2500 */\n    .se-tabs {\n      display: flex;\n      gap: 2px;\n      margin-bottom: 12px;\n      border-bottom: 1px solid rgba(68, 255, 136, 0.15);\n      padding-bottom: 0;\n    }\n\n    .se-tab {\n      flex: 1;\n      text-align: center;\n      padding: 6px 0;\n      font-size: 10px;\n      letter-spacing: 2px;\n      text-transform: uppercase;\n      color: rgba(255, 255, 255, 0.4);\n      cursor: pointer;\n      user-select: none;\n      border-bottom: 2px solid transparent;\n      transition: all 0.15s ease;\n      margin-bottom: -1px;\n    }\n\n    .se-tab:hover {\n      color: rgba(255, 255, 255, 0.7);\n    }\n\n    .se-tab.active {\n      color: rgba(68, 255, 136, 0.9);\n      border-bottom-color: rgba(68, 255, 136, 0.8);\n    }\n\n    .se-title {\n      font-size: 10px;\n      color: rgba(68, 255, 136, 0.8);\n      letter-spacing: 2px;\n      text-transform: uppercase;\n      margin-bottom: 12px;\n      padding-bottom: 4px;\n      border-bottom: 1px solid rgba(68, 255, 136, 0.15);\n    }\n\n    .se-section {\n      margin-bottom: 10px;\n    }\n\n    .se-group-label {\n      font-size: 9px;\n      color: rgba(68, 255, 136, 0.5);\n      letter-spacing: 1.5px;\n      text-transform: uppercase;\n      margin-bottom: 5px;\n    }\n\n    .se-wave-msg {\n      width: 100%;\n      margin-top: 6px;\n      background: rgba(255, 255, 255, 0.03);\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      border-radius: 3px;\n      color: rgba(255, 255, 255, 0.8);\n      font-size: 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      padding: 4px 6px;\n      outline: none;\n      box-sizing: border-box;\n    }\n    .se-wave-msg:hover {\n      border-color: rgba(255, 255, 255, 0.2);\n    }\n    .se-wave-msg:focus {\n      border-color: rgba(68, 255, 136, 0.5);\n      background: rgba(0, 0, 0, 0.3);\n    }\n\n    .se-selector {\n      display: flex;\n      align-items: center;\n      gap: 6px;\n    }\n\n    .se-selector span {\n      font-size: 13px;\n      color: rgba(255, 255, 255, 0.8);\n      min-width: 30px;\n      text-align: center;\n    }\n\n    .se-btn {\n      padding: 3px 8px;\n      font-size: 11px;\n      color: rgba(255, 255, 255, 0.6);\n      background: rgba(255, 255, 255, 0.05);\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 3px;\n      cursor: pointer;\n      user-select: none;\n      transition: all 0.12s ease;\n    }\n\n    .se-btn:hover {\n      background: rgba(68, 255, 136, 0.1);\n      border-color: rgba(68, 255, 136, 0.4);\n      color: rgba(255, 255, 255, 0.9);\n    }\n\n    .se-btn.se-add {\n      color: rgba(68, 255, 136, 0.7);\n    }\n\n    .se-btn.se-del {\n      color: rgba(255, 68, 102, 0.7);\n    }\n    .se-btn.se-del:hover {\n      background: rgba(255, 68, 102, 0.1);\n      border-color: rgba(255, 68, 102, 0.4);\n    }\n\n    .se-slider-row {\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      margin-bottom: 5px;\n    }\n\n    .se-slider-row span:first-child {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.5);\n      width: 75px;\n      flex-shrink: 0;\n    }\n\n    .se-slider-row span.has-tooltip {\n      cursor: help;\n      text-decoration: underline dotted rgba(255, 255, 255, 0.2);\n      text-underline-offset: 2px;\n    }\n\n    .se-slider-row input[type=\"range\"] {\n      flex: 1;\n      height: 4px;\n      -webkit-appearance: none;\n      appearance: none;\n      background: rgba(100, 100, 160, 0.3);\n      border-radius: 2px;\n      outline: none;\n      cursor: pointer;\n    }\n\n    .se-slider-row input[type=\"range\"]::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background: #44ff88;\n      cursor: pointer;\n      border: none;\n    }\n\n    .se-slider-row span:last-child {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.7);\n      min-width: 55px;\n      text-align: right;\n      flex-shrink: 0;\n    }\n\n    .se-slider-row input[type=\"text\"] {\n      background: transparent;\n      border: 1px solid transparent;\n      border-radius: 3px;\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      min-width: 55px;\n      max-width: 65px;\n      text-align: right;\n      padding: 1px 4px;\n      flex-shrink: 0;\n      outline: none;\n    }\n    .se-slider-row input[type=\"text\"]:hover {\n      border-color: rgba(255, 255, 255, 0.15);\n    }\n    .se-slider-row input[type=\"text\"]:focus {\n      border-color: rgba(68, 255, 136, 0.5);\n      color: rgba(255, 255, 255, 0.9);\n      background: rgba(0, 0, 0, 0.3);\n    }\n\n    .se-type-picker {\n      display: flex;\n      gap: 4px;\n      flex-wrap: wrap;\n    }\n\n    .se-type-btn {\n      padding: 4px 8px;\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.5);\n      background: rgba(255, 255, 255, 0.03);\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 3px;\n      cursor: pointer;\n      user-select: none;\n      transition: all 0.12s ease;\n    }\n\n    .se-type-btn:hover {\n      opacity: 1;\n      color: rgba(255, 255, 255, 0.9);\n    }\n\n    .se-type-btn.selected {\n      color: #fff;\n      background: rgba(255, 255, 255, 0.1);\n      border-width: 2px;\n      opacity: 1;\n    }\n\n    .se-collapsible {\n      cursor: pointer;\n      user-select: none;\n    }\n    .se-collapsible:hover {\n      color: rgba(68, 255, 136, 0.8);\n    }\n\n    #se-tuning-body {\n      max-height: 300px;\n      overflow-y: auto;\n      transition: max-height 0.2s ease;\n    }\n    #se-tuning-body.collapsed {\n      max-height: 0;\n      overflow: hidden;\n    }\n    #se-tuning-body::-webkit-scrollbar {\n      width: 4px;\n    }\n    #se-tuning-body::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.2);\n    }\n    #se-tuning-body::-webkit-scrollbar-thumb {\n      background: rgba(68, 255, 136, 0.3);\n      border-radius: 2px;\n    }\n\n    /* .se-tuning-val styling handled by input[type=\"text\"] rule above */\n\n    .se-spawn-count {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.5);\n      margin-bottom: 4px;\n    }\n\n    .se-selected-info {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.8);\n      background: rgba(255, 255, 255, 0.05);\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 3px;\n      padding: 4px 6px;\n      margin-bottom: 6px;\n      display: none;\n    }\n\n    .se-action {\n      margin-top: 4px;\n      text-align: center;\n      padding: 5px 0;\n    }\n\n    .se-actions {\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n    }\n\n    .se-play {\n      color: rgba(68, 255, 136, 0.8) !important;\n      border-color: rgba(68, 255, 136, 0.3) !important;\n    }\n    .se-play:hover {\n      background: rgba(68, 255, 136, 0.12) !important;\n      border-color: rgba(68, 255, 136, 0.6) !important;\n    }\n\n    .se-save {\n      color: rgba(68, 200, 255, 0.8) !important;\n      border-color: rgba(68, 200, 255, 0.3) !important;\n    }\n    .se-save:hover {\n      background: rgba(68, 200, 255, 0.12) !important;\n      border-color: rgba(68, 200, 255, 0.6) !important;\n    }\n\n    .se-btn.copied {\n      color: #ffcc44 !important;\n      border-color: rgba(255, 204, 68, 0.4) !important;\n    }\n\n    /* \u2500\u2500\u2500 Preset Selector \u2500\u2500\u2500 */\n    .se-preset-row {\n      display: flex;\n      gap: 4px;\n      align-items: center;\n    }\n\n    .se-preset-select {\n      flex: 1;\n      background: rgba(255, 255, 255, 0.05);\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 3px;\n      color: rgba(255, 255, 255, 0.8);\n      font-size: 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      padding: 4px 6px;\n      outline: none;\n    }\n\n    .se-preset-select:focus {\n      border-color: rgba(68, 200, 255, 0.5);\n    }\n\n    .se-btn.se-small {\n      font-size: 9px;\n      padding: 3px 8px;\n    }\n\n    /* \u2500\u2500\u2500 Level Tab Item List \u2500\u2500\u2500 */\n    .se-item-list {\n      max-height: 180px;\n      overflow-y: auto;\n      margin-bottom: 6px;\n    }\n\n    .se-item-list::-webkit-scrollbar {\n      width: 4px;\n    }\n    .se-item-list::-webkit-scrollbar-thumb {\n      background: rgba(68, 255, 136, 0.3);\n      border-radius: 2px;\n    }\n\n    .se-item-row {\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      padding: 4px 6px;\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.6);\n      border: 1px solid transparent;\n      border-radius: 3px;\n      cursor: pointer;\n      transition: all 0.1s ease;\n      margin-bottom: 2px;\n    }\n\n    .se-item-row:hover {\n      background: rgba(255, 255, 255, 0.05);\n      border-color: rgba(255, 255, 255, 0.1);\n    }\n\n    .se-item-row.selected {\n      background: rgba(68, 255, 136, 0.08);\n      border-color: rgba(68, 255, 136, 0.3);\n      color: rgba(255, 255, 255, 0.9);\n    }\n\n    .se-item-label {\n      flex-shrink: 0;\n      width: 50px;\n    }\n\n    .se-item-coords {\n      color: rgba(255, 255, 255, 0.4);\n      flex: 1;\n    }\n\n    .se-item-dims {\n      color: rgba(100, 180, 255, 0.6);\n      flex-shrink: 0;\n    }\n\n    #se-tooltip {\n      position: fixed;\n      z-index: 300;\n      max-width: 220px;\n      padding: 6px 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      font-size: 10px;\n      line-height: 1.4;\n      color: rgba(255, 255, 255, 0.9);\n      background: rgba(10, 10, 30, 0.95);\n      border: 1px solid rgba(68, 255, 136, 0.4);\n      border-radius: 4px;\n      pointer-events: none;\n      opacity: 0;\n      transition: opacity 0.12s ease;\n      backdrop-filter: blur(6px);\n    }\n\n    #se-tooltip.visible {\n      opacity: 1;\n    }\n\n    #editor-banner {\n      position: fixed;\n      top: 8px;\n      left: 50%;\n      transform: translateX(-50%);\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      font-size: 11px;\n      letter-spacing: 2px;\n      text-transform: uppercase;\n      color: rgba(68, 255, 136, 0.8);\n      background: rgba(10, 10, 26, 0.85);\n      border: 1px solid rgba(68, 255, 136, 0.3);\n      border-radius: 4px;\n      padding: 5px 16px;\n      z-index: 250;\n      pointer-events: none;\n      opacity: 0;\n      transition: opacity 0.2s ease;\n    }\n\n    #editor-banner.visible {\n      opacity: 1;\n    }\n  `;\n  document.head.appendChild(style);\n}\n", "import { initRenderer, updateCamera, getScene, getRendererInstance, getCamera } from './renderer';\nimport { initInput, updateInput, consumeInput, getInputState, autoAimClosestEnemy } from './input';\nimport { createPlayer, updatePlayer, getPlayerPos, resetPlayer } from '../entities/player';\nimport { initProjectilePool, updateProjectiles } from '../entities/projectile';\nimport { initEnemySystem, updateEnemies } from '../entities/enemy';\nimport { initMortarSystem, updateMortarProjectiles, updateIcePatches } from '../entities/mortarProjectile';\nimport { initRoomManager, loadRoom, updateRoomManager, resetRoomManager } from './roomManager';\nimport { checkCollisions, checkPitFalls, updateEffectGhosts, applyVelocities, applyObjectVelocities, resolveEnemyCollisions, resolveObjectCollisions, resolvePhysicsObjectBodyCollisions, resolveObjectObstacleCollisions, processDestroyedObstacles } from './physics';\nimport { initAoeTelegraph, updateAoeTelegraphs, updatePendingEffects } from './aoeTelegraph';\nimport { initHUD, updateHUD } from '../ui/hud';\nimport { initScreens, showGameOver, hideScreens } from '../ui/screens';\nimport { initDamageNumbers, updateDamageNumbers } from '../ui/damageNumbers';\nimport { initTuningPanel } from '../ui/tuning';\nimport { initSpawnEditor, checkEditorToggle, updateSpawnEditor, isEditorActive } from '../ui/spawnEditor';\nimport { initLevelEditor, toggleLevelEditor, isLevelEditorActive, updateLevelEditor } from '../ui/levelEditor';\nimport { initAudio, resumeAudio } from './audio';\nimport { initParticles, updateParticles } from './particles';\nimport { initBulletTime, toggleBulletTime, updateBulletTime, getBulletTimeScale, resetBulletTime } from './bulletTime';\nimport { initBendMode, toggleBendMode, isBendModeActive, isBendTargeting, handleBendClick, enterTargeting, resetBendMode, updateBendMode, updateBendHover } from './bendMode';\nimport { initRadialMenu, setOnBendSelected } from '../ui/radialMenu';\nimport { PLAYER, MELEE } from '../config/player';\nimport { on } from './events';\nimport { applyUrlParams, snapshotDefaults } from './urlParams';\nimport { GameState } from '../types/index';\n\nconst gameState: GameState = {\n  phase: 'waiting',\n  playerHealth: PLAYER.maxHealth,\n  playerMaxHealth: PLAYER.maxHealth,\n  currency: 0,\n  currentWave: 1,\n  enemies: [],\n  physicsObjects: [],\n  bendMode: false,\n  bendsPerRoom: 3,\n  abilities: {\n    dash:     { cooldownRemaining: 0 },\n    ultimate: { cooldownRemaining: 0, active: false, activeRemaining: 0, charging: false, chargeT: 0 }\n  }\n};\n\nlet lastTime = 0;\nlet hitPauseTimer = 0; // ms remaining \u2014 freeze frame on melee hit\n\nfunction gameLoop(timestamp: number): void {\n  requestAnimationFrame(gameLoop);\n\n  if (gameState.phase === 'waiting') {\n    getRendererInstance().render(getScene(), getCamera());\n    return;\n  }\n\n  if (gameState.phase === 'gameOver') {\n    getRendererInstance().render(getScene(), getCamera());\n    return;\n  }\n\n  if (gameState.phase === 'editorPaused') {\n    updateInput();\n    updateSpawnEditor(0);\n    if (isLevelEditorActive()) updateLevelEditor();\n    getRendererInstance().render(getScene(), getCamera());\n    consumeInput();\n    return;\n  }\n\n  let dt = (timestamp - lastTime) / 1000;\n  lastTime = timestamp;\n  dt = Math.min(dt, 0.05);\n\n  if (dt <= 0) return;\n\n  // Hit pause (freeze frame on melee hit)\n  if (hitPauseTimer > 0) {\n    hitPauseTimer -= dt * 1000;\n    getRendererInstance().render(getScene(), getCamera());\n    return;\n  }\n\n  // 1. Input\n  updateInput();\n  autoAimClosestEnemy(gameState.enemies);\n  const input = getInputState();\n\n  // 1b. Bend Mode toggle (Q key) \u2014 takes priority over bullet time\n  if (input.bendMode) toggleBendMode();\n  if (!isBendModeActive() && input.bulletTime) toggleBulletTime();\n  updateBulletTime(dt);\n  const gameDt = dt * getBulletTimeScale(); // slowed dt for world systems\n\n  // 1c. Bend targeting click \u2014 when bend mode is active and a bend is selected\n  if (isBendModeActive() && isBendTargeting() && input.attack) {\n    handleBendClick(input.mouseNDC, gameState);\n  }\n\n  // 1d. Bend mode update \u2014 highlights + hover detection\n  updateBendMode(dt, gameState);\n  if (isBendModeActive() && isBendTargeting()) {\n    updateBendHover(input.mouseNDC, gameState);\n  }\n\n  // 2. Player (uses real dt \u2014 player moves at normal speed)\n  // Gate combat input when bend mode is active\n  if (isBendModeActive()) {\n    const gatedInput = { ...input, attack: false, dash: false, ultimate: false, ultimateHeld: false };\n    updatePlayer(gatedInput, dt, gameState);\n  } else {\n    updatePlayer(input, dt, gameState);\n  }\n\n  // 3. Projectiles (slowed)\n  updateProjectiles(gameDt);\n\n  // 4. Room Manager (slowed)\n  updateRoomManager(gameDt, gameState);\n\n  // 5. Enemies (slowed)\n  updateEnemies(gameDt, getPlayerPos(), gameState);\n\n  // 6. Collisions\n  checkCollisions(gameState);\n\n  // 6a. Physics velocities \u2014 knockback sliding, wall slam detection (slowed)\n  applyVelocities(gameDt, gameState);\n\n  // 6a1. Physics object velocities \u2014 wall slam + pit fall (slowed)\n  applyObjectVelocities(gameDt, gameState);\n\n  // 6a2. Enemy-enemy collision (separation + momentum transfer)\n  resolveEnemyCollisions(gameState);\n\n  // 6a3. Object-object + object-enemy collision\n  resolveObjectCollisions(gameState);\n\n  // 6a3b. Physics objects as solid bodies \u2014 block player + enemy pathing\n  resolvePhysicsObjectBodyCollisions(gameState);\n\n  // 6a4. Object-obstacle collision (destructible obstacles)\n  resolveObjectObstacleCollisions(gameState);\n\n  // 6b. Pit falls\n  checkPitFalls(gameState);\n\n  // 6b1. Process destroyed obstacles (deferred removal)\n  processDestroyedObstacles();\n\n  // 6c. Effect ghosts (slowed)\n  updateEffectGhosts(gameDt);\n\n  // 6d. Particles (slowed)\n  updateParticles(gameDt);\n\n  // 7. AoE telegraphs (slowed)\n  updateAoeTelegraphs(gameDt);\n  updatePendingEffects(gameDt);\n\n  // 8. Mortar projectiles (slowed)\n  updateMortarProjectiles(gameDt);\n\n  // 8b. Ice patches (slowed)\n  updateIcePatches(gameDt);\n\n  // 9. Check for game over (phase may have changed during collision checks)\n  if ((gameState.phase as string) === 'gameOver') {\n    showGameOver(gameState);\n  }\n\n  // 10. Camera (real dt \u2014 smooth camera)\n  updateCamera(getPlayerPos(), dt);\n\n  // 11. HUD\n  updateHUD(gameState);\n\n  // 12. Check editor toggle\n  checkEditorToggle();\n\n  // 13. Consume edge-triggered inputs\n  consumeInput();\n\n  // 14. Render\n  getRendererInstance().render(getScene(), getCamera());\n\n  // 15. Damage numbers (slowed)\n  updateDamageNumbers(gameDt);\n}\n\nfunction restart(): void {\n  gameState.phase = 'playing';\n  gameState.playerHealth = PLAYER.maxHealth;\n  gameState.playerMaxHealth = PLAYER.maxHealth;\n  gameState.currency = 0;\n  gameState.currentWave = 1;\n  gameState.abilities.dash.cooldownRemaining = 0;\n  gameState.abilities.ultimate.cooldownRemaining = 0;\n  gameState.abilities.ultimate.active = false;\n  gameState.abilities.ultimate.activeRemaining = 0;\n  gameState.abilities.ultimate.charging = false;\n  gameState.abilities.ultimate.chargeT = 0;\n\n  resetPlayer();\n  resetRoomManager();\n  resetBulletTime();\n  resetBendMode();\n  loadRoom(0, gameState);\n}\n\nfunction init(): void {\n  try {\n    (window as any).__configDefaults = snapshotDefaults();\n    applyUrlParams();\n\n    const { scene } = initRenderer();\n\n    initInput();\n    createPlayer(scene);\n    initProjectilePool(scene);\n    initEnemySystem(scene);\n    initMortarSystem(scene);\n    initAoeTelegraph(scene);\n    initRoomManager(scene);\n    initAudio();\n    initParticles(scene);\n    initBulletTime();\n    initRadialMenu();\n    initBendMode();\n    setOnBendSelected(() => enterTargeting());\n\n    // Melee hit pause \u2014 subscribe to meleeHit event\n    on('meleeHit', () => {\n      hitPauseTimer = MELEE.hitPause;\n    });\n    initHUD();\n    initDamageNumbers();\n    initTuningPanel();\n    initSpawnEditor(scene, gameState);\n    initLevelEditor(scene, gameState);\n    initScreens(restart, () => {\n      resumeAudio(); // AudioContext requires user gesture to start\n      gameState.phase = 'playing';\n      document.getElementById('hud')!.style.visibility = 'visible';\n      loadRoom(0, gameState);\n      lastTime = performance.now();\n    });\n\n    document.getElementById('hud')!.style.visibility = 'hidden';\n\n    lastTime = performance.now();\n    requestAnimationFrame(gameLoop);\n  } catch (err) {\n    console.error('[init] Fatal error during initialization:', err);\n  }\n}\n\ninit();\n\n// DEBUG: Expose game state for verification scripts (localhost only)\nif (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n  (window as any).gameState = gameState;\n  (window as any).getPlayerPos = getPlayerPos;\n}\n"],
  "mappings": "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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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",
  "names": ["playerPos", "camera", "scene", "gameState", "sceneRef", "scene", "pool", "active", "sceneRef", "scene", "gameState", "playerPos", "gameState", "sceneRef", "gameState", "sceneRef", "sceneRef", "scene", "easeOutQuad", "inputState", "isDashing", "easeOutQuad", "scene", "inputState", "gameState", "fillGeo", "scene", "_ghostHeadGeo", "scene", "gameState", "playerPos", "POOL_SIZE", "pool", "sceneRef", "scene", "sceneRef", "ringGeo", "scene", "sceneRef", "ringGeo", "removeTelegraph", "sceneRef", "scene", "playerPos", "scene", "gameState", "maxBends", "active", "gameState", "camera", "active", "activeTelegraphs", "sceneRef", "scene", "gameState", "playerPos", "removeTelegraph", "pack", "activeTelegraphs", "INV_SQRT2", "ISO_RIGHT_X", "ISO_RIGHT_Z", "ISO_UP_X", "ISO_UP_Z", "isDragging", "gameState", "gameState", "ctx", "initialized", "wireEventBus", "snap", "announceEl", "gameState", "showAnnounce", "removeTelegraph", "hideAnnounce", "showAnnounce", "announceEl", "hideAnnounce", "sceneRef", "scene", "on", "camera", "sceneRef", "active", "selectedBendId", "snap", "camera", "ringGeo", "camera", "sceneRef", "camera", "active", "selectedBendId", "scene", "gameState", "sceneRef", "gameStateRef", "panel", "active", "previousPhase", "isDragging", "dragStarted", "dragStartWorld", "undoStack", "redoStack", "MAX_UNDO", "pushUndo", "snap", "applySnapshot", "onArenaChanged", "getNestedValue", "setNestedValue", "scene", "gameState", "injectStyles", "onMouseDown", "onMouseMove", "onMouseUp", "exitEditor", "enterEditor", "mouseToWorld", "hit", "ringGeo", "boxGeo", "group", "arrRef", "objRef", "unitDisplay", "unitStr", "display", "scene"]
}
