{
  "version": 3,
  "sources": ["../src/config/arena.ts", "../src/engine/renderer.ts", "../src/config/player.ts", "../src/config/abilities.ts", "../src/engine/pools.ts", "../src/entities/projectile.ts", "../src/ui/damageNumbers.ts", "../src/engine/aoeTelegraph.ts", "../src/config/enemies.ts", "../src/entities/enemy.ts", "../src/entities/mortarProjectile.ts", "../src/entities/player.ts", "../src/engine/input.ts", "../src/config/waves.ts", "../src/engine/telegraph.ts", "../src/engine/waveRunner.ts", "../src/engine/physics.ts", "../src/ui/hud.ts", "../src/ui/screens.ts", "../src/config/boss.ts", "../src/engine/urlParams.ts", "../src/ui/tuning.ts", "../src/ui/spawnEditor.ts", "../src/engine/game.ts"],
  "sourcesContent": ["import { Obstacle, Pit, AABB } from '../types/index';\n\nexport const ARENA_HALF = 20;\n\nexport const OBSTACLES: Obstacle[] = [\n  { x: 5, z: 9, w: 2, h: 1.5, d: 3 },\n  { x: -9, z: -7.5, w: 4, h: 1.5, d: 2 },\n  { x: 3.5, z: -3, w: 1.5, h: 2, d: 1.5 },\n  { x: 3.5, z: -9.5, w: 1.5, h: 2, d: 1.5 },\n  { x: 1, z: 10, w: 9, h: 1, d: 1 },\n  { x: 8.5, z: -8, w: 3, h: 1, d: 1 },\n  { x: 10, z: 9, w: 1, h: 2.5, d: 1 },\n  { x: -7.5, z: 8, w: 1, h: 2.5, d: 1 },\n];\n\nexport const WALL_THICKNESS = 0.5;\nexport const WALL_HEIGHT = 2;\n\nexport const PITS: Pit[] = [\n  { x: 0, z: 7.5, w: 8, d: 3 },\n  { x: 16, z: -17, w: 4.5, d: 4.5 },\n  { x: -7.5, z: 0, w: 2.5, d: 8 },\n  { x: -0.5, z: -7, w: 8.5, d: 2.5 },\n  { x: 8, z: 0, w: 3, d: 9 },\n];\n\nexport function getPitBounds(): AABB[] {\n  return PITS.map(p => ({\n    minX: p.x - p.w / 2,\n    maxX: p.x + p.w / 2,\n    minZ: p.z - p.d / 2,\n    maxZ: p.z + p.d / 2,\n  }));\n}\n\nexport function getCollisionBounds(): AABB[] {\n  const bounds: AABB[] = [];\n\n  for (const o of OBSTACLES) {\n    bounds.push({\n      minX: o.x - o.w / 2,\n      maxX: o.x + o.w / 2,\n      minZ: o.z - o.d / 2,\n      maxZ: o.z + o.d / 2,\n    });\n  }\n\n  const h = ARENA_HALF;\n  const t = WALL_THICKNESS;\n  bounds.push({ minX: -h - t/2, maxX: h + t/2, minZ: h - t/2, maxZ: h + t/2 });\n  bounds.push({ minX: -h - t/2, maxX: h + t/2, minZ: -h - t/2, maxZ: -h + t/2 });\n  bounds.push({ minX: h - t/2, maxX: h + t/2, minZ: -h - t/2, maxZ: h + t/2 });\n  bounds.push({ minX: -h - t/2, maxX: -h + t/2, minZ: -h - t/2, maxZ: h + t/2 });\n\n  return bounds;\n}\n", "import { OBSTACLES, PITS, ARENA_HALF, WALL_THICKNESS, WALL_HEIGHT } from '../config/arena';\n\nlet scene: any, camera: any, renderer: any;\nconst baseFrustum = 12;\nlet currentFrustum = 12;\nconst cameraOffset = new THREE.Vector3(20, 20, 20);\n\n// Tracked arena meshes for dynamic rebuild\nlet obstacleMeshes: any[] = [];\nlet wallMeshes: any[] = [];\nlet pitMeshes: any[] = [];\n\n// Screen shake state\nlet shakeRemaining = 0;\nlet shakeIntensity = 0;\n\n// Reusable vectors\nconst _camTarget = new THREE.Vector3();\nconst _unprojectVec = new THREE.Vector3();\nconst _camDir = new THREE.Vector3();\n\nexport function initRenderer() {\n  scene = new THREE.Scene();\n  scene.background = new THREE.Color(0x0a0a1a);\n  scene.fog = new THREE.Fog(0x0a0a1a, 30, 60);\n\n  const { w, h } = getViewportSize();\n  const aspect = w / h;\n  camera = new THREE.OrthographicCamera(\n    -baseFrustum * aspect, baseFrustum * aspect,\n    baseFrustum, -baseFrustum, 0.1, 100\n  );\n  camera.position.copy(cameraOffset);\n  camera.lookAt(0, 0, 0);\n\n  // Zoom camera in on mobile for tighter view\n  const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n  if (hasTouch) applyFrustum(8);\n\n  renderer = new THREE.WebGLRenderer({ antialias: true });\n  renderer.setSize(w, h);\n  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n  document.body.prepend(renderer.domElement);\n\n  // Lighting\n  const ambient = new THREE.AmbientLight(0x6666aa, 0.4);\n  scene.add(ambient);\n\n  const dirLight = new THREE.DirectionalLight(0xffeedd, 0.8);\n  dirLight.position.set(10, 15, 10);\n  scene.add(dirLight);\n\n  const rimLight = new THREE.DirectionalLight(0x4488ff, 0.3);\n  rimLight.position.set(-10, 5, -10);\n  scene.add(rimLight);\n\n  // Ground\n  const ground = new THREE.Mesh(\n    new THREE.PlaneGeometry(60, 60),\n    new THREE.MeshStandardMaterial({ color: 0x1a1a2e, roughness: 0.9, metalness: 0.1 })\n  );\n  ground.rotation.x = -Math.PI / 2;\n  scene.add(ground);\n\n  // Grid overlay\n  const grid = new THREE.GridHelper(60, 30, 0x2a4a4a, 0x1a2a3a);\n  grid.position.y = 0.01;\n  scene.add(grid);\n\n  // Arena obstacles\n  createObstacles();\n\n  // Arena pits\n  createPits();\n\n  // Resize handler \u2014 also handle mobile orientation changes\n  window.addEventListener('resize', onResize);\n  window.addEventListener('orientationchange', () => {\n    // Delay to let browser settle after orientation change\n    setTimeout(onResize, 150);\n  });\n  if (window.visualViewport) {\n    window.visualViewport.addEventListener('resize', onResize);\n  }\n\n  return { scene, camera, renderer };\n}\n\nfunction clearObstacleMeshes() {\n  for (const m of obstacleMeshes) {\n    scene.remove(m);\n    if (m.geometry) m.geometry.dispose();\n  }\n  obstacleMeshes = [];\n  for (const m of wallMeshes) {\n    scene.remove(m);\n    if (m.geometry) m.geometry.dispose();\n  }\n  wallMeshes = [];\n}\n\nfunction createObstacles() {\n  clearObstacleMeshes();\n\n  const mat = new THREE.MeshStandardMaterial({\n    color: 0x2a2a4a,\n    emissive: 0x223355,\n    emissiveIntensity: 0.3,\n    roughness: 0.7,\n    metalness: 0.2\n  });\n\n  for (const o of OBSTACLES) {\n    const mesh = new THREE.Mesh(new THREE.BoxGeometry(o.w, o.h, o.d), mat);\n    mesh.position.set(o.x, o.h / 2, o.z);\n    scene.add(mesh);\n    obstacleMeshes.push(mesh);\n  }\n\n  // Arena perimeter walls\n  const wallMat = new THREE.MeshStandardMaterial({\n    color: 0x1a1a2e,\n    emissive: 0x334466,\n    emissiveIntensity: 0.4,\n    roughness: 0.8\n  });\n\n  // North/South walls\n  for (const zSign of [-1, 1]) {\n    const wall = new THREE.Mesh(\n      new THREE.BoxGeometry(ARENA_HALF * 2 + WALL_THICKNESS, WALL_HEIGHT, WALL_THICKNESS),\n      wallMat\n    );\n    wall.position.set(0, WALL_HEIGHT / 2, zSign * ARENA_HALF);\n    scene.add(wall);\n    wallMeshes.push(wall);\n  }\n  // East/West walls\n  for (const xSign of [-1, 1]) {\n    const wall = new THREE.Mesh(\n      new THREE.BoxGeometry(WALL_THICKNESS, WALL_HEIGHT, ARENA_HALF * 2 + WALL_THICKNESS),\n      wallMat\n    );\n    wall.position.set(xSign * ARENA_HALF, WALL_HEIGHT / 2, 0);\n    scene.add(wall);\n    wallMeshes.push(wall);\n  }\n}\n\nfunction clearPitMeshes() {\n  for (const m of pitMeshes) {\n    scene.remove(m);\n    if (m.geometry) m.geometry.dispose();\n  }\n  pitMeshes = [];\n}\n\nfunction createPits() {\n  clearPitMeshes();\n\n  const edgeThickness = 0.08;\n  const edgeHeight = 0.02;\n\n  const edgeMat = new THREE.MeshBasicMaterial({\n    color: 0xff2244,\n    transparent: true,\n    opacity: 0.8,\n  });\n\n  for (const p of PITS) {\n    // Dark void floor (slightly below ground)\n    const voidMesh = new THREE.Mesh(\n      new THREE.PlaneGeometry(p.w, p.d),\n      new THREE.MeshBasicMaterial({ color: 0x000000 })\n    );\n    voidMesh.rotation.x = -Math.PI / 2;\n    voidMesh.position.set(p.x, -0.05, p.z);\n    scene.add(voidMesh);\n    pitMeshes.push(voidMesh);\n\n    // North edge\n    const nEdge = new THREE.Mesh(\n      new THREE.BoxGeometry(p.w + edgeThickness * 2, edgeHeight, edgeThickness),\n      edgeMat\n    );\n    nEdge.position.set(p.x, 0.01, p.z + p.d / 2);\n    scene.add(nEdge);\n    pitMeshes.push(nEdge);\n\n    // South edge\n    const sEdge = new THREE.Mesh(\n      new THREE.BoxGeometry(p.w + edgeThickness * 2, edgeHeight, edgeThickness),\n      edgeMat\n    );\n    sEdge.position.set(p.x, 0.01, p.z - p.d / 2);\n    scene.add(sEdge);\n    pitMeshes.push(sEdge);\n\n    // East edge\n    const eEdge = new THREE.Mesh(\n      new THREE.BoxGeometry(edgeThickness, edgeHeight, p.d),\n      edgeMat\n    );\n    eEdge.position.set(p.x + p.w / 2, 0.01, p.z);\n    scene.add(eEdge);\n    pitMeshes.push(eEdge);\n\n    // West edge\n    const wEdge = new THREE.Mesh(\n      new THREE.BoxGeometry(edgeThickness, edgeHeight, p.d),\n      edgeMat\n    );\n    wEdge.position.set(p.x - p.w / 2, 0.01, p.z);\n    scene.add(wEdge);\n    pitMeshes.push(wEdge);\n  }\n}\n\n// Rebuild all arena visuals (obstacles + pits) \u2014 called by level editor\nexport function rebuildArenaVisuals() {\n  createObstacles();\n  createPits();\n}\n\nfunction getViewportSize() {\n  // visualViewport gives accurate size on mobile (accounts for browser chrome)\n  if (window.visualViewport) {\n    return { w: window.visualViewport.width, h: window.visualViewport.height };\n  }\n  return { w: window.innerWidth, h: window.innerHeight };\n}\n\nfunction onResize() {\n  const { w, h } = getViewportSize();\n  applyFrustum(currentFrustum);\n  renderer.setSize(w, h);\n}\n\nfunction applyFrustum(f: number) {\n  const { w, h } = getViewportSize();\n  const aspect = w / h;\n  camera.left = -f * aspect;\n  camera.right = f * aspect;\n  camera.top = f;\n  camera.bottom = -f;\n  camera.updateProjectionMatrix();\n  currentFrustum = f;\n}\n\nexport function setZoom(frustum: number) {\n  applyFrustum(Math.max(8, Math.min(30, frustum)));\n}\n\nexport function resetZoom() {\n  applyFrustum(baseFrustum);\n}\n\nexport function getCurrentFrustum() {\n  return currentFrustum;\n}\n\nexport function updateCamera(playerPos: any, dt: number) {\n  // Snap camera to player \u2014 no lerp. Ortho camera + lerp causes a sliding/swimming feel\n  // because the lookAt target and position desync subtly each frame.\n  camera.position.copy(playerPos).add(cameraOffset);\n\n  // Screen shake (offset from snapped position)\n  if (shakeRemaining > 0) {\n    shakeRemaining -= dt * 1000;\n    const decay = Math.max(0, shakeRemaining / 150);\n    const amt = shakeIntensity * decay;\n    camera.position.x += (Math.random() - 0.5) * amt * 0.1;\n    camera.position.z += (Math.random() - 0.5) * amt * 0.1;\n  }\n\n  camera.lookAt(playerPos);\n}\n\nexport function screenShake(intensity: number, durationMs = 100) {\n  shakeIntensity = intensity;\n  shakeRemaining = durationMs;\n}\n\n// Convert mouse NDC to world position on y=0 plane\nexport function screenToWorld(ndcX: number, ndcY: number) {\n  _unprojectVec.set(ndcX, ndcY, 0);\n  _unprojectVec.unproject(camera);\n\n  // Camera direction\n  _camDir.set(0, 0, -1).applyQuaternion(camera.quaternion);\n\n  // Intersect ray with y=0 plane\n  const t = -_unprojectVec.y / _camDir.y;\n  return new THREE.Vector3(\n    _unprojectVec.x + _camDir.x * t,\n    0,\n    _unprojectVec.z + _camDir.z * t\n  );\n}\n\nexport function getScene() { return scene; }\nexport function getCamera() { return camera; }\nexport function getRendererInstance() { return renderer; }\n", "import { PlayerConfig } from '../types/index';\n\nexport const PLAYER: PlayerConfig = {\n  maxHealth: 100,\n  speed: 5,\n  fireRate: 410,\n  projectile: { speed: 16, damage: 10, color: 0x44ff88, size: 0.2 },\n  size: { radius: 0.35, height: 1.2 }\n};\n", "import { AbilitiesConfig } from '../types/index';\n\nexport const ABILITIES: AbilitiesConfig = {\n  dash: {\n    name: 'Shadow Dash',\n    key: 'Space',\n    cooldown: 3000,\n    duration: 200,\n    distance: 5,\n    curve: 'easeOut',\n    invincible: true,\n    iFrameStart: 0,\n    iFrameEnd: 200,\n    directionSource: 'movement',\n    afterimageCount: 3,\n    afterimageFadeDuration: 300,\n    ghostColor: 0x44ffaa,\n    trailColor: 0x44ff88,\n    screenShakeOnStart: 1.5,\n    canShootDuring: false,\n    canAbilityCancel: false,\n    endLag: 50,\n    description: 'Dash forward, briefly invincible'\n  },\n  ultimate: {\n    name: 'Force Push',\n    key: 'E',\n    cooldown: 5000,\n    chargeTimeMs: 1500,\n    minLength: 3,\n    maxLength: 12,\n    width: 3,\n    minKnockback: 1.5,\n    maxKnockback: 5,\n    color: 0x44ffaa,\n    telegraphOpacity: 0.3,\n    chargeMoveSpeedMult: 0.4,\n    description: 'Charge a directional push \u2014 hold to extend range'\n  }\n};\n", "export class ObjectPool {\n  pool: any[];\n  active: any[];\n  createFn: () => any;\n\n  constructor(createFn: () => any, initialSize = 50) {\n    this.pool = [];\n    this.active = [];\n    this.createFn = createFn;\n    for (let i = 0; i < initialSize; i++) {\n      const obj = createFn();\n      obj.mesh.visible = false;\n      this.pool.push(obj);\n    }\n  }\n\n  acquire() {\n    let obj = this.pool.pop();\n    if (!obj) {\n      obj = this.createFn();\n    }\n    obj.mesh.visible = true;\n    this.active.push(obj);\n    return obj;\n  }\n\n  release(obj: any) {\n    obj.mesh.visible = false;\n    const idx = this.active.indexOf(obj);\n    if (idx !== -1) {\n      // Swap-remove: O(1) instead of O(n) splice\n      const last = this.active.length - 1;\n      if (idx !== last) this.active[idx] = this.active[last];\n      this.active.length = last;\n    }\n    this.pool.push(obj);\n  }\n\n  releaseAll() {\n    for (let i = this.active.length - 1; i >= 0; i--) {\n      const obj = this.active[i];\n      obj.mesh.visible = false;\n      this.pool.push(obj);\n    }\n    this.active.length = 0;\n  }\n\n  getActive() { return this.active; }\n}\n", "import { ObjectPool } from '../engine/pools';\nimport { PLAYER } from '../config/player';\n\nlet playerPool: any, enemyPool: any;\nlet sceneRef: any;\nlet basePlayerProjSize: number; // original geometry radius for scale calculation\n\nexport function initProjectilePool(scene: any) {\n  sceneRef = scene;\n\n  basePlayerProjSize = PLAYER.projectile.size;\n  const playerProjGeo = new THREE.SphereGeometry(basePlayerProjSize, 6, 4);\n  const playerProjMat = new THREE.MeshStandardMaterial({\n    color: PLAYER.projectile.color,\n    emissive: PLAYER.projectile.color,\n    emissiveIntensity: 0.8\n  });\n\n  playerPool = new ObjectPool(() => {\n    const mesh = new THREE.Mesh(playerProjGeo, playerProjMat.clone());\n    scene.add(mesh);\n    return { mesh, dir: new THREE.Vector3(), speed: 0, damage: 0, life: 0, isEnemy: false };\n  }, 80);\n\n  const enemyProjGeo = new THREE.SphereGeometry(0.1, 6, 4);\n\n  enemyPool = new ObjectPool(() => {\n    const mesh = new THREE.Mesh(\n      enemyProjGeo,\n      new THREE.MeshStandardMaterial({\n        color: 0xff4466,\n        emissive: 0xff2244,\n        emissiveIntensity: 0.8\n      })\n    );\n    scene.add(mesh);\n    return { mesh, dir: new THREE.Vector3(), speed: 0, damage: 0, life: 0, isEnemy: true };\n  }, 40);\n}\n\nexport function fireProjectile(origin: any, direction: any, config: any, isEnemy?: boolean) {\n  if (isEnemy === undefined) isEnemy = false;\n  const pool = isEnemy ? enemyPool : playerPool;\n  const p = pool.acquire();\n  p.mesh.position.set(origin.x, 0.8, origin.z);\n  p.dir.copy(direction).normalize();\n  p.speed = config.speed;\n  p.damage = config.damage;\n  p.life = 0;\n\n  // Scale player projectile mesh based on current config size vs base geometry\n  if (!isEnemy && basePlayerProjSize) {\n    const s = PLAYER.projectile.size / basePlayerProjSize;\n    p.mesh.scale.set(s, s, s);\n  }\n\n  // Update enemy projectile color per-type\n  if (isEnemy && config.color) {\n    p.mesh.material.color.setHex(config.color);\n    p.mesh.material.emissive.setHex(config.color);\n  }\n\n  return p;\n}\n\nexport function updateProjectiles(dt: number) {\n  const maxLife = 2.0;\n  for (const pool of [playerPool, enemyPool]) {\n    const active = pool.getActive();\n    for (let i = active.length - 1; i >= 0; i--) {\n      const p = active[i];\n      p.mesh.position.x += p.dir.x * p.speed * dt;\n      p.mesh.position.z += p.dir.z * p.speed * dt;\n      p.life += dt;\n      if (p.life > maxLife) {\n        pool.release(p);\n      }\n    }\n  }\n}\n\nexport function getPlayerProjectiles() { return playerPool ? playerPool.getActive() : []; }\nexport function getEnemyProjectiles() { return enemyPool ? enemyPool.getActive() : []; }\n\nexport function releaseProjectile(p: any) {\n  if (p.isEnemy) {\n    enemyPool.release(p);\n  } else {\n    playerPool.release(p);\n  }\n}\n\nexport function releaseAllProjectiles() {\n  if (playerPool) playerPool.releaseAll();\n  if (enemyPool) enemyPool.releaseAll();\n}\n", "// Canvas 2D damage number system \u2014 no DOM thrash, scales to hundreds of numbers\nimport { getCamera } from '../engine/renderer';\n\nlet canvas: any, ctx: any;\nconst POOL_SIZE = 40;\nconst LIFETIME = 600; // ms\nconst FLOAT_DISTANCE = 40; // px upward travel\n\n// Pre-allocated pool of damage number slots\nconst pool: any[] = [];\nfor (let i = 0; i < POOL_SIZE; i++) {\n  pool.push({ active: false, x: 0, y: 0, value: 0, life: 0, color: '#ffffff' });\n}\n\n// Reusable vector for world\u2192screen projection\nconst _projVec = new THREE.Vector3();\n\nexport function initDamageNumbers() {\n  canvas = document.createElement('canvas');\n  canvas.id = 'damage-canvas';\n  canvas.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:15;';\n  document.body.appendChild(canvas);\n  resizeCanvas();\n  window.addEventListener('resize', resizeCanvas);\n}\n\nfunction resizeCanvas() {\n  canvas.width = window.innerWidth;\n  canvas.height = window.innerHeight;\n}\n\nexport function spawnDamageNumber(worldX: number, worldZ: number, value: any, color?: string) {\n  if (!color) color = '#ffffff';\n\n  // Find inactive slot\n  let slot: any = null;\n  for (let i = 0; i < POOL_SIZE; i++) {\n    if (!pool[i].active) {\n      slot = pool[i];\n      break;\n    }\n  }\n  // If pool full, recycle oldest\n  if (!slot) {\n    let oldest = pool[0];\n    for (let i = 1; i < POOL_SIZE; i++) {\n      if (pool[i].life > oldest.life) oldest = pool[i];\n    }\n    slot = oldest;\n  }\n\n  // Project world position to screen\n  const camera = getCamera();\n  _projVec.set(worldX, 1.5, worldZ); // slightly above ground\n  _projVec.project(camera);\n\n  slot.active = true;\n  slot.x = (_projVec.x * 0.5 + 0.5) * canvas.width;\n  slot.y = (-_projVec.y * 0.5 + 0.5) * canvas.height;\n  slot.value = typeof value === 'string' ? value : Math.round(value);\n  slot.life = 0;\n  slot.color = color;\n\n  // Add slight random horizontal offset to prevent stacking\n  slot.x += (Math.random() - 0.5) * 20;\n}\n\nexport function updateDamageNumbers(dt: number) {\n  if (!ctx) ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n  const dtMs = dt * 1000;\n\n  for (let i = 0; i < POOL_SIZE; i++) {\n    const slot = pool[i];\n    if (!slot.active) continue;\n\n    slot.life += dtMs;\n    if (slot.life >= LIFETIME) {\n      slot.active = false;\n      continue;\n    }\n\n    const t = slot.life / LIFETIME;\n    const alpha = 1 - t * t; // fade out with ease\n    const yOffset = -FLOAT_DISTANCE * t; // float upward\n    const scale = 1 + t * 0.3; // slight grow\n\n    const x = slot.x;\n    const y = slot.y + yOffset;\n\n    ctx.save();\n    ctx.globalAlpha = alpha;\n    ctx.font = `bold ${Math.round(16 * scale)}px 'SF Mono', 'Consolas', monospace`;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n\n    // Shadow for readability\n    ctx.shadowColor = 'rgba(0,0,0,0.8)';\n    ctx.shadowBlur = 4;\n    ctx.shadowOffsetX = 1;\n    ctx.shadowOffsetY = 1;\n\n    ctx.fillStyle = slot.color;\n    ctx.fillText(slot.value, x, y);\n    ctx.restore();\n  }\n}\n\nexport function clearDamageNumbers() {\n  for (let i = 0; i < POOL_SIZE; i++) {\n    pool[i].active = false;\n  }\n  if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);\n}\n", "// Generic AoE telegraph system \u2014 expanding rings, rectangles, and cascading per-target effects.\n// Not tied to any specific mechanic \u2014 works for stun, damage, slow, etc.\n\nimport { spawnDamageNumber } from '../ui/damageNumbers';\n\nlet sceneRef: any;\n\n// Active telegraph shapes (rings + rects)\nconst activeTelegraphs: any[] = [];\n\n// Pending per-target effects (delayed callbacks)\nconst pendingEffects: any[] = [];\n\n// Shared geometries (created once)\nlet ringGeo: any;\nlet planeGeo: any;\n\n// --- Easing ---\n\nfunction easeOutQuad(t: number) {\n  return t * (2 - t);\n}\n\n// --- Init ---\n\nexport function initAoeTelegraph(scene: any) {\n  sceneRef = scene;\n}\n\n// --- Ring Shape ---\n\nexport function createAoeRing(x: number, z: number, maxRadius: number, durationMs: number, color: number) {\n  if (!ringGeo) {\n    ringGeo = new THREE.RingGeometry(0.8, 1.0, 32);\n    ringGeo.rotateX(-Math.PI / 2); // lay flat on ground\n  }\n\n  const mat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.8,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n\n  const mesh = new THREE.Mesh(ringGeo, mat);\n  mesh.position.set(x, 0.05, z); // slightly above ground\n  mesh.scale.set(0.01, 0.01, 0.01); // start tiny\n  sceneRef.add(mesh);\n\n  const telegraph = {\n    type: 'ring',\n    mesh: mesh,\n    material: mat,\n    center: { x, z },\n    maxRadius: maxRadius,\n    duration: durationMs,\n    elapsed: 0,\n    color: color,\n  };\n\n  activeTelegraphs.push(telegraph);\n  return telegraph;\n}\n\n// --- Rectangle Shape ---\n\nexport function createAoeRect(x: number, z: number, width: number, height: number, rotation: number, durationMs: number, color: number) {\n  if (!planeGeo) {\n    planeGeo = new THREE.PlaneGeometry(1, 1);\n    planeGeo.rotateX(-Math.PI / 2); // lay flat on ground\n  }\n\n  const group = new THREE.Group();\n  group.position.set(x, 0.05, z);\n  group.rotation.y = rotation;\n\n  // Fill plane\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.0, // ramps up over first 30%\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const fillMesh = new THREE.Mesh(planeGeo, fillMat);\n  fillMesh.scale.set(width * 0.8, 1, height * 0.8); // start at 80%\n  group.add(fillMesh);\n\n  // Border outline\n  const edgeGeo = new THREE.EdgesGeometry(new THREE.PlaneGeometry(width, height));\n  edgeGeo.rotateX(-Math.PI / 2);\n  const borderMat = new THREE.LineBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.9,\n    depthWrite: false,\n  });\n  const borderMesh = new THREE.LineSegments(edgeGeo, borderMat);\n  group.add(borderMesh);\n\n  sceneRef.add(group);\n\n  const telegraph = {\n    type: 'rect',\n    mesh: group,\n    fillMesh: fillMesh,\n    fillMaterial: fillMat,\n    borderMesh: borderMesh,\n    borderMaterial: borderMat,\n    borderEdgeGeo: edgeGeo,\n    center: { x, z },\n    width: width,\n    height: height,\n    rotation: rotation,\n    duration: durationMs,\n    elapsed: 0,\n    color: color,\n  };\n\n  activeTelegraphs.push(telegraph);\n  return telegraph;\n}\n\n// --- Hit Testing ---\n\n/**\n * Check if a point is inside a rotated rectangle.\n */\nexport function isInRotatedRect(ex: number, ez: number, cx: number, cz: number, w: number, h: number, rotation: number, padding?: number) {\n  const pad = padding || 0;\n  const dx = ex - cx;\n  const dz = ez - cz;\n  const cos = Math.cos(-rotation);\n  const sin = Math.sin(-rotation);\n  const localX = dx * cos - dz * sin;\n  const localZ = dx * sin + dz * cos;\n  return Math.abs(localX) < (w / 2 + pad) && Math.abs(localZ) < (h / 2 + pad);\n}\n\n// --- Update Telegraphs ---\n\nexport function updateAoeTelegraphs(dt: number) {\n  const dtMs = dt * 1000;\n\n  for (let i = activeTelegraphs.length - 1; i >= 0; i--) {\n    const t = activeTelegraphs[i];\n    t.elapsed += dtMs;\n    const progress = Math.min(t.elapsed / t.duration, 1);\n\n    if (t.type === 'ring') {\n      updateRing(t, progress);\n    } else if (t.type === 'rect') {\n      updateRect(t, progress);\n    }\n\n    // Remove when complete\n    if (progress >= 1) {\n      removeTelegraph(t);\n      activeTelegraphs.splice(i, 1);\n    }\n  }\n}\n\nfunction updateRing(t: any, progress: number) {\n  const easedProgress = easeOutQuad(progress);\n\n  // Scale \u2014 expand from 0 to maxRadius\n  const currentRadius = t.maxRadius * easedProgress;\n  t.mesh.scale.set(currentRadius, currentRadius, currentRadius);\n\n  // Thickness shrinks (simulated via Y scale stretching the ring thinner feel)\n  // The ring geometry is 0.8\u21921.0 inner/outer, so at scale 1 it's 0.2 thick.\n  // We modulate opacity instead for the thinning effect.\n\n  // Opacity fades out\n  t.material.opacity = 0.8 * (1 - progress);\n}\n\nfunction updateRect(t: any, progress: number) {\n  const easedProgress = easeOutQuad(progress);\n\n  // Fill: opacity ramps 0 \u2192 0.3 over first 30%, then fades\n  let fillOpacity;\n  if (progress < 0.3) {\n    fillOpacity = 0.3 * (progress / 0.3);\n  } else {\n    fillOpacity = 0.3 * (1 - (progress - 0.3) / 0.7);\n  }\n  t.fillMaterial.opacity = Math.max(0, fillOpacity);\n\n  // Fill scale: 80% \u2192 100%\n  const scaleMult = 0.8 + 0.2 * easedProgress;\n  t.fillMesh.scale.set(t.width * scaleMult, 1, t.height * scaleMult);\n\n  // Border: pulse frequency accelerates 2Hz \u2192 8Hz\n  const freq = 2 + 6 * progress;\n  const pulse = 0.5 + 0.5 * Math.sin(performance.now() * freq * 0.00628); // 2\u03C0/1000\n  t.borderMaterial.opacity = 0.4 + 0.5 * pulse;\n\n  // Brightness ramp in last 100ms \u2014 telegraph flashes bright before firing\n  const flashThreshold = 1 - (100 / t.duration); // last 100ms as fraction of total\n  if (progress > flashThreshold) {\n    const flashProgress = (progress - flashThreshold) / (1 - flashThreshold); // 0\u21921\n    // Ramp fill to full bright\n    t.fillMaterial.opacity = 0.3 + 0.5 * flashProgress;\n    // Solid bright border\n    t.borderMaterial.opacity = 0.8 + 0.2 * flashProgress;\n    // Brighten fill color toward white\n    const r = ((t.color >> 16) & 0xff) / 255;\n    const g = ((t.color >> 8) & 0xff) / 255;\n    const b = (t.color & 0xff) / 255;\n    t.fillMaterial.color.setRGB(\n      r + (1 - r) * flashProgress * 0.6,\n      g + (1 - g) * flashProgress * 0.6,\n      b + (1 - b) * flashProgress * 0.6\n    );\n    t.borderMaterial.color.setRGB(\n      r + (1 - r) * flashProgress * 0.6,\n      g + (1 - g) * flashProgress * 0.6,\n      b + (1 - b) * flashProgress * 0.6\n    );\n  } else if (progress > 0.8) {\n    // Border fades in last 20% (but before the flash window)\n    const fadeProgress = (progress - 0.8) / (flashThreshold - 0.8);\n    t.borderMaterial.opacity *= (1 - fadeProgress * 0.5);\n    t.fillMaterial.opacity *= (1 - fadeProgress * 0.5);\n  }\n}\n\nfunction removeTelegraph(t: any) {\n  if (t.type === 'ring') {\n    t.material.dispose();\n    sceneRef.remove(t.mesh);\n  } else if (t.type === 'rect') {\n    t.fillMaterial.dispose();\n    t.borderMaterial.dispose();\n    t.borderEdgeGeo.dispose();\n    sceneRef.remove(t.mesh);\n  }\n}\n\n// --- Pending Effects ---\n\nexport function schedulePendingEffect(enemy: any, delayMs: number, callback: (enemy: any) => void) {\n  pendingEffects.push({ enemy, delay: delayMs, callback });\n}\n\n// Generic delayed callback (not tied to an enemy)\nexport function scheduleCallback(delayMs: number, callback: () => void) {\n  pendingEffects.push({ enemy: null, delay: delayMs, callback });\n}\n\nexport function updatePendingEffects(dt: number) {\n  const dtMs = dt * 1000;\n\n  for (let i = pendingEffects.length - 1; i >= 0; i--) {\n    const p = pendingEffects[i];\n    p.delay -= dtMs;\n    if (p.delay <= 0) {\n      if (p.enemy) {\n        p.callback(p.enemy);\n      } else {\n        p.callback();\n      }\n      pendingEffects.splice(i, 1);\n    }\n  }\n}\n\n// --- Generic AoE Applicator ---\n\n/**\n * Trigger an AoE effect with visual telegraph and cascading per-target application.\n */\nexport function applyAoeEffect({ x, z, radius, durationMs, color, label, effectFn, gameState, excludeEnemy }: {\n  x: number;\n  z: number;\n  radius: number;\n  durationMs: number;\n  color: number;\n  label?: string;\n  effectFn: (enemy: any) => void;\n  gameState: any;\n  excludeEnemy?: any;\n}) {\n  // 1. Create expanding ring visual\n  createAoeRing(x, z, radius, durationMs, color);\n\n  // 2. Schedule cascade effects on each enemy in range\n  const colorStr = '#' + color.toString(16).padStart(6, '0');\n\n  for (const enemy of gameState.enemies) {\n    if (enemy === excludeEnemy) continue;\n\n    const dx = enemy.pos.x - x;\n    const dz = enemy.pos.z - z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n\n    if (dist < radius) {\n      // Delay proportional to distance \u2014 closest react first\n      const delayMs = (dist / radius) * durationMs;\n\n      schedulePendingEffect(enemy, delayMs, (e) => {\n        // Apply the actual game effect\n        effectFn(e);\n\n        // Visual feedback \u2014 flash enemy to effect color\n        e.flashTimer = 200;\n        e.bodyMesh.material.emissive.setHex(color);\n        if (e.headMesh) e.headMesh.material.emissive.setHex(color);\n\n        // Floating text label\n        if (label) {\n          spawnDamageNumber(e.pos.x, e.pos.z, label, colorStr);\n        }\n      });\n    }\n  }\n}\n\n// --- Rectangle AoE Applicator ---\n\n/**\n * Trigger a rectangle AoE \u2014 shows a telegraph, then fires a damage corridor.\n * Hits both enemies AND the player (friendly fire / environmental hazard).\n */\nexport function applyAoeRectEffect({\n  x, z, width, height, rotation,\n  telegraphDurationMs, lingerDurationMs,\n  color, damage,\n  playerDamageFn, enemyDamageFn,\n  gameState, excludeEnemy\n}: {\n  x: number;\n  z: number;\n  width: number;\n  height: number;\n  rotation: number;\n  telegraphDurationMs: number;\n  lingerDurationMs: number;\n  color: number;\n  damage: number;\n  playerDamageFn?: (x: number, z: number, width: number, height: number, rotation: number) => void;\n  enemyDamageFn?: (enemy: any) => void;\n  gameState: any;\n  excludeEnemy?: any;\n}) {\n  // 1. Show telegraph rect (warning phase)\n  createAoeRect(x, z, width, height, rotation, telegraphDurationMs, color);\n\n  // 2. Schedule the actual damage at the end of the telegraph\n  const colorStr = '#' + color.toString(16).padStart(6, '0');\n\n  scheduleCallback(telegraphDurationMs, () => {\n    // Show a bright \"fired\" rect that lingers briefly\n    createAoeRect(x, z, width, height, rotation, lingerDurationMs, color);\n\n    // Check all enemies in the rect (pad by enemy collision radius for generous hit detection)\n    for (const enemy of gameState.enemies) {\n      if (enemy === excludeEnemy) continue;\n      const enemyRadius = (enemy.config && enemy.config.size) ? enemy.config.size.radius : 0;\n      if (isInRotatedRect(enemy.pos.x, enemy.pos.z, x, z, width, height, rotation, enemyRadius)) {\n        if (enemyDamageFn) {\n          enemyDamageFn(enemy);\n        }\n        // Visual feedback\n        enemy.flashTimer = 200;\n        enemy.bodyMesh.material.emissive.setHex(color);\n        if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(color);\n        spawnDamageNumber(enemy.pos.x, enemy.pos.z, damage, colorStr);\n      }\n    }\n\n    // Check player\n    if (playerDamageFn) {\n      playerDamageFn(x, z, width, height, rotation);\n    }\n  });\n}\n\n// --- Cleanup ---\n\nexport function clearAoeTelegraphs() {\n  // Remove all active telegraph shapes\n  for (const t of activeTelegraphs) {\n    removeTelegraph(t);\n  }\n  activeTelegraphs.length = 0;\n\n  // Clear pending effects\n  pendingEffects.length = 0;\n}\n", "import { EnemyConfig } from '../types/index';\n\nexport const ENEMY_TYPES: Record<string, EnemyConfig> = {\n  goblin: {\n    name: \"Goblin\",\n    health: 30,\n    speed: 2.45,\n    damage: 10,\n    attackRange: 1.5,\n    attackRate: 800,\n    behavior: \"rush\",\n    knockbackResist: 0,\n    color: 16729190,\n    emissive: 16720452,\n    size: { radius: 0.3, height: 0.8 },\n    drops: { currency: { min: 1, max: 3 }, healthChance: 0.1 },\n    rush: { stopDistance: 0.5 },\n    pitLeap: {\n      edgeTimeRequired: 1500,\n      leapSpeed: 7,\n      arcHeight: 2,\n      cooldown: 4000\n    }\n  },\n  skeletonArcher: {\n    name: \"Skeleton Archer\",\n    health: 20,\n    speed: 1.4,\n    damage: 15,\n    attackRange: 12,\n    attackRate: 2500,\n    behavior: \"kite\",\n    knockbackResist: 0.1,\n    color: 11176191,\n    emissive: 8930508,\n    size: { radius: 0.25, height: 1 },\n    drops: { currency: { min: 2, max: 4 }, healthChance: 0.05 },\n    kite: { preferredRangeMult: 0.7, retreatBuffer: 1, advanceBuffer: 3 },\n    sniper: {\n      telegraphDuration: 800,\n      shotWidth: 1.2,\n      shotLength: 14,\n      damage: 15,\n      color: 11158783,\n      lingerDuration: 200,\n      slowDuration: 1000,\n      slowMult: 0.5\n    }\n  },\n  iceMortarImp: {\n    name: \"Ice Mortar Imp\",\n    health: 25,\n    speed: 1.6,\n    damage: 12,\n    attackRange: 15.5,\n    attackRate: 3000,\n    behavior: \"mortar\",\n    knockbackResist: 0.1,\n    color: 4513279,\n    emissive: 13391104,\n    size: { radius: 0.3, height: 0.9 },\n    drops: { currency: { min: 2, max: 5 }, healthChance: 0.08 },\n    kite: { preferredRangeMult: 0.65, retreatBuffer: 1.5, advanceBuffer: 3 },\n    mortar: {\n      aimDuration: 900,\n      projectileSpeed: 11,\n      arcHeight: 6,\n      blastRadius: 2.5,\n      damage: 18,\n      color: 5765887,\n      inaccuracy: 1.5,\n      slowDuration: 800,\n      slowMult: 0.6,\n      explosionDuration: 300,\n      circleStartScale: 0.25,\n      circleScaleTime: 800,\n      icePatch: {\n        enabled: true,\n        duration: 2000,\n        color: 8454143,\n        speedMult: 2.0,\n        knockbackMult: 2.0,\n        affectsPlayer: true,\n        affectsEnemies: true\n      }\n    }\n  },\n  stoneGolem: {\n    name: \"Stone Golem\",\n    health: 80,\n    speed: 1.05,\n    damage: 25,\n    attackRange: 2,\n    attackRate: 1200,\n    behavior: \"tank\",\n    knockbackResist: 0.6,\n    color: 16746547,\n    emissive: 2263244,\n    size: { radius: 0.5, height: 1.4 },\n    drops: { currency: { min: 3, max: 6 }, healthChance: 0.2 },\n    tank: {\n      chargeSpeedMult: 3,\n      chargeDuration: 500,\n      chargeCooldownMin: 3000,\n      chargeCooldownMax: 5000,\n      chargeMinDist: 2,\n      chargeMaxDist: 10,\n      chargeDamageMult: 1.5,\n      telegraphDuration: 300\n    },\n    shield: {\n      maxHealth: 40,\n      stunRadius: 5,\n      stunDuration: 1500,\n      breakRingDuration: 400,\n      color: 8974079,\n      emissive: 4508927,\n      opacity: 0.35\n    },\n    deathExplosion: {\n      radius: 4,\n      damage: 20,\n      color: 4513279,\n      ringDuration: 400,\n      stunDuration: 0,\n      telegraphDuration: 1200\n    }\n  },\n};\n", "import { ENEMY_TYPES } from '../config/enemies';\nimport { getCollisionBounds, getPitBounds } from '../config/arena';\nimport { applyAoeRectEffect, isInRotatedRect, applyAoeEffect } from '../engine/aoeTelegraph';\nimport { getPlayerPos, isPlayerInvincible } from './player';\nimport { screenShake } from '../engine/renderer';\nimport { spawnDamageNumber } from '../ui/damageNumbers';\nimport { fireMortarProjectile, getIceEffects } from './mortarProjectile';\n\nlet sceneRef: any;\n\n// Shared shield geometry (created once)\nlet shieldGeo: any;\n\n// Shared body/head geometry per enemy type (keyed by typeName)\nconst _bodyGeoCache: Record<string, any> = {};\nconst _headGeoCache: Record<string, any> = {};\n\n// Shared mortar fill circle geometry\nlet _mortarFillGeoShared: any = null;\n\n// Shared death telegraph fill geometry\nlet _deathFillGeoShared: any = null;\n\nexport function initEnemySystem(scene: any) {\n  sceneRef = scene;\n}\n\nfunction createShieldMesh(cfg: any) {\n  const shieldCfg = cfg.shield;\n  const radius = cfg.size.radius * 1.8;\n  if (!shieldGeo) shieldGeo = new THREE.SphereGeometry(1, 16, 12); // unit sphere, scaled per enemy\n  const mat = new THREE.MeshStandardMaterial({\n    color: shieldCfg.color || 0x88eeff,\n    emissive: shieldCfg.emissive || 0x44ccff,\n    emissiveIntensity: 0.4,\n    transparent: true,\n    opacity: shieldCfg.opacity || 0.35,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const mesh = new THREE.Mesh(shieldGeo, mat);\n  mesh.scale.set(radius, radius, radius);\n  return mesh;\n}\n\nexport function spawnEnemy(typeName: string, position: any, gameState: any) {\n  const cfg = ENEMY_TYPES[typeName];\n  if (!cfg) return null;\n\n  const group = new THREE.Group();\n\n  // Body (shared geometry per type)\n  if (!_bodyGeoCache[typeName]) {\n    _bodyGeoCache[typeName] = new THREE.CylinderGeometry(cfg.size.radius, cfg.size.radius, cfg.size.height * 0.6, 6);\n  }\n  const bodyMesh = new THREE.Mesh(\n    _bodyGeoCache[typeName],\n    new THREE.MeshStandardMaterial({\n      color: cfg.color,\n      emissive: cfg.emissive,\n      emissiveIntensity: 0.5\n    })\n  );\n  bodyMesh.position.y = cfg.size.height * 0.3;\n  group.add(bodyMesh);\n\n  // Head (shared geometry per type)\n  if (!_headGeoCache[typeName]) {\n    _headGeoCache[typeName] = new THREE.SphereGeometry(cfg.size.radius * 0.7, 6, 4);\n  }\n  const headMesh = new THREE.Mesh(\n    _headGeoCache[typeName],\n    new THREE.MeshStandardMaterial({\n      color: cfg.color,\n      emissive: cfg.emissive,\n      emissiveIntensity: 0.6\n    })\n  );\n  headMesh.position.y = cfg.size.height * 0.75;\n  group.add(headMesh);\n\n  group.position.copy(position);\n  sceneRef.add(group);\n\n  const enemy: any = {\n    mesh: group,\n    bodyMesh,\n    headMesh,\n    type: typeName,\n    config: cfg,\n    health: cfg.health,\n    pos: position.clone(),\n    behavior: cfg.behavior,\n    lastAttackTime: 0,\n    flashTimer: 0,\n    stunTimer: 0,\n    // Tank-specific\n    chargeTimer: 0,\n    chargeCooldown: 4000,\n    isCharging: false,\n    chargeDir: new THREE.Vector3(),\n    // Shield\n    shieldHealth: 0,\n    shieldActive: false,\n    shieldMesh: null as any,\n    // Slow debuff\n    slowTimer: 0,\n    slowMult: 1,               // speed multiplier while slowed (e.g., 0.5 = half speed)\n    // Sniper (kite behavior)\n    sniperPhase: 'idle',       // 'idle' | 'telegraphing' | 'cooldown'\n    sniperTimer: 0,\n    sniperAimAngle: 0,         // locked aim direction (radians)\n    sniperAimCenter: { x: 0, z: 0 }, // center of the damage rect\n    // Mortar\n    mortarPhase: 'idle',       // 'idle' | 'aiming' | 'cooldown'\n    mortarTimer: 0,\n    mortarTarget: { x: 0, z: 0 }, // aimed landing position\n    mortarArcLine: null as any,       // THREE.Line for aim arc preview\n    mortarGroundCircle: null as any,  // THREE.Mesh for persistent ground circle\n    // Pit / edge-slide\n    wasDeflected: false,       // true when movement was deflected by collision (edge-sliding)\n    fellInPit: false,          // true when killed by falling into a pit\n    // Pit leap (goblins)\n    pitEdgeTimer: 0,           // ms spent hugging a pit edge (wasDeflected near pit)\n    isLeaping: false,          // true during arc leap over pit\n    leapElapsed: 0,            // time into leap\n    leapDuration: 0,           // total flight time\n    leapStartX: 0,\n    leapStartZ: 0,\n    leapTargetX: 0,\n    leapTargetZ: 0,\n    leapArcHeight: 0,\n    leapCooldown: 0,           // ms until next leap allowed\n  };\n\n  // Initialize shield if config has one\n  if (cfg.shield && cfg.shield.maxHealth > 0) {\n    enemy.shieldHealth = cfg.shield.maxHealth;\n    enemy.shieldActive = true;\n    enemy.shieldMesh = createShieldMesh(cfg);\n    enemy.shieldMesh.position.y = cfg.size.height * 0.5;\n    group.add(enemy.shieldMesh);\n  }\n\n  gameState.enemies.push(enemy);\n  return enemy;\n}\n\nexport function spawnTestGroup(gameState: any) {\n  // Larger group for longer sessions\n  const spawns = [\n    // Goblins \u2014 scattered around arena\n    { type: 'goblin', x: 10, z: 5 },\n    { type: 'goblin', x: -8, z: 7 },\n    { type: 'goblin', x: 5, z: -10 },\n    { type: 'goblin', x: -12, z: -3 },\n    { type: 'goblin', x: 15, z: 0 },\n    { type: 'goblin', x: -5, z: 12 },\n    { type: 'goblin', x: -15, z: 8 },\n    { type: 'goblin', x: 8, z: -15 },\n    { type: 'goblin', x: -3, z: -14 },\n    { type: 'goblin', x: 14, z: 10 },\n    { type: 'goblin', x: -10, z: -10 },\n    { type: 'goblin', x: 16, z: -8 },\n    // Archers \u2014 positioned at range\n    { type: 'skeletonArcher', x: 12, z: 12 },\n    { type: 'skeletonArcher', x: -12, z: -12 },\n    { type: 'skeletonArcher', x: -14, z: 10 },\n    { type: 'skeletonArcher', x: 14, z: -10 },\n    { type: 'skeletonArcher', x: 0, z: -16 },\n    // Mortar Imps \u2014 lobbed AoE\n    { type: 'iceMortarImp', x: 10, z: -14 },\n    { type: 'iceMortarImp', x: -10, z: 14 },\n    { type: 'iceMortarImp', x: -16, z: -10 },\n    // Golems \u2014 fewer but threatening\n    { type: 'stoneGolem', x: 0, z: 15 },\n    { type: 'stoneGolem', x: -15, z: -5 },\n    { type: 'stoneGolem', x: 15, z: -5 },\n  ];\n\n  for (const s of spawns) {\n    spawnEnemy(s.type, new THREE.Vector3(s.x, 0, s.z), gameState);\n  }\n}\n\n// Reusable vector for calculations\nconst _toPlayer = new THREE.Vector3();\n\n// Cached collision bounds (loaded once)\nlet _collisionBounds: any = null;\nlet _pitBoundsCache: any = null;\n\n/**\n * Check if position (x,z) is inside any pit (with margin).\n * Returns the pit AABB if inside, or null.\n */\nfunction pitAt(x: number, z: number, margin: number) {\n  if (!_pitBoundsCache) _pitBoundsCache = getPitBounds();\n  for (const pit of _pitBoundsCache) {\n    if (x > pit.minX - margin && x < pit.maxX + margin &&\n        z > pit.minZ - margin && z < pit.maxZ + margin) {\n      return pit;\n    }\n  }\n  return null;\n}\n\n/**\n * Pit-aware movement: given a desired movement direction (dx, dz \u2014 normalized),\n * check if a lookahead step would enter a pit. If so, deflect the direction\n * sideways (perpendicular to the original direction, choosing the side away\n * from the pit center). Returns adjusted { dx, dz }.\n */\nfunction pitAwareDir(x: number, z: number, dx: number, dz: number, lookahead: number) {\n  const ahead = pitAt(x + dx * lookahead, z + dz * lookahead, 0.5);\n  if (!ahead) return { dx, dz }; // no pit ahead \u2014 go straight\n\n  // Pit center\n  const pcx = (ahead.minX + ahead.maxX) / 2;\n  const pcz = (ahead.minZ + ahead.maxZ) / 2;\n\n  // Two perpendicular options: rotate +/-90deg\n  // Option A: (dz, -dx)   Option B: (-dz, dx)\n  // Pick the one whose lookahead is further from pit center\n  const ax = x + dz * lookahead, az = z + (-dx) * lookahead;\n  const bx = x + (-dz) * lookahead, bz = z + dx * lookahead;\n  const distA = (ax - pcx) * (ax - pcx) + (az - pcz) * (az - pcz);\n  const distB = (bx - pcx) * (bx - pcx) + (bz - pcz) * (bz - pcz);\n\n  // Also verify the chosen strafe doesn't land in another pit\n  if (distA >= distB) {\n    if (!pitAt(ax, az, 0.5)) return { dx: dz, dz: -dx };\n    if (!pitAt(bx, bz, 0.5)) return { dx: -dz, dz: dx };\n  } else {\n    if (!pitAt(bx, bz, 0.5)) return { dx: -dz, dz: dx };\n    if (!pitAt(ax, az, 0.5)) return { dx: dz, dz: -dx };\n  }\n\n  // Both sides blocked \u2014 stop moving (better than walking into a pit)\n  return { dx: 0, dz: 0 };\n}\n\n/**\n * Raycast from (ox, oz) in direction (dx, dz) and find distance to first AABB hit.\n * Returns the distance, or maxDist if nothing is hit.\n * Uses slab method for ray-AABB intersection on the XZ plane.\n */\nfunction raycastTerrainDist(ox: number, oz: number, dx: number, dz: number, maxDist: number) {\n  if (!_collisionBounds) _collisionBounds = getCollisionBounds();\n\n  let closest = maxDist;\n\n  for (const box of _collisionBounds) {\n    // Slab method on X axis\n    let tmin: number, tmax: number;\n    if (Math.abs(dx) < 1e-8) {\n      // Ray parallel to X \u2014 check if origin is within X slab\n      if (ox < box.minX || ox > box.maxX) continue;\n      tmin = -Infinity;\n      tmax = Infinity;\n    } else {\n      const invDx = 1 / dx;\n      let t1 = (box.minX - ox) * invDx;\n      let t2 = (box.maxX - ox) * invDx;\n      if (t1 > t2) { const tmp = t1; t1 = t2; t2 = tmp; }\n      tmin = t1;\n      tmax = t2;\n    }\n\n    // Slab method on Z axis\n    if (Math.abs(dz) < 1e-8) {\n      if (oz < box.minZ || oz > box.maxZ) continue;\n      // tmin/tmax unchanged\n    } else {\n      const invDz = 1 / dz;\n      let t1 = (box.minZ - oz) * invDz;\n      let t2 = (box.maxZ - oz) * invDz;\n      if (t1 > t2) { const tmp = t1; t1 = t2; t2 = tmp; }\n      tmin = Math.max(tmin, t1);\n      tmax = Math.min(tmax, t2);\n    }\n\n    // Check valid intersection\n    if (tmax < 0 || tmin > tmax) continue; // behind ray or no intersection\n    const t = tmin > 0 ? tmin : tmax; // entry point (or exit if starting inside)\n    if (t > 0 && t < closest) {\n      closest = t;\n    }\n  }\n\n  return closest;\n}\n\nexport function updateEnemies(dt: number, playerPos: any, gameState: any) {\n  for (let i = gameState.enemies.length - 1; i >= 0; i--) {\n    const enemy = gameState.enemies[i];\n\n    // Pit leap update \u2014 runs independently of stun (can't stun mid-air)\n    if (enemy.isLeaping) {\n      updateLeap(enemy, dt);\n      // Skip normal behavior/movement but still check death below\n    } else if (enemy.stunTimer > 0) {\n      // Stun check \u2014 stunned enemies cannot move or attack\n      enemy.stunTimer -= dt * 1000;\n    } else {\n      // Behavior dispatch (only when not stunned)\n      switch (enemy.behavior) {\n        case 'rush': behaviorRush(enemy, playerPos, dt); break;\n        case 'kite': behaviorKite(enemy, playerPos, dt, gameState); break;\n        case 'tank': behaviorTank(enemy, playerPos, dt); break;\n        case 'mortar': behaviorMortar(enemy, playerPos, dt, gameState); break;\n      }\n    }\n\n    // Arena clamp\n    enemy.pos.x = Math.max(-19, Math.min(19, enemy.pos.x));\n    enemy.pos.z = Math.max(-19, Math.min(19, enemy.pos.z));\n    if (enemy.isLeaping) {\n      // Sync clamped XZ but preserve arc Y set by updateLeap\n      enemy.mesh.position.x = enemy.pos.x;\n      enemy.mesh.position.z = enemy.pos.z;\n    } else {\n      enemy.mesh.position.copy(enemy.pos);\n    }\n\n    // Flash timer (hit feedback)\n    if (enemy.flashTimer > 0) {\n      enemy.flashTimer -= dt * 1000;\n      if (enemy.flashTimer <= 0) {\n        enemy.bodyMesh.material.emissive.setHex(enemy.config.emissive);\n        if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(enemy.config.emissive);\n      }\n    }\n\n    // Slow debuff timer\n    if (enemy.slowTimer > 0) {\n      enemy.slowTimer -= dt * 1000;\n      if (enemy.slowTimer <= 0) {\n        enemy.slowTimer = 0;\n        enemy.slowMult = 1;\n      }\n    }\n\n    // Shield durability visual feedback\n    if (enemy.shieldActive && enemy.shieldMesh) {\n      const shieldCfg = enemy.config.shield;\n      const ratio = enemy.shieldHealth / shieldCfg.maxHealth; // 1.0 = full, 0.0 = broken\n\n      const baseOpacity = shieldCfg.opacity || 0.35;\n\n      // Opacity fades as shield depletes\n      let opacity = baseOpacity * (0.3 + 0.7 * ratio); // never fully invisible while active\n\n      // Color shifts cyan -> red as shield weakens\n      const r = Math.round(0x44 + (0xff - 0x44) * (1 - ratio));\n      const g = Math.round(0xcc * ratio);\n      const b = Math.round(0xff * ratio);\n      enemy.shieldMesh.material.emissive.setRGB(r / 255, g / 255, b / 255);\n\n      // Flicker when below 25%\n      if (ratio < 0.25) {\n        const flicker = 0.5 + 0.5 * Math.sin(performance.now() * 0.06); // ~10Hz\n        opacity *= (0.5 + 0.5 * flicker);\n      } else {\n        // Gentle pulse when healthy\n        opacity += 0.05 * Math.sin(performance.now() * 0.003);\n      }\n\n      enemy.shieldMesh.material.opacity = Math.max(0.05, opacity);\n    }\n\n    // Death telegraph countdown (golem detonation delay)\n    if (enemy.deathTimer > 0) {\n      enemy.deathTimer -= dt * 1000;\n      updateDeathTelegraph(enemy, dt);\n\n      // Sync mesh position (enemy can be pushed by Force Push during telegraph)\n      enemy.mesh.position.copy(enemy.pos);\n\n      // If pushed into a pit during telegraph, cancel explosion and remove immediately\n      if (enemy.fellInPit) {\n        removeDeathTelegraph(enemy);\n        if (enemy.shieldMesh) {\n          enemy.shieldMesh.geometry.dispose();\n          enemy.shieldMesh.material.dispose();\n        }\n        removeMortarArcLine(enemy);\n        removeMortarGroundCircle(enemy);\n        sceneRef.remove(enemy.mesh);\n        gameState.enemies.splice(i, 1);\n        const drops = enemy.config.drops;\n        gameState.currency += Math.floor(\n          drops.currency.min + Math.random() * (drops.currency.max - drops.currency.min + 1)\n        );\n        continue;\n      }\n\n      if (enemy.deathTimer <= 0) {\n        // Telegraph expired \u2014 detonate at CURRENT position (may have been pushed)\n        if (enemy.config.deathExplosion && !enemy.fellInPit) {\n          onDeathExplosion(enemy, gameState);\n        }\n        removeDeathTelegraph(enemy);\n\n        // Clean up shield mesh\n        if (enemy.shieldMesh) {\n          enemy.shieldMesh.geometry.dispose();\n          enemy.shieldMesh.material.dispose();\n        }\n        removeMortarArcLine(enemy);\n        removeMortarGroundCircle(enemy);\n        sceneRef.remove(enemy.mesh);\n        gameState.enemies.splice(i, 1);\n        const drops = enemy.config.drops;\n        gameState.currency += Math.floor(\n          drops.currency.min + Math.random() * (drops.currency.max - drops.currency.min + 1)\n        );\n      }\n      continue; // Skip normal death check while telegraph is active\n    }\n\n    // Death\n    if (enemy.health <= 0) {\n      const deathCfg = enemy.config.deathExplosion;\n\n      // If this enemy has a telegraph duration, defer the explosion\n      if (deathCfg && deathCfg.telegraphDuration && !enemy.fellInPit) {\n        enemy.deathTimer = deathCfg.telegraphDuration;\n        enemy.stunTimer = deathCfg.telegraphDuration + 100; // keep stunned through telegraph\n        createDeathTelegraph(enemy);\n        continue;\n      }\n\n      // Immediate death (no telegraph) \u2014 AoE damage to nearby units (skip if fell in pit)\n      if (deathCfg && !enemy.fellInPit) {\n        onDeathExplosion(enemy, gameState);\n      }\n\n      // Clean up shield mesh\n      if (enemy.shieldMesh) {\n        enemy.shieldMesh.geometry.dispose();\n        enemy.shieldMesh.material.dispose();\n      }\n      // Clean up mortar visuals\n      removeMortarArcLine(enemy);\n      removeMortarGroundCircle(enemy);\n      sceneRef.remove(enemy.mesh);\n      gameState.enemies.splice(i, 1);\n      // Currency drop\n      const drops = enemy.config.drops;\n      gameState.currency += Math.floor(\n        drops.currency.min + Math.random() * (drops.currency.max - drops.currency.min + 1)\n      );\n    }\n  }\n}\n\nfunction behaviorRush(enemy: any, playerPos: any, dt: number) {\n  // Skip normal movement during leap (handled by updateLeap)\n  if (enemy.isLeaping) return;\n\n  _toPlayer.subVectors(playerPos, enemy.pos);\n  _toPlayer.y = 0;\n  const dist = _toPlayer.length();\n\n  const stopDist = (enemy.config.rush && enemy.config.rush.stopDistance) || 0.5;\n  if (dist > stopDist) {\n    _toPlayer.normalize();\n    const slideBoost = enemy.wasDeflected ? 1.175 : 1.0;\n    const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n    const speed = enemy.config.speed * (enemy.slowTimer > 0 ? enemy.slowMult : 1) * slideBoost * iceEffects.speedMult;\n    enemy.pos.x += _toPlayer.x * speed * dt;\n    enemy.pos.z += _toPlayer.z * speed * dt;\n  }\n\n  // Face player\n  if (dist > 0.1) {\n    enemy.mesh.rotation.y = Math.atan2(-_toPlayer.x, -_toPlayer.z);\n  }\n\n  // --- Pit leap detection ---\n  const leapCfg = enemy.config.pitLeap;\n  if (!leapCfg) return;\n\n  // Tick cooldown\n  if (enemy.leapCooldown > 0) {\n    enemy.leapCooldown -= dt * 1000;\n    enemy.pitEdgeTimer = 0;\n    return;\n  }\n\n  // Track time spent hugging a pit edge\n  if (enemy.wasDeflected && pitAt(enemy.pos.x, enemy.pos.z, 1.0)) {\n    enemy.pitEdgeTimer += dt * 1000;\n  } else {\n    enemy.pitEdgeTimer = 0;\n  }\n\n  // Trigger leap after hugging long enough\n  if (enemy.pitEdgeTimer >= leapCfg.edgeTimeRequired) {\n    startPitLeap(enemy, playerPos, leapCfg);\n  }\n}\n\n// --- Pit Leap (goblin arc jump over pits) ---\n\nfunction startPitLeap(enemy: any, playerPos: any, leapCfg: any) {\n  // Direction toward player\n  const dx = playerPos.x - enemy.pos.x;\n  const dz = playerPos.z - enemy.pos.z;\n  const dist = Math.sqrt(dx * dx + dz * dz);\n  if (dist < 0.1) return; // too close, skip\n\n  const dirX = dx / dist;\n  const dirZ = dz / dist;\n\n  // Find how far we need to leap to clear the pit ahead\n  // Scan forward in small steps to find where the pit ends\n  let leapDist = 3; // minimum leap distance\n  for (let probe = 1; probe <= 15; probe += 0.5) {\n    const px = enemy.pos.x + dirX * probe;\n    const pz = enemy.pos.z + dirZ * probe;\n    if (!pitAt(px, pz, 0.3)) {\n      leapDist = probe + 1; // overshoot by 1 unit to land clear\n      break;\n    }\n    leapDist = probe + 1;\n  }\n\n  // Cap the leap distance\n  leapDist = Math.min(leapDist, 12);\n\n  enemy.isLeaping = true;\n  enemy.leapStartX = enemy.pos.x;\n  enemy.leapStartZ = enemy.pos.z;\n  enemy.leapTargetX = enemy.pos.x + dirX * leapDist;\n  enemy.leapTargetZ = enemy.pos.z + dirZ * leapDist;\n  enemy.leapArcHeight = leapCfg.arcHeight || 3;\n  enemy.leapElapsed = 0;\n  enemy.pitEdgeTimer = 0;\n\n  // Flight time based on distance and speed\n  const flightDist = leapDist + 2 * enemy.leapArcHeight * enemy.leapArcHeight / Math.max(leapDist, 0.1);\n  enemy.leapDuration = flightDist / (leapCfg.leapSpeed || 12);\n\n}\n\nfunction updateLeap(enemy: any, dt: number) {\n  enemy.leapElapsed += dt;\n  const t = Math.min(enemy.leapElapsed / enemy.leapDuration, 1);\n\n  // Interpolate XZ position linearly\n  enemy.pos.x = enemy.leapStartX + (enemy.leapTargetX - enemy.leapStartX) * t;\n  enemy.pos.z = enemy.leapStartZ + (enemy.leapTargetZ - enemy.leapStartZ) * t;\n\n  // Parabolic arc for Y (visual only)\n  const arcY = 4 * enemy.leapArcHeight * t * (1 - t);\n  enemy.mesh.position.set(enemy.pos.x, arcY, enemy.pos.z);\n\n  // Face direction of travel\n  const dx = enemy.leapTargetX - enemy.leapStartX;\n  const dz = enemy.leapTargetZ - enemy.leapStartZ;\n  if (dx * dx + dz * dz > 0.01) {\n    enemy.mesh.rotation.y = Math.atan2(-dx, -dz);\n  }\n\n  // Landing\n  if (t >= 1) {\n    enemy.isLeaping = false;\n    enemy.leapCooldown = (enemy.config.pitLeap && enemy.config.pitLeap.cooldown) || 4000;\n    // Snap mesh back to ground\n    enemy.mesh.position.set(enemy.pos.x, 0, enemy.pos.z);\n  }\n}\n\nfunction behaviorKite(enemy: any, playerPos: any, dt: number, gameState: any) {\n  _toPlayer.subVectors(playerPos, enemy.pos);\n  _toPlayer.y = 0;\n  const dist = _toPlayer.length();\n  const kite = enemy.config.kite || {};\n  const sniper = enemy.config.sniper || {};\n  const preferredRange = enemy.config.attackRange * (kite.preferredRangeMult || 0.7);\n\n  const isTelegraphing = enemy.sniperPhase === 'telegraphing';\n\n  // Movement: maintain preferred range (freeze during telegraph \u2014 lining up the shot)\n  if (!isTelegraphing) {\n    const slideBoost = enemy.wasDeflected ? 1.175 : 1.0;\n    const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n    const speed = enemy.config.speed * (enemy.slowTimer > 0 ? enemy.slowMult : 1) * slideBoost * iceEffects.speedMult;\n    if (dist < preferredRange - (kite.retreatBuffer || 1)) {\n      // Too close \u2014 retreat (pit-aware)\n      _toPlayer.normalize();\n      const retreat = pitAwareDir(enemy.pos.x, enemy.pos.z, -_toPlayer.x, -_toPlayer.z, 2.5);\n      enemy.pos.x += retreat.dx * speed * dt;\n      enemy.pos.z += retreat.dz * speed * dt;\n    } else if (dist > preferredRange + (kite.advanceBuffer || 3)) {\n      // Too far \u2014 approach (pit-aware)\n      _toPlayer.normalize();\n      const advance = pitAwareDir(enemy.pos.x, enemy.pos.z, _toPlayer.x, _toPlayer.z, 2.5);\n      enemy.pos.x += advance.dx * speed * dt;\n      enemy.pos.z += advance.dz * speed * dt;\n    }\n  }\n\n  // Always face player (or locked aim direction during telegraph)\n  if (isTelegraphing) {\n    enemy.mesh.rotation.y = enemy.sniperAimAngle + Math.PI;\n  } else if (dist > 0.1) {\n    const nx = _toPlayer.x / dist;\n    const nz = _toPlayer.z / dist;\n    enemy.mesh.rotation.y = Math.atan2(-nx, -nz);\n  }\n\n  // Sniper attack logic\n  const now = performance.now();\n\n  if (enemy.sniperPhase === 'idle') {\n    // Check if ready to fire\n    if (dist < enemy.config.attackRange && now - enemy.lastAttackTime > enemy.config.attackRate) {\n      // Lock aim and begin telegraph\n      enemy.sniperPhase = 'telegraphing';\n      enemy.sniperTimer = sniper.telegraphDuration || 800;\n\n      // Calculate aim direction and rect center\n      const aimAngle = Math.atan2(playerPos.x - enemy.pos.x, playerPos.z - enemy.pos.z);\n      enemy.sniperAimAngle = aimAngle;\n      const maxShotLength = sniper.shotLength || 14;\n\n      // Raycast to clip shot at terrain \u2014 stops at first obstacle\n      const dirX = Math.sin(aimAngle);\n      const dirZ = Math.cos(aimAngle);\n      const terrainDist = raycastTerrainDist(enemy.pos.x, enemy.pos.z, dirX, dirZ, maxShotLength);\n      const shotLength = Math.min(maxShotLength, terrainDist);\n\n      // Center the rect: starts at archer, extends shotLength forward\n      enemy.sniperAimCenter.x = enemy.pos.x + dirX * (shotLength / 2);\n      enemy.sniperAimCenter.z = enemy.pos.z + dirZ * (shotLength / 2);\n\n      // Flash emissive to signal telegraph start\n      enemy.flashTimer = sniper.telegraphDuration || 800;\n      enemy.bodyMesh.material.emissive.setHex(sniper.color || 0xaa44ff);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(sniper.color || 0xaa44ff);\n\n      // Spawn the telegraph + schedule damage via AoE rect system\n      const shotWidth = sniper.shotWidth || 1.2;\n      const dmg = sniper.damage || 15;\n      const color = sniper.color || 0xaa44ff;\n      const lingerMs = sniper.lingerDuration || 200;\n\n      applyAoeRectEffect({\n        x: enemy.sniperAimCenter.x,\n        z: enemy.sniperAimCenter.z,\n        width: shotWidth,\n        height: shotLength,\n        rotation: aimAngle,\n        telegraphDurationMs: sniper.telegraphDuration || 800,\n        lingerDurationMs: lingerMs,\n        color: color,\n        damage: dmg,\n        enemyDamageFn: (e: any) => {\n          // Friendly fire \u2014 damages other enemies\n          e.health -= dmg;\n          // Apply slow debuff\n          const slowDur = sniper.slowDuration || 1000;\n          const slowMul = sniper.slowMult || 0.5;\n          slowEnemy(e, slowDur, slowMul);\n          spawnDamageNumber(e.pos.x, e.pos.z, 'SLOWED', '#cc88ff');\n        },\n        playerDamageFn: (cx: number, cz: number, w: number, h: number, rot: number) => {\n          // Check if player is in the rect at fire time\n          if (isPlayerInvincible()) return;\n          const pp = getPlayerPos();\n          if (isInRotatedRect(pp.x, pp.z, cx, cz, w, h, rot)) {\n            gameState.playerHealth -= dmg;\n            screenShake(3, 100);\n            spawnDamageNumber(pp.x, pp.z, dmg, '#ff4466');\n            if (gameState.playerHealth <= 0) {\n              gameState.playerHealth = 0;\n              gameState.phase = 'gameOver';\n            }\n          }\n        },\n        gameState,\n        excludeEnemy: enemy,\n      });\n    }\n  } else if (enemy.sniperPhase === 'telegraphing') {\n    // Count down telegraph timer\n    enemy.sniperTimer -= dt * 1000;\n    if (enemy.sniperTimer <= 0) {\n      // Shot fires (handled by scheduled callback in aoeTelegraph)\n      enemy.sniperPhase = 'idle';\n      enemy.lastAttackTime = now;\n    }\n  }\n}\n\n\nfunction behaviorMortar(enemy: any, playerPos: any, dt: number, gameState: any) {\n  _toPlayer.subVectors(playerPos, enemy.pos);\n  _toPlayer.y = 0;\n  const dist = _toPlayer.length();\n  const kite = enemy.config.kite || {};\n  const mortar = enemy.config.mortar || {};\n  const preferredRange = enemy.config.attackRange * (kite.preferredRangeMult || 0.65);\n\n  const isAiming = enemy.mortarPhase === 'aiming';\n\n  // Movement: kite like an archer (freeze during aim to line up the shot, pit-aware)\n  if (!isAiming) {\n    const slideBoost = enemy.wasDeflected ? 1.175 : 1.0;\n    const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n    const speed = enemy.config.speed * (enemy.slowTimer > 0 ? enemy.slowMult : 1) * slideBoost * iceEffects.speedMult;\n    if (dist < preferredRange - (kite.retreatBuffer || 1.5)) {\n      _toPlayer.normalize();\n      const retreat = pitAwareDir(enemy.pos.x, enemy.pos.z, -_toPlayer.x, -_toPlayer.z, 2.5);\n      enemy.pos.x += retreat.dx * speed * dt;\n      enemy.pos.z += retreat.dz * speed * dt;\n    } else if (dist > preferredRange + (kite.advanceBuffer || 3)) {\n      _toPlayer.normalize();\n      const advance = pitAwareDir(enemy.pos.x, enemy.pos.z, _toPlayer.x, _toPlayer.z, 2.5);\n      enemy.pos.x += advance.dx * speed * dt;\n      enemy.pos.z += advance.dz * speed * dt;\n    }\n  }\n\n  // Face player (or target during aim)\n  if (isAiming) {\n    const dx = enemy.mortarTarget.x - enemy.pos.x;\n    const dz = enemy.mortarTarget.z - enemy.pos.z;\n    if (Math.abs(dx) > 0.01 || Math.abs(dz) > 0.01) {\n      enemy.mesh.rotation.y = Math.atan2(-dx, -dz);\n    }\n  } else if (dist > 0.1) {\n    const nx = _toPlayer.x / dist;\n    const nz = _toPlayer.z / dist;\n    enemy.mesh.rotation.y = Math.atan2(-nx, -nz);\n  }\n\n  // Mortar attack logic\n  const now = performance.now();\n\n  if (enemy.mortarPhase === 'idle') {\n    if (dist < enemy.config.attackRange && now - enemy.lastAttackTime > enemy.config.attackRate) {\n      // Start aim phase \u2014 pick a target near the player\n      enemy.mortarPhase = 'aiming';\n      enemy.mortarTimer = mortar.aimDuration || 1200;\n\n      // Target = player position + random inaccuracy offset\n      const inaccuracy = mortar.inaccuracy || 1.5;\n      const angle = Math.random() * Math.PI * 2;\n      enemy.mortarTarget.x = playerPos.x + Math.cos(angle) * Math.random() * inaccuracy;\n      enemy.mortarTarget.z = playerPos.z + Math.sin(angle) * Math.random() * inaccuracy;\n\n      // Clamp target to arena\n      enemy.mortarTarget.x = Math.max(-19, Math.min(19, enemy.mortarTarget.x));\n      enemy.mortarTarget.z = Math.max(-19, Math.min(19, enemy.mortarTarget.z));\n\n      // Flash emissive to signal aim start\n      enemy.flashTimer = mortar.aimDuration || 1200;\n      enemy.bodyMesh.material.emissive.setHex(mortar.color || 0xff6622);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(mortar.color || 0xff6622);\n\n      // Create aim arc line preview\n      createMortarArcLine(enemy);\n\n      // Create persistent ground circle at landing point (stays through aim + flight)\n      createMortarGroundCircle(enemy);\n    }\n  } else if (enemy.mortarPhase === 'aiming') {\n    enemy.mortarTimer -= dt * 1000;\n\n    // Update arc line visual each frame\n    updateMortarArcLine(enemy);\n\n    // Pulse the ground circle during aim phase (stays at or above 0.3 opacity)\n    if (enemy.mortarGroundCircle) {\n      const gc = enemy.mortarGroundCircle;\n      const aimDuration = mortar.aimDuration || 1200;\n      const aimProgress = 1 - (enemy.mortarTimer / aimDuration); // 0->1 over aim phase\n\n      // Scale-in animation: circleStartScale -> 1.0 over circleScaleTime (easeOutQuad)\n      gc.scaleElapsed += dt;\n      const scaleT = Math.min(gc.scaleElapsed / gc.scaleDuration, 1);\n      const eased = 1 - (1 - scaleT) * (1 - scaleT); // easeOutQuad\n      const startS = gc.circleStartScale;\n      const s = gc.targetRadius * (startS + (1 - startS) * eased);\n      gc.group.scale.set(s, s, s);\n\n      // Ring: pulse between 0.3 and 0.5, accelerating pulse rate as aim progresses\n      const freq = 0.004 + 0.008 * aimProgress; // pulse speeds up\n      const pulse = 0.85 + 0.15 * Math.sin(performance.now() * freq);\n      gc.ringMat.opacity = (0.3 + 0.15 * aimProgress) * pulse;\n      gc.fillMat.opacity = 0.08 + 0.04 * aimProgress;\n    }\n\n    if (enemy.mortarTimer <= 0) {\n      // Fire the mortar projectile!\n      enemy.mortarPhase = 'idle';\n      enemy.lastAttackTime = now;\n\n      // Remove aim arc line\n      removeMortarArcLine(enemy);\n\n      // Hand the ground circle to the projectile (it persists during flight)\n      const groundCircle = enemy.mortarGroundCircle;\n      enemy.mortarGroundCircle = null;\n\n      // Launch the projectile along the arc\n      fireMortarProjectile({\n        startX: enemy.pos.x,\n        startZ: enemy.pos.z,\n        targetX: enemy.mortarTarget.x,\n        targetZ: enemy.mortarTarget.z,\n        arcHeight: mortar.arcHeight || 6,\n        speed: mortar.projectileSpeed || 8,\n        color: mortar.color || 0xff6622,\n        blastRadius: mortar.blastRadius || 2.5,\n        damage: mortar.damage || 18,\n        slowDuration: mortar.slowDuration || 800,\n        slowMult: mortar.slowMult || 0.6,\n        explosionDuration: mortar.explosionDuration || 300,\n        icePatch: mortar.icePatch || null,\n        gameState,\n        sourceEnemy: enemy,\n        groundCircle,\n      });\n    }\n  }\n}\n\n// --- Mortar arc line helpers ---\n\nconst ARC_SEGMENTS = 20;\nlet _arcLineGeo: any = null;\n\nfunction createMortarArcLine(enemy: any) {\n  if (!_arcLineGeo) {\n    const positions = new Float32Array((ARC_SEGMENTS + 1) * 3);\n    _arcLineGeo = new THREE.BufferGeometry();\n    _arcLineGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n  }\n\n  // Clone geometry so each enemy gets its own buffer\n  const geo = _arcLineGeo.clone();\n  geo.setAttribute('position', new THREE.BufferAttribute(\n    new Float32Array((ARC_SEGMENTS + 1) * 3), 3\n  ));\n\n  const mat = new THREE.LineBasicMaterial({\n    color: enemy.config.mortar?.color || 0xff6622,\n    transparent: true,\n    opacity: 0.6,\n    depthWrite: false,\n  });\n\n  const line = new THREE.Line(geo, mat);\n  sceneRef.add(line);\n  enemy.mortarArcLine = line;\n\n  updateMortarArcLine(enemy);\n}\n\nfunction updateMortarArcLine(enemy: any) {\n  if (!enemy.mortarArcLine) return;\n  const mortar = enemy.config.mortar || {};\n  const sx = enemy.pos.x;\n  const sz = enemy.pos.z;\n  const tx = enemy.mortarTarget.x;\n  const tz = enemy.mortarTarget.z;\n  const arcH = mortar.arcHeight || 6;\n  const startY = 0.8; // launch from body height\n\n  const positions = enemy.mortarArcLine.geometry.attributes.position.array;\n  for (let i = 0; i <= ARC_SEGMENTS; i++) {\n    const t = i / ARC_SEGMENTS;\n    const x = sx + (tx - sx) * t;\n    const z = sz + (tz - sz) * t;\n    // Parabolic arc: y = startY + 4*arcH*t*(1-t) gives a nice arc peaking at arcH\n    const y = startY + 4 * arcH * t * (1 - t);\n    positions[i * 3] = x;\n    positions[i * 3 + 1] = y;\n    positions[i * 3 + 2] = z;\n  }\n  enemy.mortarArcLine.geometry.attributes.position.needsUpdate = true;\n\n  // Pulse opacity for telegraph effect\n  const pulse = 0.3 + 0.3 * Math.sin(performance.now() * 0.008);\n  enemy.mortarArcLine.material.opacity = pulse;\n}\n\nfunction removeMortarArcLine(enemy: any) {\n  if (enemy.mortarArcLine) {\n    enemy.mortarArcLine.geometry.dispose();\n    enemy.mortarArcLine.material.dispose();\n    sceneRef.remove(enemy.mortarArcLine);\n    enemy.mortarArcLine = null;\n  }\n}\n\n// --- Mortar ground circle (persistent through aim + flight) ---\n\nlet _circleGeo: any = null;\n\nfunction createMortarGroundCircle(enemy: any) {\n  const mortar = enemy.config.mortar || {};\n  const radius = mortar.blastRadius || 2.5;\n  const color = mortar.color || 0xff6622;\n\n  // Shared ring geometry (unit scale, scaled per instance)\n  if (!_circleGeo) {\n    _circleGeo = new THREE.RingGeometry(0.85, 1.0, 32);\n    _circleGeo.rotateX(-Math.PI / 2);\n  }\n\n  // Ring outline\n  const ringMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.3,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const ringMesh = new THREE.Mesh(_circleGeo, ringMat);\n\n  // Filled disc for area indication (shared geometry)\n  if (!_mortarFillGeoShared) {\n    _mortarFillGeoShared = new THREE.CircleGeometry(1, 32);\n    _mortarFillGeoShared.rotateX(-Math.PI / 2);\n  }\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.08,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const fillMesh = new THREE.Mesh(_mortarFillGeoShared, fillMat);\n\n  const group = new THREE.Group();\n  group.add(ringMesh);\n  group.add(fillMesh);\n  group.position.set(enemy.mortarTarget.x, 0.05, enemy.mortarTarget.z);\n  const circleStartScale = mortar.circleStartScale || 0.25;\n  const startScale = radius * circleStartScale;\n  group.scale.set(startScale, startScale, startScale);\n  sceneRef.add(group);\n\n  enemy.mortarGroundCircle = {\n    group,\n    ringMat,\n    fillMat,\n    color,\n    targetRadius: radius,\n    circleStartScale,\n    scaleElapsed: 0,                              // tracks time for scale-in animation\n    scaleDuration: (mortar.circleScaleTime || 200) / 1000, // convert ms -> seconds\n  };\n}\n\nfunction removeMortarGroundCircle(enemy: any) {\n  if (enemy.mortarGroundCircle) {\n    const gc = enemy.mortarGroundCircle;\n    gc.ringMat.dispose();\n    gc.fillMat.dispose();\n    // geometry is shared \u2014 don't dispose\n    sceneRef.remove(gc.group);\n    enemy.mortarGroundCircle = null;\n  }\n}\n\n// --- Death telegraph circle (expanding ring before golem explosion) ---\n\nlet _deathCircleGeo: any = null;\n\nfunction createDeathTelegraph(enemy: any) {\n  const cfg = enemy.config.deathExplosion;\n  const radius = cfg.radius;\n  const color = cfg.color;\n\n  // Shared ring geometry (unit scale)\n  if (!_deathCircleGeo) {\n    _deathCircleGeo = new THREE.RingGeometry(0.85, 1.0, 32);\n    _deathCircleGeo.rotateX(-Math.PI / 2);\n  }\n\n  // Ring outline\n  const ringMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.5,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const ringMesh = new THREE.Mesh(_deathCircleGeo, ringMat);\n\n  // Filled disc (shared geometry)\n  if (!_deathFillGeoShared) {\n    _deathFillGeoShared = new THREE.CircleGeometry(1, 32);\n    _deathFillGeoShared.rotateX(-Math.PI / 2);\n  }\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.12,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const fillMesh = new THREE.Mesh(_deathFillGeoShared, fillMat);\n\n  const group = new THREE.Group();\n  group.add(ringMesh);\n  group.add(fillMesh);\n  group.position.set(enemy.pos.x, 0.05, enemy.pos.z);\n  // Start tiny, will scale up\n  group.scale.set(0.1, 0.1, 0.1);\n  sceneRef.add(group);\n\n  enemy.deathTelegraph = {\n    group,\n    ringMat,\n    fillMat,\n    targetRadius: radius,\n  };\n}\n\nfunction updateDeathTelegraph(enemy: any, _dt: number) {\n  const tg = enemy.deathTelegraph;\n  if (!tg) return;\n\n  const cfg = enemy.config.deathExplosion;\n  const duration = (cfg.telegraphDuration || 200) / 1000;\n  const elapsed = (cfg.telegraphDuration - enemy.deathTimer) / 1000;\n  const t = Math.min(elapsed / duration, 1);\n\n  // Scale from tiny to target radius\n  const scale = tg.targetRadius * t;\n  tg.group.scale.set(scale, scale, scale);\n\n  // Follow the enemy position (can be pushed)\n  tg.group.position.set(enemy.pos.x, 0.05, enemy.pos.z);\n\n  // Pulsing opacity on ring\n  const pulse = 0.5 + 0.3 * Math.sin(performance.now() * 0.02);\n  tg.ringMat.opacity = pulse;\n  tg.fillMat.opacity = 0.12 + 0.08 * t;\n}\n\nfunction removeDeathTelegraph(enemy: any) {\n  const tg = enemy.deathTelegraph;\n  if (!tg) return;\n  tg.ringMat.dispose();\n  tg.fillMat.dispose();\n  // geometry is shared \u2014 don't dispose\n  sceneRef.remove(tg.group);\n  enemy.deathTelegraph = null;\n}\n\n// --- Death explosion (crystal golem etc.) ---\n\nfunction onDeathExplosion(enemy: any, gameState: any) {\n  const cfg = enemy.config.deathExplosion;\n  const x = enemy.pos.x;\n  const z = enemy.pos.z;\n\n  // Screen shake\n  screenShake(5, 250);\n\n  // Show \"BOOM\" text on dying enemy\n  const colorStr = '#' + cfg.color.toString(16).padStart(6, '0');\n  spawnDamageNumber(x, z, 'BOOM', colorStr);\n\n  // AoE effect \u2014 damages nearby enemies with cascade visual\n  applyAoeEffect({\n    x,\n    z,\n    radius: cfg.radius,\n    durationMs: cfg.ringDuration || 400,\n    color: cfg.color,\n    label: cfg.damage + '',\n    effectFn: (e: any) => {\n      e.health -= cfg.damage;\n      if (cfg.stunDuration > 0) {\n        stunEnemy(e, cfg.stunDuration);\n      }\n    },\n    gameState,\n    excludeEnemy: enemy, // exclude the dying enemy itself\n  });\n\n  // Check player damage\n  const pp = getPlayerPos();\n  const pdx = pp.x - x;\n  const pdz = pp.z - z;\n  const playerDist = Math.sqrt(pdx * pdx + pdz * pdz);\n  if (playerDist < cfg.radius && !isPlayerInvincible()) {\n    gameState.playerHealth -= cfg.damage;\n    screenShake(4, 200);\n    spawnDamageNumber(pp.x, pp.z, cfg.damage, '#ff4466');\n    if (gameState.playerHealth <= 0) {\n      gameState.playerHealth = 0;\n      gameState.phase = 'gameOver';\n    }\n  }\n}\n\nfunction behaviorTank(enemy: any, playerPos: any, dt: number) {\n  const tank = enemy.config.tank || {};\n  _toPlayer.subVectors(playerPos, enemy.pos);\n  _toPlayer.y = 0;\n  const dist = _toPlayer.length();\n\n  const slowFactor = enemy.slowTimer > 0 ? enemy.slowMult : 1;\n  const slideBoost = enemy.wasDeflected ? 1.175 : 1.0;\n  const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n  if (enemy.isCharging) {\n    // Charge forward at multiplied speed\n    const speedMult = tank.chargeSpeedMult || 3;\n    enemy.pos.x += enemy.chargeDir.x * enemy.config.speed * speedMult * slowFactor * slideBoost * iceEffects.speedMult * dt;\n    enemy.pos.z += enemy.chargeDir.z * enemy.config.speed * speedMult * slowFactor * slideBoost * iceEffects.speedMult * dt;\n    enemy.chargeTimer -= dt * 1000;\n\n    if (enemy.chargeTimer <= 0) {\n      enemy.isCharging = false;\n      const cdMin = tank.chargeCooldownMin || 3000;\n      const cdMax = tank.chargeCooldownMax || 5000;\n      enemy.chargeCooldown = cdMin + Math.random() * (cdMax - cdMin);\n    }\n  } else {\n    // Normal slow movement toward player\n    if (dist > 1) {\n      _toPlayer.normalize();\n      enemy.pos.x += _toPlayer.x * enemy.config.speed * slowFactor * slideBoost * iceEffects.speedMult * dt;\n      enemy.pos.z += _toPlayer.z * enemy.config.speed * slowFactor * slideBoost * iceEffects.speedMult * dt;\n    }\n\n    // Charge cooldown\n    enemy.chargeCooldown -= dt * 1000;\n    const minD = tank.chargeMinDist || 2;\n    const maxD = tank.chargeMaxDist || 10;\n    if (enemy.chargeCooldown <= 0 && dist < maxD && dist > minD) {\n      // Start charge \u2014 telegraph with flash\n      enemy.isCharging = true;\n      enemy.chargeTimer = tank.chargeDuration || 500;\n      _toPlayer.subVectors(playerPos, enemy.pos).normalize();\n      enemy.chargeDir.copy(_toPlayer);\n\n      // Telegraph flash\n      const telegraphMs = tank.telegraphDuration || 300;\n      enemy.flashTimer = telegraphMs;\n      enemy.bodyMesh.material.emissive.setHex(0xffffff);\n      if (enemy.headMesh) enemy.headMesh.material.emissive.setHex(0xffffff);\n    }\n  }\n\n  // Face movement direction\n  if (dist > 0.1) {\n    const nx = (playerPos.x - enemy.pos.x);\n    const nz = (playerPos.z - enemy.pos.z);\n    const l = Math.sqrt(nx * nx + nz * nz);\n    if (l > 0) {\n      enemy.mesh.rotation.y = Math.atan2(-nx / l, -nz / l);\n    }\n  }\n}\n\nexport function slowEnemy(enemy: any, durationMs: number, mult: number) {\n  enemy.slowTimer = durationMs;\n  enemy.slowMult = mult;\n}\n\nexport function stunEnemy(enemy: any, durationMs: number) {\n  enemy.stunTimer = durationMs;\n  // Cancel any active charge\n  enemy.isCharging = false;\n  // Cancel sniper telegraph (shot will still fire visually but enemy resets state)\n  if (enemy.sniperPhase === 'telegraphing') {\n    enemy.sniperPhase = 'idle';\n  }\n  // Cancel mortar aim\n  if (enemy.mortarPhase === 'aiming') {\n    enemy.mortarPhase = 'idle';\n    removeMortarArcLine(enemy);\n    removeMortarGroundCircle(enemy);\n  }\n}\n\nexport function stunEnemiesInRadius(centerPos: any, radius: number, durationMs: number, gameState: any) {\n  const r2 = radius * radius;\n  for (const enemy of gameState.enemies) {\n    const dx = enemy.pos.x - centerPos.x;\n    const dz = enemy.pos.z - centerPos.z;\n    if (dx * dx + dz * dz < r2) {\n      stunEnemy(enemy, durationMs);\n    }\n  }\n}\n\nexport function clearEnemies(gameState: any) {\n  for (const enemy of gameState.enemies) {\n    // Clean up shield mesh if present\n    if (enemy.shieldMesh) {\n      enemy.shieldMesh.geometry.dispose();\n      enemy.shieldMesh.material.dispose();\n    }\n    // Clean up mortar visuals\n    removeMortarArcLine(enemy);\n    removeMortarGroundCircle(enemy);\n    // Clean up death telegraph if active\n    removeDeathTelegraph(enemy);\n    sceneRef.remove(enemy.mesh);\n  }\n  gameState.enemies.length = 0;\n\n  // Invalidate cached bounds (level editor may have changed arena)\n  _collisionBounds = null;\n  _pitBoundsCache = null;\n}\n", "// Mortar projectile system \u2014 lobbed arc projectiles with AoE impact\n// Each projectile travels along a parabolic arc, then explodes on landing.\n// Ice Mortar Imps leave behind ice patches that affect movement and knockback.\n\nimport { applyAoeEffect } from '../engine/aoeTelegraph';\nimport { getPlayerPos, isPlayerInvincible } from './player';\nimport { slowEnemy } from './enemy';\nimport { screenShake } from '../engine/renderer';\nimport { spawnDamageNumber } from '../ui/damageNumbers';\n\nlet sceneRef: any;\n\n// Active mortar projectiles in flight\nconst activeMortars: any[] = [];\n\n// Active ice patches on the ground\nconst activeIcePatches: any[] = [];\n\n// Shared geometry (created once)\nlet shellGeo: any;\n\nexport function initMortarSystem(scene: any) {\n  sceneRef = scene;\n}\n\n/**\n * Fire a mortar projectile along a parabolic arc.\n */\nexport function fireMortarProjectile(opts: any) {\n  if (!shellGeo) {\n    shellGeo = new THREE.SphereGeometry(0.15, 6, 4);\n  }\n\n  const mat = new THREE.MeshStandardMaterial({\n    color: opts.color,\n    emissive: opts.color,\n    emissiveIntensity: 0.8,\n  });\n\n  const mesh = new THREE.Mesh(shellGeo, mat);\n  mesh.position.set(opts.startX, 0.8, opts.startZ);\n  sceneRef.add(mesh);\n\n  // Create a glowing trail line behind the projectile\n  const trailPositions = new Float32Array(30 * 3); // 30-point trail\n  const trailGeo = new THREE.BufferGeometry();\n  trailGeo.setAttribute('position', new THREE.BufferAttribute(trailPositions, 3));\n  const trailMat = new THREE.LineBasicMaterial({\n    color: opts.color,\n    transparent: true,\n    opacity: 0.5,\n    depthWrite: false,\n  });\n  const trail = new THREE.Line(trailGeo, trailMat);\n  sceneRef.add(trail);\n\n  // Calculate arc distance and total flight time\n  const dx = opts.targetX - opts.startX;\n  const dz = opts.targetZ - opts.startZ;\n  const groundDist = Math.sqrt(dx * dx + dz * dz);\n\n  // Approximate arc length (parabolic arc is longer than ground distance)\n  // Using a simple approximation: arcLen ~ groundDist + 2*arcHeight^2/groundDist\n  const arcLen = groundDist > 0.1\n    ? groundDist + 2 * opts.arcHeight * opts.arcHeight / groundDist\n    : opts.arcHeight * 2;\n  const flightTime = arcLen / opts.speed;\n\n  const mortar: any = {\n    mesh,\n    trail,\n    trailGeo,\n    trailMat,\n    mat,\n    startX: opts.startX,\n    startZ: opts.startZ,\n    targetX: opts.targetX,\n    targetZ: opts.targetZ,\n    arcHeight: opts.arcHeight,\n    flightTime,\n    elapsed: 0,\n    color: opts.color,\n    blastRadius: opts.blastRadius,\n    damage: opts.damage,\n    slowDuration: opts.slowDuration,\n    slowMult: opts.slowMult,\n    explosionDuration: opts.explosionDuration,\n    icePatch: opts.icePatch || null,\n    gameState: opts.gameState,\n    sourceEnemy: opts.sourceEnemy,\n    trailHistory: [], // past positions for trail\n    groundCircle: opts.groundCircle || null, // persistent ground circle from aim phase\n  };\n\n  activeMortars.push(mortar);\n  return mortar;\n}\n\n/**\n * Update all in-flight mortar projectiles.\n * Call this every frame from the game loop.\n */\nexport function updateMortarProjectiles(dt: number) {\n  for (let i = activeMortars.length - 1; i >= 0; i--) {\n    const m = activeMortars[i];\n    m.elapsed += dt;\n    const t = Math.min(m.elapsed / m.flightTime, 1);\n\n    // Interpolate position along parabolic arc\n    const x = m.startX + (m.targetX - m.startX) * t;\n    const z = m.startZ + (m.targetZ - m.startZ) * t;\n    const y = 0.8 + 4 * m.arcHeight * t * (1 - t); // parabolic arc\n\n    m.mesh.position.set(x, y, z);\n\n    // Pulse glow\n    const pulse = 0.6 + 0.4 * Math.sin(performance.now() * 0.01);\n    m.mat.emissiveIntensity = pulse;\n\n    // Update trail\n    m.trailHistory.push({ x, y, z });\n    if (m.trailHistory.length > 30) m.trailHistory.shift();\n\n    const positions = m.trailGeo.attributes.position.array;\n    for (let j = 0; j < 30; j++) {\n      const idx = j < m.trailHistory.length ? j : m.trailHistory.length - 1;\n      const p = m.trailHistory[idx];\n      positions[j * 3] = p.x;\n      positions[j * 3 + 1] = p.y;\n      positions[j * 3 + 2] = p.z;\n    }\n    m.trailGeo.attributes.position.needsUpdate = true;\n    m.trailGeo.setDrawRange(0, m.trailHistory.length);\n\n    // Trail fades as projectile progresses\n    m.trailMat.opacity = 0.5 * (1 - t * 0.5);\n\n    // Update ground circle opacity \u2014 ramps from 0.3 -> 0.9 as projectile approaches\n    if (m.groundCircle) {\n      const gc = m.groundCircle;\n      // Ring: 0.3 at launch -> 0.9 at impact (never below 0.3)\n      const ringOpacity = 0.3 + 0.6 * t;\n      // Fill: 0.08 at launch -> 0.35 at impact\n      const fillOpacity = 0.08 + 0.27 * t;\n      // Pulse border for urgency\n      const gcPulse = 0.85 + 0.15 * Math.sin(performance.now() * (0.006 + 0.012 * t));\n      gc.ringMat.opacity = ringOpacity * gcPulse;\n      gc.fillMat.opacity = fillOpacity;\n    }\n\n    // Impact \u2014 projectile has landed\n    if (t >= 1) {\n      onMortarImpact(m);\n      removeMortar(m);\n      activeMortars.splice(i, 1);\n    }\n  }\n}\n\n/**\n * Handle mortar impact \u2014 AoE damage + slow + visual.\n */\nfunction onMortarImpact(m: any) {\n  const tx = m.targetX;\n  const tz = m.targetZ;\n\n  // Screen shake on impact\n  screenShake(3, 150);\n\n  // AoE effect \u2014 damages and slows all enemies in blast radius\n  applyAoeEffect({\n    x: tx,\n    z: tz,\n    radius: m.blastRadius,\n    durationMs: m.explosionDuration,\n    color: m.color,\n    label: 'SLOWED',\n    effectFn: (e: any) => {\n      e.health -= m.damage;\n      slowEnemy(e, m.slowDuration, m.slowMult);\n    },\n    gameState: m.gameState,\n    excludeEnemy: m.sourceEnemy,\n  });\n\n  // Check player damage\n  const pp = getPlayerPos();\n  const pdx = pp.x - tx;\n  const pdz = pp.z - tz;\n  const playerDist = Math.sqrt(pdx * pdx + pdz * pdz);\n  if (playerDist < m.blastRadius && !isPlayerInvincible()) {\n    m.gameState.playerHealth -= m.damage;\n    screenShake(4, 200);\n    spawnDamageNumber(pp.x, pp.z, m.damage, '#ff4466');\n    if (m.gameState.playerHealth <= 0) {\n      m.gameState.playerHealth = 0;\n      m.gameState.phase = 'gameOver';\n    }\n  }\n\n  // Create ice patch if enabled\n  if (m.icePatch && m.icePatch.enabled) {\n    createIcePatch(tx, tz, m.blastRadius, m.icePatch);\n  }\n}\n\n/**\n * Create a persistent ice patch on the ground.\n */\nfunction createIcePatch(x: number, z: number, radius: number, config: any) {\n  // Create visual ice patch (flat circle on ground)\n  const geo = new THREE.CircleGeometry(radius, 32);\n  geo.rotateX(-Math.PI / 2); // lay flat\n\n  const mat = new THREE.MeshBasicMaterial({\n    color: config.color || 0x80E0FF,\n    transparent: true,\n    opacity: 0.5,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n\n  const mesh = new THREE.Mesh(geo, mat);\n  mesh.position.set(x, 0.02, z); // slightly above ground to avoid z-fighting\n  sceneRef.add(mesh);\n\n  const patch = {\n    x,\n    z,\n    radius,\n    mesh,\n    mat,\n    geo,\n    duration: config.duration,\n    elapsed: 0,\n    speedMult: config.speedMult,\n    knockbackMult: config.knockbackMult,\n    affectsPlayer: config.affectsPlayer,\n    affectsEnemies: config.affectsEnemies,\n  };\n\n  activeIcePatches.push(patch);\n  return patch;\n}\n\n/**\n * Update all ice patches \u2014 handle duration and fading.\n */\nexport function updateIcePatches(dt: number) {\n  for (let i = activeIcePatches.length - 1; i >= 0; i--) {\n    const patch = activeIcePatches[i];\n    patch.elapsed += dt * 1000;\n\n    // Fade out in last 500ms\n    const remaining = patch.duration - patch.elapsed;\n    if (remaining < 500) {\n      patch.mat.opacity = 0.5 * (remaining / 500);\n    }\n\n    // Remove when expired\n    if (patch.elapsed >= patch.duration) {\n      patch.geo.dispose();\n      patch.mat.dispose();\n      sceneRef.remove(patch.mesh);\n      activeIcePatches.splice(i, 1);\n    }\n  }\n}\n\n/**\n * Check if a position is on any ice patch.\n * Returns the ice patch config if on ice, null otherwise.\n */\nexport function getIcePatchAt(x: number, z: number) {\n  for (const patch of activeIcePatches) {\n    const dx = x - patch.x;\n    const dz = z - patch.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n    if (dist <= patch.radius) {\n      return patch;\n    }\n  }\n  return null;\n}\n\n/**\n * Get ice effect multipliers for an entity at position.\n */\nexport function getIceEffects(x: number, z: number, isPlayer: boolean) {\n  const patch = getIcePatchAt(x, z);\n  if (!patch) {\n    return { speedMult: 1.0, knockbackMult: 1.0 };\n  }\n\n  // Check if this entity type is affected\n  if (isPlayer && !patch.affectsPlayer) {\n    return { speedMult: 1.0, knockbackMult: 1.0 };\n  }\n  if (!isPlayer && !patch.affectsEnemies) {\n    return { speedMult: 1.0, knockbackMult: 1.0 };\n  }\n\n  return {\n    speedMult: patch.speedMult,\n    knockbackMult: patch.knockbackMult,\n  };\n}\n\n/**\n * Clean up a mortar projectile's visual resources.\n */\nfunction removeMortar(m: any) {\n  m.mat.dispose();\n  sceneRef.remove(m.mesh);\n  m.trailGeo.dispose();\n  m.trailMat.dispose();\n  sceneRef.remove(m.trail);\n  // Clean up ground circle (geometry is shared \u2014 don't dispose)\n  if (m.groundCircle) {\n    const gc = m.groundCircle;\n    gc.ringMat.dispose();\n    gc.fillMat.dispose();\n    sceneRef.remove(gc.group);\n    m.groundCircle = null;\n  }\n}\n\n/**\n * Clear all in-flight mortar projectiles (on restart/cleanup).\n */\nexport function clearMortarProjectiles() {\n  for (const m of activeMortars) {\n    removeMortar(m);\n  }\n  activeMortars.length = 0;\n}\n\n/**\n * Clear all ice patches (on restart/cleanup).\n */\nexport function clearIcePatches() {\n  for (const patch of activeIcePatches) {\n    patch.geo.dispose();\n    patch.mat.dispose();\n    sceneRef.remove(patch.mesh);\n  }\n  activeIcePatches.length = 0;\n}\n", "import { PLAYER } from '../config/player';\nimport { ABILITIES } from '../config/abilities';\nimport { screenShake, getScene } from '../engine/renderer';\nimport { fireProjectile } from './projectile';\nimport { getAbilityDirOverride, clearAbilityDirOverride } from '../engine/input';\nimport { getIceEffects } from './mortarProjectile';\n\nlet playerGroup: any, body: any, head: any, aimIndicator: any;\nconst playerPos = new THREE.Vector3(0, 0, 0);\nlet bobPhase = 0;\nlet lastFireTime = 0;\n\n// Dash state\nlet isDashing = false;\nlet dashTimer = 0;\nlet dashDuration = 0;\nlet dashDistance = 0;\nconst dashDir = new THREE.Vector3();\nconst dashStartPos = new THREE.Vector3();\nlet isInvincible = false;\nlet endLagTimer = 0;\n\n// Afterimages\nconst afterimages: any[] = [];\n\n// Push event (consumed by physics each frame)\nlet pushEvent: any = null;\n\n// Charge state\nlet isCharging = false;\nlet chargeTimer = 0;\nlet chargeAimAngle = 0;\nlet chargeTelegraphGroup: any = null;\nlet chargeFillMesh: any = null;\nlet chargeBorderMesh: any = null;\nlet chargeBorderGeo: any = null;\n\n// Reusable vector for auto-fire direction\nconst _fireDir = new THREE.Vector3();\n\n// Shared geometry for player afterimages\nlet _playerGhostBodyGeo: any = null;\nlet _playerGhostHeadGeo: any = null;\n\n// Original emissive colors\nconst BODY_EMISSIVE = 0x22aa66;\nconst HEAD_EMISSIVE = 0x33bb88;\n\nexport function createPlayer(scene: any) {\n  playerGroup = new THREE.Group();\n\n  body = new THREE.Mesh(\n    new THREE.CylinderGeometry(PLAYER.size.radius, PLAYER.size.radius + 0.05, PLAYER.size.height * 0.6, 8),\n    new THREE.MeshStandardMaterial({\n      color: 0x44cc88,\n      emissive: BODY_EMISSIVE,\n      emissiveIntensity: 0.4\n    })\n  );\n  body.position.y = 0.7;\n  playerGroup.add(body);\n\n  head = new THREE.Mesh(\n    new THREE.SphereGeometry(PLAYER.size.radius * 0.85, 8, 6),\n    new THREE.MeshStandardMaterial({\n      color: 0x55ddaa,\n      emissive: HEAD_EMISSIVE,\n      emissiveIntensity: 0.5\n    })\n  );\n  head.position.y = 1.45;\n  playerGroup.add(head);\n\n  aimIndicator = new THREE.Mesh(\n    new THREE.ConeGeometry(0.12, 0.6, 4),\n    new THREE.MeshStandardMaterial({\n      color: 0x44ff88,\n      emissive: 0x44ff88,\n      emissiveIntensity: 0.8\n    })\n  );\n  aimIndicator.rotation.x = -Math.PI / 2;\n  aimIndicator.position.set(0, 0.8, -0.7);\n  playerGroup.add(aimIndicator);\n\n  scene.add(playerGroup);\n  return playerGroup;\n}\n\nexport function updatePlayer(inputState: any, dt: number, gameState: any) {\n  const now = performance.now();\n\n  // Tick ability cooldowns\n  for (const key of Object.keys(gameState.abilities)) {\n    if (gameState.abilities[key].cooldownRemaining > 0) {\n      gameState.abilities[key].cooldownRemaining -= dt * 1000;\n    }\n  }\n\n  // Tick charge system\n  if (isCharging) {\n    updateCharge(inputState, dt, gameState);\n  }\n\n  // End lag (post-dash lockout)\n  if (endLagTimer > 0) {\n    endLagTimer -= dt * 1000;\n    // During end lag, don't process movement or abilities\n    playerGroup.position.copy(playerPos);\n    updateAfterimages(dt);\n    return;\n  }\n\n  // === DASH ===\n  if (isDashing) {\n    updateDash(dt, gameState);\n    playerGroup.position.copy(playerPos);\n\n    // Aim still tracks cursor during dash\n    aimAtCursor(inputState);\n\n    updateAfterimages(dt);\n    return;\n  }\n\n  // Trigger dash\n  if (inputState.dash && gameState.abilities.dash.cooldownRemaining <= 0) {\n    startDash(inputState, gameState);\n  }\n\n  // Trigger charge (start)\n  if (inputState.ultimate && gameState.abilities.ultimate.cooldownRemaining <= 0 && !isCharging) {\n    startCharge(inputState, gameState);\n  }\n\n  // === MOVEMENT ===\n  if (Math.abs(inputState.moveX) > 0.01 || Math.abs(inputState.moveZ) > 0.01) {\n    const chargeSlow = isCharging ? ABILITIES.ultimate.chargeMoveSpeedMult : 1;\n    // Check for ice patch effects (doubled speed on ice)\n    const iceEffects = getIceEffects(playerPos.x, playerPos.z, true);\n    const speedMod = chargeSlow * iceEffects.speedMult;\n    playerPos.x += inputState.moveX * PLAYER.speed * speedMod * dt;\n    playerPos.z += inputState.moveZ * PLAYER.speed * speedMod * dt;\n\n    // Bob animation\n    bobPhase += dt * 12;\n    body.position.y = 0.7 + Math.sin(bobPhase) * 0.05;\n    head.position.y = 1.45 + Math.sin(bobPhase) * 0.07;\n  }\n\n  // Arena clamp\n  playerPos.x = Math.max(-19.5, Math.min(19.5, playerPos.x));\n  playerPos.z = Math.max(-19.5, Math.min(19.5, playerPos.z));\n\n  playerGroup.position.copy(playerPos);\n\n  // === AIM ===\n  aimAtCursor(inputState);\n\n  // === AUTO-FIRE ===\n  const dashCfg = ABILITIES.dash;\n  const canShoot = (!isDashing || dashCfg.canShootDuring) && !isCharging;\n\n  if (canShoot && now - lastFireTime > PLAYER.fireRate) {\n    _fireDir.set(\n      -Math.sin(playerGroup.rotation.y),\n      0,\n      -Math.cos(playerGroup.rotation.y)\n    );\n\n    fireProjectile(playerPos, _fireDir, { speed: PLAYER.projectile.speed, damage: PLAYER.projectile.damage, color: PLAYER.projectile.color }, false);\n    lastFireTime = now;\n  }\n\n  updateAfterimages(dt);\n}\n\nfunction aimAtCursor(inputState: any) {\n  const dx = inputState.aimWorldPos.x - playerPos.x;\n  const dz = inputState.aimWorldPos.z - playerPos.z;\n  if (dx * dx + dz * dz > 0.01) {\n    playerGroup.rotation.y = Math.atan2(-dx, -dz);\n  }\n}\n\n// === DASH SYSTEM ===\nfunction startDash(inputState: any, gameState: any) {\n  const cfg = ABILITIES.dash;\n  isDashing = true;\n  dashTimer = 0;\n  dashDuration = cfg.duration;\n  dashDistance = cfg.distance;\n  dashStartPos.copy(playerPos);\n\n  // Direction source \u2014 drag-to-aim override takes priority (mobile buttons)\n  const override = getAbilityDirOverride();\n  const hasMovement = Math.abs(inputState.moveX) > 0.01 || Math.abs(inputState.moveZ) > 0.01;\n\n  if (override) {\n    dashDir.set(override.x, 0, override.z).normalize();\n    clearAbilityDirOverride();\n  } else if (cfg.directionSource === 'movement' && hasMovement) {\n    dashDir.set(inputState.moveX, 0, inputState.moveZ).normalize();\n  } else if (cfg.directionSource === 'aim') {\n    dashDir.set(\n      inputState.aimWorldPos.x - playerPos.x, 0,\n      inputState.aimWorldPos.z - playerPos.z\n    ).normalize();\n  } else {\n    // 'movementOrAim' or fallback\n    if (hasMovement) {\n      dashDir.set(inputState.moveX, 0, inputState.moveZ).normalize();\n    } else {\n      dashDir.set(\n        inputState.aimWorldPos.x - playerPos.x, 0,\n        inputState.aimWorldPos.z - playerPos.z\n      ).normalize();\n    }\n  }\n\n  gameState.abilities.dash.cooldownRemaining = cfg.cooldown;\n\n  if (cfg.screenShakeOnStart > 0) {\n    screenShake(cfg.screenShakeOnStart, 80);\n  }\n}\n\nfunction updateDash(dt: number, gameState: any) {\n  const cfg = ABILITIES.dash;\n  dashTimer += dt * 1000;\n  const t = Math.min(dashTimer / dashDuration, 1.0);\n\n  // Easing\n  let easedT: number;\n  switch (cfg.curve) {\n    case 'easeOut':   easedT = 1 - (1 - t) * (1 - t); break;\n    case 'easeIn':    easedT = t * t; break;\n    case 'easeInOut': easedT = t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2; break;\n    default:          easedT = t;\n  }\n\n  // Position along dash path\n  playerPos.copy(dashStartPos);\n  playerPos.x += dashDir.x * dashDistance * easedT;\n  playerPos.z += dashDir.z * dashDistance * easedT;\n\n  // Arena clamp during dash\n  playerPos.x = Math.max(-19.5, Math.min(19.5, playerPos.x));\n  playerPos.z = Math.max(-19.5, Math.min(19.5, playerPos.z));\n\n  // I-frame window\n  isInvincible = cfg.invincible && (dashTimer >= cfg.iFrameStart && dashTimer <= cfg.iFrameEnd);\n\n  // Spawn afterimages at intervals\n  if (cfg.afterimageCount > 0) {\n    const interval = dashDuration / (cfg.afterimageCount + 1);\n    const prevCount = Math.floor((dashTimer - dt * 1000) / interval);\n    const currCount = Math.floor(dashTimer / interval);\n    if (currCount > prevCount) {\n      spawnAfterimage(cfg);\n    }\n  }\n\n  // End dash\n  if (t >= 1.0) {\n    isDashing = false;\n    isInvincible = false;\n    endLagTimer = cfg.endLag;\n  }\n}\n\nfunction spawnAfterimage(cfg: any) {\n  const scene = getScene();\n  const ghost = new THREE.Group();\n\n  // Simplified ghost \u2014 body and head silhouettes (shared geometry)\n  if (!_playerGhostBodyGeo) {\n    _playerGhostBodyGeo = new THREE.CylinderGeometry(PLAYER.size.radius, PLAYER.size.radius + 0.05, PLAYER.size.height * 0.6, 6);\n    _playerGhostHeadGeo = new THREE.SphereGeometry(PLAYER.size.radius * 0.85, 6, 4);\n  }\n  const ghostBody = new THREE.Mesh(\n    _playerGhostBodyGeo,\n    new THREE.MeshBasicMaterial({\n      color: cfg.ghostColor,\n      transparent: true,\n      opacity: 0.5\n    })\n  );\n  ghostBody.position.y = 0.7;\n  ghost.add(ghostBody);\n\n  const ghostHead = new THREE.Mesh(\n    _playerGhostHeadGeo,\n    new THREE.MeshBasicMaterial({\n      color: cfg.ghostColor,\n      transparent: true,\n      opacity: 0.5\n    })\n  );\n  ghostHead.position.y = 1.45;\n  ghost.add(ghostHead);\n\n  ghost.position.copy(playerPos);\n  ghost.rotation.y = playerGroup.rotation.y;\n  scene.add(ghost);\n\n  afterimages.push({ mesh: ghost, life: 0, maxLife: cfg.afterimageFadeDuration });\n}\n\nfunction updateAfterimages(dt: number) {\n  const scene = getScene();\n  for (let i = afterimages.length - 1; i >= 0; i--) {\n    const ai = afterimages[i];\n    ai.life += dt * 1000;\n    const fade = Math.max(0, 1 - ai.life / ai.maxLife);\n\n    ai.mesh.children.forEach((child: any) => {\n      if (child.material) child.material.opacity = fade * 0.5;\n    });\n\n    if (ai.life >= ai.maxLife) {\n      scene.remove(ai.mesh);\n      afterimages.splice(i, 1);\n    }\n  }\n}\n\n// === CHARGE PUSH SYSTEM ===\nfunction startCharge(inputState: any, gameState: any) {\n  const cfg = ABILITIES.ultimate;\n  isCharging = true;\n  chargeTimer = 0;\n  gameState.abilities.ultimate.charging = true;\n  gameState.abilities.ultimate.chargeT = 0;\n\n  // Calculate initial aim angle toward cursor\n  // atan2(dx, dz) so that sin(angle)=dx/len, cos(angle)=dz/len -> local +Z extends toward cursor\n  const dx = inputState.aimWorldPos.x - playerPos.x;\n  const dz = inputState.aimWorldPos.z - playerPos.z;\n  chargeAimAngle = Math.atan2(dx, dz);\n\n  // Create telegraph visual\n  createChargeTelegraph(cfg);\n\n  // Visual feedback \u2014 player glows while charging\n  body.material.emissive.setHex(0x44ffaa);\n  head.material.emissive.setHex(0x66ffcc);\n  body.material.emissiveIntensity = 0.6;\n  head.material.emissiveIntensity = 0.7;\n}\n\nfunction createChargeTelegraph(cfg: any) {\n  const scene = getScene();\n\n  chargeTelegraphGroup = new THREE.Group();\n  chargeTelegraphGroup.position.set(playerPos.x, 0.05, playerPos.z);\n  chargeTelegraphGroup.rotation.y = chargeAimAngle;\n\n  // Fill plane (unit plane, scaled each frame)\n  const fillGeo = new THREE.PlaneGeometry(1, 1);\n  fillGeo.rotateX(-Math.PI / 2);\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: cfg.color,\n    transparent: true,\n    opacity: cfg.telegraphOpacity,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  chargeFillMesh = new THREE.Mesh(fillGeo, fillMat);\n  // Position fill to start from player (offset by half minLength)\n  const halfLen = cfg.minLength / 2;\n  chargeFillMesh.scale.set(cfg.width, 1, cfg.minLength);\n  chargeFillMesh.position.set(0, 0, halfLen);\n  chargeTelegraphGroup.add(chargeFillMesh);\n\n  // Border \u2014 edges of a unit-sized plane, scaled each frame\n  const basePlane = new THREE.PlaneGeometry(1, 1);\n  const borderGeo = new THREE.EdgesGeometry(basePlane);\n  borderGeo.rotateX(-Math.PI / 2);\n  const borderMat = new THREE.LineBasicMaterial({\n    color: cfg.color,\n    transparent: true,\n    opacity: 0.8,\n    depthWrite: false,\n  });\n  chargeBorderMesh = new THREE.LineSegments(borderGeo, borderMat);\n  chargeBorderGeo = borderGeo;\n  chargeBorderMesh.scale.set(cfg.width, 1, cfg.minLength);\n  chargeBorderMesh.position.set(0, 0, halfLen);\n  chargeTelegraphGroup.add(chargeBorderMesh);\n\n  scene.add(chargeTelegraphGroup);\n}\n\nfunction updateCharge(inputState: any, dt: number, gameState: any) {\n  const cfg = ABILITIES.ultimate;\n  chargeTimer += dt * 1000;\n  const chargeT = Math.min(chargeTimer / cfg.chargeTimeMs, 1);\n  gameState.abilities.ultimate.chargeT = chargeT;\n\n  // Update aim angle from cursor\n  const dx = inputState.aimWorldPos.x - playerPos.x;\n  const dz = inputState.aimWorldPos.z - playerPos.z;\n  if (dx * dx + dz * dz > 0.01) {\n    chargeAimAngle = Math.atan2(dx, dz);\n  }\n\n  // Calculate current rect length\n  const currentLength = cfg.minLength + (cfg.maxLength - cfg.minLength) * chargeT;\n\n  // Update telegraph position and rotation\n  if (chargeTelegraphGroup) {\n    chargeTelegraphGroup.position.set(playerPos.x, 0.05, playerPos.z);\n    chargeTelegraphGroup.rotation.y = chargeAimAngle;\n\n    // Offset fill and border so the rect starts at the player and extends forward\n    const halfLen = currentLength / 2;\n\n    // Scale fill (unit plane scaled to desired size)\n    chargeFillMesh.scale.set(cfg.width, 1, currentLength);\n    chargeFillMesh.position.set(0, 0, halfLen);\n\n    // Scale border (unit-sized EdgesGeometry, scale to desired size)\n    chargeBorderMesh.scale.set(cfg.width, 1, currentLength);\n    chargeBorderMesh.position.set(0, 0, halfLen);\n\n    // Pulse border opacity\n    const pulse = 0.6 + 0.3 * Math.sin(performance.now() * 0.008);\n    chargeBorderMesh.material.opacity = pulse;\n\n    // Fill gets brighter as charge increases\n    chargeFillMesh.material.opacity = cfg.telegraphOpacity + chargeT * 0.2;\n  }\n\n  // Player glow intensifies with charge\n  body.material.emissiveIntensity = 0.6 + chargeT * 0.4;\n  head.material.emissiveIntensity = 0.7 + chargeT * 0.3;\n\n  // Auto-fire at max charge OR release key (100ms grace period prevents instant-fire)\n  if (chargeT >= 1 || (chargeTimer > 100 && !inputState.ultimateHeld)) {\n    fireChargePush(chargeT, gameState);\n  }\n}\n\nfunction fireChargePush(chargeT: number, gameState: any) {\n  const cfg = ABILITIES.ultimate;\n  const currentLength = cfg.minLength + (cfg.maxLength - cfg.minLength) * chargeT;\n  const force = cfg.minKnockback + (cfg.maxKnockback - cfg.minKnockback) * chargeT;\n\n  // Rectangle center = player position + half length toward cursor\n  // chargeAimAngle = atan2(dx, dz), so sin(angle) = dx/len, cos(angle) = dz/len -> toward cursor\n  const halfLen = currentLength / 2;\n  const dirX = Math.sin(chargeAimAngle);\n  const dirZ = Math.cos(chargeAimAngle);\n  const centerX = playerPos.x + dirX * halfLen;\n  const centerZ = playerPos.z + dirZ * halfLen;\n\n  // Emit push event for physics\n  pushEvent = {\n    x: centerX,\n    z: centerZ,\n    width: cfg.width,\n    length: currentLength,\n    rotation: chargeAimAngle,\n    force: force,\n    dirX: dirX,\n    dirZ: dirZ,\n  };\n\n  // Clean up telegraph\n  removeChargeTelegraph();\n\n  // Reset charge state\n  isCharging = false;\n  gameState.abilities.ultimate.charging = false;\n  gameState.abilities.ultimate.chargeT = 0;\n  gameState.abilities.ultimate.cooldownRemaining = cfg.cooldown;\n\n  // Restore player visuals\n  body.material.emissive.setHex(BODY_EMISSIVE);\n  head.material.emissive.setHex(HEAD_EMISSIVE);\n  body.material.emissiveIntensity = 0.4;\n  head.material.emissiveIntensity = 0.5;\n\n  // Screen shake scales with charge\n  screenShake(2 + chargeT * 3, 120);\n}\n\nfunction removeChargeTelegraph() {\n  if (chargeTelegraphGroup) {\n    const scene = getScene();\n    // Dispose materials and geometries\n    if (chargeFillMesh) {\n      chargeFillMesh.material.dispose();\n      chargeFillMesh.geometry.dispose();\n    }\n    if (chargeBorderMesh) {\n      chargeBorderMesh.material.dispose();\n      if (chargeBorderGeo) chargeBorderGeo.dispose();\n    }\n    scene.remove(chargeTelegraphGroup);\n    chargeTelegraphGroup = null;\n    chargeFillMesh = null;\n    chargeBorderMesh = null;\n    chargeBorderGeo = null;\n  }\n}\n\n// === PUBLIC API ===\nexport function getPlayerPos() { return playerPos; }\nexport function getPlayerGroup() { return playerGroup; }\nexport function isPlayerInvincible() { return isInvincible; }\nexport function isPlayerDashing() { return isDashing; }\nexport function consumePushEvent() {\n  const evt = pushEvent;\n  pushEvent = null;\n  return evt;\n}\n\nexport function resetPlayer() {\n  playerPos.set(0, 0, 0);\n  playerGroup.position.set(0, 0, 0);\n  playerGroup.rotation.y = 0;\n  isDashing = false;\n  isInvincible = false;\n  endLagTimer = 0;\n  lastFireTime = 0;\n  isCharging = false;\n  chargeTimer = 0;\n  pushEvent = null;\n  removeChargeTelegraph();\n  body.material.emissive.setHex(BODY_EMISSIVE);\n  head.material.emissive.setHex(HEAD_EMISSIVE);\n  body.material.emissiveIntensity = 0.4;\n  head.material.emissiveIntensity = 0.5;\n\n  // Clean up afterimages\n  const scene = getScene();\n  for (const ai of afterimages) {\n    scene.remove(ai.mesh);\n  }\n  afterimages.length = 0;\n}\n", "import { screenToWorld } from './renderer';\nimport { getPlayerPos } from '../entities/player';\n\nconst keys: Record<string, boolean> = {};\n\nconst inputState = {\n  moveX: 0,\n  moveZ: 0,\n  aimWorldPos: { x: 0, y: 0, z: 0 },\n  mouseNDC: { x: 0, y: 0 },\n  dash: false,\n  ultimate: false,\n  ultimateHeld: false,\n  toggleEditor: false,\n};\n\n// Isometric basis vectors (from prototype)\n// Camera faces along (-1, -1, -1)\n// Screen-right \u2192 world (1, 0, -1) normalized\n// Screen-up \u2192 world (-1, 0, -1) normalized\nconst INV_SQRT2 = 1 / Math.SQRT2;\nconst ISO_RIGHT_X = INV_SQRT2;\nconst ISO_RIGHT_Z = -INV_SQRT2;\nconst ISO_UP_X = -INV_SQRT2;\nconst ISO_UP_Z = -INV_SQRT2;\n\n// Gamepad state\nconst DEADZONE = 0.15;\nlet gamepadIndex = -1;\nlet gamepadAimActive = false;   // true while right stick is deflected beyond deadzone\nlet prevGamepadButtons: Record<string, boolean> = {};    // for edge-triggered button detection\n\n// Track input source \u2014 gamepad/touch aim overrides mouse aim when active\nlet usingGamepad = false;\n\n// Touch joystick state (nipplejs)\nlet touchMoveX = 0, touchMoveY = 0;  // screen-space from left stick\nlet touchAimX = 0, touchAimY = 0;    // screen-space from right stick\nlet touchAimActive = false;\nlet touchActive = false;             // true when any touch joystick is in use\n\nexport function initInput() {\n  window.addEventListener('keydown', (e) => {\n    if (e.repeat) return;\n    keys[e.code] = true;\n    usingGamepad = false;\n\n    // Edge-triggered ability inputs\n    if (e.code === 'Space') { inputState.dash = true; e.preventDefault(); }\n    if (e.code === 'KeyE') inputState.ultimate = true;\n    if (e.code === 'Backquote') inputState.toggleEditor = true;\n  });\n\n  window.addEventListener('keyup', (e) => {\n    keys[e.code] = false;\n  });\n\n  window.addEventListener('mousemove', (e) => {\n    inputState.mouseNDC.x = (e.clientX / window.innerWidth) * 2 - 1;\n    inputState.mouseNDC.y = -(e.clientY / window.innerHeight) * 2 + 1;\n    usingGamepad = false;\n  });\n\n  // Gamepad connect/disconnect\n  window.addEventListener('gamepadconnected', (e: GamepadEvent) => {\n    console.log(`[input] Gamepad connected: ${e.gamepad.id}`);\n    gamepadIndex = e.gamepad.index;\n  });\n  window.addEventListener('gamepaddisconnected', (e: GamepadEvent) => {\n    console.log(`[input] Gamepad disconnected: ${e.gamepad.id}`);\n    if (e.gamepad.index === gamepadIndex) gamepadIndex = -1;\n  });\n\n  // Touch joysticks (nipplejs) \u2014 only on touch-capable devices\n  initTouchJoysticks();\n}\n\nfunction applyDeadzone(value: number) {\n  if (Math.abs(value) < DEADZONE) return 0;\n  // Remap from [deadzone..1] to [0..1] for smooth ramp\n  const sign = value > 0 ? 1 : -1;\n  return sign * (Math.abs(value) - DEADZONE) / (1 - DEADZONE);\n}\n\nfunction initTouchJoysticks() {\n  // Only initialize if nipplejs is loaded and we have touch capability\n  if (typeof nipplejs === 'undefined') return;\n  const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n  if (!hasTouch) return;\n\n  const zoneLeft = document.getElementById('zone-left');\n  const zoneRight = document.getElementById('zone-right');\n  if (!zoneLeft || !zoneRight) return;\n\n  // Ensure zones are visible on touch devices\n  zoneLeft.style.display = 'block';\n  zoneRight.style.display = 'block';\n\n  console.log('[input] Touch joysticks initialized');\n\n  // Left joystick \u2014 movement\n  const leftJoystick = nipplejs.create({\n    zone: zoneLeft,\n    mode: 'dynamic',\n    position: { left: '50%', top: '50%' },\n    color: 'rgba(68, 204, 136, 0.35)',\n    size: 120,\n    restOpacity: 0.5,\n  });\n\n  leftJoystick.on('move', (evt: any, data: any) => {\n    const force = Math.min(data.force, 1.5) / 1.5;\n    const angle = data.angle.radian;\n    touchMoveX = Math.cos(angle) * force;   // screen-right\n    touchMoveY = Math.sin(angle) * force;   // screen-up\n    touchActive = true;\n  });\n  leftJoystick.on('end', () => {\n    touchMoveX = 0;\n    touchMoveY = 0;\n  });\n\n  // Right joystick \u2014 aim + auto-fire\n  const rightJoystick = nipplejs.create({\n    zone: zoneRight,\n    mode: 'dynamic',\n    position: { left: '50%', top: '50%' },\n    color: 'rgba(255, 102, 68, 0.35)',\n    size: 120,\n    restOpacity: 0.5,\n  });\n\n  rightJoystick.on('move', (evt: any, data: any) => {\n    const force = Math.min(data.force, 1.5) / 1.5;\n    const angle = data.angle.radian;\n    touchAimX = Math.cos(angle) * force;\n    touchAimY = Math.sin(angle) * force;\n    touchAimActive = true;\n    touchActive = true;\n  });\n  rightJoystick.on('end', () => {\n    touchAimX = 0;\n    touchAimY = 0;\n    touchAimActive = false;\n  });\n}\n\nfunction pollTouchJoysticks() {\n  if (!touchActive) return;\n\n  // --- Left stick: movement ---\n  if (Math.abs(touchMoveX) > 0.01 || Math.abs(touchMoveY) > 0.01) {\n    // Map screen-space joystick to isometric world-space (same as WASD/gamepad)\n    // touchMoveX = screen right, touchMoveY = screen up\n    const tMoveX = touchMoveX * ISO_RIGHT_X + touchMoveY * ISO_UP_X;\n    const tMoveZ = touchMoveX * ISO_RIGHT_Z + touchMoveY * ISO_UP_Z;\n\n    // Touch overrides keyboard if keyboard isn't active\n    const kbActive = Math.abs(inputState.moveX) > 0.01 || Math.abs(inputState.moveZ) > 0.01;\n    if (!kbActive) {\n      inputState.moveX = tMoveX;\n      inputState.moveZ = tMoveZ;\n      const len = Math.sqrt(inputState.moveX * inputState.moveX + inputState.moveZ * inputState.moveZ);\n      if (len > 1) {\n        inputState.moveX /= len;\n        inputState.moveZ /= len;\n      }\n    }\n  }\n\n  // --- Right stick: aim ---\n  if (touchAimActive) {\n    const aimDirX = touchAimX * ISO_RIGHT_X + touchAimY * ISO_UP_X;\n    const aimDirZ = touchAimX * ISO_RIGHT_Z + touchAimY * ISO_UP_Z;\n\n    const pp = getPlayerPos();\n    const aimDist = 10;\n    inputState.aimWorldPos.x = pp.x + aimDirX * aimDist;\n    inputState.aimWorldPos.y = 0;\n    inputState.aimWorldPos.z = pp.z + aimDirZ * aimDist;\n  }\n}\n\nfunction pollGamepad() {\n  if (gamepadIndex < 0) return;\n  const gamepads = navigator.getGamepads();\n  const gp = gamepads[gamepadIndex];\n  if (!gp) return;\n\n  usingGamepad = true;\n\n  // --- Left stick: movement (axes 0, 1) ---\n  const lx = applyDeadzone(gp.axes[0] || 0);\n  const ly = applyDeadzone(gp.axes[1] || 0); // Y axis inverted (up = negative)\n\n  // Map screen-space stick to isometric world-space (same as WASD)\n  // lx = screen right, -ly = screen up (stick Y is inverted)\n  const gpMoveX = lx * ISO_RIGHT_X + (-ly) * ISO_UP_X;\n  const gpMoveZ = lx * ISO_RIGHT_Z + (-ly) * ISO_UP_Z;\n\n  // Blend with keyboard: if keyboard has input, keyboard wins; otherwise gamepad\n  const kbActive = Math.abs(inputState.moveX) > 0.01 || Math.abs(inputState.moveZ) > 0.01;\n  if (!kbActive && (Math.abs(gpMoveX) > 0.01 || Math.abs(gpMoveZ) > 0.01)) {\n    inputState.moveX = gpMoveX;\n    inputState.moveZ = gpMoveZ;\n    // Normalize if > 1\n    const len = Math.sqrt(inputState.moveX * inputState.moveX + inputState.moveZ * inputState.moveZ);\n    if (len > 1) {\n      inputState.moveX /= len;\n      inputState.moveZ /= len;\n    }\n  }\n\n  // --- Right stick: aim (axes 2, 3) ---\n  const rx = applyDeadzone(gp.axes[2] || 0);\n  const ry = applyDeadzone(gp.axes[3] || 0);\n\n  gamepadAimActive = (Math.abs(rx) > 0.01 || Math.abs(ry) > 0.01);\n\n  if (gamepadAimActive) {\n    // Convert stick direction to isometric world direction\n    const aimDirX = rx * ISO_RIGHT_X + (-ry) * ISO_UP_X;\n    const aimDirZ = rx * ISO_RIGHT_Z + (-ry) * ISO_UP_Z;\n\n    // Place aim target at player + direction * distance\n    const pp = getPlayerPos();\n    const aimDist = 10; // arbitrary distance so atan2 calculation works\n    inputState.aimWorldPos.x = pp.x + aimDirX * aimDist;\n    inputState.aimWorldPos.y = 0;\n    inputState.aimWorldPos.z = pp.z + aimDirZ * aimDist;\n  }\n\n  // --- Buttons (edge-triggered) ---\n  // Standard gamepad mapping:\n  // 0 = A (South), 1 = B (East), 2 = X (West), 3 = Y (North)\n  // 4 = LB, 5 = RB, 6 = LT, 7 = RT\n  const buttons = gp.buttons;\n\n  // Dash: A button (0) or LB (4)\n  const dashBtn = (buttons[0] && buttons[0].pressed) || (buttons[4] && buttons[4].pressed);\n  if (dashBtn && !prevGamepadButtons.dash) inputState.dash = true;\n  prevGamepadButtons.dash = !!dashBtn;\n\n  // Ultimate: RB (5) or RT (7)\n  const ultBtn = (buttons[5] && buttons[5].pressed) || (buttons[7] && buttons[7].pressed);\n  if (ultBtn && !prevGamepadButtons.ult) inputState.ultimate = true;\n  prevGamepadButtons.ult = !!ultBtn;\n\n  // Ultimate held (for charge release detection)\n  if (ultBtn) inputState.ultimateHeld = true;\n}\n\nexport function updateInput() {\n  // WASD \u2192 raw screen-space directions\n  let rawX = 0, rawY = 0;\n  if (keys['KeyD'] || keys['ArrowRight']) rawX += 1;\n  if (keys['KeyA'] || keys['ArrowLeft'])  rawX -= 1;\n  if (keys['KeyW'] || keys['ArrowUp'])    rawY += 1;\n  if (keys['KeyS'] || keys['ArrowDown'])  rawY -= 1;\n\n  // Map screen-space to isometric world-space\n  inputState.moveX = rawX * ISO_RIGHT_X + rawY * ISO_UP_X;\n  inputState.moveZ = rawX * ISO_RIGHT_Z + rawY * ISO_UP_Z;\n\n  // Normalize diagonal movement\n  const len = Math.sqrt(inputState.moveX * inputState.moveX + inputState.moveZ * inputState.moveZ);\n  if (len > 1) {\n    inputState.moveX /= len;\n    inputState.moveZ /= len;\n  }\n\n  // Continuous held state for charge abilities\n  // Merge keyboard + touch button hold (gamepad sets it in pollGamepad)\n  inputState.ultimateHeld = !!keys['KeyE'] || _touchUltHeld;\n\n  // Mouse \u2192 world position on y=0 plane (only if not overridden by gamepad/touch/ability drag)\n  if ((!usingGamepad || !gamepadAimActive) && !touchAimActive && !_abilityAimActive) {\n    const worldPos = screenToWorld(inputState.mouseNDC.x, inputState.mouseNDC.y);\n    inputState.aimWorldPos.x = worldPos.x;\n    inputState.aimWorldPos.y = worldPos.y;\n    inputState.aimWorldPos.z = worldPos.z;\n  }\n\n  // Poll gamepad (blends with keyboard/mouse above)\n  pollGamepad();\n\n  // Poll touch joysticks (blends with keyboard/mouse/gamepad above)\n  pollTouchJoysticks();\n}\n\nexport function consumeInput() {\n  inputState.dash = false;\n  inputState.ultimate = false;\n  inputState.toggleEditor = false;\n}\n\nexport function getInputState() { return inputState; }\n\n// Expose for touch-screen ability buttons\nlet _touchUltHeld = false;\nexport function triggerDash() { inputState.dash = true; }\nexport function triggerUltimate() { inputState.ultimate = true; }\nexport function setUltimateHeld(held: boolean) { _touchUltHeld = held; }\n\n// Drag-to-aim: set aim world position from screen-space drag direction\nlet _abilityAimActive = false; // true while a mobile button drag is overriding aim\nexport function setAimFromScreenDrag(screenX: number, screenY: number) {\n  _abilityAimActive = true;\n  const aimDirX = screenX * ISO_RIGHT_X + screenY * ISO_UP_X;\n  const aimDirZ = screenX * ISO_RIGHT_Z + screenY * ISO_UP_Z;\n\n  const pp = getPlayerPos();\n  const aimDist = 10;\n  inputState.aimWorldPos.x = pp.x + aimDirX * aimDist;\n  inputState.aimWorldPos.y = 0;\n  inputState.aimWorldPos.z = pp.z + aimDirZ * aimDist;\n}\n\n// Override movement direction for dash drag-to-aim\nlet _abilityDirOverride: { x: number; z: number } | null = null;\nexport function setAbilityDirOverride(x: number, z: number) { _abilityDirOverride = { x, z }; }\nexport function clearAbilityDirOverride() { _abilityDirOverride = null; _abilityAimActive = false; }\nexport function getAbilityDirOverride() { return _abilityDirOverride; }\n\n/**\n * Mobile auto-aim: if on a touch device and the right joystick / ability drag\n * is NOT active, aim at the closest enemy automatically.\n * Called from game loop after updateInput(), before updatePlayer().\n */\nexport function autoAimClosestEnemy(enemies: any[]) {\n  // Only on touch devices, and only when no manual aim is active\n  if (!touchActive) return;\n  if (touchAimActive || _abilityAimActive) return;\n\n  if (!enemies || enemies.length === 0) return;\n\n  const pp = getPlayerPos();\n  let closest: any = null;\n  let closestDist = Infinity;\n\n  for (let i = 0; i < enemies.length; i++) {\n    const e = enemies[i];\n    if (e.fellInPit || e.health <= 0) continue;\n    const dx = e.pos.x - pp.x;\n    const dz = e.pos.z - pp.z;\n    const dist = dx * dx + dz * dz; // squared distance is fine for comparison\n    if (dist < closestDist) {\n      closestDist = dist;\n      closest = e;\n    }\n  }\n\n  if (closest) {\n    inputState.aimWorldPos.x = closest.pos.x;\n    inputState.aimWorldPos.y = 0;\n    inputState.aimWorldPos.z = closest.pos.z;\n  }\n}\n", "import { WaveDefinition } from '../types/index';\n\nexport const WAVES: WaveDefinition[] = [\n  {\n    wave: 1,\n    message: 'Wave 1 \u2014 The dungeon stirs...',\n    groups: [\n      {\n        id: 'w1g1',\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 200,\n        spawns: [\n          { type: 'goblin', x: 5, z: 2 },\n          { type: 'goblin', x: 11, z: 0 },\n          { type: 'goblin', x: 0, z: 5 },\n          { type: 'iceMortarImp', x: 7, z: -11 },\n          { type: 'iceMortarImp', x: -10, z: 9 },\n        ],\n      },\n      {\n        id: 'w1g2',\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 200,\n        spawns: [\n          { type: 'goblin', x: -2, z: -9 },\n          { type: 'goblin', x: -10, z: -3 },\n          { type: 'goblin', x: -10, z: 0 },\n        ],\n      },\n    ]\n  },\n  {\n    wave: 2,\n    message: 'Wave 2 \u2014 Watch the big ones',\n    groups: [\n      {\n        id: 'w2g1',\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 150,\n        spawns: [\n          { type: 'goblin', x: 14, z: 0 },\n          { type: 'stoneGolem', x: 12, z: 2 },\n          { type: 'goblin', x: 12, z: -2 },\n          { type: 'goblin', x: -14, z: 0 },\n          { type: 'goblin', x: -12, z: 2 },\n          { type: 'stoneGolem', x: -12, z: -1 },\n          { type: 'goblin', x: 6, z: -7 },\n          { type: 'goblin', x: -6, z: 6 },\n        ],\n      },\n      {\n        id: 'w2g2',\n        triggerDelay: 3000,\n        telegraphDuration: 2000,\n        stagger: 400,\n        spawns: [\n          { type: 'skeletonArcher', x: 12, z: 12 },\n          { type: 'skeletonArcher', x: -12, z: -12 },\n          { type: 'skeletonArcher', x: -12, z: 12 },\n        ],\n      },\n    ]\n  },\n  {\n    wave: 3,\n    message: 'Wave 3 \u2014 Final wave?',\n    groups: [\n      {\n        id: 'w3g1',\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 100,\n        spawns: [\n          { type: 'goblin', x: 15, z: 5 },\n          { type: 'goblin', x: 15, z: -5 },\n          { type: 'goblin', x: -15, z: 5 },\n          { type: 'goblin', x: -15, z: -5 },\n          { type: 'goblin', x: 5, z: 15 },\n          { type: 'goblin', x: -5, z: 15 },\n        ],\n      },\n      {\n        id: 'w3g2',\n        triggerDelay: 2000,\n        telegraphDuration: 2000,\n        stagger: 300,\n        spawns: [\n          { type: 'skeletonArcher', x: 14, z: 10 },\n          { type: 'skeletonArcher', x: -14, z: 10 },\n          { type: 'skeletonArcher', x: 0, z: -16 },\n          { type: 'skeletonArcher', x: 14, z: -10 },\n        ],\n      },\n      {\n        id: 'w3g3',\n        triggerDelay: 6000,\n        telegraphDuration: 2500,\n        stagger: 500,\n        spawns: [\n          { type: 'stoneGolem', x: 0, z: 15 },\n          { type: 'stoneGolem', x: -15, z: -5 },\n          { type: 'stoneGolem', x: 15, z: -5 },\n        ],\n      },\n      {\n        id: 'w3g4',\n        triggerDelay: 7000,\n        telegraphDuration: 1500,\n        stagger: 200,\n        spawns: [\n          { type: 'iceMortarImp', x: -13, z: 0 },\n          { type: 'iceMortarImp', x: -3, z: -12 },\n          { type: 'iceMortarImp', x: 12, z: 1 },\n          { type: 'iceMortarImp', x: -5, z: 11 },\n        ],\n      },\n    ]\n  },\n];\n", "// Telegraph system \u2014 visual warnings before enemies spawn\n// Ground ring + fill circle + type indicator per spawn point\n\nimport { ENEMY_TYPES } from '../config/enemies';\n\nlet sceneRef: any;\n\n// Shared geometries (created once, reused across all telegraphs)\nlet ringGeo: any, fillGeo: any;\nconst typeGeos: Record<string, any> = {};  // keyed by enemy type name\n\n// Type indicator shapes\nconst TYPE_LABELS: Record<string, string> = {\n  goblin: 'G',\n  skeletonArcher: 'A',\n  stoneGolem: 'T',\n};\n\nexport function initTelegraph(scene: any) {\n  sceneRef = scene;\n\n  // Ring: inner 0.6, outer 0.8, flat on ground\n  ringGeo = new THREE.RingGeometry(0.6, 0.8, 24);\n  ringGeo.rotateX(-Math.PI / 2);\n\n  // Fill circle: radius 0.6\n  fillGeo = new THREE.CircleGeometry(0.6, 24);\n  fillGeo.rotateX(-Math.PI / 2);\n\n  // Type indicators \u2014 small shapes\n  // Goblin: triangle (cone 3 sides)\n  typeGeos.goblin = new THREE.ConeGeometry(0.2, 0.4, 3);\n  // Archer: diamond (box rotated)\n  typeGeos.skeletonArcher = new THREE.BoxGeometry(0.25, 0.25, 0.25);\n  // Golem: hexagon (cylinder 6 sides, flat)\n  typeGeos.stoneGolem = new THREE.CylinderGeometry(0.25, 0.25, 0.1, 6);\n}\n\nexport function createTelegraph(x: number, z: number, typeName: string) {\n  const color = ENEMY_TYPES[typeName] ? ENEMY_TYPES[typeName].color : 0xffffff;\n  const group = new THREE.Group();\n  group.position.set(x, 0, z);\n\n  // Ground ring\n  const ringMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0.6,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const ring = new THREE.Mesh(ringGeo, ringMat);\n  ring.position.y = 0.03;\n  group.add(ring);\n\n  // Fill circle\n  const fillMat = new THREE.MeshBasicMaterial({\n    color: color,\n    transparent: true,\n    opacity: 0,\n    side: THREE.DoubleSide,\n    depthWrite: false,\n  });\n  const fill = new THREE.Mesh(fillGeo, fillMat);\n  fill.position.y = 0.02;\n  group.add(fill);\n\n  // Type indicator \u2014 floating shape\n  const typeGeo = typeGeos[typeName] || typeGeos.goblin;\n  const typeMat = new THREE.MeshStandardMaterial({\n    color: color,\n    emissive: color,\n    emissiveIntensity: 0.6,\n    transparent: true,\n    opacity: 0.8,\n  });\n  const typeIndicator = new THREE.Mesh(typeGeo, typeMat);\n  typeIndicator.position.y = 1.2;\n  if (typeName === 'skeletonArcher') {\n    typeIndicator.rotation.y = Math.PI / 4; // diamond rotation\n  }\n  group.add(typeIndicator);\n\n  sceneRef.add(group);\n\n  return {\n    group,\n    ring,\n    ringMat,\n    fill,\n    fillMat,\n    typeIndicator,\n    typeMat,\n    baseColor: color,\n    time: 0,\n  };\n}\n\n// progress: 0 = just appeared, 1 = about to spawn\nexport function updateTelegraph(telegraph: any, progress: number, dt: number) {\n  telegraph.time += dt;\n\n  // Fill circle: opacity ramps up with progress\n  telegraph.fillMat.opacity = progress * 0.4;\n\n  // Ring: pulse frequency increases with progress (2Hz \u2192 10Hz)\n  const freq = 2 + progress * 8;\n  const pulse = 0.5 + 0.5 * Math.sin(telegraph.time * freq * Math.PI * 2);\n\n  // Ring opacity: base 0.3 + pulse\n  telegraph.ringMat.opacity = 0.3 + pulse * 0.5;\n\n  // Ring scale: gentle breathing\n  const scale = 1.0 + 0.1 * Math.sin(telegraph.time * freq * Math.PI * 2);\n  telegraph.ring.scale.set(scale, 1, scale);\n\n  // Flash white when close to spawning (>80%)\n  if (progress > 0.8) {\n    const flash = Math.sin(telegraph.time * 20) > 0.5;\n    telegraph.ringMat.color.setHex(flash ? 0xffffff : telegraph.baseColor);\n    telegraph.fillMat.color.setHex(flash ? 0xffffff : telegraph.baseColor);\n  }\n\n  // Type indicator: gentle bob\n  telegraph.typeIndicator.position.y = 1.2 + 0.15 * Math.sin(telegraph.time * 2);\n  telegraph.typeIndicator.rotation.y += dt * 1.5;\n}\n\nexport function removeTelegraph(telegraph: any) {\n  if (telegraph.group.parent) {\n    sceneRef.remove(telegraph.group);\n  }\n  // Dispose cloned materials\n  telegraph.ringMat.dispose();\n  telegraph.fillMat.dispose();\n  telegraph.typeMat.dispose();\n}\n", "// Wave runner \u2014 state machine that drives wave progression\n// idle \u2192 announce \u2192 running \u2192 cleared \u2192 next wave / victory\n\nimport { WAVES } from '../config/waves';\nimport { spawnEnemy } from '../entities/enemy';\nimport { initTelegraph, createTelegraph, updateTelegraph, removeTelegraph } from './telegraph';\n\nlet sceneRef: any;\n\nconst waveState = {\n  status: 'idle' as string,          // 'idle' | 'announce' | 'running' | 'cleared' | 'victory'\n  waveIndex: 0,\n  elapsedMs: 0,            // ms since wave entered 'running'\n  announceTimer: 0,\n  clearPauseTimer: 0,\n  groups: [] as any[],              // runtime state per group\n};\n\n// Announce UI element\nlet announceEl: HTMLElement | null;\n\nexport function initWaveRunner(scene: any) {\n  sceneRef = scene;\n  initTelegraph(scene);\n\n  // Get or create announce element\n  announceEl = document.getElementById('wave-announce');\n}\n\nexport function startWave(index: number, gameState: any) {\n  if (index >= WAVES.length) {\n    waveState.status = 'victory';\n    showAnnounce('VICTORY');\n    return;\n  }\n\n  waveState.waveIndex = index;\n  waveState.status = 'announce';\n  waveState.announceTimer = 2000;\n  waveState.elapsedMs = 0;\n  waveState.groups = [];\n\n  gameState.currentWave = WAVES[index].wave;\n\n  // Show wave announcement\n  showAnnounce(WAVES[index].message);\n}\n\nexport function updateWaveRunner(dt: number, gameState: any) {\n  const dtMs = dt * 1000;\n\n  switch (waveState.status) {\n    case 'idle':\n    case 'victory':\n      return;\n\n    case 'announce':\n      waveState.announceTimer -= dtMs;\n      if (waveState.announceTimer <= 0) {\n        hideAnnounce();\n        waveState.status = 'running';\n        initGroupRuntimes();\n      }\n      break;\n\n    case 'running':\n      waveState.elapsedMs += dtMs;\n      let allGroupsDone = true;\n\n      for (const g of waveState.groups) {\n        updateGroup(g, dt, dtMs, gameState);\n        if (g.phase !== 'done') allGroupsDone = false;\n      }\n\n      // Wave cleared: all groups spawned AND no enemies alive\n      if (allGroupsDone && gameState.enemies.length === 0) {\n        waveState.status = 'cleared';\n        waveState.clearPauseTimer = 2000;\n        showAnnounce('Wave cleared!');\n      }\n      break;\n\n    case 'cleared':\n      waveState.clearPauseTimer -= dtMs;\n      if (waveState.clearPauseTimer <= 0) {\n        hideAnnounce();\n        startWave(waveState.waveIndex + 1, gameState);\n      }\n      break;\n  }\n}\n\nfunction initGroupRuntimes() {\n  const waveCfg = WAVES[waveState.waveIndex];\n  waveState.groups = waveCfg.groups.map((groupCfg: any) => ({\n    config: groupCfg,\n    phase: 'waiting',    // 'waiting' | 'telegraphing' | 'spawning' | 'done'\n    timer: 0,\n    spawnIndex: 0,\n    staggerTimer: 0,\n    telegraphs: [] as any[],\n  }));\n}\n\nfunction updateGroup(g: any, dt: number, dtMs: number, gameState: any) {\n  switch (g.phase) {\n    case 'waiting':\n      if (waveState.elapsedMs >= g.config.triggerDelay) {\n        g.phase = 'telegraphing';\n        g.timer = g.config.telegraphDuration;\n\n        // Create telegraph markers for each spawn in this group\n        for (const s of g.config.spawns) {\n          const t = createTelegraph(s.x, s.z, s.type);\n          g.telegraphs.push(t);\n        }\n      }\n      break;\n\n    case 'telegraphing':\n      g.timer -= dtMs;\n      const progress = 1.0 - Math.max(0, g.timer / g.config.telegraphDuration);\n\n      // Update all telegraph animations\n      for (const t of g.telegraphs) {\n        updateTelegraph(t, progress, dt);\n      }\n\n      if (g.timer <= 0) {\n        // Remove telegraphs\n        for (const t of g.telegraphs) {\n          removeTelegraph(t);\n        }\n        g.telegraphs = [];\n\n        // Transition to spawning\n        g.phase = 'spawning';\n        g.spawnIndex = 0;\n        g.staggerTimer = 0;\n      }\n      break;\n\n    case 'spawning':\n      g.staggerTimer -= dtMs;\n      while (g.staggerTimer <= 0 && g.spawnIndex < g.config.spawns.length) {\n        const s = g.config.spawns[g.spawnIndex];\n        spawnEnemy(s.type, new THREE.Vector3(s.x, 0, s.z), gameState);\n        g.spawnIndex++;\n        if (g.spawnIndex < g.config.spawns.length) {\n          g.staggerTimer += g.config.stagger;\n        }\n      }\n      if (g.spawnIndex >= g.config.spawns.length) {\n        g.phase = 'done';\n      }\n      break;\n  }\n}\n\nexport function resetWaveRunner() {\n  // Clean up any active telegraphs\n  for (const g of waveState.groups) {\n    for (const t of g.telegraphs) {\n      removeTelegraph(t);\n    }\n  }\n  waveState.status = 'idle';\n  waveState.waveIndex = 0;\n  waveState.elapsedMs = 0;\n  waveState.groups = [];\n  hideAnnounce();\n}\n\nexport function getWaveState() {\n  return waveState;\n}\n\nexport function isWaveRunnerActive() {\n  return waveState.status === 'running' || waveState.status === 'announce';\n}\n\n// Announce text overlay\nfunction showAnnounce(text: string) {\n  if (!announceEl) return;\n  announceEl.textContent = text;\n  announceEl.classList.add('visible');\n}\n\nfunction hideAnnounce() {\n  if (!announceEl) return;\n  announceEl.classList.remove('visible');\n}\n", "import { getPlayerPos, isPlayerInvincible, isPlayerDashing, consumePushEvent } from '../entities/player';\nimport { getPlayerProjectiles, getEnemyProjectiles, releaseProjectile } from '../entities/projectile';\nimport { stunEnemy } from '../entities/enemy';\nimport { getIceEffects } from '../entities/mortarProjectile';\nimport { screenShake, getScene } from './renderer';\nimport { PLAYER } from '../config/player';\nimport { getCollisionBounds, getPitBounds } from '../config/arena';\nimport { spawnDamageNumber } from '../ui/damageNumbers';\nimport { applyAoeEffect, isInRotatedRect, createAoeRing } from './aoeTelegraph';\nimport { AABB, GameState, Enemy } from '../types/index';\nimport type { Group, CylinderGeometry, SphereGeometry, Mesh, MeshBasicMaterial, Material } from 'three';\n\n// Cache collision bounds (invalidated when arena layout changes)\nlet collisionBounds: AABB[] | null = null;\nlet pitBounds: AABB[] | null = null;\nlet movementBounds: AABB[] | null = null;\n\n// Invalidate cached bounds \u2014 called by level editor when obstacles/pits change\nexport function invalidateCollisionBounds(): void {\n  collisionBounds = null;\n  pitBounds = null;\n  movementBounds = null;\n}\n\n// Effect ghosts \u2014 push afterimages + pit fall sinking ghosts\ninterface EffectGhost {\n  type: 'fade' | 'sink';\n  mesh: Group;\n  life: number;\n  maxLife: number;\n}\nconst effectGhosts: EffectGhost[] = [];\n\n// Shared unit geometries for ghost meshes (scaled per-instance)\nlet _ghostBodyGeo: CylinderGeometry | null = null;\nlet _ghostHeadGeo: SphereGeometry | null = null;\n\nfunction createGhostMesh(x: number, z: number, radius: number, height: number, color: number): Group {\n  if (!_ghostBodyGeo) {\n    _ghostBodyGeo = new THREE.CylinderGeometry(1, 1, 1, 6);\n    _ghostHeadGeo = new THREE.SphereGeometry(1, 6, 4);\n  }\n  const group = new THREE.Group();\n\n  const bodyMat = new THREE.MeshBasicMaterial({ color, transparent: true, opacity: 0.4 });\n  const body = new THREE.Mesh(_ghostBodyGeo, bodyMat);\n  const bodyH = height * 0.6;\n  body.scale.set(radius, bodyH, radius);\n  body.position.y = height * 0.3;\n  group.add(body);\n\n  const headMat = new THREE.MeshBasicMaterial({ color, transparent: true, opacity: 0.4 });\n  const headR = radius * 0.7;\n  const head = new THREE.Mesh(_ghostHeadGeo!, headMat);\n  head.scale.set(headR, headR, headR);\n  head.position.y = height * 0.75;\n  group.add(head);\n\n  group.position.set(x, 0, z);\n  getScene().add(group);\n  return group;\n}\n\nfunction spawnPushGhosts(enemy: Enemy, oldX: number, oldZ: number, newX: number, newZ: number): void {\n  const cfg = enemy.config;\n  const r = cfg.size.radius;\n  const h = cfg.size.height;\n  for (let t = 0.33; t < 1; t += 0.33) {\n    const gx = oldX + (newX - oldX) * t;\n    const gz = oldZ + (newZ - oldZ) * t;\n    const mesh = createGhostMesh(gx, gz, r, h, 0x44ffaa);\n    effectGhosts.push({ type: 'fade', mesh, life: 0, maxLife: 300 });\n  }\n}\n\nfunction spawnPitFallGhost(enemy: Enemy): void {\n  const cfg = enemy.config;\n  const r = cfg.size.radius;\n  const h = cfg.size.height;\n  const mesh = createGhostMesh(enemy.pos.x, enemy.pos.z, r, h, 0x8844ff);\n  mesh.children.forEach(child => {\n    ((child as Mesh).material as MeshBasicMaterial).opacity = 0.7;\n  });\n  effectGhosts.push({ type: 'sink', mesh, life: 0, maxLife: 500 });\n}\n\nexport function updateEffectGhosts(dt: number): void {\n  const dtMs = dt * 1000;\n  const scene = getScene();\n\n  for (let i = effectGhosts.length - 1; i >= 0; i--) {\n    const g = effectGhosts[i];\n    g.life += dtMs;\n    const t = Math.min(g.life / g.maxLife, 1);\n\n    if (g.type === 'fade') {\n      const alpha = 0.4 * (1 - t);\n      g.mesh.children.forEach(child => {\n        ((child as Mesh).material as MeshBasicMaterial).opacity = alpha;\n      });\n    } else if (g.type === 'sink') {\n      const scale = 1 - t;\n      g.mesh.scale.set(scale, scale, scale);\n      g.mesh.position.y = -1.5 * t;\n      const alpha = 0.7 * (1 - t * t);\n      g.mesh.children.forEach(child => {\n        ((child as Mesh).material as MeshBasicMaterial).opacity = alpha;\n      });\n    }\n\n    if (t >= 1) {\n      g.mesh.children.forEach(child => {\n        ((child as Mesh).material as Material).dispose();\n      });\n      scene.remove(g.mesh);\n      effectGhosts.splice(i, 1);\n    }\n  }\n}\n\nexport function clearEffectGhosts(): void {\n  const scene = getScene();\n  for (const g of effectGhosts) {\n    g.mesh.children.forEach(child => {\n      ((child as Mesh).material as Material).dispose();\n    });\n    scene.remove(g.mesh);\n  }\n  effectGhosts.length = 0;\n}\n\nfunction getBounds(): AABB[] {\n  if (!collisionBounds) collisionBounds = getCollisionBounds();\n  return collisionBounds;\n}\n\nfunction getPits(): AABB[] {\n  if (!pitBounds) pitBounds = getPitBounds();\n  return pitBounds;\n}\n\nfunction getMoveBounds(): AABB[] {\n  if (!movementBounds) movementBounds = [...getBounds(), ...getPits()];\n  return movementBounds;\n}\n\nfunction circleVsAABB(cx: number, cz: number, radius: number, box: AABB): { x: number; z: number } | null {\n  const closestX = Math.max(box.minX, Math.min(cx, box.maxX));\n  const closestZ = Math.max(box.minZ, Math.min(cz, box.maxZ));\n\n  const dx = cx - closestX;\n  const dz = cz - closestZ;\n  const distSq = dx * dx + dz * dz;\n\n  if (distSq < radius * radius) {\n    const dist = Math.sqrt(distSq);\n    if (dist === 0) {\n      const overlapLeft = cx - box.minX;\n      const overlapRight = box.maxX - cx;\n      const overlapTop = cz - box.minZ;\n      const overlapBottom = box.maxZ - cz;\n      const minOverlap = Math.min(overlapLeft, overlapRight, overlapTop, overlapBottom);\n      if (minOverlap === overlapLeft) return { x: -(overlapLeft + radius), z: 0 };\n      if (minOverlap === overlapRight) return { x: overlapRight + radius, z: 0 };\n      if (minOverlap === overlapTop) return { x: 0, z: -(overlapTop + radius) };\n      return { x: 0, z: overlapBottom + radius };\n    }\n    const overlap = radius - dist;\n    return { x: (dx / dist) * overlap, z: (dz / dist) * overlap };\n  }\n  return null;\n}\n\nfunction pointVsAABB(px: number, pz: number, box: AABB): boolean {\n  return px >= box.minX && px <= box.maxX && pz >= box.minZ && pz <= box.maxZ;\n}\n\nexport function resolveTerrainCollision(x: number, z: number, radius: number): { x: number; z: number } {\n  const bounds = getBounds();\n  let rx = x, rz = z;\n  for (const box of bounds) {\n    const push = circleVsAABB(rx, rz, radius, box);\n    if (push) {\n      rx += push.x;\n      rz += push.z;\n    }\n  }\n  return { x: rx, z: rz };\n}\n\nexport function pointHitsTerrain(px: number, pz: number): boolean {\n  const bounds = getBounds();\n  for (const box of bounds) {\n    if (pointVsAABB(px, pz, box)) return true;\n  }\n  return false;\n}\n\nexport function resolveMovementCollision(x: number, z: number, radius: number): { x: number; z: number; wasDeflected: boolean } {\n  const bounds = getMoveBounds();\n  let rx = x, rz = z;\n  let wasDeflected = false;\n  for (const box of bounds) {\n    const push = circleVsAABB(rx, rz, radius, box);\n    if (push) {\n      rx += push.x;\n      rz += push.z;\n      wasDeflected = true;\n    }\n  }\n  return { x: rx, z: rz, wasDeflected };\n}\n\nexport function pointInPit(px: number, pz: number): boolean {\n  const pits = getPits();\n  for (const pit of pits) {\n    if (px >= pit.minX && px <= pit.maxX && pz >= pit.minZ && pz <= pit.maxZ) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function checkPitFalls(gameState: GameState): void {\n  const playerPos = getPlayerPos();\n\n  if (!isPlayerDashing() && !isPlayerInvincible()) {\n    if (pointInPit(playerPos.x, playerPos.z)) {\n      gameState.playerHealth = 0;\n      gameState.phase = 'gameOver';\n      screenShake(5, 200);\n      spawnDamageNumber(playerPos.x, playerPos.z, 'FELL!', '#ff4466');\n    }\n  }\n\n  for (const enemy of gameState.enemies) {\n    if (enemy.health <= 0) continue;\n    if ((enemy as any).isLeaping) continue;\n    if (pointInPit(enemy.pos.x, enemy.pos.z)) {\n      spawnPitFallGhost(enemy);\n      createAoeRing(enemy.pos.x, enemy.pos.z, 2.5, 500, 0x8844ff);\n\n      enemy.health = 0;\n      (enemy as any).fellInPit = true;\n      enemy.stunTimer = 9999;\n      spawnDamageNumber(enemy.pos.x, enemy.pos.z, 'FELL!', '#8844ff');\n      screenShake(4, 200);\n    }\n  }\n}\n\nfunction applyDamageToEnemy(enemy: Enemy, damage: number, gameState: GameState): void {\n  if ((enemy as any).shieldActive && (enemy as any).shieldHealth > 0) {\n    (enemy as any).shieldHealth -= damage;\n    if ((enemy as any).shieldHealth <= 0) {\n      const overkill = -(enemy as any).shieldHealth;\n      (enemy as any).shieldHealth = 0;\n      (enemy as any).shieldActive = false;\n      onShieldBreak(enemy, gameState);\n      if (overkill > 0) {\n        enemy.health -= overkill;\n      }\n    }\n  } else {\n    enemy.health -= damage;\n  }\n}\n\nfunction onShieldBreak(enemy: Enemy, gameState: GameState): void {\n  const shieldCfg = enemy.config.shield;\n  if (!shieldCfg) return;\n\n  if ((enemy as any).shieldMesh) {\n    (enemy as any).shieldMesh.visible = false;\n    (enemy as any).mesh.remove((enemy as any).shieldMesh);\n    (enemy as any).shieldMesh.material.dispose();\n    (enemy as any).shieldMesh = null;\n  }\n\n  stunEnemy(enemy, shieldCfg.stunDuration);\n  spawnDamageNumber(enemy.pos.x, enemy.pos.z, 'BREAK', '#88eeff');\n\n  applyAoeEffect({\n    x: enemy.pos.x,\n    z: enemy.pos.z,\n    radius: shieldCfg.stunRadius,\n    durationMs: shieldCfg.breakRingDuration || 400,\n    color: 0x88eeff,\n    label: 'STUNNED',\n    effectFn: (e) => stunEnemy(e, shieldCfg.stunDuration),\n    gameState,\n    excludeEnemy: enemy,\n  });\n\n  (enemy as any).knockbackResist = 0;\n\n  if ((enemy as any).bodyMesh) {\n    (enemy as any).bodyMesh.material.transparent = true;\n    (enemy as any).bodyMesh.material.opacity = 0.5;\n  }\n  if ((enemy as any).headMesh) {\n    (enemy as any).headMesh.material.transparent = true;\n    (enemy as any).headMesh.material.opacity = 0.5;\n  }\n\n  screenShake(4, 200);\n}\n\nexport function checkCollisions(gameState: GameState): void {\n  const playerPos = getPlayerPos();\n  const playerR = PLAYER.size.radius;\n\n  if (!isPlayerDashing()) {\n    const resolved = resolveMovementCollision(playerPos.x, playerPos.z, playerR);\n    playerPos.x = resolved.x;\n    playerPos.z = resolved.z;\n  }\n\n  for (const enemy of gameState.enemies) {\n    if ((enemy as any).isLeaping) continue;\n    const resolved = resolveMovementCollision(enemy.pos.x, enemy.pos.z, enemy.config.size.radius);\n    enemy.pos.x = resolved.x;\n    enemy.pos.z = resolved.z;\n    (enemy as any).wasDeflected = resolved.wasDeflected;\n    (enemy as any).mesh.position.copy(enemy.pos);\n  }\n\n  const playerProj = getPlayerProjectiles();\n  for (let i = playerProj.length - 1; i >= 0; i--) {\n    const p = playerProj[i];\n    if (!p.mesh.visible) continue;\n\n    if (pointHitsTerrain(p.mesh.position.x, p.mesh.position.z)) {\n      releaseProjectile(p);\n      continue;\n    }\n\n    for (const enemy of gameState.enemies) {\n      const dx = p.mesh.position.x - enemy.pos.x;\n      const dz = p.mesh.position.z - enemy.pos.z;\n      const distSq = dx * dx + dz * dz;\n      const hitR = enemy.config.size.radius + PLAYER.projectile.size;\n\n      if (distSq < hitR * hitR) {\n        const wasShielded = (enemy as any).shieldActive;\n        applyDamageToEnemy(enemy, p.damage, gameState);\n        releaseProjectile(p);\n\n        const dmgColor = wasShielded ? '#88eeff' : '#44ff88';\n        spawnDamageNumber(enemy.pos.x, enemy.pos.z, p.damage, dmgColor);\n\n        enemy.flashTimer = 80;\n        (enemy as any).bodyMesh.material.emissive.setHex(0xffffff);\n        if ((enemy as any).headMesh) (enemy as any).headMesh.material.emissive.setHex(0xffffff);\n\n        break;\n      }\n    }\n  }\n\n  const enemyProj = getEnemyProjectiles();\n  for (let i = enemyProj.length - 1; i >= 0; i--) {\n    const p = enemyProj[i];\n    if (!p.mesh.visible) continue;\n\n    if (pointHitsTerrain(p.mesh.position.x, p.mesh.position.z)) {\n      releaseProjectile(p);\n      continue;\n    }\n\n    if (!isPlayerInvincible()) {\n      const dx = p.mesh.position.x - playerPos.x;\n      const dz = p.mesh.position.z - playerPos.z;\n      const distSq = dx * dx + dz * dz;\n      const hitR = playerR + 0.1;\n\n      if (distSq < hitR * hitR) {\n        gameState.playerHealth -= p.damage;\n        releaseProjectile(p);\n        screenShake(3, 100);\n\n        spawnDamageNumber(playerPos.x, playerPos.z, p.damage, '#ff4466');\n\n        if (gameState.playerHealth <= 0) {\n          gameState.playerHealth = 0;\n          gameState.phase = 'gameOver';\n        }\n        break;\n      }\n    }\n  }\n\n  if (!isPlayerInvincible()) {\n    const now = performance.now();\n    for (const enemy of gameState.enemies) {\n      if (enemy.behavior === 'kite') continue;\n      if (enemy.stunTimer > 0) continue;\n\n      const dx = enemy.pos.x - playerPos.x;\n      const dz = enemy.pos.z - playerPos.z;\n      const distSq = dx * dx + dz * dz;\n      const hitR = playerR + enemy.config.size.radius;\n\n      if (distSq < hitR * hitR) {\n        const attackCooldown = enemy.config.attackRate || 1000;\n        if (now - (enemy as any).lastAttackTime > attackCooldown) {\n          const chargeMult = (enemy.config.tank && enemy.config.tank.chargeDamageMult) || 1.5;\n          const dmg = (enemy as any).isCharging ? enemy.config.damage * chargeMult : enemy.config.damage;\n          gameState.playerHealth -= dmg;\n          (enemy as any).lastAttackTime = now;\n          screenShake((enemy as any).isCharging ? 5 : 2, (enemy as any).isCharging ? 150 : 80);\n\n          spawnDamageNumber(playerPos.x, playerPos.z, dmg, '#ff4466');\n\n          if (gameState.playerHealth <= 0) {\n            gameState.playerHealth = 0;\n            gameState.phase = 'gameOver';\n          }\n        }\n      }\n    }\n  }\n\n  const pushEvt = consumePushEvent();\n  if (pushEvt) {\n    const dirX = pushEvt.dirX;\n    const dirZ = pushEvt.dirZ;\n    for (const enemy of gameState.enemies) {\n      if (enemy.health <= 0) continue;\n      if ((enemy as any).isLeaping) continue;\n      const enemyRadius = enemy.config.size.radius;\n      if (isInRotatedRect(enemy.pos.x, enemy.pos.z, pushEvt.x, pushEvt.z,\n                           pushEvt.width, pushEvt.length, pushEvt.rotation, enemyRadius)) {\n        const oldX = enemy.pos.x;\n        const oldZ = enemy.pos.z;\n\n        const iceEffects = getIceEffects(enemy.pos.x, enemy.pos.z, false);\n        const kbMult = 1 - ((enemy as any).knockbackResist ?? enemy.config.knockbackResist ?? 0);\n        const kbDist = pushEvt.force * kbMult * iceEffects.knockbackMult;\n        enemy.pos.x += dirX * kbDist;\n        enemy.pos.z += dirZ * kbDist;\n        (enemy as any).mesh.position.copy(enemy.pos);\n\n        spawnPushGhosts(enemy, oldX, oldZ, enemy.pos.x, enemy.pos.z);\n\n        enemy.flashTimer = 100;\n        (enemy as any).bodyMesh.material.emissive.setHex(0x44ffaa);\n        if ((enemy as any).headMesh) (enemy as any).headMesh.material.emissive.setHex(0x44ffaa);\n\n        spawnDamageNumber(enemy.pos.x, enemy.pos.z, 'PUSH', '#44ffaa');\n      }\n    }\n  }\n\n  if (pushEvt) {\n    for (const enemy of gameState.enemies) {\n      if ((enemy as any).isLeaping) continue;\n      const resolved = resolveTerrainCollision(enemy.pos.x, enemy.pos.z, enemy.config.size.radius);\n      enemy.pos.x = resolved.x;\n      enemy.pos.z = resolved.z;\n      (enemy as any).mesh.position.copy(enemy.pos);\n    }\n  }\n}\n", "import { ABILITIES } from '../config/abilities';\nimport { PLAYER } from '../config/player';\nimport {\n  triggerDash, triggerUltimate, setUltimateHeld,\n  setAimFromScreenDrag, setAbilityDirOverride, clearAbilityDirOverride\n} from '../engine/input';\n\nlet healthBar: any, healthText: any, waveIndicator: any, currencyCount: any, abilityBar: any;\n\n// Mobile action button refs\nlet mobileBtnDash: any, mobileBtnUlt: any;\n\nexport function initHUD() {\n  healthBar = document.getElementById('health-bar');\n  healthText = document.getElementById('health-text');\n  waveIndicator = document.getElementById('wave-indicator');\n  currencyCount = document.getElementById('currency-count');\n  abilityBar = document.getElementById('ability-bar');\n\n  // Build desktop ability slots (keyboard labels)\n  for (const [key, ability] of Object.entries(ABILITIES)) {\n    const el = document.createElement('div');\n    el.className = 'ability-slot ready';\n    el.id = `ability-${key}`;\n    el.innerHTML =\n      `<div class=\"ability-key\">${(ability as any).key}</div>` +\n      `<div class=\"ability-name\">${(ability as any).name}</div>` +\n      `<div class=\"ability-cooldown-text\"></div>` +\n      `<div class=\"ability-cooldown-overlay\"></div>`;\n    abilityBar.appendChild(el);\n  }\n\n  // Mobile action buttons \u2014 wire up touch handlers\n  const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n  if (hasTouch) {\n    initMobileButtons();\n  }\n}\n\n// Drag-to-aim constants\nconst DRAG_THRESHOLD = 15;  // px \u2014 distinguish tap from drag\nconst DRAG_MAX_RADIUS = 80; // px \u2014 full deflection range\n\n// Isometric basis vectors (duplicated from input.js for screen\u2192world mapping)\nconst INV_SQRT2 = 1 / Math.SQRT2;\nconst ISO_RIGHT_X = INV_SQRT2;\nconst ISO_RIGHT_Z = -INV_SQRT2;\nconst ISO_UP_X = -INV_SQRT2;\nconst ISO_UP_Z = -INV_SQRT2;\n\nfunction initMobileButtons() {\n  mobileBtnDash = document.getElementById('mobile-btn-dash');\n  mobileBtnUlt = document.getElementById('mobile-btn-ultimate');\n  if (!mobileBtnDash || !mobileBtnUlt) return;\n\n  // --- Dash: drag-to-aim, release to fire ---\n  setupDragToAim(mobileBtnDash, {\n    onDragStart: () => { /* don't trigger yet \u2014 wait for release */ },\n    onDragMove: (normX: number, normY: number) => {\n      // Compute isometric world direction from screen drag\n      const isoX = normX * ISO_RIGHT_X + normY * ISO_UP_X;\n      const isoZ = normX * ISO_RIGHT_Z + normY * ISO_UP_Z;\n      setAbilityDirOverride(isoX, isoZ);\n      setAimFromScreenDrag(normX, normY);\n    },\n    onRelease: (wasDrag: boolean) => {\n      triggerDash();\n      if (!wasDrag) clearAbilityDirOverride();\n      // If wasDrag, override is already set and startDash will consume it\n    },\n    onCancel: () => {\n      clearAbilityDirOverride();\n    },\n  });\n\n  // --- Ultimate: drag-to-aim, charge while held ---\n  setupDragToAim(mobileBtnUlt, {\n    onDragStart: () => {\n      triggerUltimate();\n      setUltimateHeld(true);\n    },\n    onDragMove: (normX: number, normY: number) => {\n      setAimFromScreenDrag(normX, normY);\n    },\n    onRelease: () => {\n      setUltimateHeld(false);\n      clearAbilityDirOverride();\n    },\n    onCancel: () => {\n      setUltimateHeld(false);\n      clearAbilityDirOverride();\n    },\n  });\n}\n\n/**\n * Generic drag-to-aim handler for a mobile ability button.\n * Touch down \u2192 drag to aim \u2192 release to fire.\n * Callbacks:\n *   onDragStart() \u2014 called once when touch begins\n *   onDragMove(normX, normY) \u2014 called each touchmove when past threshold\n *     normX: -1..1 screen-right, normY: -1..1 screen-up\n *   onRelease(wasDrag) \u2014 called on touchend (wasDrag = true if threshold exceeded)\n *   onCancel() \u2014 called on touchcancel\n */\nfunction setupDragToAim(btnEl: any, { onDragStart, onDragMove, onRelease, onCancel }: any) {\n  let touchId: number | null = null;\n  let startX = 0, startY = 0;\n  let isDragging = false;\n\n  btnEl.addEventListener('touchstart', (e: any) => {\n    e.preventDefault();\n    if (touchId !== null) return; // already tracking a touch\n    const touch = e.changedTouches[0];\n    touchId = touch.identifier;\n    startX = touch.clientX;\n    startY = touch.clientY;\n    isDragging = false;\n    onDragStart();\n  });\n\n  // Listen on window so drag can extend beyond button bounds\n  window.addEventListener('touchmove', (e: any) => {\n    if (touchId === null) return;\n    const touch = findTouch(e.changedTouches, touchId);\n    if (!touch) return;\n\n    const dx = touch.clientX - startX;\n    const dy = touch.clientY - startY;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    if (dist > DRAG_THRESHOLD) {\n      isDragging = true;\n      // Normalize to -1..1 range, clamped by max radius\n      const clampedDist = Math.min(dist, DRAG_MAX_RADIUS);\n      const normX = (dx / dist) * (clampedDist / DRAG_MAX_RADIUS);\n      const normY = (-dy / dist) * (clampedDist / DRAG_MAX_RADIUS); // invert Y (screen down = negative)\n      onDragMove(normX, normY);\n    }\n  }, { passive: true });\n\n  window.addEventListener('touchend', (e: any) => {\n    if (touchId === null) return;\n    const touch = findTouch(e.changedTouches, touchId);\n    if (!touch) return;\n    touchId = null;\n    onRelease(isDragging);\n  });\n\n  window.addEventListener('touchcancel', (e: any) => {\n    if (touchId === null) return;\n    const touch = findTouch(e.changedTouches, touchId);\n    if (!touch) return;\n    touchId = null;\n    onCancel();\n  });\n}\n\nfunction findTouch(touchList: any, id: number) {\n  for (let i = 0; i < touchList.length; i++) {\n    if (touchList[i].identifier === id) return touchList[i];\n  }\n  return null;\n}\n\nexport function updateHUD(gameState: any) {\n  // Health bar\n  const pct = Math.max(0, gameState.playerHealth / gameState.playerMaxHealth);\n  healthBar.style.width = (pct * 100) + '%';\n\n  if (pct > 0.5) {\n    healthBar.style.backgroundColor = '#44ff88';\n  } else if (pct > 0.25) {\n    healthBar.style.backgroundColor = '#ffcc44';\n  } else {\n    healthBar.style.backgroundColor = '#ff4444';\n  }\n\n  healthText.textContent = Math.ceil(gameState.playerHealth) + ' / ' + gameState.playerMaxHealth;\n\n  // Wave indicator\n  waveIndicator.textContent = 'Wave ' + gameState.currentWave;\n\n  // Currency\n  currencyCount.textContent = gameState.currency;\n\n  // Ability cooldowns \u2014 update both desktop slots and mobile buttons\n  for (const [key, state] of Object.entries(gameState.abilities)) {\n    if (!(ABILITIES as any)[key]) continue;\n    const cfg = (ABILITIES as any)[key];\n\n    // --- Desktop ability slot ---\n    const slot = document.getElementById(`ability-${key}`);\n    if (slot) {\n      const overlay = slot.querySelector('.ability-cooldown-overlay') as any;\n      const cdText = slot.querySelector('.ability-cooldown-text') as any;\n\n      if ((state as any).cooldownRemaining > 0) {\n        const pctRemaining = Math.max(0, (state as any).cooldownRemaining / cfg.cooldown);\n        overlay.style.height = (pctRemaining * 100) + '%';\n        slot.classList.remove('ready');\n        const secs = Math.ceil((state as any).cooldownRemaining / 1000);\n        cdText.textContent = secs;\n        cdText.style.display = 'flex';\n      } else {\n        overlay.style.height = '0%';\n        slot.classList.add('ready');\n        cdText.style.display = 'none';\n      }\n\n      // Show charging state for ultimate (Force Push)\n      if (key === 'ultimate' && (state as any).charging) {\n        const chargePct = Math.round((state as any).chargeT * 100);\n        slot.style.borderColor = 'rgba(68, 255, 170, 0.8)';\n        slot.style.boxShadow = '0 0 12px rgba(68, 255, 170, 0.4)';\n        cdText.textContent = chargePct + '%';\n        cdText.style.display = 'flex';\n        cdText.style.color = '#44ffaa';\n        overlay.style.height = ((1 - (state as any).chargeT) * 100) + '%';\n        overlay.style.backgroundColor = 'rgba(68, 255, 170, 0.3)';\n      } else {\n        if (slot.style.borderColor) slot.style.borderColor = '';\n        if (slot.style.boxShadow) slot.style.boxShadow = '';\n        cdText.style.color = '';\n        overlay.style.backgroundColor = '';\n      }\n    }\n\n    // --- Mobile action button ---\n    const mBtn = key === 'dash' ? mobileBtnDash : key === 'ultimate' ? mobileBtnUlt : null;\n    if (mBtn) {\n      const mOverlay = mBtn.querySelector('.mobile-btn-cd-overlay');\n      const mCdText = mBtn.querySelector('.mobile-btn-cd-text');\n\n      if ((state as any).cooldownRemaining > 0) {\n        const pctRemaining = Math.max(0, (state as any).cooldownRemaining / cfg.cooldown);\n        mOverlay.style.height = (pctRemaining * 100) + '%';\n        mBtn.classList.remove('ready');\n        const secs = Math.ceil((state as any).cooldownRemaining / 1000);\n        mCdText.textContent = secs;\n        mCdText.style.display = 'flex';\n      } else {\n        mOverlay.style.height = '0%';\n        mBtn.classList.add('ready');\n        mCdText.style.display = 'none';\n      }\n\n      // Charging state for ultimate\n      if (key === 'ultimate' && (state as any).charging) {\n        const chargePct = Math.round((state as any).chargeT * 100);\n        mBtn.style.borderColor = 'rgba(68, 255, 170, 0.9)';\n        mBtn.style.boxShadow = '0 0 16px rgba(68, 255, 170, 0.5)';\n        mCdText.textContent = chargePct + '%';\n        mCdText.style.display = 'flex';\n        mCdText.style.color = '#44ffaa';\n        mOverlay.style.height = ((1 - (state as any).chargeT) * 100) + '%';\n        mOverlay.style.backgroundColor = 'rgba(68, 255, 170, 0.3)';\n      } else if (key === 'ultimate') {\n        if (mBtn.style.borderColor) mBtn.style.borderColor = '';\n        if (mBtn.style.boxShadow) mBtn.style.boxShadow = '';\n        mCdText.style.color = '';\n        mOverlay.style.backgroundColor = '';\n      }\n    }\n  }\n}\n", "let startScreen: any, startBtn: any;\nlet gameOverScreen: any, restartBtn: any, gameOverStats: any;\n\nexport function initScreens(onRestart: () => void, onStart: () => void) {\n  // Start screen\n  startScreen = document.getElementById('start-screen');\n  startBtn = document.getElementById('start-btn');\n\n  const handleStart = () => {\n    hideStartScreen();\n    onStart();\n  };\n  startBtn.addEventListener('click', handleStart);\n  startBtn.addEventListener('touchend', (e: any) => {\n    e.preventDefault();\n    handleStart();\n  });\n\n  // Game over screen\n  gameOverScreen = document.getElementById('game-over-screen');\n  restartBtn = document.getElementById('restart-btn');\n  gameOverStats = document.getElementById('game-over-stats');\n\n  restartBtn.addEventListener('click', () => {\n    hideScreens();\n    onRestart();\n  });\n}\n\nexport function hideStartScreen() {\n  startScreen.classList.add('hidden');\n}\n\nexport function showGameOver(gameState: any) {\n  gameOverStats.textContent = `Enemies defeated: ${gameState.currency} gold earned`;\n  gameOverScreen.classList.remove('hidden');\n}\n\nexport function hideScreens() {\n  gameOverScreen.classList.add('hidden');\n}\n", "import { BossConfig } from '../types/index';\n\nexport const BOSS: BossConfig = {\n  name: 'The Warden',\n  health: 300,\n  speed: 2.0,\n  damage: 30,\n  size: { radius: 0.8, height: 2.0 },\n  color: 0xff8800,\n  emissive: 0xff4400,\n  phases: [\n    { healthThreshold: 1.0, behavior: 'chase', attackRate: 1000 },\n    { healthThreshold: 0.5, behavior: 'enrage', attackRate: 600, speed: 3.0, spawnMinions: { type: 'goblin', count: 3 } },\n  ]\n};\n", "// URL query parameter overrides \u2014 apply gameplay config from URL\n// Format: ?player.speed=10&goblin.health=50&dash.cooldown=500\n//\n// First segment = config root, rest = nested dot-path within that object.\n// Values are auto-parsed as number, boolean, hex (0x...), or string.\n\nimport { PLAYER } from '../config/player';\nimport { ENEMY_TYPES } from '../config/enemies';\nimport { ABILITIES } from '../config/abilities';\nimport { BOSS } from '../config/boss';\n\n// Registry: first segment of param key \u2192 config object\nconst CONFIG_ROOTS: Record<string, any> = {\n  player:          PLAYER,\n  goblin:          ENEMY_TYPES.goblin,\n  skeletonArcher:  ENEMY_TYPES.skeletonArcher,\n  iceMortarImp:    ENEMY_TYPES.iceMortarImp,\n  stoneGolem:      ENEMY_TYPES.stoneGolem,\n  dash:            ABILITIES.dash,\n  ultimate:        ABILITIES.ultimate,\n  boss:            BOSS,\n};\n\nfunction getNestedValue(obj: any, path: string) {\n  const parts = path.split('.');\n  let cur = obj;\n  for (const p of parts) {\n    if (cur == null) return undefined;\n    cur = cur[p];\n  }\n  return cur;\n}\n\nfunction setNestedValue(obj: any, path: string, value: any) {\n  const parts = path.split('.');\n  let cur = obj;\n  for (let i = 0; i < parts.length - 1; i++) {\n    if (cur[parts[i]] == null) cur[parts[i]] = {};\n    cur = cur[parts[i]];\n  }\n  cur[parts[parts.length - 1]] = value;\n}\n\nfunction parseValue(raw: string) {\n  if (raw === 'true') return true;\n  if (raw === 'false') return false;\n  if (raw.startsWith('0x') || raw.startsWith('0X')) {\n    const hex = parseInt(raw, 16);\n    if (!isNaN(hex)) return hex;\n  }\n  const num = Number(raw);\n  return isNaN(num) ? raw : num;\n}\n\n/**\n * Parse URL search params and apply overrides to config objects.\n * Returns the count of params applied.\n */\nexport function applyUrlParams() {\n  const params = new URLSearchParams(window.location.search);\n  let applied = 0;\n\n  for (const [key, rawValue] of params) {\n    const dotIdx = key.indexOf('.');\n    if (dotIdx === -1) continue; // no prefix, skip\n\n    const prefix = key.slice(0, dotIdx);\n    const path = key.slice(dotIdx + 1);\n    if (!path) continue;\n\n    const root = CONFIG_ROOTS[prefix];\n    if (!root) {\n      console.warn(`[urlParams] Unknown prefix: \"${prefix}\" (from \"${key}\")`);\n      continue;\n    }\n\n    // Validate property exists (prevent typos from creating junk keys)\n    const existing = getNestedValue(root, path);\n    if (existing === undefined) {\n      console.warn(`[urlParams] Unknown path: \"${key}\" \u2014 no such property`);\n      continue;\n    }\n\n    const value = parseValue(rawValue);\n    setNestedValue(root, path, value);\n    applied++;\n    console.log(`[urlParams] ${key} = ${value}`);\n  }\n\n  if (applied > 0) {\n    console.log(`[urlParams] Applied ${applied} override(s) from URL`);\n  }\n  return applied;\n}\n\n/**\n * Snapshot current config values (call BEFORE applyUrlParams to capture defaults).\n */\nexport function snapshotDefaults() {\n  const snap: Record<string, any> = {};\n  for (const [prefix, root] of Object.entries(CONFIG_ROOTS)) {\n    snap[prefix] = JSON.parse(JSON.stringify(root));\n  }\n  return snap;\n}\n\n/**\n * Build a share URL containing only parameters that differ from defaults.\n */\nexport function buildShareUrl(defaults: Record<string, any>) {\n  const params = new URLSearchParams();\n\n  for (const [prefix, root] of Object.entries(CONFIG_ROOTS)) {\n    const defRoot = defaults[prefix];\n    if (!defRoot) continue;\n    collectDiffs(params, prefix, defRoot, root, '');\n  }\n\n  const base = window.location.origin + window.location.pathname;\n  const qs = params.toString();\n  return qs ? base + '?' + qs : base;\n}\n\nfunction collectDiffs(params: URLSearchParams, prefix: string, defObj: any, curObj: any, pathPrefix: string) {\n  for (const key of Object.keys(curObj)) {\n    const fullPath = pathPrefix ? pathPrefix + '.' + key : key;\n    const curVal = curObj[key];\n    const defVal = getNestedValue(defObj, fullPath);\n\n    if (curVal != null && typeof curVal === 'object' && !Array.isArray(curVal)) {\n      collectDiffs(params, prefix, defObj, curVal, fullPath);\n    } else if (curVal !== defVal) {\n      params.set(prefix + '.' + fullPath, String(curVal));\n    }\n  }\n}\n", "// Live tuning panel \u2014 designer can adjust values without touching code\n// Mutates config objects directly; game reads them each frame so changes are instant\n\nimport { PLAYER } from '../config/player';\nimport { ENEMY_TYPES } from '../config/enemies';\nimport { buildShareUrl } from '../engine/urlParams';\n\nconst SLIDERS: any[] = [\n  {\n    group: 'Projectiles (Self)',\n    items: [\n      { label: 'Fire Rate',  config: () => PLAYER,            key: 'fireRate',          min: 50,  max: 1000, step: 10, suffix: 'ms', invert: true,\n        unit: 'ms', tip: 'Time between player auto-shots. Lower = faster firing.' },\n      { label: 'Speed',      config: () => PLAYER.projectile,  key: 'speed',            min: 4,   max: 40,   step: 1,  suffix: '',\n        unit: 'u/s', tip: 'Player projectile travel speed in units per second.' },\n      { label: 'Size',       config: () => PLAYER.projectile,  key: 'size',             min: 0.04, max: 0.5, step: 0.02, suffix: '',\n        unit: 'u', tip: 'Player projectile collision radius in world units.' },\n    ]\n  },\n  {\n    group: 'Self',\n    items: [\n      { label: 'Move Speed', config: () => PLAYER,            key: 'speed',            min: 2,   max: 16,   step: 0.5, suffix: '',\n        unit: 'u/s', tip: 'Player movement speed in units per second.' },\n    ]\n  },\n  {\n    group: 'Enemies',\n    items: [\n      { label: 'Speed Mult', config: () => null,              key: 'enemySpeedMult',   min: 0.2, max: 4,    step: 0.1, suffix: 'x', custom: 'enemySpeed',\n        unit: 'x', tip: 'Global speed multiplier applied to all enemy types. 1x = default.' },\n    ]\n  }\n];\n\n// Enemy speed multiplier \u2014 applied to all enemy types\nlet enemySpeedMultiplier = 1.0;\nconst originalSpeeds: any = {};\n\n// Store original speeds so multiplier works correctly\nfunction captureOriginalSpeeds() {\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    originalSpeeds[name] = (cfg as any).speed;\n  }\n}\n\nfunction applyEnemySpeedMultiplier(mult: number) {\n  enemySpeedMultiplier = mult;\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    (cfg as any).speed = originalSpeeds[name] * mult;\n  }\n}\n\nlet panel: any, isCollapsed = true; // collapsed by default\n\nexport function initTuningPanel() {\n  captureOriginalSpeeds();\n\n  // Container\n  panel = document.createElement('div');\n  panel.id = 'tuning-panel';\n  panel.innerHTML = '';\n\n  // Toggle button\n  const toggle = document.createElement('div');\n  toggle.id = 'tuning-toggle';\n  toggle.textContent = 'Tune'; // starts collapsed\n  toggle.addEventListener('click', () => {\n    isCollapsed = !isCollapsed;\n    panel.classList.toggle('collapsed', isCollapsed);\n    toggle.textContent = isCollapsed ? 'Tune' : '\\u00d7';\n  });\n  panel.appendChild(toggle);\n\n  // Content wrapper\n  const content = document.createElement('div');\n  content.id = 'tuning-content';\n  panel.appendChild(content);\n\n  // Build slider groups\n  for (const group of SLIDERS) {\n    const groupEl = document.createElement('div');\n    groupEl.className = 'tuning-group';\n\n    const groupLabel = document.createElement('div');\n    groupLabel.className = 'tuning-group-label';\n    groupLabel.textContent = group.group;\n    groupEl.appendChild(groupLabel);\n\n    for (const item of group.items) {\n      const row = document.createElement('div');\n      row.className = 'tuning-row';\n\n      const label = document.createElement('span');\n      label.className = 'tuning-label';\n      label.textContent = item.label;\n      if (item.tip) {\n        label.setAttribute('data-tip', item.tip);\n        label.classList.add('has-tooltip');\n      }\n\n      const slider = document.createElement('input');\n      slider.type = 'range';\n      slider.className = 'tuning-slider';\n      slider.min = item.min;\n      slider.max = item.max;\n      slider.step = item.step;\n\n      // Get current value\n      let currentVal;\n      if (item.custom === 'enemySpeed') {\n        currentVal = enemySpeedMultiplier;\n      } else {\n        currentVal = item.config()[item.key];\n      }\n      slider.value = currentVal;\n\n      const valueDisplay = document.createElement('span');\n      valueDisplay.className = 'tuning-value';\n      valueDisplay.textContent = formatValue(currentVal, item);\n\n      slider.addEventListener('input', () => {\n        const val = parseFloat(slider.value);\n        if (item.custom === 'enemySpeed') {\n          applyEnemySpeedMultiplier(val);\n        } else {\n          item.config()[item.key] = val;\n        }\n        valueDisplay.textContent = formatValue(val, item);\n      });\n\n      row.appendChild(label);\n      row.appendChild(slider);\n      row.appendChild(valueDisplay);\n      groupEl.appendChild(row);\n    }\n\n    content.appendChild(groupEl);\n  }\n\n  // Copy button\n  const copyBtn = document.createElement('div');\n  copyBtn.id = 'tuning-copy';\n  copyBtn.textContent = 'Copy Values';\n  copyBtn.addEventListener('click', () => {\n    const text = buildCopyText();\n    navigator.clipboard.writeText(text).then(() => {\n      copyBtn.textContent = 'Copied!';\n      copyBtn.classList.add('copied');\n      setTimeout(() => {\n        copyBtn.textContent = 'Copy Values';\n        copyBtn.classList.remove('copied');\n      }, 1200);\n    });\n  });\n  content.appendChild(copyBtn);\n\n  // Share URL button\n  const shareBtn = document.createElement('div');\n  shareBtn.id = 'tuning-share';\n  shareBtn.textContent = 'Share URL';\n  shareBtn.addEventListener('click', () => {\n    const url = buildShareUrl((window as any).__configDefaults || {});\n    navigator.clipboard.writeText(url).then(() => {\n      shareBtn.textContent = 'Copied URL!';\n      shareBtn.classList.add('copied');\n      setTimeout(() => {\n        shareBtn.textContent = 'Share URL';\n        shareBtn.classList.remove('copied');\n      }, 1200);\n    });\n  });\n  content.appendChild(shareBtn);\n\n  // Custom tooltip for tuning panel\n  const tooltipEl = document.createElement('div');\n  tooltipEl.id = 'tuning-tooltip';\n  document.body.appendChild(tooltipEl);\n\n  let tuningTipTarget: any = null;\n  panel.addEventListener('mouseover', (e: any) => {\n    const el = e.target.closest('.has-tooltip');\n    if (el && el.getAttribute('data-tip')) {\n      tuningTipTarget = el;\n      tooltipEl.textContent = el.getAttribute('data-tip');\n      tooltipEl.classList.add('visible');\n      const rect = el.getBoundingClientRect();\n      // Position to the left of the label (panel is on right side)\n      let left = rect.left - tooltipEl.offsetWidth - 8;\n      let top = rect.top + rect.height / 2 - tooltipEl.offsetHeight / 2;\n      if (left < 4) { left = rect.right + 8; }\n      top = Math.max(4, Math.min(window.innerHeight - tooltipEl.offsetHeight - 4, top));\n      tooltipEl.style.left = left + 'px';\n      tooltipEl.style.top = top + 'px';\n    }\n  });\n  panel.addEventListener('mouseout', (e: any) => {\n    const el = e.target.closest('.has-tooltip');\n    if (el === tuningTipTarget) {\n      tuningTipTarget = null;\n      tooltipEl.classList.remove('visible');\n    }\n  });\n\n  // Start collapsed by default\n  panel.classList.add('collapsed');\n  document.body.appendChild(panel);\n  injectStyles();\n}\n\nfunction buildCopyText() {\n  const lines: string[] = [];\n  for (const group of SLIDERS) {\n    lines.push(`${group.group}:`);\n    for (const item of group.items) {\n      let val;\n      if (item.custom === 'enemySpeed') {\n        val = enemySpeedMultiplier;\n      } else {\n        val = item.config()[item.key];\n      }\n      const display = Number.isInteger(val) ? val : parseFloat(val.toFixed(4));\n      const suffix = item.suffix ? ' ' + item.suffix : '';\n      lines.push(`  ${item.label}: ${display}${suffix}`);\n    }\n  }\n  return lines.join('\\n');\n}\n\nfunction formatValue(val: number, item: any) {\n  const display = Number.isInteger(val) ? val : val.toFixed(2);\n  const unitStr = item.unit || item.suffix || '';\n  return display + (unitStr ? ' ' + unitStr : '');\n}\n\nfunction injectStyles() {\n  const style = document.createElement('style');\n  style.textContent = `\n    #tuning-panel {\n      position: fixed;\n      top: 60px;\n      right: 20px;\n      width: 300px;\n      z-index: 200;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      pointer-events: all;\n      transition: transform 0.25s ease;\n    }\n\n    #tuning-panel.collapsed #tuning-content {\n      display: none;\n    }\n\n    #tuning-toggle {\n      position: absolute;\n      top: 0;\n      right: 0;\n      width: 48px;\n      height: 28px;\n      background: rgba(20, 20, 40, 0.85);\n      border: 1px solid rgba(68, 255, 136, 0.3);\n      border-radius: 4px;\n      color: rgba(68, 255, 136, 0.8);\n      font-family: inherit;\n      font-size: 11px;\n      letter-spacing: 1px;\n      text-transform: uppercase;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      user-select: none;\n      transition: all 0.15s ease;\n    }\n\n    #tuning-toggle:hover {\n      background: rgba(68, 255, 136, 0.1);\n      border-color: rgba(68, 255, 136, 0.6);\n    }\n\n    #tuning-content {\n      margin-top: 36px;\n      background: rgba(10, 10, 26, 0.94);\n      border: 1px solid rgba(68, 255, 136, 0.2);\n      border-radius: 6px;\n      padding: 16px;\n      backdrop-filter: blur(8px);\n    }\n\n    .tuning-group {\n      margin-bottom: 14px;\n    }\n\n    .tuning-group:last-child {\n      margin-bottom: 0;\n    }\n\n    .tuning-group-label {\n      font-size: 9px;\n      color: rgba(68, 255, 136, 0.6);\n      letter-spacing: 2px;\n      text-transform: uppercase;\n      margin-bottom: 8px;\n      padding-bottom: 4px;\n      border-bottom: 1px solid rgba(68, 255, 136, 0.1);\n    }\n\n    .tuning-row {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      margin-bottom: 8px;\n    }\n\n    .tuning-row:last-child {\n      margin-bottom: 0;\n    }\n\n    .tuning-label {\n      font-size: 11px;\n      color: rgba(255, 255, 255, 0.6);\n      width: 80px;\n      flex-shrink: 0;\n    }\n\n    .tuning-label.has-tooltip {\n      cursor: help;\n      text-decoration: underline dotted rgba(255, 255, 255, 0.25);\n      text-underline-offset: 2px;\n    }\n\n    .tuning-slider {\n      flex: 1;\n      height: 4px;\n      -webkit-appearance: none;\n      appearance: none;\n      background: rgba(100, 100, 160, 0.3);\n      border-radius: 2px;\n      outline: none;\n      cursor: pointer;\n    }\n\n    .tuning-slider::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      appearance: none;\n      width: 14px;\n      height: 14px;\n      border-radius: 50%;\n      background: #44ff88;\n      cursor: pointer;\n      border: none;\n      box-shadow: 0 0 6px rgba(68, 255, 136, 0.4);\n    }\n\n    .tuning-slider::-moz-range-thumb {\n      width: 14px;\n      height: 14px;\n      border-radius: 50%;\n      background: #44ff88;\n      cursor: pointer;\n      border: none;\n      box-shadow: 0 0 6px rgba(68, 255, 136, 0.4);\n    }\n\n    .tuning-value {\n      font-size: 11px;\n      color: rgba(255, 255, 255, 0.8);\n      width: 54px;\n      text-align: right;\n      flex-shrink: 0;\n    }\n\n    #tuning-copy, #tuning-share {\n      margin-top: 14px;\n      padding: 6px 0;\n      text-align: center;\n      font-size: 10px;\n      letter-spacing: 1px;\n      text-transform: uppercase;\n      color: rgba(68, 255, 136, 0.7);\n      background: rgba(68, 255, 136, 0.06);\n      border: 1px solid rgba(68, 255, 136, 0.2);\n      border-radius: 4px;\n      cursor: pointer;\n      user-select: none;\n      transition: all 0.15s ease;\n    }\n\n    #tuning-share {\n      margin-top: 6px;\n    }\n\n    #tuning-copy:hover, #tuning-share:hover {\n      background: rgba(68, 255, 136, 0.12);\n      border-color: rgba(68, 255, 136, 0.5);\n      color: rgba(68, 255, 136, 1);\n    }\n\n    #tuning-copy.copied, #tuning-share.copied {\n      color: #ffcc44;\n      border-color: rgba(255, 204, 68, 0.4);\n      background: rgba(255, 204, 68, 0.08);\n    }\n\n    #tuning-tooltip {\n      position: fixed;\n      z-index: 300;\n      max-width: 220px;\n      padding: 6px 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      font-size: 10px;\n      line-height: 1.4;\n      color: rgba(255, 255, 255, 0.9);\n      background: rgba(10, 10, 30, 0.95);\n      border: 1px solid rgba(68, 255, 136, 0.4);\n      border-radius: 4px;\n      pointer-events: none;\n      opacity: 0;\n      transition: opacity 0.12s ease;\n      backdrop-filter: blur(6px);\n    }\n\n    #tuning-tooltip.visible {\n      opacity: 1;\n    }\n  `;\n  document.head.appendChild(style);\n}\n", "// Spawn Editor \u2014 visual dev tool for placing and configuring wave spawners\n// Toggle with backtick (`) key. Pauses gameplay, click to place spawners on arena.\n// Follows tuning.js pattern: DOM panel + injected CSS, copy-to-clipboard export.\n// Two tabs: Spawn (wave/enemy editing) and Level (obstacles/pits editing).\nconsole.log('[spawnEditor] v2 loaded \u2014 tabs enabled');\n\nimport { WAVES } from '../config/waves';\nimport { ENEMY_TYPES } from '../config/enemies';\nimport { screenToWorld, getScene, setZoom, resetZoom, getCurrentFrustum, rebuildArenaVisuals } from '../engine/renderer';\nimport { getInputState, consumeInput } from '../engine/input';\nimport { startWave, resetWaveRunner } from '../engine/waveRunner';\nimport { clearEnemies } from '../entities/enemy';\nimport { releaseAllProjectiles } from '../entities/projectile';\nimport { ARENA_HALF, OBSTACLES, PITS } from '../config/arena';\nimport { invalidateCollisionBounds } from '../engine/physics';\n\nlet sceneRef: any;\nlet gameStateRef: any;\nlet panel: any;\nlet active = false;\nlet previousPhase = 'playing';\n\n// Current tab: 'spawn' or 'level'\nlet currentTab = 'spawn';\n\n// Editor state (Spawn tab)\nconst editorState = {\n  waveIndex: 0,\n  groupIndex: 0,\n  enemyType: 'goblin',\n  selectedSpawnIdx: -1,  // index into current group's spawns, -1 = none\n};\n\n// Level editor state\nconst levelState = {\n  selectedType: null as string | null,   // 'obstacle' or 'pit'\n  selectedIdx: -1,      // index into OBSTACLES or PITS\n};\n\n// Arena preset state\nlet currentPresetName: string | null = null; // name of loaded preset, or null\n\n// Drag state\nlet isDragging = false;\nlet dragStarted = false; // true once mouse moves beyond threshold\nlet dragStartWorld: any = null;\n\n// Undo/redo stacks \u2014 stores snapshots of { waveIndex, groupIndex, spawns (deep copy) }\nconst undoStack: any[] = [];\nconst redoStack: any[] = [];\nconst MAX_UNDO = 50;\n\nfunction snapshotGroup() {\n  const wave = WAVES[editorState.waveIndex];\n  if (!wave) return null;\n  const group = wave.groups[editorState.groupIndex];\n  if (!group) return null;\n  return {\n    tab: 'spawn',\n    waveIndex: editorState.waveIndex,\n    groupIndex: editorState.groupIndex,\n    spawns: JSON.parse(JSON.stringify(group.spawns)),\n    triggerDelay: group.triggerDelay,\n    telegraphDuration: group.telegraphDuration,\n    stagger: group.stagger,\n  };\n}\n\nfunction snapshotLevel() {\n  return {\n    tab: 'level',\n    obstacles: JSON.parse(JSON.stringify(OBSTACLES)),\n    pits: JSON.parse(JSON.stringify(PITS)),\n    selectedType: levelState.selectedType,\n    selectedIdx: levelState.selectedIdx,\n  };\n}\n\nfunction pushUndo() {\n  const snap = currentTab === 'level' ? snapshotLevel() : snapshotGroup();\n  if (!snap) return;\n  undoStack.push(snap);\n  if (undoStack.length > MAX_UNDO) undoStack.shift();\n  redoStack.length = 0; // new action clears redo\n}\n\nfunction applySnapshot(snap: any) {\n  if (snap.tab === 'level') {\n    // Restore obstacle/pit arrays in place\n    OBSTACLES.length = 0;\n    for (const o of snap.obstacles) OBSTACLES.push(o);\n    PITS.length = 0;\n    for (const p of snap.pits) PITS.push(p);\n    levelState.selectedType = snap.selectedType;\n    levelState.selectedIdx = snap.selectedIdx;\n    onArenaChanged();\n    rebuildLevelMarkers();\n    refreshUI();\n  } else {\n    editorState.waveIndex = snap.waveIndex;\n    editorState.groupIndex = snap.groupIndex;\n    const wave = WAVES[snap.waveIndex];\n    if (!wave) return;\n    const group = wave.groups[snap.groupIndex];\n    if (!group) return;\n    group.spawns = snap.spawns;\n    group.triggerDelay = snap.triggerDelay;\n    group.telegraphDuration = snap.telegraphDuration;\n    group.stagger = snap.stagger;\n    rebuildMarkers();\n    refreshUI();\n  }\n}\n\nfunction popUndo() {\n  if (undoStack.length === 0) return;\n  // Save current state to redo before restoring\n  const current = currentTab === 'level' ? snapshotLevel() : snapshotGroup();\n  if (current) redoStack.push(current);\n  applySnapshot(undoStack.pop());\n}\n\nfunction popRedo() {\n  if (redoStack.length === 0) return;\n  // Save current state to undo before restoring\n  const current = currentTab === 'level' ? snapshotLevel() : snapshotGroup();\n  if (current) undoStack.push(current);\n  applySnapshot(redoStack.pop());\n}\n\n// 3D markers in scene (spawn tab)\nlet markers: any[] = []; // { mesh, waveIdx, groupIdx, spawnIdx }\n\n// 3D markers for level tab\nlet levelMarkers: any[] = []; // { mesh, type: 'obstacle'|'pit', idx }\n\n// Shared geometry/materials for markers\nlet markerGeo: any;\nconst markerMats: any = {};\n\n// DOM references\nlet waveLabel: any, groupLabel: any, spawnCountLabel: any;\nlet bannerEl: any;\nlet spawnTabContent: any, levelTabContent: any;\n\n// Enemy type shortnames for marker labels\nconst TYPE_SHORT: any = {\n  goblin: 'G',\n  skeletonArcher: 'A',\n  iceMortarImp: 'M',\n  stoneGolem: 'T',\n};\n\nconst ENEMY_TYPE_KEYS = Object.keys(ENEMY_TYPES);\n\n// \u2500\u2500\u2500 Per-Enemy Tuning Slider Definitions \u2500\u2500\u2500\n\nconst ENEMY_TUNING_SLIDERS: any = {\n  goblin: [\n    { label: 'Health',       key: 'health',             min: 5,   max: 200,  step: 5,   suffix: '', unit: 'HP',  tip: 'Hit points before death.' },\n    { label: 'Speed',        key: 'speed',              min: 0.5, max: 6,    step: 0.1, suffix: '', unit: 'u/s', tip: 'Movement speed in units per second.' },\n    { label: 'Damage',       key: 'damage',             min: 1,   max: 50,   step: 1,   suffix: '', unit: 'HP',  tip: 'Melee damage per hit.' },\n    { label: 'Attack Rate',  key: 'attackRate',          min: 200, max: 3000, step: 50,  suffix: 'ms', unit: 'ms', tip: 'Minimum time between melee attacks.' },\n    { label: 'KB Resist',    key: 'knockbackResist',     min: 0,   max: 1,    step: 0.05,suffix: '', unit: '',    tip: 'Resistance to knockback. 0 = full knockback, 1 = immune.' },\n    { label: 'Stop Dist',    key: 'rush.stopDistance',   min: 0.1, max: 3,    step: 0.1, suffix: '', unit: 'u',   tip: 'How close to the player before the goblin stops moving.' },\n    { label: 'Leap Edge',    key: 'pitLeap.edgeTimeRequired', min: 200,  max: 4000, step: 100, suffix: 'ms', unit: 'ms', tip: 'How long a goblin must hug a pit edge before leaping.' },\n    { label: 'Leap Speed',   key: 'pitLeap.leapSpeed',        min: 2,    max: 20,   step: 0.5, suffix: '', unit: 'u/s', tip: 'Travel speed along the arc. Lower = slower, more dramatic.' },\n    { label: 'Leap Height',  key: 'pitLeap.arcHeight',        min: 1,    max: 12,   step: 0.5, suffix: '', unit: 'u',   tip: 'Peak height of the parabolic leap arc.' },\n    { label: 'Leap CD',      key: 'pitLeap.cooldown',         min: 500,  max: 10000,step: 250, suffix: 'ms', unit: 'ms', tip: 'Cooldown before a goblin can leap again.' },\n  ],\n  skeletonArcher: [\n    { label: 'Health',           key: 'health',                     min: 5,   max: 200,  step: 5,    suffix: '', unit: 'HP',  tip: 'Hit points before death.' },\n    { label: 'Speed',            key: 'speed',                      min: 0.5, max: 6,    step: 0.1,  suffix: '', unit: 'u/s', tip: 'Movement speed in units per second.' },\n    { label: 'Damage',           key: 'damage',                     min: 1,   max: 50,   step: 1,    suffix: '', unit: 'HP',  tip: 'Base damage value.' },\n    { label: 'Attack Rate',      key: 'attackRate',                  min: 500, max: 5000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'Cooldown between sniper shots (includes telegraph time).' },\n    { label: 'Attack Range',     key: 'attackRange',                 min: 3,   max: 20,   step: 0.5,  suffix: '', unit: 'u',   tip: 'Maximum distance to initiate a sniper shot.' },\n    { label: 'KB Resist',        key: 'knockbackResist',             min: 0,   max: 1,    step: 0.05, suffix: '', unit: '',    tip: 'Resistance to knockback. 0 = full knockback, 1 = immune.' },\n    { label: 'Sniper Telegraph', key: 'sniper.telegraphDuration',    min: 200, max: 2000, step: 50,   suffix: 'ms', unit: 'ms', tip: 'How long the laser sight shows before firing. This is the player\\'s dodge window.' },\n    { label: 'Shot Width',       key: 'sniper.shotWidth',            min: 0.5, max: 4,    step: 0.1,  suffix: '', unit: 'u',   tip: 'Width of the damage corridor (perpendicular to aim).' },\n    { label: 'Shot Length',      key: 'sniper.shotLength',           min: 4,   max: 25,   step: 1,    suffix: '', unit: 'u',   tip: 'Length of the damage corridor (along aim direction).' },\n    { label: 'Sniper Dmg',       key: 'sniper.damage',               min: 1,   max: 50,   step: 1,    suffix: '', unit: 'HP',  tip: 'Damage dealt to everything in the corridor (player + enemies).' },\n    { label: 'Slow Dur',         key: 'sniper.slowDuration',          min: 200, max: 3000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'How long enemies hit by sniper are slowed.' },\n    { label: 'Slow Mult',        key: 'sniper.slowMult',              min: 0.1, max: 1.0,  step: 0.05, suffix: '', unit: 'x',   tip: 'Speed multiplier while slowed. 0.5 = half speed.' },\n    { label: 'Pref Range %',     key: 'kite.preferredRangeMult',     min: 0.3, max: 1.0,  step: 0.05, suffix: '', unit: 'x',   tip: 'Multiplier on attackRange for ideal distance. Lower = fights closer.' },\n    { label: 'Retreat Buf',      key: 'kite.retreatBuffer',          min: 0,   max: 5,    step: 0.5,  suffix: '', unit: 'u',   tip: 'How far inside preferred range before retreating.' },\n    { label: 'Advance Buf',      key: 'kite.advanceBuffer',          min: 0,   max: 8,    step: 0.5,  suffix: '', unit: 'u',   tip: 'How far outside preferred range before advancing.' },\n  ],\n  iceMortarImp: [\n    { label: 'Health',         key: 'health',                    min: 5,   max: 200,  step: 5,    suffix: '', unit: 'HP',  tip: 'Hit points before death.' },\n    { label: 'Speed',          key: 'speed',                     min: 0.5, max: 6,    step: 0.1,  suffix: '', unit: 'u/s', tip: 'Movement speed in units per second.' },\n    { label: 'Damage',         key: 'damage',                    min: 1,   max: 50,   step: 1,    suffix: '', unit: 'HP',  tip: 'Base damage value.' },\n    { label: 'Attack Rate',    key: 'attackRate',                  min: 1000,max: 8000, step: 250,  suffix: 'ms', unit: 'ms', tip: 'Cooldown between mortar shots (includes aim time).' },\n    { label: 'Attack Range',   key: 'attackRange',                 min: 5,   max: 25,   step: 0.5,  suffix: '', unit: 'u',   tip: 'Maximum distance to initiate a mortar shot.' },\n    { label: 'KB Resist',      key: 'knockbackResist',             min: 0,   max: 1,    step: 0.05, suffix: '', unit: '',    tip: 'Resistance to knockback.' },\n    { label: 'Aim Duration',   key: 'mortar.aimDuration',          min: 400, max: 3000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'How long the aim arc + ground circle telegraph shows. This is the dodge window.' },\n    { label: 'Proj Speed',     key: 'mortar.projectileSpeed',      min: 3,   max: 20,   step: 0.5,  suffix: '', unit: 'u/s', tip: 'Projectile travel speed along the arc.' },\n    { label: 'Arc Height',     key: 'mortar.arcHeight',            min: 2,   max: 15,   step: 0.5,  suffix: '', unit: 'u',   tip: 'Peak height of the parabolic arc.' },\n    { label: 'Blast Radius',   key: 'mortar.blastRadius',          min: 1,   max: 8,    step: 0.5,  suffix: '', unit: 'u',   tip: 'AoE damage radius on impact.' },\n    { label: 'Mortar Dmg',     key: 'mortar.damage',               min: 1,   max: 50,   step: 1,    suffix: '', unit: 'HP',  tip: 'Damage dealt to everything in the blast radius.' },\n    { label: 'Inaccuracy',     key: 'mortar.inaccuracy',           min: 0,   max: 5,    step: 0.25, suffix: '', unit: 'u',   tip: 'Random offset from player position. Higher = less accurate.' },\n    { label: 'Slow Dur',       key: 'mortar.slowDuration',          min: 200, max: 3000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'How long targets hit by mortar are slowed.' },\n    { label: 'Slow Mult',      key: 'mortar.slowMult',              min: 0.1, max: 1.0,  step: 0.05, suffix: '', unit: 'x',   tip: 'Speed multiplier while slowed.' },\n    { label: 'Circle Start',   key: 'mortar.circleStartScale',     min: 0.05, max: 1.0, step: 0.05, suffix: '', unit: 'x',   tip: 'Initial scale of ground circle on aim lock (0.25 = starts at 25% size).' },\n    { label: 'Circle Scale',   key: 'mortar.circleScaleTime',      min: 50,  max: 1000, step: 50,   suffix: 'ms', unit: 'ms', tip: 'How long the ground circle takes to scale from start size to full size.' },\n    { label: 'Pref Range %',   key: 'kite.preferredRangeMult',     min: 0.3, max: 1.0,  step: 0.05, suffix: '', unit: 'x',   tip: 'Multiplier on attackRange for ideal distance.' },\n    { label: 'Retreat Buf',    key: 'kite.retreatBuffer',          min: 0,   max: 5,    step: 0.5,  suffix: '', unit: 'u',   tip: 'How far inside preferred range before retreating.' },\n    { label: 'Advance Buf',    key: 'kite.advanceBuffer',          min: 0,   max: 8,    step: 0.5,  suffix: '', unit: 'u',   tip: 'How far outside preferred range before advancing.' },\n  ],\n  stoneGolem: [\n    { label: 'Health',          key: 'health',                     min: 20,   max: 500,  step: 10,   suffix: '', unit: 'HP',  tip: 'Hit points after shield is broken.' },\n    { label: 'Speed',           key: 'speed',                      min: 0.3,  max: 4,    step: 0.05, suffix: '', unit: 'u/s', tip: 'Base movement speed in units per second.' },\n    { label: 'Damage',          key: 'damage',                     min: 5,    max: 80,   step: 5,    suffix: '', unit: 'HP',  tip: 'Base melee damage per hit.' },\n    { label: 'Attack Rate',     key: 'attackRate',                  min: 200,  max: 5000, step: 100,  suffix: 'ms', unit: 'ms', tip: 'Minimum time between melee hits.' },\n    { label: 'KB Resist',       key: 'knockbackResist',             min: 0,    max: 1,    step: 0.05, suffix: '', unit: '',    tip: 'Knockback resistance. Golem barely moves when hit.' },\n    { label: 'Charge Speed',    key: 'tank.chargeSpeedMult',        min: 1,    max: 6,    step: 0.5,  suffix: 'x', unit: 'x',  tip: 'Speed multiplier during charge attack.' },\n    { label: 'Charge Dur',      key: 'tank.chargeDuration',         min: 100,  max: 2000, step: 50,   suffix: 'ms', unit: 'ms', tip: 'How long the charge lasts.' },\n    { label: 'Charge CD Min',   key: 'tank.chargeCooldownMin',      min: 1000, max: 10000,step: 500,  suffix: 'ms', unit: 'ms', tip: 'Minimum cooldown between charges.' },\n    { label: 'Charge CD Max',   key: 'tank.chargeCooldownMax',      min: 1000, max: 15000,step: 500,  suffix: 'ms', unit: 'ms', tip: 'Maximum cooldown between charges (random in range).' },\n    { label: 'Charge Dmg',      key: 'tank.chargeDamageMult',       min: 1,    max: 4,    step: 0.25, suffix: 'x', unit: 'x',  tip: 'Damage multiplier when hitting player during charge.' },\n    { label: 'Shield HP',       key: 'shield.maxHealth',            min: 0,    max: 200,  step: 5,    suffix: '', unit: 'HP',  tip: 'Shield hit points. Set to 0 to disable shield.' },\n    { label: 'Stun Radius',     key: 'shield.stunRadius',           min: 1,    max: 15,   step: 0.5,  suffix: '', unit: 'u',   tip: 'AoE stun radius when shield breaks.' },\n    { label: 'Stun Dur',        key: 'shield.stunDuration',         min: 500,  max: 5000, step: 250,  suffix: 'ms', unit: 'ms', tip: 'How long the golem + nearby enemies are stunned after shield break.' },\n    { label: 'Explode Rad',    key: 'deathExplosion.radius',       min: 1,    max: 10,   step: 0.5,  suffix: '', unit: 'u',   tip: 'AoE radius of the death explosion. Damages nearby enemies and player.' },\n    { label: 'Explode Dmg',    key: 'deathExplosion.damage',       min: 5,    max: 80,   step: 5,    suffix: '', unit: 'HP',  tip: 'Damage dealt by the death explosion.' },\n    { label: 'Explode Stun',   key: 'deathExplosion.stunDuration', min: 0,    max: 3000, step: 250,  suffix: 'ms', unit: 'ms', tip: 'Stun duration applied to enemies caught in death explosion. 0 = no stun.' },\n    { label: 'Explode Delay',  key: 'deathExplosion.telegraphDuration', min: 0, max: 3000, step: 100, suffix: 'ms', unit: 'ms', tip: 'Telegraph delay before explosion. Golem can be pushed during this window. 0 = instant.' },\n  ],\n};\n\n// Nested key helpers\nfunction getNestedValue(obj: any, path: string) {\n  const parts = path.split('.');\n  let cur = obj;\n  for (const p of parts) {\n    if (cur == null) return undefined;\n    cur = cur[p];\n  }\n  return cur;\n}\n\nfunction setNestedValue(obj: any, path: string, value: any) {\n  const parts = path.split('.');\n  let cur = obj;\n  for (let i = 0; i < parts.length - 1; i++) {\n    if (cur[parts[i]] == null) cur[parts[i]] = {};\n    cur = cur[parts[i]];\n  }\n  cur[parts[parts.length - 1]] = value;\n}\n\nlet lastBuiltTuningType: string | null = null;\n\nexport function initSpawnEditor(scene: any, gameState: any) {\n  sceneRef = scene;\n  gameStateRef = gameState;\n\n  // Marker geometry \u2014 small cylinder\n  markerGeo = new THREE.CylinderGeometry(0.35, 0.35, 0.8, 8);\n\n  // Materials per enemy type\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    markerMats[name] = new THREE.MeshStandardMaterial({\n      color: (cfg as any).color,\n      emissive: (cfg as any).color,\n      emissiveIntensity: 0.5,\n      transparent: true,\n      opacity: 0.8,\n    });\n  }\n\n  buildPanel();\n  injectStyles();\n\n  // Mouse handlers\n  window.addEventListener('mousedown', onMouseDown);\n  window.addEventListener('mousemove', onMouseMove);\n  window.addEventListener('mouseup', onMouseUp);\n\n  // Keyboard shortcuts in editor\n  window.addEventListener('keydown', onEditorKey);\n}\n\nexport function updateSpawnEditor(dt: number) {\n  const input = getInputState();\n\n  // Check for toggle\n  if (input.toggleEditor) {\n    toggleEditor();\n    consumeInput();\n    return;\n  }\n}\n\n// Also check toggle from main game loop (called even when not in editor)\nexport function checkEditorToggle() {\n  const input = getInputState();\n  if (input.toggleEditor) {\n    toggleEditor();\n  }\n}\n\nfunction toggleEditor() {\n  if (active) {\n    exitEditor();\n  } else {\n    enterEditor();\n  }\n}\n\nfunction onEditorWheel(e: any) {\n  e.preventDefault();\n  const delta = e.deltaY > 0 ? 1 : -1; // scroll down = zoom out (+frustum)\n  setZoom(getCurrentFrustum() + delta);\n}\n\nfunction enterEditor() {\n  active = true;\n  previousPhase = gameStateRef.phase;\n  gameStateRef.phase = 'editorPaused';\n  panel.classList.remove('hidden');\n  bannerEl.classList.add('visible');\n  window.addEventListener('wheel', onEditorWheel, { passive: false });\n  if (currentTab === 'spawn') {\n    rebuildMarkers();\n  } else {\n    rebuildLevelMarkers();\n  }\n  refreshUI();\n}\n\nfunction exitEditor() {\n  active = false;\n  gameStateRef.phase = previousPhase;\n  panel.classList.add('hidden');\n  bannerEl.classList.remove('visible');\n  window.removeEventListener('wheel', onEditorWheel);\n  resetZoom();\n  clearMarkers();\n  clearLevelMarkers();\n}\n\nexport function isEditorActive() {\n  return active;\n}\n\n// \u2500\u2500\u2500 Tab Switching \u2500\u2500\u2500\n\nfunction switchTab(tab: string) {\n  if (tab === currentTab) return;\n  currentTab = tab;\n\n  // Clear old markers\n  clearMarkers();\n  clearLevelMarkers();\n\n  // Reset selections\n  editorState.selectedSpawnIdx = -1;\n  levelState.selectedType = null;\n  levelState.selectedIdx = -1;\n  isDragging = false;\n  dragStarted = false;\n\n  // Show/hide tab contents\n  if (spawnTabContent && levelTabContent) {\n    spawnTabContent.style.display = tab === 'spawn' ? 'block' : 'none';\n    levelTabContent.style.display = tab === 'level' ? 'block' : 'none';\n  }\n\n  // Update tab buttons\n  const tabs = panel.querySelectorAll('.se-tab');\n  tabs.forEach((t: any) => t.classList.toggle('active', t.dataset.tab === tab));\n\n  // Rebuild appropriate markers\n  if (tab === 'spawn') {\n    rebuildMarkers();\n  } else {\n    rebuildLevelMarkers();\n  }\n  refreshUI();\n}\n\n// \u2500\u2500\u2500 Mouse \u2192 Select / Drag / Place \u2500\u2500\u2500\n\nfunction mouseToWorld(e: any) {\n  const ndcX = (e.clientX / window.innerWidth) * 2 - 1;\n  const ndcY = -(e.clientY / window.innerHeight) * 2 + 1;\n  return screenToWorld(ndcX, ndcY);\n}\n\nfunction clampToArena(x: number, z: number) {\n  const c = ARENA_HALF - 1.5;\n  return {\n    x: Math.round(Math.max(-c, Math.min(c, x))),\n    z: Math.round(Math.max(-c, Math.min(c, z))),\n  };\n}\n\n// Find nearest spawn in current group within radius\nfunction findNearestSpawn(worldX: number, worldZ: number, radius: number) {\n  const group = getCurrentGroup();\n  if (!group) return -1;\n  let bestIdx = -1, bestDist = radius * radius;\n  for (let i = 0; i < group.spawns.length; i++) {\n    const s = group.spawns[i];\n    const dx = s.x - worldX;\n    const dz = s.z - worldZ;\n    const distSq = dx * dx + dz * dz;\n    if (distSq < bestDist) {\n      bestDist = distSq;\n      bestIdx = i;\n    }\n  }\n  return bestIdx;\n}\n\n// Find nearest spawn across ALL groups in the current wave within radius.\n// Returns { groupIdx, spawnIdx } or null if nothing found.\nfunction findNearestSpawnAcrossGroups(worldX: number, worldZ: number, radius: number) {\n  const wave = WAVES[editorState.waveIndex];\n  if (!wave) return null;\n  let bestGroupIdx = -1, bestSpawnIdx = -1, bestDist = radius * radius;\n  for (let gi = 0; gi < wave.groups.length; gi++) {\n    const group = wave.groups[gi];\n    for (let si = 0; si < group.spawns.length; si++) {\n      const s = group.spawns[si];\n      const dx = s.x - worldX;\n      const dz = s.z - worldZ;\n      const distSq = dx * dx + dz * dz;\n      if (distSq < bestDist) {\n        bestDist = distSq;\n        bestGroupIdx = gi;\n        bestSpawnIdx = si;\n      }\n    }\n  }\n  if (bestGroupIdx < 0) return null;\n  return { groupIdx: bestGroupIdx, spawnIdx: bestSpawnIdx };\n}\n\n// \u2500\u2500\u2500 Level Tab Mouse Helpers \u2500\u2500\u2500\n\nfunction findNearestLevelObject(worldX: number, worldZ: number, radius: number) {\n  let bestType: string | null = null, bestIdx = -1, bestDist = radius * radius;\n\n  for (let i = 0; i < OBSTACLES.length; i++) {\n    const o = OBSTACLES[i];\n    const dx = o.x - worldX;\n    const dz = o.z - worldZ;\n    const distSq = dx * dx + dz * dz;\n    if (distSq < bestDist) {\n      bestDist = distSq;\n      bestType = 'obstacle';\n      bestIdx = i;\n    }\n  }\n\n  for (let i = 0; i < PITS.length; i++) {\n    const p = PITS[i];\n    const dx = p.x - worldX;\n    const dz = p.z - worldZ;\n    const distSq = dx * dx + dz * dz;\n    if (distSq < bestDist) {\n      bestDist = distSq;\n      bestType = 'pit';\n      bestIdx = i;\n    }\n  }\n\n  if (bestType === null) return null;\n  return { type: bestType, idx: bestIdx };\n}\n\nfunction onMouseDown(e: any) {\n  if (!active) return;\n  if (e.target.closest('#spawn-editor')) return;\n\n  if (currentTab === 'level') {\n    onLevelMouseDown(e);\n    return;\n  }\n\n  const worldPos = mouseToWorld(e);\n  const group = getCurrentGroup();\n  if (!group) return;\n\n  // Right-click or shift-click: delete nearest spawn (search across groups)\n  if (e.button === 2 || e.shiftKey) {\n    // Try current group first\n    let idx = findNearestSpawn(worldPos.x, worldPos.z, 1.5);\n    if (idx >= 0) {\n      pushUndo();\n      group.spawns.splice(idx, 1);\n      if (editorState.selectedSpawnIdx === idx) editorState.selectedSpawnIdx = -1;\n      else if (editorState.selectedSpawnIdx > idx) editorState.selectedSpawnIdx--;\n      rebuildMarkers();\n      refreshUI();\n    } else {\n      // Check other groups\n      const hit = findNearestSpawnAcrossGroups(worldPos.x, worldPos.z, 1.5);\n      if (hit) {\n        // Switch to that group and delete the spawn\n        editorState.groupIndex = hit.groupIdx;\n        editorState.selectedSpawnIdx = -1;\n        const targetGroup = WAVES[editorState.waveIndex].groups[hit.groupIdx];\n        pushUndo();\n        targetGroup.spawns.splice(hit.spawnIdx, 1);\n        rebuildMarkers();\n        refreshUI();\n      }\n    }\n    return;\n  }\n\n  // Left click: check if clicking on existing spawn in current group first\n  const hitIdx = findNearestSpawn(worldPos.x, worldPos.z, 1.5);\n\n  if (hitIdx >= 0) {\n    // Select it and start potential drag\n    editorState.selectedSpawnIdx = hitIdx;\n    isDragging = true;\n    dragStarted = false;\n    dragStartWorld = { x: worldPos.x, z: worldPos.z };\n    rebuildMarkers();\n    refreshUI();\n  } else {\n    // Check other groups \u2014 only auto-switch if click is very close to an existing spawn\n    // (tighter radius prevents accidental group switches when placing new spawns)\n    const hit = findNearestSpawnAcrossGroups(worldPos.x, worldPos.z, 0.8);\n\n    if (hit) {\n      // Auto-switch to that group and select the spawn\n      editorState.groupIndex = hit.groupIdx;\n      editorState.selectedSpawnIdx = hit.spawnIdx;\n      isDragging = true;\n      dragStarted = false;\n      dragStartWorld = { x: worldPos.x, z: worldPos.z };\n      rebuildMarkers();\n      refreshUI();\n    } else {\n      // Place new spawn in current group\n      pushUndo();\n      const clamped = clampToArena(worldPos.x, worldPos.z);\n      group.spawns.push({ type: editorState.enemyType, x: clamped.x, z: clamped.z });\n      editorState.selectedSpawnIdx = group.spawns.length - 1;\n      rebuildMarkers();\n      refreshUI();\n    }\n  }\n}\n\nfunction onLevelMouseDown(e: any) {\n  const worldPos = mouseToWorld(e);\n\n  // Right-click or shift-click: delete nearest object\n  if (e.button === 2 || e.shiftKey) {\n    const hit = findNearestLevelObject(worldPos.x, worldPos.z, 3);\n    if (hit) {\n      pushUndo();\n      if (hit.type === 'obstacle') {\n        OBSTACLES.splice(hit.idx, 1);\n      } else {\n        PITS.splice(hit.idx, 1);\n      }\n      // Clear selection if the deleted item was selected\n      if (levelState.selectedType === hit.type && levelState.selectedIdx === hit.idx) {\n        levelState.selectedType = null;\n        levelState.selectedIdx = -1;\n      } else if (levelState.selectedType === hit.type && levelState.selectedIdx > hit.idx) {\n        levelState.selectedIdx--;\n      }\n      onArenaChanged();\n      rebuildLevelMarkers();\n      refreshUI();\n    }\n    return;\n  }\n\n  // Left click: select or add\n  const hit = findNearestLevelObject(worldPos.x, worldPos.z, 3);\n\n  if (hit) {\n    levelState.selectedType = hit.type;\n    levelState.selectedIdx = hit.idx;\n    isDragging = true;\n    dragStarted = false;\n    dragStartWorld = { x: worldPos.x, z: worldPos.z };\n    rebuildLevelMarkers();\n    refreshUI();\n  } else {\n    // Click on empty space: deselect\n    levelState.selectedType = null;\n    levelState.selectedIdx = -1;\n    rebuildLevelMarkers();\n    refreshUI();\n  }\n}\n\nfunction onMouseMove(e: any) {\n  if (!active || !isDragging) return;\n\n  if (currentTab === 'level') {\n    onLevelMouseMove(e);\n    return;\n  }\n\n  const worldPos = mouseToWorld(e);\n  const group = getCurrentGroup();\n  if (!group || editorState.selectedSpawnIdx < 0) return;\n\n  // Check drag threshold (0.5 world units) before committing\n  if (!dragStarted) {\n    const dx = worldPos.x - dragStartWorld.x;\n    const dz = worldPos.z - dragStartWorld.z;\n    if (dx * dx + dz * dz < 0.25) return; // below threshold\n    dragStarted = true;\n    pushUndo(); // snapshot before drag begins\n  }\n\n  // Move the selected spawn\n  const clamped = clampToArena(worldPos.x, worldPos.z);\n  const spawn = group.spawns[editorState.selectedSpawnIdx];\n  spawn.x = clamped.x;\n  spawn.z = clamped.z;\n\n  // Update marker position directly (avoid full rebuild every frame)\n  const marker = markers.find((m: any) =>\n    m.groupIdx === editorState.groupIndex && m.spawnIdx === editorState.selectedSpawnIdx\n  );\n  if (marker) {\n    marker.mesh.position.set(clamped.x, 0, clamped.z);\n  }\n}\n\nfunction onLevelMouseMove(e: any) {\n  if (levelState.selectedType === null || levelState.selectedIdx < 0) return;\n\n  const worldPos = mouseToWorld(e);\n\n  // Check drag threshold\n  if (!dragStarted) {\n    const dx = worldPos.x - dragStartWorld.x;\n    const dz = worldPos.z - dragStartWorld.z;\n    if (dx * dx + dz * dz < 0.25) return;\n    dragStarted = true;\n    pushUndo();\n  }\n\n  // Move the selected object\n  const arr = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n  const obj = arr[levelState.selectedIdx];\n  if (!obj) return;\n  obj.x = Math.round(worldPos.x * 2) / 2; // snap to 0.5\n  obj.z = Math.round(worldPos.z * 2) / 2;\n\n  // Update marker position\n  const marker = levelMarkers.find((m: any) =>\n    m.type === levelState.selectedType && m.idx === levelState.selectedIdx\n  );\n  if (marker) {\n    marker.mesh.position.set(obj.x, marker.mesh.position.y, obj.z);\n  }\n}\n\nfunction onMouseUp(e: any) {\n  if (!active) return;\n\n  if (currentTab === 'level') {\n    if (isDragging && dragStarted) {\n      onArenaChanged();\n      rebuildLevelMarkers();\n      refreshUI();\n    }\n    isDragging = false;\n    dragStarted = false;\n    dragStartWorld = null;\n    return;\n  }\n\n  if (isDragging && dragStarted) {\n    // Drag finished \u2014 rebuild markers for clean state\n    rebuildMarkers();\n    refreshUI();\n  }\n  isDragging = false;\n  dragStarted = false;\n  dragStartWorld = null;\n}\n\n// \u2500\u2500\u2500 Arena Changed (rebuild visuals + invalidate physics) \u2500\u2500\u2500\n\nfunction onArenaChanged() {\n  rebuildArenaVisuals();\n  invalidateCollisionBounds();\n}\n\n// \u2500\u2500\u2500 Arena Presets \u2500\u2500\u2500\n// Note: Arena save/load requires a backend server. On static hosting (GitHub Pages,\n// npx serve), these functions no-op silently. Set window.ARENA_BACKEND = true if\n// you're running a backend that supports /arenas endpoints.\n\nconst hasArenaBackend = () => (window as any).ARENA_BACKEND === true;\n\nasync function fetchPresetList() {\n  if (!hasArenaBackend()) return [];\n  try {\n    const res = await fetch('/arenas');\n    if (!res.ok) return [];\n    return await res.json();\n  } catch (e) {\n    console.warn('[spawnEditor] Could not fetch preset list:', e);\n    return [];\n  }\n}\n\nasync function refreshPresetDropdown() {\n  const select = document.getElementById('se-preset-select') as any;\n  if (!select) return;\n  const list = await fetchPresetList();\n  let html = '<option value=\"\">(unsaved)</option>';\n  for (const name of list) {\n    const sel = name === currentPresetName ? ' selected' : '';\n    html += `<option value=\"${name}\"${sel}>${name}</option>`;\n  }\n  select.innerHTML = html;\n}\n\nasync function loadPreset(name: string) {\n  if (!name || !hasArenaBackend()) return;\n  try {\n    const res = await fetch(`/arenas/load?name=${encodeURIComponent(name)}`);\n    if (!res.ok) throw new Error(res.statusText);\n    const data = await res.json();\n\n    pushUndo();\n\n    // Replace arrays in-place (same pattern as undo/redo)\n    OBSTACLES.length = 0;\n    for (const o of data.obstacles) OBSTACLES.push(o);\n    PITS.length = 0;\n    for (const p of data.pits) PITS.push(p);\n\n    currentPresetName = name;\n    levelState.selectedType = null;\n    levelState.selectedIdx = -1;\n\n    onArenaChanged();\n    rebuildLevelMarkers();\n    refreshLevelUI();\n    refreshPresetDropdown();\n  } catch (e) {\n    console.error('[spawnEditor] Load preset failed:', e);\n  }\n}\n\nasync function savePreset(name: string) {\n  if (!name || !hasArenaBackend()) return;\n  try {\n    const res = await fetch('/arenas/save', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name, obstacles: OBSTACLES, pits: PITS }),\n    });\n    if (!res.ok) throw new Error(res.statusText);\n    currentPresetName = name;\n    refreshPresetDropdown();\n  } catch (e) {\n    console.error('[spawnEditor] Save preset failed:', e);\n  }\n}\n\nasync function deletePreset(name: string) {\n  if (!name || !hasArenaBackend()) return;\n  try {\n    const res = await fetch('/arenas/delete', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name }),\n    });\n    if (!res.ok) throw new Error(res.statusText);\n    if (currentPresetName === name) currentPresetName = null;\n    refreshPresetDropdown();\n  } catch (e) {\n    console.error('[spawnEditor] Delete preset failed:', e);\n  }\n}\n\n// \u2500\u2500\u2500 Keyboard Shortcuts \u2500\u2500\u2500\n\nfunction onEditorKey(e: any) {\n  if (!active) return;\n\n  // Cmd/Ctrl+Z: undo\n  if (e.code === 'KeyZ' && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n    e.preventDefault();\n    popUndo();\n    return;\n  }\n\n  // Ctrl+Y or Cmd+Shift+Z: redo\n  if ((e.code === 'KeyY' && (e.metaKey || e.ctrlKey)) ||\n      (e.code === 'KeyZ' && (e.metaKey || e.ctrlKey) && e.shiftKey)) {\n    e.preventDefault();\n    popRedo();\n    return;\n  }\n\n  // Escape: deselect\n  if (e.code === 'Escape') {\n    if (currentTab === 'level') {\n      levelState.selectedType = null;\n      levelState.selectedIdx = -1;\n      rebuildLevelMarkers();\n    } else {\n      editorState.selectedSpawnIdx = -1;\n      rebuildMarkers();\n    }\n    refreshUI();\n    return;\n  }\n\n  // Tab-specific shortcuts\n  if (currentTab === 'level') {\n    onLevelKey(e);\n    return;\n  }\n\n  // Spawn tab shortcuts below\n\n  // 1/2/3/4 to select enemy type \u2014 also changes selected spawn's type\n  const typeKeyMap: any = { 'Digit1': 0, 'Digit2': 1, 'Digit3': 2, 'Digit4': 3 };\n  if (e.code in typeKeyMap) {\n    const idx = typeKeyMap[e.code];\n    if (idx < ENEMY_TYPE_KEYS.length) {\n      editorState.enemyType = ENEMY_TYPE_KEYS[idx];\n      // If a spawn is selected, change its type too\n      if (editorState.selectedSpawnIdx >= 0) {\n        const group = getCurrentGroup();\n        if (group && group.spawns[editorState.selectedSpawnIdx]) {\n          pushUndo();\n          group.spawns[editorState.selectedSpawnIdx].type = ENEMY_TYPE_KEYS[idx];\n          rebuildMarkers();\n        }\n      }\n      refreshUI();\n    }\n  }\n\n  // Delete/Backspace: remove selected spawn, or clear group if none selected\n  if (e.code === 'Delete' || e.code === 'Backspace') {\n    if (e.target.tagName === 'INPUT') return; // don't intercept slider input\n    const group = getCurrentGroup();\n    if (!group) return;\n\n    if (editorState.selectedSpawnIdx >= 0 && editorState.selectedSpawnIdx < group.spawns.length) {\n      // Delete just the selected spawn\n      pushUndo();\n      group.spawns.splice(editorState.selectedSpawnIdx, 1);\n      editorState.selectedSpawnIdx = -1;\n      rebuildMarkers();\n      refreshUI();\n    } else {\n      // No selection \u2014 clear all spawns in group\n      pushUndo();\n      group.spawns = [];\n      rebuildMarkers();\n      refreshUI();\n    }\n  }\n\n  // P: play current wave\n  if (e.code === 'KeyP') {\n    playCurrentWave();\n  }\n}\n\nfunction onLevelKey(e: any) {\n  // Delete/Backspace: delete selected level object\n  if (e.code === 'Delete' || e.code === 'Backspace') {\n    if (e.target.tagName === 'INPUT') return;\n    if (levelState.selectedType && levelState.selectedIdx >= 0) {\n      pushUndo();\n      if (levelState.selectedType === 'obstacle') {\n        OBSTACLES.splice(levelState.selectedIdx, 1);\n      } else {\n        PITS.splice(levelState.selectedIdx, 1);\n      }\n      levelState.selectedType = null;\n      levelState.selectedIdx = -1;\n      onArenaChanged();\n      rebuildLevelMarkers();\n      refreshUI();\n    }\n  }\n}\n\n// \u2500\u2500\u2500 3D Markers (Spawn Tab) \u2500\u2500\u2500\n\nfunction clearMarkers() {\n  for (const m of markers) {\n    sceneRef.remove(m.mesh);\n    // dispose cloned materials\n    m.mesh.children.forEach((c: any) => {\n      if (c.material && c.material !== markerMats[m.type]) c.material.dispose();\n    });\n  }\n  markers = [];\n}\n\nfunction rebuildMarkers() {\n  clearMarkers();\n\n  for (let wi = 0; wi < WAVES.length; wi++) {\n    const wave = WAVES[wi];\n    if (wi !== editorState.waveIndex) continue; // only show current wave\n\n    for (let gi = 0; gi < wave.groups.length; gi++) {\n      const group = wave.groups[gi];\n      const isCurrent = (gi === editorState.groupIndex);\n\n      for (let si = 0; si < group.spawns.length; si++) {\n        const spawn = group.spawns[si];\n        const mat = markerMats[spawn.type] || markerMats.goblin;\n        const isSelected = isCurrent && si === editorState.selectedSpawnIdx;\n\n        // Clone material for opacity control\n        const clonedMat = mat.clone();\n        clonedMat.opacity = isCurrent ? 0.85 : 0.25;\n        if (isSelected) {\n          clonedMat.emissiveIntensity = 1.0;\n        }\n\n        const mesh = new THREE.Group();\n\n        // Cylinder body\n        const body = new THREE.Mesh(markerGeo, clonedMat);\n        body.position.y = 0.4;\n        mesh.add(body);\n\n        // Ground ring \u2014 white if selected, enemy color otherwise\n        const ringColor = isSelected ? 0xffffff\n          : ((ENEMY_TYPES as any)[spawn.type] ? (ENEMY_TYPES as any)[spawn.type].color : 0xffffff);\n        const ringGeo = new THREE.RingGeometry(\n          isSelected ? 0.55 : 0.5,\n          isSelected ? 0.75 : 0.65,\n          16\n        );\n        ringGeo.rotateX(-Math.PI / 2);\n        const ringMat = new THREE.MeshBasicMaterial({\n          color: ringColor,\n          transparent: true,\n          opacity: isSelected ? 0.9 : (isCurrent ? 0.5 : 0.15),\n          side: THREE.DoubleSide,\n          depthWrite: false,\n        });\n        const ring = new THREE.Mesh(ringGeo, ringMat);\n        ring.position.y = 0.02;\n        mesh.add(ring);\n\n        mesh.position.set(spawn.x, 0, spawn.z);\n        sceneRef.add(mesh);\n\n        markers.push({\n          mesh,\n          type: spawn.type,\n          waveIdx: wi,\n          groupIdx: gi,\n          spawnIdx: si,\n        });\n      }\n    }\n  }\n}\n\n// \u2500\u2500\u2500 3D Markers (Level Tab) \u2500\u2500\u2500\n\nfunction clearLevelMarkers() {\n  for (const m of levelMarkers) {\n    sceneRef.remove(m.mesh);\n    m.mesh.children.forEach((c: any) => {\n      if (c.material) c.material.dispose();\n      if (c.geometry) c.geometry.dispose();\n    });\n  }\n  levelMarkers = [];\n}\n\nfunction rebuildLevelMarkers() {\n  clearLevelMarkers();\n\n  const isObsSelected = levelState.selectedType === 'obstacle';\n  const isPitSelected = levelState.selectedType === 'pit';\n\n  // Obstacle markers \u2014 wireframe boxes at obstacle positions\n  for (let i = 0; i < OBSTACLES.length; i++) {\n    const o = OBSTACLES[i];\n    const selected = isObsSelected && levelState.selectedIdx === i;\n\n    const group = new THREE.Group();\n\n    // Wireframe outline\n    const boxGeo = new THREE.BoxGeometry(o.w, o.h, o.d);\n    const edgesGeo = new THREE.EdgesGeometry(boxGeo);\n    const lineMat = new THREE.LineBasicMaterial({\n      color: selected ? 0x44ff88 : 0x66aaff,\n      linewidth: 1,\n    });\n    const wireframe = new THREE.LineSegments(edgesGeo, lineMat);\n    wireframe.position.y = o.h / 2;\n    group.add(wireframe);\n\n    // Ground ring\n    const ringGeo = new THREE.RingGeometry(\n      selected ? 0.6 : 0.5,\n      selected ? 0.85 : 0.7,\n      16\n    );\n    ringGeo.rotateX(-Math.PI / 2);\n    const ringMat = new THREE.MeshBasicMaterial({\n      color: selected ? 0x44ff88 : 0x66aaff,\n      transparent: true,\n      opacity: selected ? 0.8 : 0.4,\n      side: THREE.DoubleSide,\n      depthWrite: false,\n    });\n    const ring = new THREE.Mesh(ringGeo, ringMat);\n    ring.position.y = 0.03;\n    group.add(ring);\n\n    group.position.set(o.x, 0, o.z);\n    sceneRef.add(group);\n\n    levelMarkers.push({ mesh: group, type: 'obstacle', idx: i });\n  }\n\n  // Pit markers \u2014 wireframe rectangles on ground\n  for (let i = 0; i < PITS.length; i++) {\n    const p = PITS[i];\n    const selected = isPitSelected && levelState.selectedIdx === i;\n\n    const group = new THREE.Group();\n\n    // Wireframe rectangle at ground level\n    const planeGeo = new THREE.PlaneGeometry(p.w, p.d);\n    const edgesGeo = new THREE.EdgesGeometry(planeGeo);\n    const lineMat = new THREE.LineBasicMaterial({\n      color: selected ? 0xff44aa : 0xff4466,\n      linewidth: 1,\n    });\n    const wireframe = new THREE.LineSegments(edgesGeo, lineMat);\n    wireframe.rotation.x = -Math.PI / 2;\n    wireframe.position.y = 0.1;\n    group.add(wireframe);\n\n    // Ground ring\n    const ringGeo = new THREE.RingGeometry(\n      selected ? 0.6 : 0.5,\n      selected ? 0.85 : 0.7,\n      16\n    );\n    ringGeo.rotateX(-Math.PI / 2);\n    const ringMat = new THREE.MeshBasicMaterial({\n      color: selected ? 0xff44aa : 0xff4466,\n      transparent: true,\n      opacity: selected ? 0.8 : 0.4,\n      side: THREE.DoubleSide,\n      depthWrite: false,\n    });\n    const ring = new THREE.Mesh(ringGeo, ringMat);\n    ring.position.y = 0.03;\n    group.add(ring);\n\n    group.position.set(p.x, 0, p.z);\n    sceneRef.add(group);\n\n    levelMarkers.push({ mesh: group, type: 'pit', idx: i });\n  }\n}\n\n// \u2500\u2500\u2500 UI Panel \u2500\u2500\u2500\n\nfunction buildPanel() {\n  panel = document.createElement('div');\n  panel.id = 'spawn-editor';\n  panel.className = 'hidden';\n\n  // Prevent context menu on panel\n  panel.addEventListener('contextmenu', (e: any) => e.preventDefault());\n\n  // Banner\n  bannerEl = document.createElement('div');\n  bannerEl.id = 'editor-banner';\n  document.body.appendChild(bannerEl);\n  bannerEl.textContent = 'EDITOR MODE \u2014 press ` to exit';\n\n  let html = '';\n\n  // Tab bar\n  html += '<div class=\"se-tabs\">';\n  html += '<div class=\"se-tab active\" data-tab=\"spawn\">Spawn</div>';\n  html += '<div class=\"se-tab\" data-tab=\"level\">Level</div>';\n  html += '</div>';\n\n  // \u2500\u2500\u2500 Spawn Tab Content \u2500\u2500\u2500\n  html += '<div id=\"se-spawn-content\">';\n\n  // Wave selector\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Wave</div>';\n  html += '<div class=\"se-selector\">';\n  html += '<div class=\"se-btn\" id=\"se-wave-prev\">&lt;</div>';\n  html += '<span id=\"se-wave-label\">1</span>';\n  html += '<div class=\"se-btn\" id=\"se-wave-next\">&gt;</div>';\n  html += '<div class=\"se-btn se-add\" id=\"se-wave-add\">+</div>';\n  html += '</div>';\n  html += '<input type=\"text\" id=\"se-wave-msg\" class=\"se-wave-msg\" placeholder=\"Wave announcement message...\">';\n  html += '</div>';\n\n  // Group selector\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Group</div>';\n  html += '<div class=\"se-selector\">';\n  html += '<div class=\"se-btn\" id=\"se-group-prev\">&lt;</div>';\n  html += '<span id=\"se-group-label\">g1</span>';\n  html += '<div class=\"se-btn\" id=\"se-group-next\">&gt;</div>';\n  html += '<div class=\"se-btn se-add\" id=\"se-group-add\">+</div>';\n  html += '<div class=\"se-btn se-del\" id=\"se-group-del\">\\u00d7</div>';\n  html += '</div></div>';\n\n  // Timing sliders\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Timing</div>';\n  html += '<div class=\"se-slider-row\"><span class=\"has-tooltip\" data-tip=\"Time after wave starts before this group\\'s telegraph begins. Use to stagger multiple groups.\">Trigger Delay</span><input type=\"range\" id=\"se-trigger\" min=\"0\" max=\"10000\" step=\"250\" value=\"0\"><input type=\"text\" class=\"se-timing-val\" id=\"se-trigger-val\" value=\"0 ms\"></div>';\n  html += '<div class=\"se-slider-row\"><span class=\"has-tooltip\" data-tip=\"How long the pulsing warning circles appear on the ground before enemies materialize. This is the player\\'s reaction window.\">Telegraph Time</span><input type=\"range\" id=\"se-telegraph\" min=\"500\" max=\"5000\" step=\"250\" value=\"1500\"><input type=\"text\" class=\"se-timing-val\" id=\"se-telegraph-val\" value=\"1500 ms\"></div>';\n  html += '<div class=\"se-slider-row\"><span class=\"has-tooltip\" data-tip=\"Time between each individual enemy spawning within a group. 0 = all spawn simultaneously.\">Spawn Stagger</span><input type=\"range\" id=\"se-stagger\" min=\"0\" max=\"1000\" step=\"50\" value=\"200\"><input type=\"text\" class=\"se-timing-val\" id=\"se-stagger-val\" value=\"200 ms\"></div>';\n  html += '</div>';\n\n  // Enemy type picker\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Enemy Type (1/2/3/4)</div>';\n  html += '<div class=\"se-type-picker\" id=\"se-type-picker\">';\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    const short = TYPE_SHORT[name] || name[0].toUpperCase();\n    html += `<div class=\"se-type-btn\" data-type=\"${name}\" style=\"border-color: #${(cfg as any).color.toString(16).padStart(6, '0')}\">${short} ${(cfg as any).name}</div>`;\n  }\n  html += '</div></div>';\n\n  // Per-enemy tuning (collapsible)\n  html += '<div class=\"se-section\" id=\"se-enemy-tuning\">';\n  html += '<div class=\"se-group-label se-collapsible\" id=\"se-tuning-header\">Enemy Properties &#x25BC;</div>';\n  html += '<div id=\"se-tuning-body\"></div>';\n  html += '</div>';\n\n  // Spawn count\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-spawn-count\">Spawns: <span id=\"se-spawn-count\">0</span></div>';\n  html += '<div class=\"se-selected-info\" id=\"se-selected-info\"></div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-clear\">Clear Group</div>';\n  html += '</div>';\n\n  // Action buttons\n  html += '<div class=\"se-section se-actions\">';\n  html += '<div class=\"se-btn se-action se-play\" id=\"se-play\">Play Wave</div>';\n  html += '<div class=\"se-btn se-action se-save\" id=\"se-save-spawns\">Save All</div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-copy-wave\">Copy Wave</div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-copy-all\">Copy All</div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-copy-enemies\">Copy Enemy Config</div>';\n  html += '</div>';\n\n  html += '</div>'; // end se-spawn-content\n\n  // \u2500\u2500\u2500 Level Tab Content \u2500\u2500\u2500\n  html += '<div id=\"se-level-content\" style=\"display:none\">';\n\n  // Arena preset selector\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Arena Preset</div>';\n  html += '<div class=\"se-preset-row\">';\n  html += '<select id=\"se-preset-select\" class=\"se-preset-select\"><option value=\"\">(unsaved)</option></select>';\n  html += '<div class=\"se-btn se-action se-small\" id=\"se-preset-load\">Load</div>';\n  html += '</div>';\n  html += '<div class=\"se-preset-row\" style=\"margin-top:4px\">';\n  html += '<div class=\"se-btn se-action se-save se-small\" id=\"se-preset-save\">Save Preset</div>';\n  html += '<div class=\"se-btn se-action se-del se-small\" id=\"se-preset-delete\">Delete</div>';\n  html += '</div>';\n  html += '</div>';\n\n  // Obstacles section\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Obstacles</div>';\n  html += '<div id=\"se-obstacle-list\" class=\"se-item-list\"></div>';\n  html += '<div class=\"se-btn se-action se-add\" id=\"se-add-obstacle\">+ Add Obstacle</div>';\n  html += '</div>';\n\n  // Pits section\n  html += '<div class=\"se-section\">';\n  html += '<div class=\"se-group-label\">Pits</div>';\n  html += '<div id=\"se-pit-list\" class=\"se-item-list\"></div>';\n  html += '<div class=\"se-btn se-action se-add\" id=\"se-add-pit\">+ Add Pit</div>';\n  html += '</div>';\n\n  // Selected object properties\n  html += '<div class=\"se-section\" id=\"se-level-props\" style=\"display:none\">';\n  html += '<div class=\"se-group-label\" id=\"se-level-props-label\">Properties</div>';\n  html += '<div id=\"se-level-props-body\"></div>';\n  html += '</div>';\n\n  // Level actions\n  html += '<div class=\"se-section se-actions\">';\n  html += '<div class=\"se-btn se-action se-save\" id=\"se-save-arena\">Save Arena</div>';\n  html += '<div class=\"se-btn se-action\" id=\"se-copy-arena\">Copy Arena Config</div>';\n  html += '</div>';\n\n  html += '</div>'; // end se-level-content\n\n  panel.innerHTML = html;\n  document.body.appendChild(panel);\n\n  // Cache tab content references\n  spawnTabContent = document.getElementById('se-spawn-content');\n  levelTabContent = document.getElementById('se-level-content');\n\n  // Tooltip element\n  const tooltipEl = document.createElement('div');\n  tooltipEl.id = 'se-tooltip';\n  document.body.appendChild(tooltipEl);\n\n  // Wire up events after DOM is created\n  setTimeout(() => wireEvents(), 0);\n}\n\nfunction wireEvents() {\n  // Tab switching\n  panel.querySelectorAll('.se-tab').forEach((tab: any) => {\n    tab.addEventListener('click', () => switchTab(tab.dataset.tab));\n  });\n\n  // Wave navigation\n  document.getElementById('se-wave-prev')!.addEventListener('click', () => {\n    editorState.waveIndex = Math.max(0, editorState.waveIndex - 1);\n    editorState.groupIndex = 0;\n    editorState.selectedSpawnIdx = -1;\n    rebuildMarkers(); refreshUI();\n  });\n  document.getElementById('se-wave-next')!.addEventListener('click', () => {\n    editorState.waveIndex = Math.min(WAVES.length - 1, editorState.waveIndex + 1);\n    editorState.groupIndex = 0;\n    editorState.selectedSpawnIdx = -1;\n    rebuildMarkers(); refreshUI();\n  });\n  document.getElementById('se-wave-add')!.addEventListener('click', () => {\n    const newWave = {\n      wave: WAVES.length + 1,\n      message: `Wave ${WAVES.length + 1}`,\n      groups: [{\n        id: `w${WAVES.length + 1}g1`,\n        triggerDelay: 0,\n        telegraphDuration: 1500,\n        stagger: 200,\n        spawns: [],\n      }],\n    };\n    WAVES.push(newWave);\n    editorState.waveIndex = WAVES.length - 1;\n    editorState.groupIndex = 0;\n    editorState.selectedSpawnIdx = -1;\n    rebuildMarkers(); refreshUI();\n  });\n\n  // Wave message input\n  const waveMsgInput = document.getElementById('se-wave-msg') as any;\n  waveMsgInput.addEventListener('input', () => {\n    const wave = WAVES[editorState.waveIndex];\n    if (wave) wave.message = waveMsgInput.value;\n  });\n  waveMsgInput.addEventListener('keydown', (e: any) => {\n    e.stopPropagation();\n    if (e.key === 'Enter') waveMsgInput.blur();\n  });\n  waveMsgInput.addEventListener('focus', () => waveMsgInput.select());\n\n  // Group navigation\n  document.getElementById('se-group-prev')!.addEventListener('click', () => {\n    editorState.groupIndex = Math.max(0, editorState.groupIndex - 1);\n    editorState.selectedSpawnIdx = -1;\n    rebuildMarkers(); refreshUI();\n  });\n  document.getElementById('se-group-next')!.addEventListener('click', () => {\n    const wave = WAVES[editorState.waveIndex];\n    if (wave) {\n      editorState.groupIndex = Math.min(wave.groups.length - 1, editorState.groupIndex + 1);\n      editorState.selectedSpawnIdx = -1;\n      rebuildMarkers(); refreshUI();\n    }\n  });\n  document.getElementById('se-group-add')!.addEventListener('click', () => {\n    const wave = WAVES[editorState.waveIndex];\n    if (!wave) return;\n    const newGroup = {\n      id: `w${editorState.waveIndex + 1}g${wave.groups.length + 1}`,\n      triggerDelay: 0,\n      telegraphDuration: 1500,\n      stagger: 200,\n      spawns: [],\n    };\n    wave.groups.push(newGroup);\n    editorState.groupIndex = wave.groups.length - 1;\n    rebuildMarkers(); refreshUI();\n  });\n  document.getElementById('se-group-del')!.addEventListener('click', () => {\n    const wave = WAVES[editorState.waveIndex];\n    if (!wave || wave.groups.length <= 1) return; // keep at least 1 group\n    wave.groups.splice(editorState.groupIndex, 1);\n    editorState.groupIndex = Math.min(editorState.groupIndex, wave.groups.length - 1);\n    rebuildMarkers(); refreshUI();\n  });\n\n  // Timing sliders\n  const triggerSlider = document.getElementById('se-trigger') as any;\n  const telegraphSlider = document.getElementById('se-telegraph') as any;\n  const staggerSlider = document.getElementById('se-stagger') as any;\n\n  // Push undo on mousedown (start of drag), not on every input tick\n  const sliderUndoOnce = (slider: any) => {\n    let pushed = false;\n    slider.addEventListener('mousedown', () => { pushUndo(); pushed = true; });\n    slider.addEventListener('touchstart', () => { if (!pushed) pushUndo(); pushed = true; });\n    slider.addEventListener('mouseup', () => { pushed = false; });\n    slider.addEventListener('touchend', () => { pushed = false; });\n  };\n  sliderUndoOnce(triggerSlider);\n  sliderUndoOnce(telegraphSlider);\n  sliderUndoOnce(staggerSlider);\n\n  triggerSlider.addEventListener('input', () => {\n    const group = getCurrentGroup();\n    if (group) group.triggerDelay = parseInt(triggerSlider.value);\n    (document.getElementById('se-trigger-val') as any).value = triggerSlider.value + ' ms';\n  });\n  telegraphSlider.addEventListener('input', () => {\n    const group = getCurrentGroup();\n    if (group) group.telegraphDuration = parseInt(telegraphSlider.value);\n    (document.getElementById('se-telegraph-val') as any).value = telegraphSlider.value + ' ms';\n  });\n  staggerSlider.addEventListener('input', () => {\n    const group = getCurrentGroup();\n    if (group) group.stagger = parseInt(staggerSlider.value);\n    (document.getElementById('se-stagger-val') as any).value = staggerSlider.value + ' ms';\n  });\n\n  // Wire text input handlers for timing sliders\n  const timingInputs = [\n    { inputId: 'se-trigger-val', sliderId: 'se-trigger', prop: 'triggerDelay', min: 0, max: 10000 },\n    { inputId: 'se-telegraph-val', sliderId: 'se-telegraph', prop: 'telegraphDuration', min: 500, max: 5000 },\n    { inputId: 'se-stagger-val', sliderId: 'se-stagger', prop: 'stagger', min: 0, max: 1000 },\n  ];\n  for (const t of timingInputs) {\n    const inp = document.getElementById(t.inputId) as any;\n    const slider = document.getElementById(t.sliderId) as any;\n    const commitTimingValue = () => {\n      const parsed = parseInt(inp.value);\n      if (isNaN(parsed)) {\n        const group = getCurrentGroup();\n        inp.value = (group ? (group as any)[t.prop] : slider.value) + ' ms';\n        return;\n      }\n      const clamped = Math.max(t.min, Math.min(t.max, parsed));\n      const group = getCurrentGroup();\n      if (group) (group as any)[t.prop] = clamped;\n      slider.value = clamped;\n      inp.value = clamped + ' ms';\n    };\n    inp.addEventListener('change', commitTimingValue);\n    inp.addEventListener('blur', commitTimingValue);\n    inp.addEventListener('keydown', (e: any) => {\n      e.stopPropagation();\n      if (e.key === 'Enter') inp.blur();\n    });\n    inp.addEventListener('focus', () => inp.select());\n  }\n\n  // Enemy type picker\n  document.getElementById('se-type-picker')!.addEventListener('click', (e: any) => {\n    const btn = e.target.closest('.se-type-btn');\n    if (btn) {\n      editorState.enemyType = btn.dataset.type;\n      refreshUI();\n    }\n  });\n\n  // Clear group\n  document.getElementById('se-clear')!.addEventListener('click', () => {\n    const group = getCurrentGroup();\n    if (group) {\n      pushUndo();\n      group.spawns = [];\n      rebuildMarkers(); refreshUI();\n    }\n  });\n\n  // Play wave\n  document.getElementById('se-play')!.addEventListener('click', playCurrentWave);\n\n  // Copy wave\n  document.getElementById('se-copy-wave')!.addEventListener('click', () => {\n    const text = buildWaveText(editorState.waveIndex);\n    copyToClipboard(text, document.getElementById('se-copy-wave')!);\n  });\n\n  // Copy all\n  document.getElementById('se-copy-all')!.addEventListener('click', () => {\n    const text = buildAllWavesText();\n    copyToClipboard(text, document.getElementById('se-copy-all')!);\n  });\n\n  // Copy enemy config\n  document.getElementById('se-copy-enemies')!.addEventListener('click', () => {\n    const text = buildEnemyConfigText();\n    copyToClipboard(text, document.getElementById('se-copy-enemies')!);\n  });\n\n  // Tuning section collapse toggle\n  document.getElementById('se-tuning-header')!.addEventListener('click', () => {\n    const body = document.getElementById('se-tuning-body')!;\n    body.classList.toggle('collapsed');\n    const header = document.getElementById('se-tuning-header')!;\n    header.innerHTML = body.classList.contains('collapsed')\n      ? 'Enemy Properties &#x25B6;'\n      : 'Enemy Properties &#x25BC;';\n  });\n\n  // \u2500\u2500\u2500 Preset Events \u2500\u2500\u2500\n  document.getElementById('se-preset-load')!.addEventListener('click', () => {\n    const select = document.getElementById('se-preset-select') as any;\n    if (select.value) loadPreset(select.value);\n  });\n\n  document.getElementById('se-preset-save')!.addEventListener('click', async () => {\n    let name = currentPresetName;\n    if (!name) {\n      name = prompt('Preset name:');\n      if (!name) return;\n    }\n    const btn = document.getElementById('se-preset-save')!;\n    await savePreset(name);\n    const orig = btn.textContent;\n    btn.textContent = 'Saved \\u2713';\n    btn.classList.add('copied');\n    setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 1200);\n  });\n\n  document.getElementById('se-preset-delete')!.addEventListener('click', async () => {\n    const select = document.getElementById('se-preset-select') as any;\n    const name = select.value;\n    if (!name) return;\n    if (!confirm(`Delete preset \"${name}\"?`)) return;\n    await deletePreset(name);\n  });\n\n  // Fetch presets on startup\n  refreshPresetDropdown();\n\n  // \u2500\u2500\u2500 Level Tab Events \u2500\u2500\u2500\n  document.getElementById('se-add-obstacle')!.addEventListener('click', () => {\n    pushUndo();\n    OBSTACLES.push({ x: 0, z: 0, w: 2, h: 1.5, d: 2 });\n    levelState.selectedType = 'obstacle';\n    levelState.selectedIdx = OBSTACLES.length - 1;\n    onArenaChanged();\n    rebuildLevelMarkers();\n    refreshUI();\n  });\n\n  document.getElementById('se-add-pit')!.addEventListener('click', () => {\n    pushUndo();\n    PITS.push({ x: 0, z: 0, w: 3, d: 3 });\n    levelState.selectedType = 'pit';\n    levelState.selectedIdx = PITS.length - 1;\n    onArenaChanged();\n    rebuildLevelMarkers();\n    refreshUI();\n  });\n\n  document.getElementById('se-copy-arena')!.addEventListener('click', () => {\n    const text = buildArenaConfigText();\n    copyToClipboard(text, document.getElementById('se-copy-arena')!);\n  });\n\n  // Save buttons\n  document.getElementById('se-save-spawns')!.addEventListener('click', async () => {\n    const btn = document.getElementById('se-save-spawns')!;\n    const wavesText = buildAllWavesText();\n    const enemiesText = buildEnemyConfigText();\n    await saveToFile('config/waves.js', wavesText, btn);\n    // Save enemies too (reuse same button \u2014 brief delay so \"Saved\" shows for waves)\n    await saveToFile('config/enemies.js', enemiesText, btn);\n  });\n\n  document.getElementById('se-save-arena')!.addEventListener('click', () => {\n    const text = buildArenaConfigText();\n    saveToFile('config/arena.js', text, document.getElementById('se-save-arena')!);\n  });\n\n  // Prevent right-click context menu on canvas\n  window.addEventListener('contextmenu', (e: any) => {\n    if (active) e.preventDefault();\n  });\n\n  // Custom tooltip on hover \u2014 replaces native title for has-tooltip elements\n  const tooltipEl = document.getElementById('se-tooltip')!;\n  let tooltipTarget: any = null;\n\n  panel.addEventListener('mouseover', (e: any) => {\n    const el = e.target.closest('.has-tooltip');\n    if (el && el.getAttribute('data-tip')) {\n      tooltipTarget = el;\n      tooltipEl.textContent = el.getAttribute('data-tip');\n      tooltipEl.classList.add('visible');\n      positionTooltip(el);\n    }\n  });\n\n  panel.addEventListener('mouseout', (e: any) => {\n    const el = e.target.closest('.has-tooltip');\n    if (el === tooltipTarget) {\n      tooltipTarget = null;\n      tooltipEl.classList.remove('visible');\n    }\n  });\n\n  function positionTooltip(targetEl: any) {\n    const rect = targetEl.getBoundingClientRect();\n    const tipRect = tooltipEl.getBoundingClientRect();\n    // Position to the right of the label, vertically centered\n    let left = rect.right + 8;\n    let top = rect.top + rect.height / 2 - tipRect.height / 2;\n    // If it goes off-screen right, show below instead\n    if (left + 200 > window.innerWidth) {\n      left = rect.left;\n      top = rect.bottom + 6;\n    }\n    // Clamp to viewport\n    top = Math.max(4, Math.min(window.innerHeight - tipRect.height - 4, top));\n    tooltipEl.style.left = left + 'px';\n    tooltipEl.style.top = top + 'px';\n  }\n\n  // Cache DOM refs\n  waveLabel = document.getElementById('se-wave-label');\n  groupLabel = document.getElementById('se-group-label');\n  spawnCountLabel = document.getElementById('se-spawn-count');\n}\n\nfunction getCurrentGroup() {\n  const wave = WAVES[editorState.waveIndex];\n  if (!wave) return null;\n  return wave.groups[editorState.groupIndex] || null;\n}\n\nfunction refreshUI() {\n  if (currentTab === 'spawn') {\n    refreshSpawnUI();\n  } else {\n    refreshLevelUI();\n  }\n}\n\nfunction refreshSpawnUI() {\n  const wave = WAVES[editorState.waveIndex];\n\n  // Wave label\n  if (waveLabel) waveLabel.textContent = wave ? wave.wave : '?';\n\n  // Wave message\n  const waveMsgInput = document.getElementById('se-wave-msg') as any;\n  if (waveMsgInput) waveMsgInput.value = wave ? (wave.message || '') : '';\n\n  // Group label\n  const group = getCurrentGroup();\n  if (groupLabel) groupLabel.textContent = group ? group.id : '?';\n\n  // Spawn count\n  if (spawnCountLabel) spawnCountLabel.textContent = group ? group.spawns.length : 0;\n\n  // Timing sliders\n  const triggerSlider = document.getElementById('se-trigger') as any;\n  const telegraphSlider = document.getElementById('se-telegraph') as any;\n  const staggerSlider = document.getElementById('se-stagger') as any;\n  if (group && triggerSlider) {\n    triggerSlider.value = group.triggerDelay;\n    (document.getElementById('se-trigger-val') as any).value = group.triggerDelay + ' ms';\n    telegraphSlider.value = group.telegraphDuration;\n    (document.getElementById('se-telegraph-val') as any).value = group.telegraphDuration + ' ms';\n    staggerSlider.value = group.stagger;\n    (document.getElementById('se-stagger-val') as any).value = group.stagger + ' ms';\n  }\n\n  // Enemy type buttons\n  const btns = document.querySelectorAll('.se-type-btn');\n  btns.forEach((btn: any) => {\n    btn.classList.toggle('selected', btn.dataset.type === editorState.enemyType);\n  });\n\n  // Selected spawn info\n  const infoEl = document.getElementById('se-selected-info') as any;\n  if (infoEl) {\n    if (editorState.selectedSpawnIdx >= 0 && group && group.spawns[editorState.selectedSpawnIdx]) {\n      const s = group.spawns[editorState.selectedSpawnIdx];\n      const typeName = (ENEMY_TYPES as any)[s.type] ? (ENEMY_TYPES as any)[s.type].name : s.type;\n      infoEl.textContent = `Selected: ${typeName} (${s.x}, ${s.z})`;\n      infoEl.style.display = 'block';\n    } else {\n      infoEl.style.display = 'none';\n    }\n  }\n\n  // Per-enemy tuning sliders (rebuild only when type changes)\n  rebuildEnemyTuningSliders();\n}\n\nfunction refreshLevelUI() {\n  // Rebuild obstacle list\n  const obsList = document.getElementById('se-obstacle-list');\n  if (obsList) {\n    let html = '';\n    for (let i = 0; i < OBSTACLES.length; i++) {\n      const o = OBSTACLES[i];\n      const sel = levelState.selectedType === 'obstacle' && levelState.selectedIdx === i;\n      html += `<div class=\"se-item-row${sel ? ' selected' : ''}\" data-type=\"obstacle\" data-idx=\"${i}\">`;\n      html += `<span class=\"se-item-label\">Obs ${i + 1}</span>`;\n      html += `<span class=\"se-item-coords\">(${o.x}, ${o.z})</span>`;\n      html += `<span class=\"se-item-dims\">${o.w}\\u00d7${o.d}\\u00d7${o.h}</span>`;\n      html += '</div>';\n    }\n    obsList.innerHTML = html;\n\n    // Click handlers for list items\n    obsList.querySelectorAll('.se-item-row').forEach((row: any) => {\n      row.addEventListener('click', () => {\n        levelState.selectedType = row.dataset.type;\n        levelState.selectedIdx = parseInt(row.dataset.idx);\n        rebuildLevelMarkers();\n        refreshLevelUI();\n      });\n    });\n  }\n\n  // Rebuild pit list\n  const pitList = document.getElementById('se-pit-list');\n  if (pitList) {\n    let html = '';\n    for (let i = 0; i < PITS.length; i++) {\n      const p = PITS[i];\n      const sel = levelState.selectedType === 'pit' && levelState.selectedIdx === i;\n      html += `<div class=\"se-item-row${sel ? ' selected' : ''}\" data-type=\"pit\" data-idx=\"${i}\">`;\n      html += `<span class=\"se-item-label\">Pit ${i + 1}</span>`;\n      html += `<span class=\"se-item-coords\">(${p.x}, ${p.z})</span>`;\n      html += `<span class=\"se-item-dims\">${p.w}\\u00d7${p.d}</span>`;\n      html += '</div>';\n    }\n    pitList.innerHTML = html;\n\n    pitList.querySelectorAll('.se-item-row').forEach((row: any) => {\n      row.addEventListener('click', () => {\n        levelState.selectedType = row.dataset.type;\n        levelState.selectedIdx = parseInt(row.dataset.idx);\n        rebuildLevelMarkers();\n        refreshLevelUI();\n      });\n    });\n  }\n\n  // Properties panel for selected object\n  const propsPanel = document.getElementById('se-level-props') as any;\n  const propsLabel = document.getElementById('se-level-props-label') as any;\n  const propsBody = document.getElementById('se-level-props-body') as any;\n\n  if (propsPanel && levelState.selectedType && levelState.selectedIdx >= 0) {\n    const arr = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n    const obj = arr[levelState.selectedIdx] as any;\n    if (!obj) {\n      propsPanel.style.display = 'none';\n      return;\n    }\n\n    propsPanel.style.display = 'block';\n    const label = levelState.selectedType === 'obstacle'\n      ? `Obstacle ${levelState.selectedIdx + 1}`\n      : `Pit ${levelState.selectedIdx + 1}`;\n    propsLabel.textContent = label;\n\n    const sliders = levelState.selectedType === 'obstacle'\n      ? [\n          { label: 'X', key: 'x', min: -19, max: 19, step: 0.5, unit: '' },\n          { label: 'Z', key: 'z', min: -19, max: 19, step: 0.5, unit: '' },\n          { label: 'Width', key: 'w', min: 0.5, max: 10, step: 0.5, unit: 'u' },\n          { label: 'Depth', key: 'd', min: 0.5, max: 10, step: 0.5, unit: 'u' },\n          { label: 'Height', key: 'h', min: 0.5, max: 5, step: 0.5, unit: 'u' },\n        ]\n      : [\n          { label: 'X', key: 'x', min: -19, max: 19, step: 0.5, unit: '' },\n          { label: 'Z', key: 'z', min: -19, max: 19, step: 0.5, unit: '' },\n          { label: 'Width', key: 'w', min: 1, max: 10, step: 0.5, unit: 'u' },\n          { label: 'Depth', key: 'd', min: 1, max: 10, step: 0.5, unit: 'u' },\n        ];\n\n    let html = '';\n    for (const s of sliders) {\n      const val = obj[s.key];\n      const display = Number.isInteger(val) ? val : parseFloat(val).toFixed(1);\n      const unitDisplay = s.unit ? ' ' + s.unit : '';\n      html += `<div class=\"se-slider-row\">`;\n      html += `<span>${s.label}</span>`;\n      html += `<input type=\"range\" class=\"se-level-slider\" data-key=\"${s.key}\" min=\"${s.min}\" max=\"${s.max}\" step=\"${s.step}\" value=\"${val}\">`;\n      html += `<input type=\"text\" class=\"se-level-val\" data-key=\"${s.key}\" value=\"${display}${unitDisplay}\">`;\n      html += `</div>`;\n    }\n\n    // Delete button\n    html += `<div class=\"se-btn se-action se-del\" id=\"se-delete-level-obj\">Delete ${levelState.selectedType === 'obstacle' ? 'Obstacle' : 'Pit'}</div>`;\n\n    propsBody.innerHTML = html;\n\n    // Wire slider events\n    propsBody.querySelectorAll('.se-level-slider').forEach((el: any) => {\n      const key = el.dataset.key;\n      const sdef = sliders.find((s: any) => s.key === key)!;\n      el.addEventListener('input', () => {\n        const newVal = parseFloat(el.value);\n        const arrRef = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n        const objRef = arrRef[levelState.selectedIdx] as any;\n        if (!objRef) return;\n        objRef[key] = newVal;\n        const unitDisplay = sdef.unit ? ' ' + sdef.unit : '';\n        const display = Number.isInteger(newVal) ? newVal : parseFloat(newVal as any).toFixed(1);\n        propsBody.querySelector(`.se-level-val[data-key=\"${key}\"]`).value = display + unitDisplay;\n        onArenaChanged();\n        rebuildLevelMarkers();\n      });\n\n      // Undo on first mousedown\n      let pushed = false;\n      el.addEventListener('mousedown', () => { pushUndo(); pushed = true; });\n      el.addEventListener('mouseup', () => { pushed = false; });\n    });\n\n    // Wire text input handlers\n    propsBody.querySelectorAll('.se-level-val').forEach((inp: any) => {\n      const key = inp.dataset.key;\n      const sdef = sliders.find((s: any) => s.key === key)!;\n      const commitValue = () => {\n        const parsed = parseFloat(inp.value);\n        if (isNaN(parsed)) {\n          const arrRef = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n          const objRef = arrRef[levelState.selectedIdx] as any;\n          if (objRef) {\n            const val = objRef[key];\n            const unitDisplay = sdef.unit ? ' ' + sdef.unit : '';\n            inp.value = (Number.isInteger(val) ? val : parseFloat(val).toFixed(1)) + unitDisplay;\n          }\n          return;\n        }\n        const clamped = Math.max(sdef.min, Math.min(sdef.max, parsed));\n        const arrRef = levelState.selectedType === 'obstacle' ? OBSTACLES : PITS;\n        const objRef = arrRef[levelState.selectedIdx] as any;\n        if (!objRef) return;\n        pushUndo();\n        objRef[key] = clamped;\n        const rangeEl = propsBody.querySelector(`.se-level-slider[data-key=\"${key}\"]`);\n        if (rangeEl) rangeEl.value = clamped;\n        const unitDisplay = sdef.unit ? ' ' + sdef.unit : '';\n        inp.value = (Number.isInteger(clamped) ? clamped : parseFloat(clamped as any).toFixed(1)) + unitDisplay;\n        onArenaChanged();\n        rebuildLevelMarkers();\n      };\n      inp.addEventListener('change', commitValue);\n      inp.addEventListener('blur', commitValue);\n      inp.addEventListener('keydown', (e: any) => {\n        e.stopPropagation();\n        if (e.key === 'Enter') inp.blur();\n      });\n      inp.addEventListener('focus', () => inp.select());\n    });\n\n    // Delete button\n    const deleteBtn = document.getElementById('se-delete-level-obj');\n    if (deleteBtn) {\n      deleteBtn.addEventListener('click', () => {\n        pushUndo();\n        if (levelState.selectedType === 'obstacle') {\n          OBSTACLES.splice(levelState.selectedIdx, 1);\n        } else {\n          PITS.splice(levelState.selectedIdx, 1);\n        }\n        levelState.selectedType = null;\n        levelState.selectedIdx = -1;\n        onArenaChanged();\n        rebuildLevelMarkers();\n        refreshLevelUI();\n      });\n    }\n  } else if (propsPanel) {\n    propsPanel.style.display = 'none';\n  }\n}\n\n// \u2500\u2500\u2500 Per-Enemy Tuning Sliders \u2500\u2500\u2500\n\nfunction rebuildEnemyTuningSliders() {\n  const container = document.getElementById('se-tuning-body');\n  if (!container) return;\n\n  // Only rebuild if type changed\n  if (lastBuiltTuningType === editorState.enemyType) {\n    // Just update values without rebuilding DOM\n    updateTuningSliderValues();\n    return;\n  }\n  lastBuiltTuningType = editorState.enemyType;\n\n  const sliders = ENEMY_TUNING_SLIDERS[editorState.enemyType];\n  if (!sliders) {\n    container.innerHTML = '<div style=\"color:rgba(255,255,255,0.3);font-size:9px;padding:4px;\">No tuning available</div>';\n    return;\n  }\n\n  const cfg = (ENEMY_TYPES as any)[editorState.enemyType];\n  let html = '';\n  for (let i = 0; i < sliders.length; i++) {\n    const s = sliders[i];\n    const val = getNestedValue(cfg, s.key);\n    const displayVal = (val != null) ? (Number.isInteger(s.step) ? val : parseFloat(val).toFixed(2)) : '?';\n    const unitStr = s.unit || s.suffix || '';\n    const unitDisplay = unitStr ? ' ' + unitStr : '';\n    const tipAttr = s.tip ? ` data-tip=\"${s.tip.replace(/\"/g, '&quot;')}\"` : '';\n    const tipClass = s.tip ? ' has-tooltip' : '';\n    html += `<div class=\"se-slider-row\">`;\n    html += `<span class=\"${tipClass}\"${tipAttr}>${s.label}</span>`;\n    html += `<input type=\"range\" class=\"se-tuning-slider\" data-idx=\"${i}\" min=\"${s.min}\" max=\"${s.max}\" step=\"${s.step}\" value=\"${val != null ? val : s.min}\">`;\n    html += `<input type=\"text\" class=\"se-tuning-val\" data-idx=\"${i}\" value=\"${displayVal}${unitDisplay}\">`;\n    html += `</div>`;\n  }\n  container.innerHTML = html;\n\n  // Wire slider events\n  const sliderEls = container.querySelectorAll('.se-tuning-slider');\n  sliderEls.forEach((el: any) => {\n    const idx = parseInt(el.dataset.idx);\n    const s = sliders[idx];\n\n    el.addEventListener('input', () => {\n      const newVal = parseFloat(el.value);\n      setNestedValue((ENEMY_TYPES as any)[editorState.enemyType], s.key, newVal);\n      const unitStr = s.unit || s.suffix || '';\n      const unitDisplay = unitStr ? ' ' + unitStr : '';\n      const display = Number.isInteger(s.step) ? newVal : parseFloat(newVal as any).toFixed(2);\n      container.querySelector(`.se-tuning-val[data-idx=\"${idx}\"]`)!.setAttribute('value', display + unitDisplay);\n      (container.querySelector(`.se-tuning-val[data-idx=\"${idx}\"]`) as any).value = display + unitDisplay;\n    });\n  });\n\n  // Wire text input handlers for direct value entry\n  const valInputs = container.querySelectorAll('.se-tuning-val');\n  valInputs.forEach((inp: any) => {\n    const idx = parseInt(inp.dataset.idx);\n    const s = sliders[idx];\n\n    const commitValue = () => {\n      const parsed = parseFloat(inp.value);\n      if (isNaN(parsed)) {\n        // Revert to current config value\n        const cur = getNestedValue((ENEMY_TYPES as any)[editorState.enemyType], s.key);\n        const unitStr = s.unit || s.suffix || '';\n        const unitDisplay = unitStr ? ' ' + unitStr : '';\n        const display = (cur != null) ? (Number.isInteger(s.step) ? cur : parseFloat(cur).toFixed(2)) : s.min;\n        inp.value = display + unitDisplay;\n        return;\n      }\n      const clamped = Math.max(s.min, Math.min(s.max, parsed));\n      setNestedValue((ENEMY_TYPES as any)[editorState.enemyType], s.key, clamped);\n      // Sync range slider\n      const rangeEl = container.querySelector(`.se-tuning-slider[data-idx=\"${idx}\"]`) as any;\n      if (rangeEl) rangeEl.value = clamped;\n      // Re-format display\n      const unitStr = s.unit || s.suffix || '';\n      const unitDisplay = unitStr ? ' ' + unitStr : '';\n      const display = Number.isInteger(s.step) ? clamped : parseFloat(clamped as any).toFixed(2);\n      inp.value = display + unitDisplay;\n    };\n\n    inp.addEventListener('change', commitValue);\n    inp.addEventListener('blur', commitValue);\n\n    // Stop keyboard events from reaching the game while typing in inputs\n    inp.addEventListener('keydown', (e: any) => {\n      e.stopPropagation();\n      if (e.key === 'Enter') inp.blur();\n    });\n\n    // Select all text on focus for easy overwriting\n    inp.addEventListener('focus', () => inp.select());\n  });\n}\n\nfunction updateTuningSliderValues() {\n  const container = document.getElementById('se-tuning-body');\n  if (!container) return;\n  const sliders = ENEMY_TUNING_SLIDERS[editorState.enemyType];\n  if (!sliders) return;\n  const cfg = (ENEMY_TYPES as any)[editorState.enemyType];\n\n  const sliderEls = container.querySelectorAll('.se-tuning-slider');\n  sliderEls.forEach((el: any) => {\n    const idx = parseInt(el.dataset.idx);\n    const s = sliders[idx];\n    if (!s) return;\n    const val = getNestedValue(cfg, s.key);\n    if (val != null) {\n      el.value = val;\n      const unitStr = s.unit || s.suffix || '';\n      const unitDisplay = unitStr ? ' ' + unitStr : '';\n      const display = Number.isInteger(s.step) ? val : parseFloat(val).toFixed(2);\n      (container.querySelector(`.se-tuning-val[data-idx=\"${idx}\"]`) as any).value = display + unitDisplay;\n    }\n  });\n}\n\nfunction buildEnemyConfigText() {\n  let text = 'export const ENEMY_TYPES = {\\n';\n  for (const [name, cfg] of Object.entries(ENEMY_TYPES)) {\n    text += `  ${name}: ${JSON.stringify(cfg, null, 4).split('\\n').map((l: string, i: number) => i === 0 ? l : '  ' + l).join('\\n')},\\n`;\n  }\n  text += '};\\n';\n  return text;\n}\n\nfunction buildArenaConfigText() {\n  let text = '// Arena layout \u2014 shared between renderer (meshes) and physics (collision)\\n';\n  text += '// All obstacles and walls defined here so designer can rearrange the arena\\n\\n';\n  text += `export const ARENA_HALF = ${ARENA_HALF};\\n\\n`;\n  text += '// Obstacles: x, z = center position; w, d = width/depth on xz plane; h = height (visual only)\\n';\n  text += 'export const OBSTACLES = [\\n';\n  for (const o of OBSTACLES) {\n    text += `  { x: ${o.x}, z: ${o.z}, w: ${o.w}, h: ${o.h}, d: ${o.d} },\\n`;\n  }\n  text += '];\\n\\n';\n  text += '// Walls: auto-generated from ARENA_HALF\\n';\n  text += 'export const WALL_THICKNESS = 0.5;\\n';\n  text += 'export const WALL_HEIGHT = 2;\\n\\n';\n  text += '// Pits: x, z = center position; w, d = width/depth on xz plane\\n';\n  text += '// Entities that enter a pit die instantly. Enemies edge-slide around them.\\n';\n  text += 'export const PITS = [\\n';\n  for (const p of PITS) {\n    text += `  { x: ${p.x}, z: ${p.z}, w: ${p.w}, d: ${p.d} },\\n`;\n  }\n  text += '];\\n';\n  // Static helper functions \u2014 appended verbatim\n  text += ARENA_STATIC_SUFFIX;\n  return text;\n}\n\n// Static portion of arena.js (helper functions that don't change)\nconst ARENA_STATIC_SUFFIX = `\n// Convert pits to AABB format for collision\nexport function getPitBounds() {\n  return PITS.map(p => ({\n    minX: p.x - p.w / 2,\n    maxX: p.x + p.w / 2,\n    minZ: p.z - p.d / 2,\n    maxZ: p.z + p.d / 2,\n  }));\n}\n\n// Pre-computed AABB list for collision (obstacles + walls)\n// Each entry: { minX, maxX, minZ, maxZ }\nexport function getCollisionBounds() {\n  const bounds = [];\n\n  // Obstacles\n  for (const o of OBSTACLES) {\n    bounds.push({\n      minX: o.x - o.w / 2,\n      maxX: o.x + o.w / 2,\n      minZ: o.z - o.d / 2,\n      maxZ: o.z + o.d / 2,\n    });\n  }\n\n  // Walls\n  const h = ARENA_HALF;\n  const t = WALL_THICKNESS;\n  // North wall\n  bounds.push({ minX: -h - t/2, maxX: h + t/2, minZ: h - t/2, maxZ: h + t/2 });\n  // South wall\n  bounds.push({ minX: -h - t/2, maxX: h + t/2, minZ: -h - t/2, maxZ: -h + t/2 });\n  // East wall\n  bounds.push({ minX: h - t/2, maxX: h + t/2, minZ: -h - t/2, maxZ: h + t/2 });\n  // West wall\n  bounds.push({ minX: -h - t/2, maxX: -h + t/2, minZ: -h - t/2, maxZ: h + t/2 });\n\n  return bounds;\n}\n`;\n\n// \u2500\u2500\u2500 Play Wave \u2500\u2500\u2500\n\nfunction playCurrentWave() {\n  exitEditor();\n  // Clear enemies and projectiles, then start the wave\n  clearEnemies(gameStateRef);\n  releaseAllProjectiles();\n  resetWaveRunner();\n  gameStateRef.phase = 'playing';\n  startWave(editorState.waveIndex, gameStateRef);\n}\n\n// \u2500\u2500\u2500 Save to File (via dev server) \u2500\u2500\u2500\n\nasync function saveToFile(filename: string, content: string, btnEl: any) {\n  const orig = btnEl.textContent;\n  btnEl.textContent = 'Saving...';\n  try {\n    const res = await fetch('/save', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ file: filename, content }),\n    });\n    if (!res.ok) throw new Error(res.statusText);\n    btnEl.textContent = 'Saved \\u2713';\n    btnEl.classList.add('copied');\n  } catch (e) {\n    btnEl.textContent = 'Error!';\n    console.error('[spawnEditor] Save failed:', filename, e);\n  }\n  setTimeout(() => { btnEl.textContent = orig; btnEl.classList.remove('copied'); }, 1200);\n}\n\n// \u2500\u2500\u2500 Copy to Clipboard \u2500\u2500\u2500\n\nfunction copyToClipboard(text: string, btnEl: any) {\n  navigator.clipboard.writeText(text).then(() => {\n    const orig = btnEl.textContent;\n    btnEl.textContent = 'Copied!';\n\n    btnEl.classList.add('copied');\n    setTimeout(() => {\n      btnEl.textContent = orig;\n      btnEl.classList.remove('copied');\n    }, 1200);\n  });\n}\n\nfunction buildWaveText(waveIdx: number) {\n  const wave = WAVES[waveIdx];\n  if (!wave) return '';\n  return formatWaveObj(wave);\n}\n\nfunction buildAllWavesText() {\n  const lines = [\n    '// Wave definitions \u2014 each wave has groups of spawns with independent timing',\n    '// Designer edits this file or uses the spawn editor (backtick key) to place visually',\n    '',\n    'export const WAVES = [',\n  ];\n  for (let i = 0; i < WAVES.length; i++) {\n    lines.push('  ' + formatWaveObj(WAVES[i]).split('\\n').join('\\n  ') + ',');\n  }\n  lines.push('];');\n  lines.push('');\n  return lines.join('\\n');\n}\n\nfunction formatWaveObj(wave: any) {\n  let s = '{\\n';\n  s += `  wave: ${wave.wave},\\n`;\n  s += `  message: '${wave.message}',\\n`;\n  s += `  groups: [\\n`;\n  for (const g of wave.groups) {\n    s += `    {\\n`;\n    s += `      id: '${g.id}',\\n`;\n    s += `      triggerDelay: ${g.triggerDelay},\\n`;\n    s += `      telegraphDuration: ${g.telegraphDuration},\\n`;\n    s += `      stagger: ${g.stagger},\\n`;\n    s += `      spawns: [\\n`;\n    for (const sp of g.spawns) {\n      s += `        { type: '${sp.type}', x: ${sp.x}, z: ${sp.z} },\\n`;\n    }\n    s += `      ],\\n`;\n    s += `    },\\n`;\n  }\n  s += `  ]\\n`;\n  s += `}`;\n  return s;\n}\n\n// \u2500\u2500\u2500 Styles \u2500\u2500\u2500\n\nfunction injectStyles() {\n  const style = document.createElement('style');\n  style.textContent = `\n    #spawn-editor {\n      position: fixed;\n      top: 60px;\n      left: 20px;\n      width: 320px;\n      max-height: calc(100vh - 80px);\n      overflow-y: auto;\n      z-index: 200;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      pointer-events: all;\n      background: rgba(10, 10, 26, 0.94);\n      border: 1px solid rgba(68, 255, 136, 0.2);\n      border-radius: 6px;\n      padding: 14px;\n      backdrop-filter: blur(8px);\n    }\n\n    #spawn-editor.hidden {\n      display: none;\n    }\n\n    #spawn-editor::-webkit-scrollbar {\n      width: 4px;\n    }\n    #spawn-editor::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.2);\n    }\n    #spawn-editor::-webkit-scrollbar-thumb {\n      background: rgba(68, 255, 136, 0.3);\n      border-radius: 2px;\n    }\n\n    /* \u2500\u2500\u2500 Tabs \u2500\u2500\u2500 */\n    .se-tabs {\n      display: flex;\n      gap: 2px;\n      margin-bottom: 12px;\n      border-bottom: 1px solid rgba(68, 255, 136, 0.15);\n      padding-bottom: 0;\n    }\n\n    .se-tab {\n      flex: 1;\n      text-align: center;\n      padding: 6px 0;\n      font-size: 10px;\n      letter-spacing: 2px;\n      text-transform: uppercase;\n      color: rgba(255, 255, 255, 0.4);\n      cursor: pointer;\n      user-select: none;\n      border-bottom: 2px solid transparent;\n      transition: all 0.15s ease;\n      margin-bottom: -1px;\n    }\n\n    .se-tab:hover {\n      color: rgba(255, 255, 255, 0.7);\n    }\n\n    .se-tab.active {\n      color: rgba(68, 255, 136, 0.9);\n      border-bottom-color: rgba(68, 255, 136, 0.8);\n    }\n\n    .se-title {\n      font-size: 10px;\n      color: rgba(68, 255, 136, 0.8);\n      letter-spacing: 2px;\n      text-transform: uppercase;\n      margin-bottom: 12px;\n      padding-bottom: 4px;\n      border-bottom: 1px solid rgba(68, 255, 136, 0.15);\n    }\n\n    .se-section {\n      margin-bottom: 10px;\n    }\n\n    .se-group-label {\n      font-size: 9px;\n      color: rgba(68, 255, 136, 0.5);\n      letter-spacing: 1.5px;\n      text-transform: uppercase;\n      margin-bottom: 5px;\n    }\n\n    .se-wave-msg {\n      width: 100%;\n      margin-top: 6px;\n      background: rgba(255, 255, 255, 0.03);\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      border-radius: 3px;\n      color: rgba(255, 255, 255, 0.8);\n      font-size: 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      padding: 4px 6px;\n      outline: none;\n      box-sizing: border-box;\n    }\n    .se-wave-msg:hover {\n      border-color: rgba(255, 255, 255, 0.2);\n    }\n    .se-wave-msg:focus {\n      border-color: rgba(68, 255, 136, 0.5);\n      background: rgba(0, 0, 0, 0.3);\n    }\n\n    .se-selector {\n      display: flex;\n      align-items: center;\n      gap: 6px;\n    }\n\n    .se-selector span {\n      font-size: 13px;\n      color: rgba(255, 255, 255, 0.8);\n      min-width: 30px;\n      text-align: center;\n    }\n\n    .se-btn {\n      padding: 3px 8px;\n      font-size: 11px;\n      color: rgba(255, 255, 255, 0.6);\n      background: rgba(255, 255, 255, 0.05);\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 3px;\n      cursor: pointer;\n      user-select: none;\n      transition: all 0.12s ease;\n    }\n\n    .se-btn:hover {\n      background: rgba(68, 255, 136, 0.1);\n      border-color: rgba(68, 255, 136, 0.4);\n      color: rgba(255, 255, 255, 0.9);\n    }\n\n    .se-btn.se-add {\n      color: rgba(68, 255, 136, 0.7);\n    }\n\n    .se-btn.se-del {\n      color: rgba(255, 68, 102, 0.7);\n    }\n    .se-btn.se-del:hover {\n      background: rgba(255, 68, 102, 0.1);\n      border-color: rgba(255, 68, 102, 0.4);\n    }\n\n    .se-slider-row {\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      margin-bottom: 5px;\n    }\n\n    .se-slider-row span:first-child {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.5);\n      width: 75px;\n      flex-shrink: 0;\n    }\n\n    .se-slider-row span.has-tooltip {\n      cursor: help;\n      text-decoration: underline dotted rgba(255, 255, 255, 0.2);\n      text-underline-offset: 2px;\n    }\n\n    .se-slider-row input[type=\"range\"] {\n      flex: 1;\n      height: 4px;\n      -webkit-appearance: none;\n      appearance: none;\n      background: rgba(100, 100, 160, 0.3);\n      border-radius: 2px;\n      outline: none;\n      cursor: pointer;\n    }\n\n    .se-slider-row input[type=\"range\"]::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background: #44ff88;\n      cursor: pointer;\n      border: none;\n    }\n\n    .se-slider-row span:last-child {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.7);\n      min-width: 55px;\n      text-align: right;\n      flex-shrink: 0;\n    }\n\n    .se-slider-row input[type=\"text\"] {\n      background: transparent;\n      border: 1px solid transparent;\n      border-radius: 3px;\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      min-width: 55px;\n      max-width: 65px;\n      text-align: right;\n      padding: 1px 4px;\n      flex-shrink: 0;\n      outline: none;\n    }\n    .se-slider-row input[type=\"text\"]:hover {\n      border-color: rgba(255, 255, 255, 0.15);\n    }\n    .se-slider-row input[type=\"text\"]:focus {\n      border-color: rgba(68, 255, 136, 0.5);\n      color: rgba(255, 255, 255, 0.9);\n      background: rgba(0, 0, 0, 0.3);\n    }\n\n    .se-type-picker {\n      display: flex;\n      gap: 4px;\n      flex-wrap: wrap;\n    }\n\n    .se-type-btn {\n      padding: 4px 8px;\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.5);\n      background: rgba(255, 255, 255, 0.03);\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 3px;\n      cursor: pointer;\n      user-select: none;\n      transition: all 0.12s ease;\n    }\n\n    .se-type-btn:hover {\n      opacity: 1;\n      color: rgba(255, 255, 255, 0.9);\n    }\n\n    .se-type-btn.selected {\n      color: #fff;\n      background: rgba(255, 255, 255, 0.1);\n      border-width: 2px;\n      opacity: 1;\n    }\n\n    .se-collapsible {\n      cursor: pointer;\n      user-select: none;\n    }\n    .se-collapsible:hover {\n      color: rgba(68, 255, 136, 0.8);\n    }\n\n    #se-tuning-body {\n      max-height: 300px;\n      overflow-y: auto;\n      transition: max-height 0.2s ease;\n    }\n    #se-tuning-body.collapsed {\n      max-height: 0;\n      overflow: hidden;\n    }\n    #se-tuning-body::-webkit-scrollbar {\n      width: 4px;\n    }\n    #se-tuning-body::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.2);\n    }\n    #se-tuning-body::-webkit-scrollbar-thumb {\n      background: rgba(68, 255, 136, 0.3);\n      border-radius: 2px;\n    }\n\n    /* .se-tuning-val styling handled by input[type=\"text\"] rule above */\n\n    .se-spawn-count {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.5);\n      margin-bottom: 4px;\n    }\n\n    .se-selected-info {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.8);\n      background: rgba(255, 255, 255, 0.05);\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 3px;\n      padding: 4px 6px;\n      margin-bottom: 6px;\n      display: none;\n    }\n\n    .se-action {\n      margin-top: 4px;\n      text-align: center;\n      padding: 5px 0;\n    }\n\n    .se-actions {\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n    }\n\n    .se-play {\n      color: rgba(68, 255, 136, 0.8) !important;\n      border-color: rgba(68, 255, 136, 0.3) !important;\n    }\n    .se-play:hover {\n      background: rgba(68, 255, 136, 0.12) !important;\n      border-color: rgba(68, 255, 136, 0.6) !important;\n    }\n\n    .se-save {\n      color: rgba(68, 200, 255, 0.8) !important;\n      border-color: rgba(68, 200, 255, 0.3) !important;\n    }\n    .se-save:hover {\n      background: rgba(68, 200, 255, 0.12) !important;\n      border-color: rgba(68, 200, 255, 0.6) !important;\n    }\n\n    .se-btn.copied {\n      color: #ffcc44 !important;\n      border-color: rgba(255, 204, 68, 0.4) !important;\n    }\n\n    /* \u2500\u2500\u2500 Preset Selector \u2500\u2500\u2500 */\n    .se-preset-row {\n      display: flex;\n      gap: 4px;\n      align-items: center;\n    }\n\n    .se-preset-select {\n      flex: 1;\n      background: rgba(255, 255, 255, 0.05);\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 3px;\n      color: rgba(255, 255, 255, 0.8);\n      font-size: 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      padding: 4px 6px;\n      outline: none;\n    }\n\n    .se-preset-select:focus {\n      border-color: rgba(68, 200, 255, 0.5);\n    }\n\n    .se-btn.se-small {\n      font-size: 9px;\n      padding: 3px 8px;\n    }\n\n    /* \u2500\u2500\u2500 Level Tab Item List \u2500\u2500\u2500 */\n    .se-item-list {\n      max-height: 180px;\n      overflow-y: auto;\n      margin-bottom: 6px;\n    }\n\n    .se-item-list::-webkit-scrollbar {\n      width: 4px;\n    }\n    .se-item-list::-webkit-scrollbar-thumb {\n      background: rgba(68, 255, 136, 0.3);\n      border-radius: 2px;\n    }\n\n    .se-item-row {\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      padding: 4px 6px;\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.6);\n      border: 1px solid transparent;\n      border-radius: 3px;\n      cursor: pointer;\n      transition: all 0.1s ease;\n      margin-bottom: 2px;\n    }\n\n    .se-item-row:hover {\n      background: rgba(255, 255, 255, 0.05);\n      border-color: rgba(255, 255, 255, 0.1);\n    }\n\n    .se-item-row.selected {\n      background: rgba(68, 255, 136, 0.08);\n      border-color: rgba(68, 255, 136, 0.3);\n      color: rgba(255, 255, 255, 0.9);\n    }\n\n    .se-item-label {\n      flex-shrink: 0;\n      width: 50px;\n    }\n\n    .se-item-coords {\n      color: rgba(255, 255, 255, 0.4);\n      flex: 1;\n    }\n\n    .se-item-dims {\n      color: rgba(100, 180, 255, 0.6);\n      flex-shrink: 0;\n    }\n\n    #se-tooltip {\n      position: fixed;\n      z-index: 300;\n      max-width: 220px;\n      padding: 6px 10px;\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      font-size: 10px;\n      line-height: 1.4;\n      color: rgba(255, 255, 255, 0.9);\n      background: rgba(10, 10, 30, 0.95);\n      border: 1px solid rgba(68, 255, 136, 0.4);\n      border-radius: 4px;\n      pointer-events: none;\n      opacity: 0;\n      transition: opacity 0.12s ease;\n      backdrop-filter: blur(6px);\n    }\n\n    #se-tooltip.visible {\n      opacity: 1;\n    }\n\n    #editor-banner {\n      position: fixed;\n      top: 8px;\n      left: 50%;\n      transform: translateX(-50%);\n      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;\n      font-size: 11px;\n      letter-spacing: 2px;\n      text-transform: uppercase;\n      color: rgba(68, 255, 136, 0.8);\n      background: rgba(10, 10, 26, 0.85);\n      border: 1px solid rgba(68, 255, 136, 0.3);\n      border-radius: 4px;\n      padding: 5px 16px;\n      z-index: 250;\n      pointer-events: none;\n      opacity: 0;\n      transition: opacity 0.2s ease;\n    }\n\n    #editor-banner.visible {\n      opacity: 1;\n    }\n  `;\n  document.head.appendChild(style);\n}\n", "import { initRenderer, updateCamera, getScene, getRendererInstance, getCamera } from './renderer';\nimport { initInput, updateInput, consumeInput, getInputState, autoAimClosestEnemy } from './input';\nimport { createPlayer, updatePlayer, getPlayerPos, resetPlayer } from '../entities/player';\nimport { initProjectilePool, updateProjectiles, releaseAllProjectiles } from '../entities/projectile';\nimport { initEnemySystem, updateEnemies, clearEnemies } from '../entities/enemy';\nimport { initMortarSystem, updateMortarProjectiles, clearMortarProjectiles, updateIcePatches, clearIcePatches } from '../entities/mortarProjectile';\nimport { initWaveRunner, updateWaveRunner, startWave, resetWaveRunner } from './waveRunner';\nimport { checkCollisions, checkPitFalls, updateEffectGhosts, clearEffectGhosts } from './physics';\nimport { initAoeTelegraph, updateAoeTelegraphs, updatePendingEffects, clearAoeTelegraphs } from './aoeTelegraph';\nimport { initHUD, updateHUD } from '../ui/hud';\nimport { initScreens, showGameOver, hideScreens } from '../ui/screens';\nimport { initDamageNumbers, updateDamageNumbers, clearDamageNumbers } from '../ui/damageNumbers';\nimport { initTuningPanel } from '../ui/tuning';\nimport { initSpawnEditor, checkEditorToggle, updateSpawnEditor, isEditorActive } from '../ui/spawnEditor';\nimport { PLAYER } from '../config/player';\nimport { applyUrlParams, snapshotDefaults } from './urlParams';\nimport { GameState } from '../types/index';\n\nconst gameState: GameState = {\n  phase: 'waiting',\n  playerHealth: PLAYER.maxHealth,\n  playerMaxHealth: PLAYER.maxHealth,\n  currency: 0,\n  currentWave: 1,\n  enemies: [],\n  abilities: {\n    dash:     { cooldownRemaining: 0 },\n    ultimate: { cooldownRemaining: 0, active: false, activeRemaining: 0, charging: false, chargeT: 0 }\n  }\n};\n\nlet lastTime = 0;\n\nfunction gameLoop(timestamp: number): void {\n  requestAnimationFrame(gameLoop);\n\n  if (gameState.phase === 'waiting') {\n    getRendererInstance().render(getScene(), getCamera());\n    return;\n  }\n\n  if (gameState.phase === 'gameOver') {\n    getRendererInstance().render(getScene(), getCamera());\n    return;\n  }\n\n  if (gameState.phase === 'editorPaused') {\n    updateInput();\n    updateSpawnEditor(0);\n    getRendererInstance().render(getScene(), getCamera());\n    consumeInput();\n    return;\n  }\n\n  let dt = (timestamp - lastTime) / 1000;\n  lastTime = timestamp;\n  dt = Math.min(dt, 0.05);\n\n  if (dt <= 0) return;\n\n  // 1. Input\n  updateInput();\n  autoAimClosestEnemy(gameState.enemies);\n  const input = getInputState();\n\n  // 2. Player\n  updatePlayer(input, dt, gameState);\n\n  // 3. Projectiles\n  updateProjectiles(dt);\n\n  // 4. Wave Runner\n  updateWaveRunner(dt, gameState);\n\n  // 5. Enemies\n  updateEnemies(dt, getPlayerPos(), gameState);\n\n  // 6. Collisions\n  checkCollisions(gameState);\n\n  // 6b. Pit falls\n  checkPitFalls(gameState);\n\n  // 6c. Effect ghosts\n  updateEffectGhosts(dt);\n\n  // 7. AoE telegraphs\n  updateAoeTelegraphs(dt);\n  updatePendingEffects(dt);\n\n  // 8. Mortar projectiles\n  updateMortarProjectiles(dt);\n\n  // 8b. Ice patches\n  updateIcePatches(dt);\n\n  // 9. Check for game over (phase may have changed during collision checks)\n  if ((gameState.phase as string) === 'gameOver') {\n    showGameOver(gameState);\n  }\n\n  // 10. Camera\n  updateCamera(getPlayerPos(), dt);\n\n  // 11. HUD\n  updateHUD(gameState);\n\n  // 12. Check editor toggle\n  checkEditorToggle();\n\n  // 13. Consume edge-triggered inputs\n  consumeInput();\n\n  // 14. Render\n  getRendererInstance().render(getScene(), getCamera());\n\n  // 15. Damage numbers\n  updateDamageNumbers(dt);\n}\n\nfunction restart(): void {\n  gameState.phase = 'playing';\n  gameState.playerHealth = PLAYER.maxHealth;\n  gameState.playerMaxHealth = PLAYER.maxHealth;\n  gameState.currency = 0;\n  gameState.currentWave = 1;\n  gameState.abilities.dash.cooldownRemaining = 0;\n  gameState.abilities.ultimate.cooldownRemaining = 0;\n  gameState.abilities.ultimate.active = false;\n  gameState.abilities.ultimate.activeRemaining = 0;\n  gameState.abilities.ultimate.charging = false;\n  gameState.abilities.ultimate.chargeT = 0;\n\n  clearEnemies(gameState);\n  releaseAllProjectiles();\n  resetPlayer();\n  clearDamageNumbers();\n  clearAoeTelegraphs();\n  clearMortarProjectiles();\n  clearIcePatches();\n  clearEffectGhosts();\n  resetWaveRunner();\n\n  startWave(0, gameState);\n}\n\nfunction init(): void {\n  try {\n    (window as any).__configDefaults = snapshotDefaults();\n    applyUrlParams();\n\n    const { scene } = initRenderer();\n\n    initInput();\n    createPlayer(scene);\n    initProjectilePool(scene);\n    initEnemySystem(scene);\n    initMortarSystem(scene);\n    initAoeTelegraph(scene);\n    initWaveRunner(scene);\n    initHUD();\n    initDamageNumbers();\n    initTuningPanel();\n    initSpawnEditor(scene, gameState);\n    initScreens(restart, () => {\n      gameState.phase = 'playing';\n      document.getElementById('hud')!.style.visibility = 'visible';\n      startWave(0, gameState);\n      lastTime = performance.now();\n    });\n\n    document.getElementById('hud')!.style.visibility = 'hidden';\n\n    lastTime = performance.now();\n    requestAnimationFrame(gameLoop);\n  } catch (err) {\n    console.error('[init] Fatal error during initialization:', err);\n  }\n}\n\ninit();\n\n// DEBUG: Expose game state for verification scripts (localhost only)\nif (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n  (window as any).gameState = gameState;\n  (window as any).getPlayerPos = getPlayerPos;\n}\n"],
  "mappings": ";;;;;AAEO,IAAM,aAAa;AAEnB,IAAM,YAAwB;AAAA,EACnC,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,KAAK,GAAG,EAAE;AAAA,EACjC,EAAE,GAAG,IAAI,GAAG,MAAM,GAAG,GAAG,GAAG,KAAK,GAAG,EAAE;AAAA,EACrC,EAAE,GAAG,KAAK,GAAG,IAAI,GAAG,KAAK,GAAG,GAAG,GAAG,IAAI;AAAA,EACtC,EAAE,GAAG,KAAK,GAAG,MAAM,GAAG,KAAK,GAAG,GAAG,GAAG,IAAI;AAAA,EACxC,EAAE,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE;AAAA,EAChC,EAAE,GAAG,KAAK,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE;AAAA,EAClC,EAAE,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,KAAK,GAAG,EAAE;AAAA,EAClC,EAAE,GAAG,MAAM,GAAG,GAAG,GAAG,GAAG,GAAG,KAAK,GAAG,EAAE;AACtC;AAEO,IAAM,iBAAiB;AACvB,IAAM,cAAc;AAEpB,IAAM,OAAc;AAAA,EACzB,EAAE,GAAG,GAAG,GAAG,KAAK,GAAG,GAAG,GAAG,EAAE;AAAA,EAC3B,EAAE,GAAG,IAAI,GAAG,KAAK,GAAG,KAAK,GAAG,IAAI;AAAA,EAChC,EAAE,GAAG,MAAM,GAAG,GAAG,GAAG,KAAK,GAAG,EAAE;AAAA,EAC9B,EAAE,GAAG,MAAM,GAAG,IAAI,GAAG,KAAK,GAAG,IAAI;AAAA,EACjC,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE;AAC3B;AAEO,SAAS,eAAuB;AACrC,SAAO,KAAK,IAAI,QAAM;AAAA,IACpB,MAAM,EAAE,IAAI,EAAE,IAAI;AAAA,IAClB,MAAM,EAAE,IAAI,EAAE,IAAI;AAAA,IAClB,MAAM,EAAE,IAAI,EAAE,IAAI;AAAA,IAClB,MAAM,EAAE,IAAI,EAAE,IAAI;AAAA,EACpB,EAAE;AACJ;AAEO,SAAS,qBAA6B;AAC3C,QAAM,SAAiB,CAAC;AAExB,aAAW,KAAK,WAAW;AACzB,WAAO,KAAK;AAAA,MACV,MAAM,EAAE,IAAI,EAAE,IAAI;AAAA,MAClB,MAAM,EAAE,IAAI,EAAE,IAAI;AAAA,MAClB,MAAM,EAAE,IAAI,EAAE,IAAI;AAAA,MAClB,MAAM,EAAE,IAAI,EAAE,IAAI;AAAA,IACpB,CAAC;AAAA,EACH;AAEA,QAAM,IAAI;AACV,QAAM,IAAI;AACV,SAAO,KAAK,EAAE,MAAM,CAAC,IAAI,IAAE,GAAG,MAAM,IAAI,IAAE,GAAG,MAAM,IAAI,IAAE,GAAG,MAAM,IAAI,IAAE,EAAE,CAAC;AAC3E,SAAO,KAAK,EAAE,MAAM,CAAC,IAAI,IAAE,GAAG,MAAM,IAAI,IAAE,GAAG,MAAM,CAAC,IAAI,IAAE,GAAG,MAAM,CAAC,IAAI,IAAE,EAAE,CAAC;AAC7E,SAAO,KAAK,EAAE,MAAM,IAAI,IAAE,GAAG,MAAM,IAAI,IAAE,GAAG,MAAM,CAAC,IAAI,IAAE,GAAG,MAAM,IAAI,IAAE,EAAE,CAAC;AAC3E,SAAO,KAAK,EAAE,MAAM,CAAC,IAAI,IAAE,GAAG,MAAM,CAAC,IAAI,IAAE,GAAG,MAAM,CAAC,IAAI,IAAE,GAAG,MAAM,IAAI,IAAE,EAAE,CAAC;AAE7E,SAAO;AACT;;;ACrDA,IAAI;AAAJ,IAAgB;AAAhB,IAA6B;AAC7B,IAAM,cAAc;AACpB,IAAI,iBAAiB;AACrB,IAAM,eAAe,IAAI,MAAM,QAAQ,IAAI,IAAI,EAAE;AAGjD,IAAI,iBAAwB,CAAC;AAC7B,IAAI,aAAoB,CAAC;AACzB,IAAI,YAAmB,CAAC;AAGxB,IAAI,iBAAiB;AACrB,IAAI,iBAAiB;AAGrB,IAAM,aAAa,IAAI,MAAM,QAAQ;AACrC,IAAM,gBAAgB,IAAI,MAAM,QAAQ;AACxC,IAAM,UAAU,IAAI,MAAM,QAAQ;AAE3B,SAAS,eAAe;AAC7B,UAAQ,IAAI,MAAM,MAAM;AACxB,QAAM,aAAa,IAAI,MAAM,MAAM,MAAQ;AAC3C,QAAM,MAAM,IAAI,MAAM,IAAI,QAAU,IAAI,EAAE;AAE1C,QAAM,EAAE,GAAG,EAAE,IAAI,gBAAgB;AACjC,QAAM,SAAS,IAAI;AACnB,WAAS,IAAI,MAAM;AAAA,IACjB,CAAC,cAAc;AAAA,IAAQ,cAAc;AAAA,IACrC;AAAA,IAAa,CAAC;AAAA,IAAa;AAAA,IAAK;AAAA,EAClC;AACA,SAAO,SAAS,KAAK,YAAY;AACjC,SAAO,OAAO,GAAG,GAAG,CAAC;AAGrB,QAAM,WAAW,kBAAkB,UAAU,UAAU,iBAAiB;AACxE,MAAI,SAAU,cAAa,CAAC;AAE5B,aAAW,IAAI,MAAM,cAAc,EAAE,WAAW,KAAK,CAAC;AACtD,WAAS,QAAQ,GAAG,CAAC;AACrB,WAAS,cAAc,KAAK,IAAI,OAAO,kBAAkB,CAAC,CAAC;AAC3D,WAAS,KAAK,QAAQ,SAAS,UAAU;AAGzC,QAAM,UAAU,IAAI,MAAM,aAAa,SAAU,GAAG;AACpD,QAAM,IAAI,OAAO;AAEjB,QAAM,WAAW,IAAI,MAAM,iBAAiB,UAAU,GAAG;AACzD,WAAS,SAAS,IAAI,IAAI,IAAI,EAAE;AAChC,QAAM,IAAI,QAAQ;AAElB,QAAM,WAAW,IAAI,MAAM,iBAAiB,SAAU,GAAG;AACzD,WAAS,SAAS,IAAI,KAAK,GAAG,GAAG;AACjC,QAAM,IAAI,QAAQ;AAGlB,QAAM,SAAS,IAAI,MAAM;AAAA,IACvB,IAAI,MAAM,cAAc,IAAI,EAAE;AAAA,IAC9B,IAAI,MAAM,qBAAqB,EAAE,OAAO,SAAU,WAAW,KAAK,WAAW,IAAI,CAAC;AAAA,EACpF;AACA,SAAO,SAAS,IAAI,CAAC,KAAK,KAAK;AAC/B,QAAM,IAAI,MAAM;AAGhB,QAAM,OAAO,IAAI,MAAM,WAAW,IAAI,IAAI,SAAU,OAAQ;AAC5D,OAAK,SAAS,IAAI;AAClB,QAAM,IAAI,IAAI;AAGd,kBAAgB;AAGhB,aAAW;AAGX,SAAO,iBAAiB,UAAU,QAAQ;AAC1C,SAAO,iBAAiB,qBAAqB,MAAM;AAEjD,eAAW,UAAU,GAAG;AAAA,EAC1B,CAAC;AACD,MAAI,OAAO,gBAAgB;AACzB,WAAO,eAAe,iBAAiB,UAAU,QAAQ;AAAA,EAC3D;AAEA,SAAO,EAAE,OAAO,QAAQ,SAAS;AACnC;AAEA,SAAS,sBAAsB;AAC7B,aAAW,KAAK,gBAAgB;AAC9B,UAAM,OAAO,CAAC;AACd,QAAI,EAAE,SAAU,GAAE,SAAS,QAAQ;AAAA,EACrC;AACA,mBAAiB,CAAC;AAClB,aAAW,KAAK,YAAY;AAC1B,UAAM,OAAO,CAAC;AACd,QAAI,EAAE,SAAU,GAAE,SAAS,QAAQ;AAAA,EACrC;AACA,eAAa,CAAC;AAChB;AAEA,SAAS,kBAAkB;AACzB,sBAAoB;AAEpB,QAAM,MAAM,IAAI,MAAM,qBAAqB;AAAA,IACzC,OAAO;AAAA,IACP,UAAU;AAAA,IACV,mBAAmB;AAAA,IACnB,WAAW;AAAA,IACX,WAAW;AAAA,EACb,CAAC;AAED,aAAW,KAAK,WAAW;AACzB,UAAM,OAAO,IAAI,MAAM,KAAK,IAAI,MAAM,YAAY,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,GAAG,GAAG;AACrE,SAAK,SAAS,IAAI,EAAE,GAAG,EAAE,IAAI,GAAG,EAAE,CAAC;AACnC,UAAM,IAAI,IAAI;AACd,mBAAe,KAAK,IAAI;AAAA,EAC1B;AAGA,QAAM,UAAU,IAAI,MAAM,qBAAqB;AAAA,IAC7C,OAAO;AAAA,IACP,UAAU;AAAA,IACV,mBAAmB;AAAA,IACnB,WAAW;AAAA,EACb,CAAC;AAGD,aAAW,SAAS,CAAC,IAAI,CAAC,GAAG;AAC3B,UAAM,OAAO,IAAI,MAAM;AAAA,MACrB,IAAI,MAAM,YAAY,aAAa,IAAI,gBAAgB,aAAa,cAAc;AAAA,MAClF;AAAA,IACF;AACA,SAAK,SAAS,IAAI,GAAG,cAAc,GAAG,QAAQ,UAAU;AACxD,UAAM,IAAI,IAAI;AACd,eAAW,KAAK,IAAI;AAAA,EACtB;AAEA,aAAW,SAAS,CAAC,IAAI,CAAC,GAAG;AAC3B,UAAM,OAAO,IAAI,MAAM;AAAA,MACrB,IAAI,MAAM,YAAY,gBAAgB,aAAa,aAAa,IAAI,cAAc;AAAA,MAClF;AAAA,IACF;AACA,SAAK,SAAS,IAAI,QAAQ,YAAY,cAAc,GAAG,CAAC;AACxD,UAAM,IAAI,IAAI;AACd,eAAW,KAAK,IAAI;AAAA,EACtB;AACF;AAEA,SAAS,iBAAiB;AACxB,aAAW,KAAK,WAAW;AACzB,UAAM,OAAO,CAAC;AACd,QAAI,EAAE,SAAU,GAAE,SAAS,QAAQ;AAAA,EACrC;AACA,cAAY,CAAC;AACf;AAEA,SAAS,aAAa;AACpB,iBAAe;AAEf,QAAM,gBAAgB;AACtB,QAAM,aAAa;AAEnB,QAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,IAC1C,OAAO;AAAA,IACP,aAAa;AAAA,IACb,SAAS;AAAA,EACX,CAAC;AAED,aAAW,KAAK,MAAM;AAEpB,UAAM,WAAW,IAAI,MAAM;AAAA,MACzB,IAAI,MAAM,cAAc,EAAE,GAAG,EAAE,CAAC;AAAA,MAChC,IAAI,MAAM,kBAAkB,EAAE,OAAO,EAAS,CAAC;AAAA,IACjD;AACA,aAAS,SAAS,IAAI,CAAC,KAAK,KAAK;AACjC,aAAS,SAAS,IAAI,EAAE,GAAG,OAAO,EAAE,CAAC;AACrC,UAAM,IAAI,QAAQ;AAClB,cAAU,KAAK,QAAQ;AAGvB,UAAM,QAAQ,IAAI,MAAM;AAAA,MACtB,IAAI,MAAM,YAAY,EAAE,IAAI,gBAAgB,GAAG,YAAY,aAAa;AAAA,MACxE;AAAA,IACF;AACA,UAAM,SAAS,IAAI,EAAE,GAAG,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC;AAC3C,UAAM,IAAI,KAAK;AACf,cAAU,KAAK,KAAK;AAGpB,UAAM,QAAQ,IAAI,MAAM;AAAA,MACtB,IAAI,MAAM,YAAY,EAAE,IAAI,gBAAgB,GAAG,YAAY,aAAa;AAAA,MACxE;AAAA,IACF;AACA,UAAM,SAAS,IAAI,EAAE,GAAG,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC;AAC3C,UAAM,IAAI,KAAK;AACf,cAAU,KAAK,KAAK;AAGpB,UAAM,QAAQ,IAAI,MAAM;AAAA,MACtB,IAAI,MAAM,YAAY,eAAe,YAAY,EAAE,CAAC;AAAA,MACpD;AAAA,IACF;AACA,UAAM,SAAS,IAAI,EAAE,IAAI,EAAE,IAAI,GAAG,MAAM,EAAE,CAAC;AAC3C,UAAM,IAAI,KAAK;AACf,cAAU,KAAK,KAAK;AAGpB,UAAM,QAAQ,IAAI,MAAM;AAAA,MACtB,IAAI,MAAM,YAAY,eAAe,YAAY,EAAE,CAAC;AAAA,MACpD;AAAA,IACF;AACA,UAAM,SAAS,IAAI,EAAE,IAAI,EAAE,IAAI,GAAG,MAAM,EAAE,CAAC;AAC3C,UAAM,IAAI,KAAK;AACf,cAAU,KAAK,KAAK;AAAA,EACtB;AACF;AAGO,SAAS,sBAAsB;AACpC,kBAAgB;AAChB,aAAW;AACb;AAEA,SAAS,kBAAkB;AAEzB,MAAI,OAAO,gBAAgB;AACzB,WAAO,EAAE,GAAG,OAAO,eAAe,OAAO,GAAG,OAAO,eAAe,OAAO;AAAA,EAC3E;AACA,SAAO,EAAE,GAAG,OAAO,YAAY,GAAG,OAAO,YAAY;AACvD;AAEA,SAAS,WAAW;AAClB,QAAM,EAAE,GAAG,EAAE,IAAI,gBAAgB;AACjC,eAAa,cAAc;AAC3B,WAAS,QAAQ,GAAG,CAAC;AACvB;AAEA,SAAS,aAAa,GAAW;AAC/B,QAAM,EAAE,GAAG,EAAE,IAAI,gBAAgB;AACjC,QAAM,SAAS,IAAI;AACnB,SAAO,OAAO,CAAC,IAAI;AACnB,SAAO,QAAQ,IAAI;AACnB,SAAO,MAAM;AACb,SAAO,SAAS,CAAC;AACjB,SAAO,uBAAuB;AAC9B,mBAAiB;AACnB;AAEO,SAAS,QAAQ,SAAiB;AACvC,eAAa,KAAK,IAAI,GAAG,KAAK,IAAI,IAAI,OAAO,CAAC,CAAC;AACjD;AAEO,SAAS,YAAY;AAC1B,eAAa,WAAW;AAC1B;AAEO,SAAS,oBAAoB;AAClC,SAAO;AACT;AAEO,SAAS,aAAaA,YAAgB,IAAY;AAGvD,SAAO,SAAS,KAAKA,UAAS,EAAE,IAAI,YAAY;AAGhD,MAAI,iBAAiB,GAAG;AACtB,sBAAkB,KAAK;AACvB,UAAM,QAAQ,KAAK,IAAI,GAAG,iBAAiB,GAAG;AAC9C,UAAM,MAAM,iBAAiB;AAC7B,WAAO,SAAS,MAAM,KAAK,OAAO,IAAI,OAAO,MAAM;AACnD,WAAO,SAAS,MAAM,KAAK,OAAO,IAAI,OAAO,MAAM;AAAA,EACrD;AAEA,SAAO,OAAOA,UAAS;AACzB;AAEO,SAAS,YAAY,WAAmB,aAAa,KAAK;AAC/D,mBAAiB;AACjB,mBAAiB;AACnB;AAGO,SAAS,cAAc,MAAc,MAAc;AACxD,gBAAc,IAAI,MAAM,MAAM,CAAC;AAC/B,gBAAc,UAAU,MAAM;AAG9B,UAAQ,IAAI,GAAG,GAAG,EAAE,EAAE,gBAAgB,OAAO,UAAU;AAGvD,QAAM,IAAI,CAAC,cAAc,IAAI,QAAQ;AACrC,SAAO,IAAI,MAAM;AAAA,IACf,cAAc,IAAI,QAAQ,IAAI;AAAA,IAC9B;AAAA,IACA,cAAc,IAAI,QAAQ,IAAI;AAAA,EAChC;AACF;AAEO,SAAS,WAAW;AAAE,SAAO;AAAO;AACpC,SAAS,YAAY;AAAE,SAAO;AAAQ;AACtC,SAAS,sBAAsB;AAAE,SAAO;AAAU;;;AC5SlD,IAAM,SAAuB;AAAA,EAClC,WAAW;AAAA,EACX,OAAO;AAAA,EACP,UAAU;AAAA,EACV,YAAY,EAAE,OAAO,IAAI,QAAQ,IAAI,OAAO,SAAU,MAAM,IAAI;AAAA,EAChE,MAAM,EAAE,QAAQ,MAAM,QAAQ,IAAI;AACpC;;;ACNO,IAAM,YAA6B;AAAA,EACxC,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,KAAK;AAAA,IACL,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU;AAAA,IACV,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,aAAa;AAAA,IACb,WAAW;AAAA,IACX,iBAAiB;AAAA,IACjB,iBAAiB;AAAA,IACjB,wBAAwB;AAAA,IACxB,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,oBAAoB;AAAA,IACpB,gBAAgB;AAAA,IAChB,kBAAkB;AAAA,IAClB,QAAQ;AAAA,IACR,aAAa;AAAA,EACf;AAAA,EACA,UAAU;AAAA,IACR,MAAM;AAAA,IACN,KAAK;AAAA,IACL,UAAU;AAAA,IACV,cAAc;AAAA,IACd,WAAW;AAAA,IACX,WAAW;AAAA,IACX,OAAO;AAAA,IACP,cAAc;AAAA,IACd,cAAc;AAAA,IACd,OAAO;AAAA,IACP,kBAAkB;AAAA,IAClB,qBAAqB;AAAA,IACrB,aAAa;AAAA,EACf;AACF;;;ACvCO,IAAM,aAAN,MAAiB;AAAA,EAKtB,YAAY,UAAqB,cAAc,IAAI;AACjD,SAAK,OAAO,CAAC;AACb,SAAK,SAAS,CAAC;AACf,SAAK,WAAW;AAChB,aAAS,IAAI,GAAG,IAAI,aAAa,KAAK;AACpC,YAAM,MAAM,SAAS;AACrB,UAAI,KAAK,UAAU;AACnB,WAAK,KAAK,KAAK,GAAG;AAAA,IACpB;AAAA,EACF;AAAA,EAEA,UAAU;AACR,QAAI,MAAM,KAAK,KAAK,IAAI;AACxB,QAAI,CAAC,KAAK;AACR,YAAM,KAAK,SAAS;AAAA,IACtB;AACA,QAAI,KAAK,UAAU;AACnB,SAAK,OAAO,KAAK,GAAG;AACpB,WAAO;AAAA,EACT;AAAA,EAEA,QAAQ,KAAU;AAChB,QAAI,KAAK,UAAU;AACnB,UAAM,MAAM,KAAK,OAAO,QAAQ,GAAG;AACnC,QAAI,QAAQ,IAAI;AAEd,YAAM,OAAO,KAAK,OAAO,SAAS;AAClC,UAAI,QAAQ,KAAM,MAAK,OAAO,GAAG,IAAI,KAAK,OAAO,IAAI;AACrD,WAAK,OAAO,SAAS;AAAA,IACvB;AACA,SAAK,KAAK,KAAK,GAAG;AAAA,EACpB;AAAA,EAEA,aAAa;AACX,aAAS,IAAI,KAAK,OAAO,SAAS,GAAG,KAAK,GAAG,KAAK;AAChD,YAAM,MAAM,KAAK,OAAO,CAAC;AACzB,UAAI,KAAK,UAAU;AACnB,WAAK,KAAK,KAAK,GAAG;AAAA,IACpB;AACA,SAAK,OAAO,SAAS;AAAA,EACvB;AAAA,EAEA,YAAY;AAAE,WAAO,KAAK;AAAA,EAAQ;AACpC;;;AC7CA,IAAI;AAAJ,IAAqB;AACrB,IAAI;AACJ,IAAI;AAEG,SAAS,mBAAmBC,QAAY;AAC7C,aAAWA;AAEX,uBAAqB,OAAO,WAAW;AACvC,QAAM,gBAAgB,IAAI,MAAM,eAAe,oBAAoB,GAAG,CAAC;AACvE,QAAM,gBAAgB,IAAI,MAAM,qBAAqB;AAAA,IACnD,OAAO,OAAO,WAAW;AAAA,IACzB,UAAU,OAAO,WAAW;AAAA,IAC5B,mBAAmB;AAAA,EACrB,CAAC;AAED,eAAa,IAAI,WAAW,MAAM;AAChC,UAAM,OAAO,IAAI,MAAM,KAAK,eAAe,cAAc,MAAM,CAAC;AAChE,IAAAA,OAAM,IAAI,IAAI;AACd,WAAO,EAAE,MAAM,KAAK,IAAI,MAAM,QAAQ,GAAG,OAAO,GAAG,QAAQ,GAAG,MAAM,GAAG,SAAS,MAAM;AAAA,EACxF,GAAG,EAAE;AAEL,QAAM,eAAe,IAAI,MAAM,eAAe,KAAK,GAAG,CAAC;AAEvD,cAAY,IAAI,WAAW,MAAM;AAC/B,UAAM,OAAO,IAAI,MAAM;AAAA,MACrB;AAAA,MACA,IAAI,MAAM,qBAAqB;AAAA,QAC7B,OAAO;AAAA,QACP,UAAU;AAAA,QACV,mBAAmB;AAAA,MACrB,CAAC;AAAA,IACH;AACA,IAAAA,OAAM,IAAI,IAAI;AACd,WAAO,EAAE,MAAM,KAAK,IAAI,MAAM,QAAQ,GAAG,OAAO,GAAG,QAAQ,GAAG,MAAM,GAAG,SAAS,KAAK;AAAA,EACvF,GAAG,EAAE;AACP;AAEO,SAAS,eAAe,QAAa,WAAgB,QAAa,SAAmB;AAC1F,MAAI,YAAY,OAAW,WAAU;AACrC,QAAMC,QAAO,UAAU,YAAY;AACnC,QAAM,IAAIA,MAAK,QAAQ;AACvB,IAAE,KAAK,SAAS,IAAI,OAAO,GAAG,KAAK,OAAO,CAAC;AAC3C,IAAE,IAAI,KAAK,SAAS,EAAE,UAAU;AAChC,IAAE,QAAQ,OAAO;AACjB,IAAE,SAAS,OAAO;AAClB,IAAE,OAAO;AAGT,MAAI,CAAC,WAAW,oBAAoB;AAClC,UAAM,IAAI,OAAO,WAAW,OAAO;AACnC,MAAE,KAAK,MAAM,IAAI,GAAG,GAAG,CAAC;AAAA,EAC1B;AAGA,MAAI,WAAW,OAAO,OAAO;AAC3B,MAAE,KAAK,SAAS,MAAM,OAAO,OAAO,KAAK;AACzC,MAAE,KAAK,SAAS,SAAS,OAAO,OAAO,KAAK;AAAA,EAC9C;AAEA,SAAO;AACT;AAEO,SAAS,kBAAkB,IAAY;AAC5C,QAAM,UAAU;AAChB,aAAWA,SAAQ,CAAC,YAAY,SAAS,GAAG;AAC1C,UAAMC,UAASD,MAAK,UAAU;AAC9B,aAAS,IAAIC,QAAO,SAAS,GAAG,KAAK,GAAG,KAAK;AAC3C,YAAM,IAAIA,QAAO,CAAC;AAClB,QAAE,KAAK,SAAS,KAAK,EAAE,IAAI,IAAI,EAAE,QAAQ;AACzC,QAAE,KAAK,SAAS,KAAK,EAAE,IAAI,IAAI,EAAE,QAAQ;AACzC,QAAE,QAAQ;AACV,UAAI,EAAE,OAAO,SAAS;AACpB,QAAAD,MAAK,QAAQ,CAAC;AAAA,MAChB;AAAA,IACF;AAAA,EACF;AACF;AAEO,SAAS,uBAAuB;AAAE,SAAO,aAAa,WAAW,UAAU,IAAI,CAAC;AAAG;AACnF,SAAS,sBAAsB;AAAE,SAAO,YAAY,UAAU,UAAU,IAAI,CAAC;AAAG;AAEhF,SAAS,kBAAkB,GAAQ;AACxC,MAAI,EAAE,SAAS;AACb,cAAU,QAAQ,CAAC;AAAA,EACrB,OAAO;AACL,eAAW,QAAQ,CAAC;AAAA,EACtB;AACF;AAEO,SAAS,wBAAwB;AACtC,MAAI,WAAY,YAAW,WAAW;AACtC,MAAI,UAAW,WAAU,WAAW;AACtC;;;AC5FA,IAAI;AAAJ,IAAiB;AACjB,IAAM,YAAY;AAClB,IAAM,WAAW;AACjB,IAAM,iBAAiB;AAGvB,IAAM,OAAc,CAAC;AACrB,SAAS,IAAI,GAAG,IAAI,WAAW,KAAK;AAClC,OAAK,KAAK,EAAE,QAAQ,OAAO,GAAG,GAAG,GAAG,GAAG,OAAO,GAAG,MAAM,GAAG,OAAO,UAAU,CAAC;AAC9E;AAGA,IAAM,WAAW,IAAI,MAAM,QAAQ;AAE5B,SAAS,oBAAoB;AAClC,WAAS,SAAS,cAAc,QAAQ;AACxC,SAAO,KAAK;AACZ,SAAO,MAAM,UAAU;AACvB,WAAS,KAAK,YAAY,MAAM;AAChC,eAAa;AACb,SAAO,iBAAiB,UAAU,YAAY;AAChD;AAEA,SAAS,eAAe;AACtB,SAAO,QAAQ,OAAO;AACtB,SAAO,SAAS,OAAO;AACzB;AAEO,SAAS,kBAAkB,QAAgB,QAAgB,OAAY,OAAgB;AAC5F,MAAI,CAAC,MAAO,SAAQ;AAGpB,MAAI,OAAY;AAChB,WAAS,IAAI,GAAG,IAAI,WAAW,KAAK;AAClC,QAAI,CAAC,KAAK,CAAC,EAAE,QAAQ;AACnB,aAAO,KAAK,CAAC;AACb;AAAA,IACF;AAAA,EACF;AAEA,MAAI,CAAC,MAAM;AACT,QAAI,SAAS,KAAK,CAAC;AACnB,aAAS,IAAI,GAAG,IAAI,WAAW,KAAK;AAClC,UAAI,KAAK,CAAC,EAAE,OAAO,OAAO,KAAM,UAAS,KAAK,CAAC;AAAA,IACjD;AACA,WAAO;AAAA,EACT;AAGA,QAAME,UAAS,UAAU;AACzB,WAAS,IAAI,QAAQ,KAAK,MAAM;AAChC,WAAS,QAAQA,OAAM;AAEvB,OAAK,SAAS;AACd,OAAK,KAAK,SAAS,IAAI,MAAM,OAAO,OAAO;AAC3C,OAAK,KAAK,CAAC,SAAS,IAAI,MAAM,OAAO,OAAO;AAC5C,OAAK,QAAQ,OAAO,UAAU,WAAW,QAAQ,KAAK,MAAM,KAAK;AACjE,OAAK,OAAO;AACZ,OAAK,QAAQ;AAGb,OAAK,MAAM,KAAK,OAAO,IAAI,OAAO;AACpC;AAEO,SAAS,oBAAoB,IAAY;AAC9C,MAAI,CAAC,IAAK,OAAM,OAAO,WAAW,IAAI;AACtC,MAAI,UAAU,GAAG,GAAG,OAAO,OAAO,OAAO,MAAM;AAE/C,QAAM,OAAO,KAAK;AAElB,WAAS,IAAI,GAAG,IAAI,WAAW,KAAK;AAClC,UAAM,OAAO,KAAK,CAAC;AACnB,QAAI,CAAC,KAAK,OAAQ;AAElB,SAAK,QAAQ;AACb,QAAI,KAAK,QAAQ,UAAU;AACzB,WAAK,SAAS;AACd;AAAA,IACF;AAEA,UAAM,IAAI,KAAK,OAAO;AACtB,UAAM,QAAQ,IAAI,IAAI;AACtB,UAAM,UAAU,CAAC,iBAAiB;AAClC,UAAM,QAAQ,IAAI,IAAI;AAEtB,UAAM,IAAI,KAAK;AACf,UAAM,IAAI,KAAK,IAAI;AAEnB,QAAI,KAAK;AACT,QAAI,cAAc;AAClB,QAAI,OAAO,QAAQ,KAAK,MAAM,KAAK,KAAK,CAAC;AACzC,QAAI,YAAY;AAChB,QAAI,eAAe;AAGnB,QAAI,cAAc;AAClB,QAAI,aAAa;AACjB,QAAI,gBAAgB;AACpB,QAAI,gBAAgB;AAEpB,QAAI,YAAY,KAAK;AACrB,QAAI,SAAS,KAAK,OAAO,GAAG,CAAC;AAC7B,QAAI,QAAQ;AAAA,EACd;AACF;AAEO,SAAS,qBAAqB;AACnC,WAAS,IAAI,GAAG,IAAI,WAAW,KAAK;AAClC,SAAK,CAAC,EAAE,SAAS;AAAA,EACnB;AACA,MAAI,IAAK,KAAI,UAAU,GAAG,GAAG,OAAO,OAAO,OAAO,MAAM;AAC1D;;;AC7GA,IAAIC;AAGJ,IAAM,mBAA0B,CAAC;AAGjC,IAAM,iBAAwB,CAAC;AAG/B,IAAI;AACJ,IAAI;AAIJ,SAAS,YAAY,GAAW;AAC9B,SAAO,KAAK,IAAI;AAClB;AAIO,SAAS,iBAAiBC,QAAY;AAC3C,EAAAD,YAAWC;AACb;AAIO,SAAS,cAAc,GAAW,GAAW,WAAmB,YAAoB,OAAe;AACxG,MAAI,CAAC,SAAS;AACZ,cAAU,IAAI,MAAM,aAAa,KAAK,GAAK,EAAE;AAC7C,YAAQ,QAAQ,CAAC,KAAK,KAAK,CAAC;AAAA,EAC9B;AAEA,QAAM,MAAM,IAAI,MAAM,kBAAkB;AAAA,IACtC;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AAED,QAAM,OAAO,IAAI,MAAM,KAAK,SAAS,GAAG;AACxC,OAAK,SAAS,IAAI,GAAG,MAAM,CAAC;AAC5B,OAAK,MAAM,IAAI,MAAM,MAAM,IAAI;AAC/B,EAAAD,UAAS,IAAI,IAAI;AAEjB,QAAM,YAAY;AAAA,IAChB,MAAM;AAAA,IACN;AAAA,IACA,UAAU;AAAA,IACV,QAAQ,EAAE,GAAG,EAAE;AAAA,IACf;AAAA,IACA,UAAU;AAAA,IACV,SAAS;AAAA,IACT;AAAA,EACF;AAEA,mBAAiB,KAAK,SAAS;AAC/B,SAAO;AACT;AAIO,SAAS,cAAc,GAAW,GAAW,OAAe,QAAgB,UAAkB,YAAoB,OAAe;AACtI,MAAI,CAAC,UAAU;AACb,eAAW,IAAI,MAAM,cAAc,GAAG,CAAC;AACvC,aAAS,QAAQ,CAAC,KAAK,KAAK,CAAC;AAAA,EAC/B;AAEA,QAAM,QAAQ,IAAI,MAAM,MAAM;AAC9B,QAAM,SAAS,IAAI,GAAG,MAAM,CAAC;AAC7B,QAAM,SAAS,IAAI;AAGnB,QAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,IAC1C;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AACD,QAAM,WAAW,IAAI,MAAM,KAAK,UAAU,OAAO;AACjD,WAAS,MAAM,IAAI,QAAQ,KAAK,GAAG,SAAS,GAAG;AAC/C,QAAM,IAAI,QAAQ;AAGlB,QAAM,UAAU,IAAI,MAAM,cAAc,IAAI,MAAM,cAAc,OAAO,MAAM,CAAC;AAC9E,UAAQ,QAAQ,CAAC,KAAK,KAAK,CAAC;AAC5B,QAAM,YAAY,IAAI,MAAM,kBAAkB;AAAA,IAC5C;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA,IACT,YAAY;AAAA,EACd,CAAC;AACD,QAAM,aAAa,IAAI,MAAM,aAAa,SAAS,SAAS;AAC5D,QAAM,IAAI,UAAU;AAEpB,EAAAA,UAAS,IAAI,KAAK;AAElB,QAAM,YAAY;AAAA,IAChB,MAAM;AAAA,IACN,MAAM;AAAA,IACN;AAAA,IACA,cAAc;AAAA,IACd;AAAA,IACA,gBAAgB;AAAA,IAChB,eAAe;AAAA,IACf,QAAQ,EAAE,GAAG,EAAE;AAAA,IACf;AAAA,IACA;AAAA,IACA;AAAA,IACA,UAAU;AAAA,IACV,SAAS;AAAA,IACT;AAAA,EACF;AAEA,mBAAiB,KAAK,SAAS;AAC/B,SAAO;AACT;AAOO,SAAS,gBAAgB,IAAY,IAAY,IAAY,IAAY,GAAW,GAAW,UAAkB,SAAkB;AACxI,QAAM,MAAM,WAAW;AACvB,QAAM,KAAK,KAAK;AAChB,QAAM,KAAK,KAAK;AAChB,QAAM,MAAM,KAAK,IAAI,CAAC,QAAQ;AAC9B,QAAM,MAAM,KAAK,IAAI,CAAC,QAAQ;AAC9B,QAAM,SAAS,KAAK,MAAM,KAAK;AAC/B,QAAM,SAAS,KAAK,MAAM,KAAK;AAC/B,SAAO,KAAK,IAAI,MAAM,IAAK,IAAI,IAAI,OAAQ,KAAK,IAAI,MAAM,IAAK,IAAI,IAAI;AACzE;AAIO,SAAS,oBAAoB,IAAY;AAC9C,QAAM,OAAO,KAAK;AAElB,WAAS,IAAI,iBAAiB,SAAS,GAAG,KAAK,GAAG,KAAK;AACrD,UAAM,IAAI,iBAAiB,CAAC;AAC5B,MAAE,WAAW;AACb,UAAM,WAAW,KAAK,IAAI,EAAE,UAAU,EAAE,UAAU,CAAC;AAEnD,QAAI,EAAE,SAAS,QAAQ;AACrB,iBAAW,GAAG,QAAQ;AAAA,IACxB,WAAW,EAAE,SAAS,QAAQ;AAC5B,iBAAW,GAAG,QAAQ;AAAA,IACxB;AAGA,QAAI,YAAY,GAAG;AACjB,sBAAgB,CAAC;AACjB,uBAAiB,OAAO,GAAG,CAAC;AAAA,IAC9B;AAAA,EACF;AACF;AAEA,SAAS,WAAW,GAAQ,UAAkB;AAC5C,QAAM,gBAAgB,YAAY,QAAQ;AAG1C,QAAM,gBAAgB,EAAE,YAAY;AACpC,IAAE,KAAK,MAAM,IAAI,eAAe,eAAe,aAAa;AAO5D,IAAE,SAAS,UAAU,OAAO,IAAI;AAClC;AAEA,SAAS,WAAW,GAAQ,UAAkB;AAC5C,QAAM,gBAAgB,YAAY,QAAQ;AAG1C,MAAI;AACJ,MAAI,WAAW,KAAK;AAClB,kBAAc,OAAO,WAAW;AAAA,EAClC,OAAO;AACL,kBAAc,OAAO,KAAK,WAAW,OAAO;AAAA,EAC9C;AACA,IAAE,aAAa,UAAU,KAAK,IAAI,GAAG,WAAW;AAGhD,QAAM,YAAY,MAAM,MAAM;AAC9B,IAAE,SAAS,MAAM,IAAI,EAAE,QAAQ,WAAW,GAAG,EAAE,SAAS,SAAS;AAGjE,QAAM,OAAO,IAAI,IAAI;AACrB,QAAM,QAAQ,MAAM,MAAM,KAAK,IAAI,YAAY,IAAI,IAAI,OAAO,MAAO;AACrE,IAAE,eAAe,UAAU,MAAM,MAAM;AAGvC,QAAM,iBAAiB,IAAK,MAAM,EAAE;AACpC,MAAI,WAAW,gBAAgB;AAC7B,UAAM,iBAAiB,WAAW,mBAAmB,IAAI;AAEzD,MAAE,aAAa,UAAU,MAAM,MAAM;AAErC,MAAE,eAAe,UAAU,MAAM,MAAM;AAEvC,UAAM,KAAM,EAAE,SAAS,KAAM,OAAQ;AACrC,UAAM,KAAM,EAAE,SAAS,IAAK,OAAQ;AACpC,UAAM,KAAK,EAAE,QAAQ,OAAQ;AAC7B,MAAE,aAAa,MAAM;AAAA,MACnB,KAAK,IAAI,KAAK,gBAAgB;AAAA,MAC9B,KAAK,IAAI,KAAK,gBAAgB;AAAA,MAC9B,KAAK,IAAI,KAAK,gBAAgB;AAAA,IAChC;AACA,MAAE,eAAe,MAAM;AAAA,MACrB,KAAK,IAAI,KAAK,gBAAgB;AAAA,MAC9B,KAAK,IAAI,KAAK,gBAAgB;AAAA,MAC9B,KAAK,IAAI,KAAK,gBAAgB;AAAA,IAChC;AAAA,EACF,WAAW,WAAW,KAAK;AAEzB,UAAM,gBAAgB,WAAW,QAAQ,iBAAiB;AAC1D,MAAE,eAAe,WAAY,IAAI,eAAe;AAChD,MAAE,aAAa,WAAY,IAAI,eAAe;AAAA,EAChD;AACF;AAEA,SAAS,gBAAgB,GAAQ;AAC/B,MAAI,EAAE,SAAS,QAAQ;AACrB,MAAE,SAAS,QAAQ;AACnB,IAAAA,UAAS,OAAO,EAAE,IAAI;AAAA,EACxB,WAAW,EAAE,SAAS,QAAQ;AAC5B,MAAE,aAAa,QAAQ;AACvB,MAAE,eAAe,QAAQ;AACzB,MAAE,cAAc,QAAQ;AACxB,IAAAA,UAAS,OAAO,EAAE,IAAI;AAAA,EACxB;AACF;AAIO,SAAS,sBAAsB,OAAY,SAAiB,UAAgC;AACjG,iBAAe,KAAK,EAAE,OAAO,OAAO,SAAS,SAAS,CAAC;AACzD;AAGO,SAAS,iBAAiB,SAAiB,UAAsB;AACtE,iBAAe,KAAK,EAAE,OAAO,MAAM,OAAO,SAAS,SAAS,CAAC;AAC/D;AAEO,SAAS,qBAAqB,IAAY;AAC/C,QAAM,OAAO,KAAK;AAElB,WAAS,IAAI,eAAe,SAAS,GAAG,KAAK,GAAG,KAAK;AACnD,UAAM,IAAI,eAAe,CAAC;AAC1B,MAAE,SAAS;AACX,QAAI,EAAE,SAAS,GAAG;AAChB,UAAI,EAAE,OAAO;AACX,UAAE,SAAS,EAAE,KAAK;AAAA,MACpB,OAAO;AACL,UAAE,SAAS;AAAA,MACb;AACA,qBAAe,OAAO,GAAG,CAAC;AAAA,IAC5B;AAAA,EACF;AACF;AAOO,SAAS,eAAe,EAAE,GAAG,GAAG,QAAQ,YAAY,OAAO,OAAO,UAAU,WAAAE,YAAW,aAAa,GAUxG;AAED,gBAAc,GAAG,GAAG,QAAQ,YAAY,KAAK;AAG7C,QAAM,WAAW,MAAM,MAAM,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG;AAEzD,aAAW,SAASA,WAAU,SAAS;AACrC,QAAI,UAAU,aAAc;AAE5B,UAAM,KAAK,MAAM,IAAI,IAAI;AACzB,UAAM,KAAK,MAAM,IAAI,IAAI;AACzB,UAAM,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAExC,QAAI,OAAO,QAAQ;AAEjB,YAAM,UAAW,OAAO,SAAU;AAElC,4BAAsB,OAAO,SAAS,CAAC,MAAM;AAE3C,iBAAS,CAAC;AAGV,UAAE,aAAa;AACf,UAAE,SAAS,SAAS,SAAS,OAAO,KAAK;AACzC,YAAI,EAAE,SAAU,GAAE,SAAS,SAAS,SAAS,OAAO,KAAK;AAGzD,YAAI,OAAO;AACT,4BAAkB,EAAE,IAAI,GAAG,EAAE,IAAI,GAAG,OAAO,QAAQ;AAAA,QACrD;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AACF;AAQO,SAAS,mBAAmB;AAAA,EACjC;AAAA,EAAG;AAAA,EAAG;AAAA,EAAO;AAAA,EAAQ;AAAA,EACrB;AAAA,EAAqB;AAAA,EACrB;AAAA,EAAO;AAAA,EACP;AAAA,EAAgB;AAAA,EAChB,WAAAA;AAAA,EAAW;AACb,GAcG;AAED,gBAAc,GAAG,GAAG,OAAO,QAAQ,UAAU,qBAAqB,KAAK;AAGvE,QAAM,WAAW,MAAM,MAAM,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG;AAEzD,mBAAiB,qBAAqB,MAAM;AAE1C,kBAAc,GAAG,GAAG,OAAO,QAAQ,UAAU,kBAAkB,KAAK;AAGpE,eAAW,SAASA,WAAU,SAAS;AACrC,UAAI,UAAU,aAAc;AAC5B,YAAM,cAAe,MAAM,UAAU,MAAM,OAAO,OAAQ,MAAM,OAAO,KAAK,SAAS;AACrF,UAAI,gBAAgB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,GAAG,GAAG,OAAO,QAAQ,UAAU,WAAW,GAAG;AACzF,YAAI,eAAe;AACjB,wBAAc,KAAK;AAAA,QACrB;AAEA,cAAM,aAAa;AACnB,cAAM,SAAS,SAAS,SAAS,OAAO,KAAK;AAC7C,YAAI,MAAM,SAAU,OAAM,SAAS,SAAS,SAAS,OAAO,KAAK;AACjE,0BAAkB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,QAAQ,QAAQ;AAAA,MAC9D;AAAA,IACF;AAGA,QAAI,gBAAgB;AAClB,qBAAe,GAAG,GAAG,OAAO,QAAQ,QAAQ;AAAA,IAC9C;AAAA,EACF,CAAC;AACH;AAIO,SAAS,qBAAqB;AAEnC,aAAW,KAAK,kBAAkB;AAChC,oBAAgB,CAAC;AAAA,EACnB;AACA,mBAAiB,SAAS;AAG1B,iBAAe,SAAS;AAC1B;;;ACtYO,IAAM,cAA2C;AAAA,EACtD,QAAQ;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,UAAU;AAAA,IACV,MAAM,EAAE,QAAQ,KAAK,QAAQ,IAAI;AAAA,IACjC,OAAO,EAAE,UAAU,EAAE,KAAK,GAAG,KAAK,EAAE,GAAG,cAAc,IAAI;AAAA,IACzD,MAAM,EAAE,cAAc,IAAI;AAAA,IAC1B,SAAS;AAAA,MACP,kBAAkB;AAAA,MAClB,WAAW;AAAA,MACX,WAAW;AAAA,MACX,UAAU;AAAA,IACZ;AAAA,EACF;AAAA,EACA,gBAAgB;AAAA,IACd,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,UAAU;AAAA,IACV,MAAM,EAAE,QAAQ,MAAM,QAAQ,EAAE;AAAA,IAChC,OAAO,EAAE,UAAU,EAAE,KAAK,GAAG,KAAK,EAAE,GAAG,cAAc,KAAK;AAAA,IAC1D,MAAM,EAAE,oBAAoB,KAAK,eAAe,GAAG,eAAe,EAAE;AAAA,IACpE,QAAQ;AAAA,MACN,mBAAmB;AAAA,MACnB,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,gBAAgB;AAAA,MAChB,cAAc;AAAA,MACd,UAAU;AAAA,IACZ;AAAA,EACF;AAAA,EACA,cAAc;AAAA,IACZ,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,UAAU;AAAA,IACV,MAAM,EAAE,QAAQ,KAAK,QAAQ,IAAI;AAAA,IACjC,OAAO,EAAE,UAAU,EAAE,KAAK,GAAG,KAAK,EAAE,GAAG,cAAc,KAAK;AAAA,IAC1D,MAAM,EAAE,oBAAoB,MAAM,eAAe,KAAK,eAAe,EAAE;AAAA,IACvE,QAAQ;AAAA,MACN,aAAa;AAAA,MACb,iBAAiB;AAAA,MACjB,WAAW;AAAA,MACX,aAAa;AAAA,MACb,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,MACV,mBAAmB;AAAA,MACnB,kBAAkB;AAAA,MAClB,iBAAiB;AAAA,MACjB,UAAU;AAAA,QACR,SAAS;AAAA,QACT,UAAU;AAAA,QACV,OAAO;AAAA,QACP,WAAW;AAAA,QACX,eAAe;AAAA,QACf,eAAe;AAAA,QACf,gBAAgB;AAAA,MAClB;AAAA,IACF;AAAA,EACF;AAAA,EACA,YAAY;AAAA,IACV,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,UAAU;AAAA,IACV,MAAM,EAAE,QAAQ,KAAK,QAAQ,IAAI;AAAA,IACjC,OAAO,EAAE,UAAU,EAAE,KAAK,GAAG,KAAK,EAAE,GAAG,cAAc,IAAI;AAAA,IACzD,MAAM;AAAA,MACJ,iBAAiB;AAAA,MACjB,gBAAgB;AAAA,MAChB,mBAAmB;AAAA,MACnB,mBAAmB;AAAA,MACnB,eAAe;AAAA,MACf,eAAe;AAAA,MACf,kBAAkB;AAAA,MAClB,mBAAmB;AAAA,IACrB;AAAA,IACA,QAAQ;AAAA,MACN,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,mBAAmB;AAAA,MACnB,OAAO;AAAA,MACP,UAAU;AAAA,MACV,SAAS;AAAA,IACX;AAAA,IACA,gBAAgB;AAAA,MACd,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,cAAc;AAAA,MACd,cAAc;AAAA,MACd,mBAAmB;AAAA,IACrB;AAAA,EACF;AACF;;;ACxHA,IAAIC;AAGJ,IAAI;AAGJ,IAAM,gBAAqC,CAAC;AAC5C,IAAM,gBAAqC,CAAC;AAG5C,IAAI,uBAA4B;AAGhC,IAAI,sBAA2B;AAExB,SAAS,gBAAgBC,QAAY;AAC1C,EAAAD,YAAWC;AACb;AAEA,SAAS,iBAAiB,KAAU;AAClC,QAAM,YAAY,IAAI;AACtB,QAAM,SAAS,IAAI,KAAK,SAAS;AACjC,MAAI,CAAC,UAAW,aAAY,IAAI,MAAM,eAAe,GAAG,IAAI,EAAE;AAC9D,QAAM,MAAM,IAAI,MAAM,qBAAqB;AAAA,IACzC,OAAO,UAAU,SAAS;AAAA,IAC1B,UAAU,UAAU,YAAY;AAAA,IAChC,mBAAmB;AAAA,IACnB,aAAa;AAAA,IACb,SAAS,UAAU,WAAW;AAAA,IAC9B,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AACD,QAAM,OAAO,IAAI,MAAM,KAAK,WAAW,GAAG;AAC1C,OAAK,MAAM,IAAI,QAAQ,QAAQ,MAAM;AACrC,SAAO;AACT;AAEO,SAAS,WAAW,UAAkB,UAAeC,YAAgB;AAC1E,QAAM,MAAM,YAAY,QAAQ;AAChC,MAAI,CAAC,IAAK,QAAO;AAEjB,QAAM,QAAQ,IAAI,MAAM,MAAM;AAG9B,MAAI,CAAC,cAAc,QAAQ,GAAG;AAC5B,kBAAc,QAAQ,IAAI,IAAI,MAAM,iBAAiB,IAAI,KAAK,QAAQ,IAAI,KAAK,QAAQ,IAAI,KAAK,SAAS,KAAK,CAAC;AAAA,EACjH;AACA,QAAM,WAAW,IAAI,MAAM;AAAA,IACzB,cAAc,QAAQ;AAAA,IACtB,IAAI,MAAM,qBAAqB;AAAA,MAC7B,OAAO,IAAI;AAAA,MACX,UAAU,IAAI;AAAA,MACd,mBAAmB;AAAA,IACrB,CAAC;AAAA,EACH;AACA,WAAS,SAAS,IAAI,IAAI,KAAK,SAAS;AACxC,QAAM,IAAI,QAAQ;AAGlB,MAAI,CAAC,cAAc,QAAQ,GAAG;AAC5B,kBAAc,QAAQ,IAAI,IAAI,MAAM,eAAe,IAAI,KAAK,SAAS,KAAK,GAAG,CAAC;AAAA,EAChF;AACA,QAAM,WAAW,IAAI,MAAM;AAAA,IACzB,cAAc,QAAQ;AAAA,IACtB,IAAI,MAAM,qBAAqB;AAAA,MAC7B,OAAO,IAAI;AAAA,MACX,UAAU,IAAI;AAAA,MACd,mBAAmB;AAAA,IACrB,CAAC;AAAA,EACH;AACA,WAAS,SAAS,IAAI,IAAI,KAAK,SAAS;AACxC,QAAM,IAAI,QAAQ;AAElB,QAAM,SAAS,KAAK,QAAQ;AAC5B,EAAAF,UAAS,IAAI,KAAK;AAElB,QAAM,QAAa;AAAA,IACjB,MAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,QAAQ,IAAI;AAAA,IACZ,KAAK,SAAS,MAAM;AAAA,IACpB,UAAU,IAAI;AAAA,IACd,gBAAgB;AAAA,IAChB,YAAY;AAAA,IACZ,WAAW;AAAA;AAAA,IAEX,aAAa;AAAA,IACb,gBAAgB;AAAA,IAChB,YAAY;AAAA,IACZ,WAAW,IAAI,MAAM,QAAQ;AAAA;AAAA,IAE7B,cAAc;AAAA,IACd,cAAc;AAAA,IACd,YAAY;AAAA;AAAA,IAEZ,WAAW;AAAA,IACX,UAAU;AAAA;AAAA;AAAA,IAEV,aAAa;AAAA;AAAA,IACb,aAAa;AAAA,IACb,gBAAgB;AAAA;AAAA,IAChB,iBAAiB,EAAE,GAAG,GAAG,GAAG,EAAE;AAAA;AAAA;AAAA,IAE9B,aAAa;AAAA;AAAA,IACb,aAAa;AAAA,IACb,cAAc,EAAE,GAAG,GAAG,GAAG,EAAE;AAAA;AAAA,IAC3B,eAAe;AAAA;AAAA,IACf,oBAAoB;AAAA;AAAA;AAAA,IAEpB,cAAc;AAAA;AAAA,IACd,WAAW;AAAA;AAAA;AAAA,IAEX,cAAc;AAAA;AAAA,IACd,WAAW;AAAA;AAAA,IACX,aAAa;AAAA;AAAA,IACb,cAAc;AAAA;AAAA,IACd,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,aAAa;AAAA,IACb,aAAa;AAAA,IACb,eAAe;AAAA,IACf,cAAc;AAAA;AAAA,EAChB;AAGA,MAAI,IAAI,UAAU,IAAI,OAAO,YAAY,GAAG;AAC1C,UAAM,eAAe,IAAI,OAAO;AAChC,UAAM,eAAe;AACrB,UAAM,aAAa,iBAAiB,GAAG;AACvC,UAAM,WAAW,SAAS,IAAI,IAAI,KAAK,SAAS;AAChD,UAAM,IAAI,MAAM,UAAU;AAAA,EAC5B;AAEA,EAAAE,WAAU,QAAQ,KAAK,KAAK;AAC5B,SAAO;AACT;AAwCA,IAAM,YAAY,IAAI,MAAM,QAAQ;AAGpC,IAAI,mBAAwB;AAC5B,IAAI,kBAAuB;AAM3B,SAAS,MAAM,GAAW,GAAW,QAAgB;AACnD,MAAI,CAAC,gBAAiB,mBAAkB,aAAa;AACrD,aAAW,OAAO,iBAAiB;AACjC,QAAI,IAAI,IAAI,OAAO,UAAU,IAAI,IAAI,OAAO,UACxC,IAAI,IAAI,OAAO,UAAU,IAAI,IAAI,OAAO,QAAQ;AAClD,aAAO;AAAA,IACT;AAAA,EACF;AACA,SAAO;AACT;AAQA,SAAS,YAAY,GAAW,GAAW,IAAY,IAAY,WAAmB;AACpF,QAAM,QAAQ,MAAM,IAAI,KAAK,WAAW,IAAI,KAAK,WAAW,GAAG;AAC/D,MAAI,CAAC,MAAO,QAAO,EAAE,IAAI,GAAG;AAG5B,QAAM,OAAO,MAAM,OAAO,MAAM,QAAQ;AACxC,QAAM,OAAO,MAAM,OAAO,MAAM,QAAQ;AAKxC,QAAM,KAAK,IAAI,KAAK,WAAW,KAAK,IAAK,CAAC,KAAM;AAChD,QAAM,KAAK,IAAK,CAAC,KAAM,WAAW,KAAK,IAAI,KAAK;AAChD,QAAM,SAAS,KAAK,QAAQ,KAAK,QAAQ,KAAK,QAAQ,KAAK;AAC3D,QAAM,SAAS,KAAK,QAAQ,KAAK,QAAQ,KAAK,QAAQ,KAAK;AAG3D,MAAI,SAAS,OAAO;AAClB,QAAI,CAAC,MAAM,IAAI,IAAI,GAAG,EAAG,QAAO,EAAE,IAAI,IAAI,IAAI,CAAC,GAAG;AAClD,QAAI,CAAC,MAAM,IAAI,IAAI,GAAG,EAAG,QAAO,EAAE,IAAI,CAAC,IAAI,IAAI,GAAG;AAAA,EACpD,OAAO;AACL,QAAI,CAAC,MAAM,IAAI,IAAI,GAAG,EAAG,QAAO,EAAE,IAAI,CAAC,IAAI,IAAI,GAAG;AAClD,QAAI,CAAC,MAAM,IAAI,IAAI,GAAG,EAAG,QAAO,EAAE,IAAI,IAAI,IAAI,CAAC,GAAG;AAAA,EACpD;AAGA,SAAO,EAAE,IAAI,GAAG,IAAI,EAAE;AACxB;AAOA,SAAS,mBAAmB,IAAY,IAAY,IAAY,IAAY,SAAiB;AAC3F,MAAI,CAAC,iBAAkB,oBAAmB,mBAAmB;AAE7D,MAAI,UAAU;AAEd,aAAW,OAAO,kBAAkB;AAElC,QAAI,MAAc;AAClB,QAAI,KAAK,IAAI,EAAE,IAAI,MAAM;AAEvB,UAAI,KAAK,IAAI,QAAQ,KAAK,IAAI,KAAM;AACpC,aAAO;AACP,aAAO;AAAA,IACT,OAAO;AACL,YAAM,QAAQ,IAAI;AAClB,UAAI,MAAM,IAAI,OAAO,MAAM;AAC3B,UAAI,MAAM,IAAI,OAAO,MAAM;AAC3B,UAAI,KAAK,IAAI;AAAE,cAAM,MAAM;AAAI,aAAK;AAAI,aAAK;AAAA,MAAK;AAClD,aAAO;AACP,aAAO;AAAA,IACT;AAGA,QAAI,KAAK,IAAI,EAAE,IAAI,MAAM;AACvB,UAAI,KAAK,IAAI,QAAQ,KAAK,IAAI,KAAM;AAAA,IAEtC,OAAO;AACL,YAAM,QAAQ,IAAI;AAClB,UAAI,MAAM,IAAI,OAAO,MAAM;AAC3B,UAAI,MAAM,IAAI,OAAO,MAAM;AAC3B,UAAI,KAAK,IAAI;AAAE,cAAM,MAAM;AAAI,aAAK;AAAI,aAAK;AAAA,MAAK;AAClD,aAAO,KAAK,IAAI,MAAM,EAAE;AACxB,aAAO,KAAK,IAAI,MAAM,EAAE;AAAA,IAC1B;AAGA,QAAI,OAAO,KAAK,OAAO,KAAM;AAC7B,UAAM,IAAI,OAAO,IAAI,OAAO;AAC5B,QAAI,IAAI,KAAK,IAAI,SAAS;AACxB,gBAAU;AAAA,IACZ;AAAA,EACF;AAEA,SAAO;AACT;AAEO,SAAS,cAAc,IAAYC,YAAgBC,YAAgB;AACxE,WAAS,IAAIA,WAAU,QAAQ,SAAS,GAAG,KAAK,GAAG,KAAK;AACtD,UAAM,QAAQA,WAAU,QAAQ,CAAC;AAGjC,QAAI,MAAM,WAAW;AACnB,iBAAW,OAAO,EAAE;AAAA,IAEtB,WAAW,MAAM,YAAY,GAAG;AAE9B,YAAM,aAAa,KAAK;AAAA,IAC1B,OAAO;AAEL,cAAQ,MAAM,UAAU;AAAA,QACtB,KAAK;AAAQ,uBAAa,OAAOD,YAAW,EAAE;AAAG;AAAA,QACjD,KAAK;AAAQ,uBAAa,OAAOA,YAAW,IAAIC,UAAS;AAAG;AAAA,QAC5D,KAAK;AAAQ,uBAAa,OAAOD,YAAW,EAAE;AAAG;AAAA,QACjD,KAAK;AAAU,yBAAe,OAAOA,YAAW,IAAIC,UAAS;AAAG;AAAA,MAClE;AAAA,IACF;AAGA,UAAM,IAAI,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,IAAI,MAAM,IAAI,CAAC,CAAC;AACrD,UAAM,IAAI,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,IAAI,MAAM,IAAI,CAAC,CAAC;AACrD,QAAI,MAAM,WAAW;AAEnB,YAAM,KAAK,SAAS,IAAI,MAAM,IAAI;AAClC,YAAM,KAAK,SAAS,IAAI,MAAM,IAAI;AAAA,IACpC,OAAO;AACL,YAAM,KAAK,SAAS,KAAK,MAAM,GAAG;AAAA,IACpC;AAGA,QAAI,MAAM,aAAa,GAAG;AACxB,YAAM,cAAc,KAAK;AACzB,UAAI,MAAM,cAAc,GAAG;AACzB,cAAM,SAAS,SAAS,SAAS,OAAO,MAAM,OAAO,QAAQ;AAC7D,YAAI,MAAM,SAAU,OAAM,SAAS,SAAS,SAAS,OAAO,MAAM,OAAO,QAAQ;AAAA,MACnF;AAAA,IACF;AAGA,QAAI,MAAM,YAAY,GAAG;AACvB,YAAM,aAAa,KAAK;AACxB,UAAI,MAAM,aAAa,GAAG;AACxB,cAAM,YAAY;AAClB,cAAM,WAAW;AAAA,MACnB;AAAA,IACF;AAGA,QAAI,MAAM,gBAAgB,MAAM,YAAY;AAC1C,YAAM,YAAY,MAAM,OAAO;AAC/B,YAAM,QAAQ,MAAM,eAAe,UAAU;AAE7C,YAAM,cAAc,UAAU,WAAW;AAGzC,UAAI,UAAU,eAAe,MAAM,MAAM;AAGzC,YAAM,IAAI,KAAK,MAAM,MAAQ,MAAO,OAAS,IAAI,MAAM;AACvD,YAAM,IAAI,KAAK,MAAM,MAAO,KAAK;AACjC,YAAM,IAAI,KAAK,MAAM,MAAO,KAAK;AACjC,YAAM,WAAW,SAAS,SAAS,OAAO,IAAI,KAAK,IAAI,KAAK,IAAI,GAAG;AAGnE,UAAI,QAAQ,MAAM;AAChB,cAAM,UAAU,MAAM,MAAM,KAAK,IAAI,YAAY,IAAI,IAAI,IAAI;AAC7D,mBAAY,MAAM,MAAM;AAAA,MAC1B,OAAO;AAEL,mBAAW,OAAO,KAAK,IAAI,YAAY,IAAI,IAAI,IAAK;AAAA,MACtD;AAEA,YAAM,WAAW,SAAS,UAAU,KAAK,IAAI,MAAM,OAAO;AAAA,IAC5D;AAGA,QAAI,MAAM,aAAa,GAAG;AACxB,YAAM,cAAc,KAAK;AACzB,2BAAqB,OAAO,EAAE;AAG9B,YAAM,KAAK,SAAS,KAAK,MAAM,GAAG;AAGlC,UAAI,MAAM,WAAW;AACnB,6BAAqB,KAAK;AAC1B,YAAI,MAAM,YAAY;AACpB,gBAAM,WAAW,SAAS,QAAQ;AAClC,gBAAM,WAAW,SAAS,QAAQ;AAAA,QACpC;AACA,4BAAoB,KAAK;AACzB,iCAAyB,KAAK;AAC9B,QAAAC,UAAS,OAAO,MAAM,IAAI;AAC1B,QAAAD,WAAU,QAAQ,OAAO,GAAG,CAAC;AAC7B,cAAM,QAAQ,MAAM,OAAO;AAC3B,QAAAA,WAAU,YAAY,KAAK;AAAA,UACzB,MAAM,SAAS,MAAM,KAAK,OAAO,KAAK,MAAM,SAAS,MAAM,MAAM,SAAS,MAAM;AAAA,QAClF;AACA;AAAA,MACF;AAEA,UAAI,MAAM,cAAc,GAAG;AAEzB,YAAI,MAAM,OAAO,kBAAkB,CAAC,MAAM,WAAW;AACnD,2BAAiB,OAAOA,UAAS;AAAA,QACnC;AACA,6BAAqB,KAAK;AAG1B,YAAI,MAAM,YAAY;AACpB,gBAAM,WAAW,SAAS,QAAQ;AAClC,gBAAM,WAAW,SAAS,QAAQ;AAAA,QACpC;AACA,4BAAoB,KAAK;AACzB,iCAAyB,KAAK;AAC9B,QAAAC,UAAS,OAAO,MAAM,IAAI;AAC1B,QAAAD,WAAU,QAAQ,OAAO,GAAG,CAAC;AAC7B,cAAM,QAAQ,MAAM,OAAO;AAC3B,QAAAA,WAAU,YAAY,KAAK;AAAA,UACzB,MAAM,SAAS,MAAM,KAAK,OAAO,KAAK,MAAM,SAAS,MAAM,MAAM,SAAS,MAAM;AAAA,QAClF;AAAA,MACF;AACA;AAAA,IACF;AAGA,QAAI,MAAM,UAAU,GAAG;AACrB,YAAM,WAAW,MAAM,OAAO;AAG9B,UAAI,YAAY,SAAS,qBAAqB,CAAC,MAAM,WAAW;AAC9D,cAAM,aAAa,SAAS;AAC5B,cAAM,YAAY,SAAS,oBAAoB;AAC/C,6BAAqB,KAAK;AAC1B;AAAA,MACF;AAGA,UAAI,YAAY,CAAC,MAAM,WAAW;AAChC,yBAAiB,OAAOA,UAAS;AAAA,MACnC;AAGA,UAAI,MAAM,YAAY;AACpB,cAAM,WAAW,SAAS,QAAQ;AAClC,cAAM,WAAW,SAAS,QAAQ;AAAA,MACpC;AAEA,0BAAoB,KAAK;AACzB,+BAAyB,KAAK;AAC9B,MAAAC,UAAS,OAAO,MAAM,IAAI;AAC1B,MAAAD,WAAU,QAAQ,OAAO,GAAG,CAAC;AAE7B,YAAM,QAAQ,MAAM,OAAO;AAC3B,MAAAA,WAAU,YAAY,KAAK;AAAA,QACzB,MAAM,SAAS,MAAM,KAAK,OAAO,KAAK,MAAM,SAAS,MAAM,MAAM,SAAS,MAAM;AAAA,MAClF;AAAA,IACF;AAAA,EACF;AACF;AAEA,SAAS,aAAa,OAAYD,YAAgB,IAAY;AAE5D,MAAI,MAAM,UAAW;AAErB,YAAU,WAAWA,YAAW,MAAM,GAAG;AACzC,YAAU,IAAI;AACd,QAAM,OAAO,UAAU,OAAO;AAE9B,QAAM,WAAY,MAAM,OAAO,QAAQ,MAAM,OAAO,KAAK,gBAAiB;AAC1E,MAAI,OAAO,UAAU;AACnB,cAAU,UAAU;AACpB,UAAM,aAAa,MAAM,eAAe,QAAQ;AAChD,UAAM,aAAa,cAAc,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,KAAK;AAChE,UAAM,QAAQ,MAAM,OAAO,SAAS,MAAM,YAAY,IAAI,MAAM,WAAW,KAAK,aAAa,WAAW;AACxG,UAAM,IAAI,KAAK,UAAU,IAAI,QAAQ;AACrC,UAAM,IAAI,KAAK,UAAU,IAAI,QAAQ;AAAA,EACvC;AAGA,MAAI,OAAO,KAAK;AACd,UAAM,KAAK,SAAS,IAAI,KAAK,MAAM,CAAC,UAAU,GAAG,CAAC,UAAU,CAAC;AAAA,EAC/D;AAGA,QAAM,UAAU,MAAM,OAAO;AAC7B,MAAI,CAAC,QAAS;AAGd,MAAI,MAAM,eAAe,GAAG;AAC1B,UAAM,gBAAgB,KAAK;AAC3B,UAAM,eAAe;AACrB;AAAA,EACF;AAGA,MAAI,MAAM,gBAAgB,MAAM,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,CAAG,GAAG;AAC9D,UAAM,gBAAgB,KAAK;AAAA,EAC7B,OAAO;AACL,UAAM,eAAe;AAAA,EACvB;AAGA,MAAI,MAAM,gBAAgB,QAAQ,kBAAkB;AAClD,iBAAa,OAAOA,YAAW,OAAO;AAAA,EACxC;AACF;AAIA,SAAS,aAAa,OAAYA,YAAgB,SAAc;AAE9D,QAAM,KAAKA,WAAU,IAAI,MAAM,IAAI;AACnC,QAAM,KAAKA,WAAU,IAAI,MAAM,IAAI;AACnC,QAAM,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AACxC,MAAI,OAAO,IAAK;AAEhB,QAAM,OAAO,KAAK;AAClB,QAAM,OAAO,KAAK;AAIlB,MAAI,WAAW;AACf,WAAS,QAAQ,GAAG,SAAS,IAAI,SAAS,KAAK;AAC7C,UAAM,KAAK,MAAM,IAAI,IAAI,OAAO;AAChC,UAAM,KAAK,MAAM,IAAI,IAAI,OAAO;AAChC,QAAI,CAAC,MAAM,IAAI,IAAI,GAAG,GAAG;AACvB,iBAAW,QAAQ;AACnB;AAAA,IACF;AACA,eAAW,QAAQ;AAAA,EACrB;AAGA,aAAW,KAAK,IAAI,UAAU,EAAE;AAEhC,QAAM,YAAY;AAClB,QAAM,aAAa,MAAM,IAAI;AAC7B,QAAM,aAAa,MAAM,IAAI;AAC7B,QAAM,cAAc,MAAM,IAAI,IAAI,OAAO;AACzC,QAAM,cAAc,MAAM,IAAI,IAAI,OAAO;AACzC,QAAM,gBAAgB,QAAQ,aAAa;AAC3C,QAAM,cAAc;AACpB,QAAM,eAAe;AAGrB,QAAM,aAAa,WAAW,IAAI,MAAM,gBAAgB,MAAM,gBAAgB,KAAK,IAAI,UAAU,GAAG;AACpG,QAAM,eAAe,cAAc,QAAQ,aAAa;AAE1D;AAEA,SAAS,WAAW,OAAY,IAAY;AAC1C,QAAM,eAAe;AACrB,QAAM,IAAI,KAAK,IAAI,MAAM,cAAc,MAAM,cAAc,CAAC;AAG5D,QAAM,IAAI,IAAI,MAAM,cAAc,MAAM,cAAc,MAAM,cAAc;AAC1E,QAAM,IAAI,IAAI,MAAM,cAAc,MAAM,cAAc,MAAM,cAAc;AAG1E,QAAM,OAAO,IAAI,MAAM,gBAAgB,KAAK,IAAI;AAChD,QAAM,KAAK,SAAS,IAAI,MAAM,IAAI,GAAG,MAAM,MAAM,IAAI,CAAC;AAGtD,QAAM,KAAK,MAAM,cAAc,MAAM;AACrC,QAAM,KAAK,MAAM,cAAc,MAAM;AACrC,MAAI,KAAK,KAAK,KAAK,KAAK,MAAM;AAC5B,UAAM,KAAK,SAAS,IAAI,KAAK,MAAM,CAAC,IAAI,CAAC,EAAE;AAAA,EAC7C;AAGA,MAAI,KAAK,GAAG;AACV,UAAM,YAAY;AAClB,UAAM,eAAgB,MAAM,OAAO,WAAW,MAAM,OAAO,QAAQ,YAAa;AAEhF,UAAM,KAAK,SAAS,IAAI,MAAM,IAAI,GAAG,GAAG,MAAM,IAAI,CAAC;AAAA,EACrD;AACF;AAEA,SAAS,aAAa,OAAYA,YAAgB,IAAYC,YAAgB;AAC5E,YAAU,WAAWD,YAAW,MAAM,GAAG;AACzC,YAAU,IAAI;AACd,QAAM,OAAO,UAAU,OAAO;AAC9B,QAAM,OAAO,MAAM,OAAO,QAAQ,CAAC;AACnC,QAAM,SAAS,MAAM,OAAO,UAAU,CAAC;AACvC,QAAM,iBAAiB,MAAM,OAAO,eAAe,KAAK,sBAAsB;AAE9E,QAAM,iBAAiB,MAAM,gBAAgB;AAG7C,MAAI,CAAC,gBAAgB;AACnB,UAAM,aAAa,MAAM,eAAe,QAAQ;AAChD,UAAM,aAAa,cAAc,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,KAAK;AAChE,UAAM,QAAQ,MAAM,OAAO,SAAS,MAAM,YAAY,IAAI,MAAM,WAAW,KAAK,aAAa,WAAW;AACxG,QAAI,OAAO,kBAAkB,KAAK,iBAAiB,IAAI;AAErD,gBAAU,UAAU;AACpB,YAAM,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,CAAC,UAAU,GAAG,CAAC,UAAU,GAAG,GAAG;AACrF,YAAM,IAAI,KAAK,QAAQ,KAAK,QAAQ;AACpC,YAAM,IAAI,KAAK,QAAQ,KAAK,QAAQ;AAAA,IACtC,WAAW,OAAO,kBAAkB,KAAK,iBAAiB,IAAI;AAE5D,gBAAU,UAAU;AACpB,YAAM,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,UAAU,GAAG,UAAU,GAAG,GAAG;AACnF,YAAM,IAAI,KAAK,QAAQ,KAAK,QAAQ;AACpC,YAAM,IAAI,KAAK,QAAQ,KAAK,QAAQ;AAAA,IACtC;AAAA,EACF;AAGA,MAAI,gBAAgB;AAClB,UAAM,KAAK,SAAS,IAAI,MAAM,iBAAiB,KAAK;AAAA,EACtD,WAAW,OAAO,KAAK;AACrB,UAAM,KAAK,UAAU,IAAI;AACzB,UAAM,KAAK,UAAU,IAAI;AACzB,UAAM,KAAK,SAAS,IAAI,KAAK,MAAM,CAAC,IAAI,CAAC,EAAE;AAAA,EAC7C;AAGA,QAAM,MAAM,YAAY,IAAI;AAE5B,MAAI,MAAM,gBAAgB,QAAQ;AAEhC,QAAI,OAAO,MAAM,OAAO,eAAe,MAAM,MAAM,iBAAiB,MAAM,OAAO,YAAY;AAE3F,YAAM,cAAc;AACpB,YAAM,cAAc,OAAO,qBAAqB;AAGhD,YAAM,WAAW,KAAK,MAAMA,WAAU,IAAI,MAAM,IAAI,GAAGA,WAAU,IAAI,MAAM,IAAI,CAAC;AAChF,YAAM,iBAAiB;AACvB,YAAM,gBAAgB,OAAO,cAAc;AAG3C,YAAM,OAAO,KAAK,IAAI,QAAQ;AAC9B,YAAM,OAAO,KAAK,IAAI,QAAQ;AAC9B,YAAM,cAAc,mBAAmB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,MAAM,MAAM,aAAa;AAC1F,YAAM,aAAa,KAAK,IAAI,eAAe,WAAW;AAGtD,YAAM,gBAAgB,IAAI,MAAM,IAAI,IAAI,QAAQ,aAAa;AAC7D,YAAM,gBAAgB,IAAI,MAAM,IAAI,IAAI,QAAQ,aAAa;AAG7D,YAAM,aAAa,OAAO,qBAAqB;AAC/C,YAAM,SAAS,SAAS,SAAS,OAAO,OAAO,SAAS,QAAQ;AAChE,UAAI,MAAM,SAAU,OAAM,SAAS,SAAS,SAAS,OAAO,OAAO,SAAS,QAAQ;AAGpF,YAAM,YAAY,OAAO,aAAa;AACtC,YAAM,MAAM,OAAO,UAAU;AAC7B,YAAM,QAAQ,OAAO,SAAS;AAC9B,YAAM,WAAW,OAAO,kBAAkB;AAE1C,yBAAmB;AAAA,QACjB,GAAG,MAAM,gBAAgB;AAAA,QACzB,GAAG,MAAM,gBAAgB;AAAA,QACzB,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,UAAU;AAAA,QACV,qBAAqB,OAAO,qBAAqB;AAAA,QACjD,kBAAkB;AAAA,QAClB;AAAA,QACA,QAAQ;AAAA,QACR,eAAe,CAAC,MAAW;AAEzB,YAAE,UAAU;AAEZ,gBAAM,UAAU,OAAO,gBAAgB;AACvC,gBAAM,UAAU,OAAO,YAAY;AACnC,oBAAU,GAAG,SAAS,OAAO;AAC7B,4BAAkB,EAAE,IAAI,GAAG,EAAE,IAAI,GAAG,UAAU,SAAS;AAAA,QACzD;AAAA,QACA,gBAAgB,CAAC,IAAY,IAAY,GAAW,GAAW,QAAgB;AAE7E,cAAI,mBAAmB,EAAG;AAC1B,gBAAM,KAAK,aAAa;AACxB,cAAI,gBAAgB,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG;AAClD,YAAAC,WAAU,gBAAgB;AAC1B,wBAAY,GAAG,GAAG;AAClB,8BAAkB,GAAG,GAAG,GAAG,GAAG,KAAK,SAAS;AAC5C,gBAAIA,WAAU,gBAAgB,GAAG;AAC/B,cAAAA,WAAU,eAAe;AACzB,cAAAA,WAAU,QAAQ;AAAA,YACpB;AAAA,UACF;AAAA,QACF;AAAA,QACA,WAAAA;AAAA,QACA,cAAc;AAAA,MAChB,CAAC;AAAA,IACH;AAAA,EACF,WAAW,MAAM,gBAAgB,gBAAgB;AAE/C,UAAM,eAAe,KAAK;AAC1B,QAAI,MAAM,eAAe,GAAG;AAE1B,YAAM,cAAc;AACpB,YAAM,iBAAiB;AAAA,IACzB;AAAA,EACF;AACF;AAGA,SAAS,eAAe,OAAYD,YAAgB,IAAYC,YAAgB;AAC9E,YAAU,WAAWD,YAAW,MAAM,GAAG;AACzC,YAAU,IAAI;AACd,QAAM,OAAO,UAAU,OAAO;AAC9B,QAAM,OAAO,MAAM,OAAO,QAAQ,CAAC;AACnC,QAAM,SAAS,MAAM,OAAO,UAAU,CAAC;AACvC,QAAM,iBAAiB,MAAM,OAAO,eAAe,KAAK,sBAAsB;AAE9E,QAAM,WAAW,MAAM,gBAAgB;AAGvC,MAAI,CAAC,UAAU;AACb,UAAM,aAAa,MAAM,eAAe,QAAQ;AAChD,UAAM,aAAa,cAAc,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,KAAK;AAChE,UAAM,QAAQ,MAAM,OAAO,SAAS,MAAM,YAAY,IAAI,MAAM,WAAW,KAAK,aAAa,WAAW;AACxG,QAAI,OAAO,kBAAkB,KAAK,iBAAiB,MAAM;AACvD,gBAAU,UAAU;AACpB,YAAM,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,CAAC,UAAU,GAAG,CAAC,UAAU,GAAG,GAAG;AACrF,YAAM,IAAI,KAAK,QAAQ,KAAK,QAAQ;AACpC,YAAM,IAAI,KAAK,QAAQ,KAAK,QAAQ;AAAA,IACtC,WAAW,OAAO,kBAAkB,KAAK,iBAAiB,IAAI;AAC5D,gBAAU,UAAU;AACpB,YAAM,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,UAAU,GAAG,UAAU,GAAG,GAAG;AACnF,YAAM,IAAI,KAAK,QAAQ,KAAK,QAAQ;AACpC,YAAM,IAAI,KAAK,QAAQ,KAAK,QAAQ;AAAA,IACtC;AAAA,EACF;AAGA,MAAI,UAAU;AACZ,UAAM,KAAK,MAAM,aAAa,IAAI,MAAM,IAAI;AAC5C,UAAM,KAAK,MAAM,aAAa,IAAI,MAAM,IAAI;AAC5C,QAAI,KAAK,IAAI,EAAE,IAAI,QAAQ,KAAK,IAAI,EAAE,IAAI,MAAM;AAC9C,YAAM,KAAK,SAAS,IAAI,KAAK,MAAM,CAAC,IAAI,CAAC,EAAE;AAAA,IAC7C;AAAA,EACF,WAAW,OAAO,KAAK;AACrB,UAAM,KAAK,UAAU,IAAI;AACzB,UAAM,KAAK,UAAU,IAAI;AACzB,UAAM,KAAK,SAAS,IAAI,KAAK,MAAM,CAAC,IAAI,CAAC,EAAE;AAAA,EAC7C;AAGA,QAAM,MAAM,YAAY,IAAI;AAE5B,MAAI,MAAM,gBAAgB,QAAQ;AAChC,QAAI,OAAO,MAAM,OAAO,eAAe,MAAM,MAAM,iBAAiB,MAAM,OAAO,YAAY;AAE3F,YAAM,cAAc;AACpB,YAAM,cAAc,OAAO,eAAe;AAG1C,YAAM,aAAa,OAAO,cAAc;AACxC,YAAM,QAAQ,KAAK,OAAO,IAAI,KAAK,KAAK;AACxC,YAAM,aAAa,IAAIA,WAAU,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,OAAO,IAAI;AACvE,YAAM,aAAa,IAAIA,WAAU,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,OAAO,IAAI;AAGvE,YAAM,aAAa,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,IAAI,MAAM,aAAa,CAAC,CAAC;AACvE,YAAM,aAAa,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,IAAI,MAAM,aAAa,CAAC,CAAC;AAGvE,YAAM,aAAa,OAAO,eAAe;AACzC,YAAM,SAAS,SAAS,SAAS,OAAO,OAAO,SAAS,QAAQ;AAChE,UAAI,MAAM,SAAU,OAAM,SAAS,SAAS,SAAS,OAAO,OAAO,SAAS,QAAQ;AAGpF,0BAAoB,KAAK;AAGzB,+BAAyB,KAAK;AAAA,IAChC;AAAA,EACF,WAAW,MAAM,gBAAgB,UAAU;AACzC,UAAM,eAAe,KAAK;AAG1B,wBAAoB,KAAK;AAGzB,QAAI,MAAM,oBAAoB;AAC5B,YAAM,KAAK,MAAM;AACjB,YAAM,cAAc,OAAO,eAAe;AAC1C,YAAM,cAAc,IAAK,MAAM,cAAc;AAG7C,SAAG,gBAAgB;AACnB,YAAM,SAAS,KAAK,IAAI,GAAG,eAAe,GAAG,eAAe,CAAC;AAC7D,YAAM,QAAQ,KAAK,IAAI,WAAW,IAAI;AACtC,YAAM,SAAS,GAAG;AAClB,YAAM,IAAI,GAAG,gBAAgB,UAAU,IAAI,UAAU;AACrD,SAAG,MAAM,MAAM,IAAI,GAAG,GAAG,CAAC;AAG1B,YAAM,OAAO,OAAQ,OAAQ;AAC7B,YAAM,QAAQ,OAAO,OAAO,KAAK,IAAI,YAAY,IAAI,IAAI,IAAI;AAC7D,SAAG,QAAQ,WAAW,MAAM,OAAO,eAAe;AAClD,SAAG,QAAQ,UAAU,OAAO,OAAO;AAAA,IACrC;AAEA,QAAI,MAAM,eAAe,GAAG;AAE1B,YAAM,cAAc;AACpB,YAAM,iBAAiB;AAGvB,0BAAoB,KAAK;AAGzB,YAAM,eAAe,MAAM;AAC3B,YAAM,qBAAqB;AAG3B,2BAAqB;AAAA,QACnB,QAAQ,MAAM,IAAI;AAAA,QAClB,QAAQ,MAAM,IAAI;AAAA,QAClB,SAAS,MAAM,aAAa;AAAA,QAC5B,SAAS,MAAM,aAAa;AAAA,QAC5B,WAAW,OAAO,aAAa;AAAA,QAC/B,OAAO,OAAO,mBAAmB;AAAA,QACjC,OAAO,OAAO,SAAS;AAAA,QACvB,aAAa,OAAO,eAAe;AAAA,QACnC,QAAQ,OAAO,UAAU;AAAA,QACzB,cAAc,OAAO,gBAAgB;AAAA,QACrC,UAAU,OAAO,YAAY;AAAA,QAC7B,mBAAmB,OAAO,qBAAqB;AAAA,QAC/C,UAAU,OAAO,YAAY;AAAA,QAC7B,WAAAC;AAAA,QACA,aAAa;AAAA,QACb;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AACF;AAIA,IAAM,eAAe;AACrB,IAAI,cAAmB;AAEvB,SAAS,oBAAoB,OAAY;AACvC,MAAI,CAAC,aAAa;AAChB,UAAM,YAAY,IAAI,cAAc,eAAe,KAAK,CAAC;AACzD,kBAAc,IAAI,MAAM,eAAe;AACvC,gBAAY,aAAa,YAAY,IAAI,MAAM,gBAAgB,WAAW,CAAC,CAAC;AAAA,EAC9E;AAGA,QAAM,MAAM,YAAY,MAAM;AAC9B,MAAI,aAAa,YAAY,IAAI,MAAM;AAAA,IACrC,IAAI,cAAc,eAAe,KAAK,CAAC;AAAA,IAAG;AAAA,EAC5C,CAAC;AAED,QAAM,MAAM,IAAI,MAAM,kBAAkB;AAAA,IACtC,OAAO,MAAM,OAAO,QAAQ,SAAS;AAAA,IACrC,aAAa;AAAA,IACb,SAAS;AAAA,IACT,YAAY;AAAA,EACd,CAAC;AAED,QAAM,OAAO,IAAI,MAAM,KAAK,KAAK,GAAG;AACpC,EAAAC,UAAS,IAAI,IAAI;AACjB,QAAM,gBAAgB;AAEtB,sBAAoB,KAAK;AAC3B;AAEA,SAAS,oBAAoB,OAAY;AACvC,MAAI,CAAC,MAAM,cAAe;AAC1B,QAAM,SAAS,MAAM,OAAO,UAAU,CAAC;AACvC,QAAM,KAAK,MAAM,IAAI;AACrB,QAAM,KAAK,MAAM,IAAI;AACrB,QAAM,KAAK,MAAM,aAAa;AAC9B,QAAM,KAAK,MAAM,aAAa;AAC9B,QAAM,OAAO,OAAO,aAAa;AACjC,QAAM,SAAS;AAEf,QAAM,YAAY,MAAM,cAAc,SAAS,WAAW,SAAS;AACnE,WAAS,IAAI,GAAG,KAAK,cAAc,KAAK;AACtC,UAAM,IAAI,IAAI;AACd,UAAM,IAAI,MAAM,KAAK,MAAM;AAC3B,UAAM,IAAI,MAAM,KAAK,MAAM;AAE3B,UAAM,IAAI,SAAS,IAAI,OAAO,KAAK,IAAI;AACvC,cAAU,IAAI,CAAC,IAAI;AACnB,cAAU,IAAI,IAAI,CAAC,IAAI;AACvB,cAAU,IAAI,IAAI,CAAC,IAAI;AAAA,EACzB;AACA,QAAM,cAAc,SAAS,WAAW,SAAS,cAAc;AAG/D,QAAM,QAAQ,MAAM,MAAM,KAAK,IAAI,YAAY,IAAI,IAAI,IAAK;AAC5D,QAAM,cAAc,SAAS,UAAU;AACzC;AAEA,SAAS,oBAAoB,OAAY;AACvC,MAAI,MAAM,eAAe;AACvB,UAAM,cAAc,SAAS,QAAQ;AACrC,UAAM,cAAc,SAAS,QAAQ;AACrC,IAAAA,UAAS,OAAO,MAAM,aAAa;AACnC,UAAM,gBAAgB;AAAA,EACxB;AACF;AAIA,IAAI,aAAkB;AAEtB,SAAS,yBAAyB,OAAY;AAC5C,QAAM,SAAS,MAAM,OAAO,UAAU,CAAC;AACvC,QAAM,SAAS,OAAO,eAAe;AACrC,QAAM,QAAQ,OAAO,SAAS;AAG9B,MAAI,CAAC,YAAY;AACf,iBAAa,IAAI,MAAM,aAAa,MAAM,GAAK,EAAE;AACjD,eAAW,QAAQ,CAAC,KAAK,KAAK,CAAC;AAAA,EACjC;AAGA,QAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,IAC1C;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AACD,QAAM,WAAW,IAAI,MAAM,KAAK,YAAY,OAAO;AAGnD,MAAI,CAAC,sBAAsB;AACzB,2BAAuB,IAAI,MAAM,eAAe,GAAG,EAAE;AACrD,yBAAqB,QAAQ,CAAC,KAAK,KAAK,CAAC;AAAA,EAC3C;AACA,QAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,IAC1C;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AACD,QAAM,WAAW,IAAI,MAAM,KAAK,sBAAsB,OAAO;AAE7D,QAAM,QAAQ,IAAI,MAAM,MAAM;AAC9B,QAAM,IAAI,QAAQ;AAClB,QAAM,IAAI,QAAQ;AAClB,QAAM,SAAS,IAAI,MAAM,aAAa,GAAG,MAAM,MAAM,aAAa,CAAC;AACnE,QAAM,mBAAmB,OAAO,oBAAoB;AACpD,QAAM,aAAa,SAAS;AAC5B,QAAM,MAAM,IAAI,YAAY,YAAY,UAAU;AAClD,EAAAA,UAAS,IAAI,KAAK;AAElB,QAAM,qBAAqB;AAAA,IACzB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAc;AAAA,IACd;AAAA,IACA,cAAc;AAAA;AAAA,IACd,gBAAgB,OAAO,mBAAmB,OAAO;AAAA;AAAA,EACnD;AACF;AAEA,SAAS,yBAAyB,OAAY;AAC5C,MAAI,MAAM,oBAAoB;AAC5B,UAAM,KAAK,MAAM;AACjB,OAAG,QAAQ,QAAQ;AACnB,OAAG,QAAQ,QAAQ;AAEnB,IAAAA,UAAS,OAAO,GAAG,KAAK;AACxB,UAAM,qBAAqB;AAAA,EAC7B;AACF;AAIA,IAAI,kBAAuB;AAE3B,SAAS,qBAAqB,OAAY;AACxC,QAAM,MAAM,MAAM,OAAO;AACzB,QAAM,SAAS,IAAI;AACnB,QAAM,QAAQ,IAAI;AAGlB,MAAI,CAAC,iBAAiB;AACpB,sBAAkB,IAAI,MAAM,aAAa,MAAM,GAAK,EAAE;AACtD,oBAAgB,QAAQ,CAAC,KAAK,KAAK,CAAC;AAAA,EACtC;AAGA,QAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,IAC1C;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AACD,QAAM,WAAW,IAAI,MAAM,KAAK,iBAAiB,OAAO;AAGxD,MAAI,CAAC,qBAAqB;AACxB,0BAAsB,IAAI,MAAM,eAAe,GAAG,EAAE;AACpD,wBAAoB,QAAQ,CAAC,KAAK,KAAK,CAAC;AAAA,EAC1C;AACA,QAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,IAC1C;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AACD,QAAM,WAAW,IAAI,MAAM,KAAK,qBAAqB,OAAO;AAE5D,QAAM,QAAQ,IAAI,MAAM,MAAM;AAC9B,QAAM,IAAI,QAAQ;AAClB,QAAM,IAAI,QAAQ;AAClB,QAAM,SAAS,IAAI,MAAM,IAAI,GAAG,MAAM,MAAM,IAAI,CAAC;AAEjD,QAAM,MAAM,IAAI,KAAK,KAAK,GAAG;AAC7B,EAAAA,UAAS,IAAI,KAAK;AAElB,QAAM,iBAAiB;AAAA,IACrB;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAc;AAAA,EAChB;AACF;AAEA,SAAS,qBAAqB,OAAY,KAAa;AACrD,QAAM,KAAK,MAAM;AACjB,MAAI,CAAC,GAAI;AAET,QAAM,MAAM,MAAM,OAAO;AACzB,QAAM,YAAY,IAAI,qBAAqB,OAAO;AAClD,QAAM,WAAW,IAAI,oBAAoB,MAAM,cAAc;AAC7D,QAAM,IAAI,KAAK,IAAI,UAAU,UAAU,CAAC;AAGxC,QAAM,QAAQ,GAAG,eAAe;AAChC,KAAG,MAAM,MAAM,IAAI,OAAO,OAAO,KAAK;AAGtC,KAAG,MAAM,SAAS,IAAI,MAAM,IAAI,GAAG,MAAM,MAAM,IAAI,CAAC;AAGpD,QAAM,QAAQ,MAAM,MAAM,KAAK,IAAI,YAAY,IAAI,IAAI,IAAI;AAC3D,KAAG,QAAQ,UAAU;AACrB,KAAG,QAAQ,UAAU,OAAO,OAAO;AACrC;AAEA,SAAS,qBAAqB,OAAY;AACxC,QAAM,KAAK,MAAM;AACjB,MAAI,CAAC,GAAI;AACT,KAAG,QAAQ,QAAQ;AACnB,KAAG,QAAQ,QAAQ;AAEnB,EAAAA,UAAS,OAAO,GAAG,KAAK;AACxB,QAAM,iBAAiB;AACzB;AAIA,SAAS,iBAAiB,OAAYD,YAAgB;AACpD,QAAM,MAAM,MAAM,OAAO;AACzB,QAAM,IAAI,MAAM,IAAI;AACpB,QAAM,IAAI,MAAM,IAAI;AAGpB,cAAY,GAAG,GAAG;AAGlB,QAAM,WAAW,MAAM,IAAI,MAAM,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG;AAC7D,oBAAkB,GAAG,GAAG,QAAQ,QAAQ;AAGxC,iBAAe;AAAA,IACb;AAAA,IACA;AAAA,IACA,QAAQ,IAAI;AAAA,IACZ,YAAY,IAAI,gBAAgB;AAAA,IAChC,OAAO,IAAI;AAAA,IACX,OAAO,IAAI,SAAS;AAAA,IACpB,UAAU,CAAC,MAAW;AACpB,QAAE,UAAU,IAAI;AAChB,UAAI,IAAI,eAAe,GAAG;AACxB,kBAAU,GAAG,IAAI,YAAY;AAAA,MAC/B;AAAA,IACF;AAAA,IACA,WAAAA;AAAA,IACA,cAAc;AAAA;AAAA,EAChB,CAAC;AAGD,QAAM,KAAK,aAAa;AACxB,QAAM,MAAM,GAAG,IAAI;AACnB,QAAM,MAAM,GAAG,IAAI;AACnB,QAAM,aAAa,KAAK,KAAK,MAAM,MAAM,MAAM,GAAG;AAClD,MAAI,aAAa,IAAI,UAAU,CAAC,mBAAmB,GAAG;AACpD,IAAAA,WAAU,gBAAgB,IAAI;AAC9B,gBAAY,GAAG,GAAG;AAClB,sBAAkB,GAAG,GAAG,GAAG,GAAG,IAAI,QAAQ,SAAS;AACnD,QAAIA,WAAU,gBAAgB,GAAG;AAC/B,MAAAA,WAAU,eAAe;AACzB,MAAAA,WAAU,QAAQ;AAAA,IACpB;AAAA,EACF;AACF;AAEA,SAAS,aAAa,OAAYD,YAAgB,IAAY;AAC5D,QAAM,OAAO,MAAM,OAAO,QAAQ,CAAC;AACnC,YAAU,WAAWA,YAAW,MAAM,GAAG;AACzC,YAAU,IAAI;AACd,QAAM,OAAO,UAAU,OAAO;AAE9B,QAAM,aAAa,MAAM,YAAY,IAAI,MAAM,WAAW;AAC1D,QAAM,aAAa,MAAM,eAAe,QAAQ;AAChD,QAAM,aAAa,cAAc,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,KAAK;AAChE,MAAI,MAAM,YAAY;AAEpB,UAAM,YAAY,KAAK,mBAAmB;AAC1C,UAAM,IAAI,KAAK,MAAM,UAAU,IAAI,MAAM,OAAO,QAAQ,YAAY,aAAa,aAAa,WAAW,YAAY;AACrH,UAAM,IAAI,KAAK,MAAM,UAAU,IAAI,MAAM,OAAO,QAAQ,YAAY,aAAa,aAAa,WAAW,YAAY;AACrH,UAAM,eAAe,KAAK;AAE1B,QAAI,MAAM,eAAe,GAAG;AAC1B,YAAM,aAAa;AACnB,YAAM,QAAQ,KAAK,qBAAqB;AACxC,YAAM,QAAQ,KAAK,qBAAqB;AACxC,YAAM,iBAAiB,QAAQ,KAAK,OAAO,KAAK,QAAQ;AAAA,IAC1D;AAAA,EACF,OAAO;AAEL,QAAI,OAAO,GAAG;AACZ,gBAAU,UAAU;AACpB,YAAM,IAAI,KAAK,UAAU,IAAI,MAAM,OAAO,QAAQ,aAAa,aAAa,WAAW,YAAY;AACnG,YAAM,IAAI,KAAK,UAAU,IAAI,MAAM,OAAO,QAAQ,aAAa,aAAa,WAAW,YAAY;AAAA,IACrG;AAGA,UAAM,kBAAkB,KAAK;AAC7B,UAAM,OAAO,KAAK,iBAAiB;AACnC,UAAM,OAAO,KAAK,iBAAiB;AACnC,QAAI,MAAM,kBAAkB,KAAK,OAAO,QAAQ,OAAO,MAAM;AAE3D,YAAM,aAAa;AACnB,YAAM,cAAc,KAAK,kBAAkB;AAC3C,gBAAU,WAAWA,YAAW,MAAM,GAAG,EAAE,UAAU;AACrD,YAAM,UAAU,KAAK,SAAS;AAG9B,YAAM,cAAc,KAAK,qBAAqB;AAC9C,YAAM,aAAa;AACnB,YAAM,SAAS,SAAS,SAAS,OAAO,QAAQ;AAChD,UAAI,MAAM,SAAU,OAAM,SAAS,SAAS,SAAS,OAAO,QAAQ;AAAA,IACtE;AAAA,EACF;AAGA,MAAI,OAAO,KAAK;AACd,UAAM,KAAMA,WAAU,IAAI,MAAM,IAAI;AACpC,UAAM,KAAMA,WAAU,IAAI,MAAM,IAAI;AACpC,UAAM,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AACrC,QAAI,IAAI,GAAG;AACT,YAAM,KAAK,SAAS,IAAI,KAAK,MAAM,CAAC,KAAK,GAAG,CAAC,KAAK,CAAC;AAAA,IACrD;AAAA,EACF;AACF;AAEO,SAAS,UAAU,OAAY,YAAoB,MAAc;AACtE,QAAM,YAAY;AAClB,QAAM,WAAW;AACnB;AAEO,SAAS,UAAU,OAAY,YAAoB;AACxD,QAAM,YAAY;AAElB,QAAM,aAAa;AAEnB,MAAI,MAAM,gBAAgB,gBAAgB;AACxC,UAAM,cAAc;AAAA,EACtB;AAEA,MAAI,MAAM,gBAAgB,UAAU;AAClC,UAAM,cAAc;AACpB,wBAAoB,KAAK;AACzB,6BAAyB,KAAK;AAAA,EAChC;AACF;AAaO,SAAS,aAAaG,YAAgB;AAC3C,aAAW,SAASA,WAAU,SAAS;AAErC,QAAI,MAAM,YAAY;AACpB,YAAM,WAAW,SAAS,QAAQ;AAClC,YAAM,WAAW,SAAS,QAAQ;AAAA,IACpC;AAEA,wBAAoB,KAAK;AACzB,6BAAyB,KAAK;AAE9B,yBAAqB,KAAK;AAC1B,IAAAC,UAAS,OAAO,MAAM,IAAI;AAAA,EAC5B;AACA,EAAAD,WAAU,QAAQ,SAAS;AAG3B,qBAAmB;AACnB,oBAAkB;AACpB;;;ACxrCA,IAAIE;AAGJ,IAAM,gBAAuB,CAAC;AAG9B,IAAM,mBAA0B,CAAC;AAGjC,IAAI;AAEG,SAAS,iBAAiBC,QAAY;AAC3C,EAAAD,YAAWC;AACb;AAKO,SAAS,qBAAqB,MAAW;AAC9C,MAAI,CAAC,UAAU;AACb,eAAW,IAAI,MAAM,eAAe,MAAM,GAAG,CAAC;AAAA,EAChD;AAEA,QAAM,MAAM,IAAI,MAAM,qBAAqB;AAAA,IACzC,OAAO,KAAK;AAAA,IACZ,UAAU,KAAK;AAAA,IACf,mBAAmB;AAAA,EACrB,CAAC;AAED,QAAM,OAAO,IAAI,MAAM,KAAK,UAAU,GAAG;AACzC,OAAK,SAAS,IAAI,KAAK,QAAQ,KAAK,KAAK,MAAM;AAC/C,EAAAD,UAAS,IAAI,IAAI;AAGjB,QAAM,iBAAiB,IAAI,aAAa,KAAK,CAAC;AAC9C,QAAM,WAAW,IAAI,MAAM,eAAe;AAC1C,WAAS,aAAa,YAAY,IAAI,MAAM,gBAAgB,gBAAgB,CAAC,CAAC;AAC9E,QAAM,WAAW,IAAI,MAAM,kBAAkB;AAAA,IAC3C,OAAO,KAAK;AAAA,IACZ,aAAa;AAAA,IACb,SAAS;AAAA,IACT,YAAY;AAAA,EACd,CAAC;AACD,QAAM,QAAQ,IAAI,MAAM,KAAK,UAAU,QAAQ;AAC/C,EAAAA,UAAS,IAAI,KAAK;AAGlB,QAAM,KAAK,KAAK,UAAU,KAAK;AAC/B,QAAM,KAAK,KAAK,UAAU,KAAK;AAC/B,QAAM,aAAa,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAI9C,QAAM,SAAS,aAAa,MACxB,aAAa,IAAI,KAAK,YAAY,KAAK,YAAY,aACnD,KAAK,YAAY;AACrB,QAAM,aAAa,SAAS,KAAK;AAEjC,QAAM,SAAc;AAAA,IAClB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,QAAQ,KAAK;AAAA,IACb,QAAQ,KAAK;AAAA,IACb,SAAS,KAAK;AAAA,IACd,SAAS,KAAK;AAAA,IACd,WAAW,KAAK;AAAA,IAChB;AAAA,IACA,SAAS;AAAA,IACT,OAAO,KAAK;AAAA,IACZ,aAAa,KAAK;AAAA,IAClB,QAAQ,KAAK;AAAA,IACb,cAAc,KAAK;AAAA,IACnB,UAAU,KAAK;AAAA,IACf,mBAAmB,KAAK;AAAA,IACxB,UAAU,KAAK,YAAY;AAAA,IAC3B,WAAW,KAAK;AAAA,IAChB,aAAa,KAAK;AAAA,IAClB,cAAc,CAAC;AAAA;AAAA,IACf,cAAc,KAAK,gBAAgB;AAAA;AAAA,EACrC;AAEA,gBAAc,KAAK,MAAM;AACzB,SAAO;AACT;AAMO,SAAS,wBAAwB,IAAY;AAClD,WAAS,IAAI,cAAc,SAAS,GAAG,KAAK,GAAG,KAAK;AAClD,UAAM,IAAI,cAAc,CAAC;AACzB,MAAE,WAAW;AACb,UAAM,IAAI,KAAK,IAAI,EAAE,UAAU,EAAE,YAAY,CAAC;AAG9C,UAAM,IAAI,EAAE,UAAU,EAAE,UAAU,EAAE,UAAU;AAC9C,UAAM,IAAI,EAAE,UAAU,EAAE,UAAU,EAAE,UAAU;AAC9C,UAAM,IAAI,MAAM,IAAI,EAAE,YAAY,KAAK,IAAI;AAE3C,MAAE,KAAK,SAAS,IAAI,GAAG,GAAG,CAAC;AAG3B,UAAM,QAAQ,MAAM,MAAM,KAAK,IAAI,YAAY,IAAI,IAAI,IAAI;AAC3D,MAAE,IAAI,oBAAoB;AAG1B,MAAE,aAAa,KAAK,EAAE,GAAG,GAAG,EAAE,CAAC;AAC/B,QAAI,EAAE,aAAa,SAAS,GAAI,GAAE,aAAa,MAAM;AAErD,UAAM,YAAY,EAAE,SAAS,WAAW,SAAS;AACjD,aAAS,IAAI,GAAG,IAAI,IAAI,KAAK;AAC3B,YAAM,MAAM,IAAI,EAAE,aAAa,SAAS,IAAI,EAAE,aAAa,SAAS;AACpE,YAAM,IAAI,EAAE,aAAa,GAAG;AAC5B,gBAAU,IAAI,CAAC,IAAI,EAAE;AACrB,gBAAU,IAAI,IAAI,CAAC,IAAI,EAAE;AACzB,gBAAU,IAAI,IAAI,CAAC,IAAI,EAAE;AAAA,IAC3B;AACA,MAAE,SAAS,WAAW,SAAS,cAAc;AAC7C,MAAE,SAAS,aAAa,GAAG,EAAE,aAAa,MAAM;AAGhD,MAAE,SAAS,UAAU,OAAO,IAAI,IAAI;AAGpC,QAAI,EAAE,cAAc;AAClB,YAAM,KAAK,EAAE;AAEb,YAAM,cAAc,MAAM,MAAM;AAEhC,YAAM,cAAc,OAAO,OAAO;AAElC,YAAM,UAAU,OAAO,OAAO,KAAK,IAAI,YAAY,IAAI,KAAK,OAAQ,QAAQ,EAAE;AAC9E,SAAG,QAAQ,UAAU,cAAc;AACnC,SAAG,QAAQ,UAAU;AAAA,IACvB;AAGA,QAAI,KAAK,GAAG;AACV,qBAAe,CAAC;AAChB,mBAAa,CAAC;AACd,oBAAc,OAAO,GAAG,CAAC;AAAA,IAC3B;AAAA,EACF;AACF;AAKA,SAAS,eAAe,GAAQ;AAC9B,QAAM,KAAK,EAAE;AACb,QAAM,KAAK,EAAE;AAGb,cAAY,GAAG,GAAG;AAGlB,iBAAe;AAAA,IACb,GAAG;AAAA,IACH,GAAG;AAAA,IACH,QAAQ,EAAE;AAAA,IACV,YAAY,EAAE;AAAA,IACd,OAAO,EAAE;AAAA,IACT,OAAO;AAAA,IACP,UAAU,CAAC,MAAW;AACpB,QAAE,UAAU,EAAE;AACd,gBAAU,GAAG,EAAE,cAAc,EAAE,QAAQ;AAAA,IACzC;AAAA,IACA,WAAW,EAAE;AAAA,IACb,cAAc,EAAE;AAAA,EAClB,CAAC;AAGD,QAAM,KAAK,aAAa;AACxB,QAAM,MAAM,GAAG,IAAI;AACnB,QAAM,MAAM,GAAG,IAAI;AACnB,QAAM,aAAa,KAAK,KAAK,MAAM,MAAM,MAAM,GAAG;AAClD,MAAI,aAAa,EAAE,eAAe,CAAC,mBAAmB,GAAG;AACvD,MAAE,UAAU,gBAAgB,EAAE;AAC9B,gBAAY,GAAG,GAAG;AAClB,sBAAkB,GAAG,GAAG,GAAG,GAAG,EAAE,QAAQ,SAAS;AACjD,QAAI,EAAE,UAAU,gBAAgB,GAAG;AACjC,QAAE,UAAU,eAAe;AAC3B,QAAE,UAAU,QAAQ;AAAA,IACtB;AAAA,EACF;AAGA,MAAI,EAAE,YAAY,EAAE,SAAS,SAAS;AACpC,mBAAe,IAAI,IAAI,EAAE,aAAa,EAAE,QAAQ;AAAA,EAClD;AACF;AAKA,SAAS,eAAe,GAAW,GAAW,QAAgB,QAAa;AAEzE,QAAM,MAAM,IAAI,MAAM,eAAe,QAAQ,EAAE;AAC/C,MAAI,QAAQ,CAAC,KAAK,KAAK,CAAC;AAExB,QAAM,MAAM,IAAI,MAAM,kBAAkB;AAAA,IACtC,OAAO,OAAO,SAAS;AAAA,IACvB,aAAa;AAAA,IACb,SAAS;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AAED,QAAM,OAAO,IAAI,MAAM,KAAK,KAAK,GAAG;AACpC,OAAK,SAAS,IAAI,GAAG,MAAM,CAAC;AAC5B,EAAAA,UAAS,IAAI,IAAI;AAEjB,QAAM,QAAQ;AAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,UAAU,OAAO;AAAA,IACjB,SAAS;AAAA,IACT,WAAW,OAAO;AAAA,IAClB,eAAe,OAAO;AAAA,IACtB,eAAe,OAAO;AAAA,IACtB,gBAAgB,OAAO;AAAA,EACzB;AAEA,mBAAiB,KAAK,KAAK;AAC3B,SAAO;AACT;AAKO,SAAS,iBAAiB,IAAY;AAC3C,WAAS,IAAI,iBAAiB,SAAS,GAAG,KAAK,GAAG,KAAK;AACrD,UAAM,QAAQ,iBAAiB,CAAC;AAChC,UAAM,WAAW,KAAK;AAGtB,UAAM,YAAY,MAAM,WAAW,MAAM;AACzC,QAAI,YAAY,KAAK;AACnB,YAAM,IAAI,UAAU,OAAO,YAAY;AAAA,IACzC;AAGA,QAAI,MAAM,WAAW,MAAM,UAAU;AACnC,YAAM,IAAI,QAAQ;AAClB,YAAM,IAAI,QAAQ;AAClB,MAAAA,UAAS,OAAO,MAAM,IAAI;AAC1B,uBAAiB,OAAO,GAAG,CAAC;AAAA,IAC9B;AAAA,EACF;AACF;AAMO,SAAS,cAAc,GAAW,GAAW;AAClD,aAAW,SAAS,kBAAkB;AACpC,UAAM,KAAK,IAAI,MAAM;AACrB,UAAM,KAAK,IAAI,MAAM;AACrB,UAAM,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AACxC,QAAI,QAAQ,MAAM,QAAQ;AACxB,aAAO;AAAA,IACT;AAAA,EACF;AACA,SAAO;AACT;AAKO,SAAS,cAAc,GAAW,GAAW,UAAmB;AACrE,QAAM,QAAQ,cAAc,GAAG,CAAC;AAChC,MAAI,CAAC,OAAO;AACV,WAAO,EAAE,WAAW,GAAK,eAAe,EAAI;AAAA,EAC9C;AAGA,MAAI,YAAY,CAAC,MAAM,eAAe;AACpC,WAAO,EAAE,WAAW,GAAK,eAAe,EAAI;AAAA,EAC9C;AACA,MAAI,CAAC,YAAY,CAAC,MAAM,gBAAgB;AACtC,WAAO,EAAE,WAAW,GAAK,eAAe,EAAI;AAAA,EAC9C;AAEA,SAAO;AAAA,IACL,WAAW,MAAM;AAAA,IACjB,eAAe,MAAM;AAAA,EACvB;AACF;AAKA,SAAS,aAAa,GAAQ;AAC5B,IAAE,IAAI,QAAQ;AACd,EAAAA,UAAS,OAAO,EAAE,IAAI;AACtB,IAAE,SAAS,QAAQ;AACnB,IAAE,SAAS,QAAQ;AACnB,EAAAA,UAAS,OAAO,EAAE,KAAK;AAEvB,MAAI,EAAE,cAAc;AAClB,UAAM,KAAK,EAAE;AACb,OAAG,QAAQ,QAAQ;AACnB,OAAG,QAAQ,QAAQ;AACnB,IAAAA,UAAS,OAAO,GAAG,KAAK;AACxB,MAAE,eAAe;AAAA,EACnB;AACF;AAKO,SAAS,yBAAyB;AACvC,aAAW,KAAK,eAAe;AAC7B,iBAAa,CAAC;AAAA,EAChB;AACA,gBAAc,SAAS;AACzB;AAKO,SAAS,kBAAkB;AAChC,aAAW,SAAS,kBAAkB;AACpC,UAAM,IAAI,QAAQ;AAClB,UAAM,IAAI,QAAQ;AAClB,IAAAA,UAAS,OAAO,MAAM,IAAI;AAAA,EAC5B;AACA,mBAAiB,SAAS;AAC5B;;;ACpVA,IAAI;AAAJ,IAAsB;AAAtB,IAAiC;AAAjC,IAA4C;AAC5C,IAAM,YAAY,IAAI,MAAM,QAAQ,GAAG,GAAG,CAAC;AAC3C,IAAI,WAAW;AACf,IAAI,eAAe;AAGnB,IAAI,YAAY;AAChB,IAAI,YAAY;AAChB,IAAI,eAAe;AACnB,IAAI,eAAe;AACnB,IAAM,UAAU,IAAI,MAAM,QAAQ;AAClC,IAAM,eAAe,IAAI,MAAM,QAAQ;AACvC,IAAI,eAAe;AACnB,IAAI,cAAc;AAGlB,IAAM,cAAqB,CAAC;AAG5B,IAAI,YAAiB;AAGrB,IAAI,aAAa;AACjB,IAAI,cAAc;AAClB,IAAI,iBAAiB;AACrB,IAAI,uBAA4B;AAChC,IAAI,iBAAsB;AAC1B,IAAI,mBAAwB;AAC5B,IAAI,kBAAuB;AAG3B,IAAM,WAAW,IAAI,MAAM,QAAQ;AAGnC,IAAI,sBAA2B;AAC/B,IAAI,sBAA2B;AAG/B,IAAM,gBAAgB;AACtB,IAAM,gBAAgB;AAEf,SAAS,aAAaE,QAAY;AACvC,gBAAc,IAAI,MAAM,MAAM;AAE9B,SAAO,IAAI,MAAM;AAAA,IACf,IAAI,MAAM,iBAAiB,OAAO,KAAK,QAAQ,OAAO,KAAK,SAAS,MAAM,OAAO,KAAK,SAAS,KAAK,CAAC;AAAA,IACrG,IAAI,MAAM,qBAAqB;AAAA,MAC7B,OAAO;AAAA,MACP,UAAU;AAAA,MACV,mBAAmB;AAAA,IACrB,CAAC;AAAA,EACH;AACA,OAAK,SAAS,IAAI;AAClB,cAAY,IAAI,IAAI;AAEpB,SAAO,IAAI,MAAM;AAAA,IACf,IAAI,MAAM,eAAe,OAAO,KAAK,SAAS,MAAM,GAAG,CAAC;AAAA,IACxD,IAAI,MAAM,qBAAqB;AAAA,MAC7B,OAAO;AAAA,MACP,UAAU;AAAA,MACV,mBAAmB;AAAA,IACrB,CAAC;AAAA,EACH;AACA,OAAK,SAAS,IAAI;AAClB,cAAY,IAAI,IAAI;AAEpB,iBAAe,IAAI,MAAM;AAAA,IACvB,IAAI,MAAM,aAAa,MAAM,KAAK,CAAC;AAAA,IACnC,IAAI,MAAM,qBAAqB;AAAA,MAC7B,OAAO;AAAA,MACP,UAAU;AAAA,MACV,mBAAmB;AAAA,IACrB,CAAC;AAAA,EACH;AACA,eAAa,SAAS,IAAI,CAAC,KAAK,KAAK;AACrC,eAAa,SAAS,IAAI,GAAG,KAAK,IAAI;AACtC,cAAY,IAAI,YAAY;AAE5B,EAAAA,OAAM,IAAI,WAAW;AACrB,SAAO;AACT;AAEO,SAAS,aAAaC,aAAiB,IAAYC,YAAgB;AACxE,QAAM,MAAM,YAAY,IAAI;AAG5B,aAAW,OAAO,OAAO,KAAKA,WAAU,SAAS,GAAG;AAClD,QAAIA,WAAU,UAAU,GAAG,EAAE,oBAAoB,GAAG;AAClD,MAAAA,WAAU,UAAU,GAAG,EAAE,qBAAqB,KAAK;AAAA,IACrD;AAAA,EACF;AAGA,MAAI,YAAY;AACd,iBAAaD,aAAY,IAAIC,UAAS;AAAA,EACxC;AAGA,MAAI,cAAc,GAAG;AACnB,mBAAe,KAAK;AAEpB,gBAAY,SAAS,KAAK,SAAS;AACnC,sBAAkB,EAAE;AACpB;AAAA,EACF;AAGA,MAAI,WAAW;AACb,eAAW,IAAIA,UAAS;AACxB,gBAAY,SAAS,KAAK,SAAS;AAGnC,gBAAYD,WAAU;AAEtB,sBAAkB,EAAE;AACpB;AAAA,EACF;AAGA,MAAIA,YAAW,QAAQC,WAAU,UAAU,KAAK,qBAAqB,GAAG;AACtE,cAAUD,aAAYC,UAAS;AAAA,EACjC;AAGA,MAAID,YAAW,YAAYC,WAAU,UAAU,SAAS,qBAAqB,KAAK,CAAC,YAAY;AAC7F,gBAAYD,aAAYC,UAAS;AAAA,EACnC;AAGA,MAAI,KAAK,IAAID,YAAW,KAAK,IAAI,QAAQ,KAAK,IAAIA,YAAW,KAAK,IAAI,MAAM;AAC1E,UAAM,aAAa,aAAa,UAAU,SAAS,sBAAsB;AAEzE,UAAM,aAAa,cAAc,UAAU,GAAG,UAAU,GAAG,IAAI;AAC/D,UAAM,WAAW,aAAa,WAAW;AACzC,cAAU,KAAKA,YAAW,QAAQ,OAAO,QAAQ,WAAW;AAC5D,cAAU,KAAKA,YAAW,QAAQ,OAAO,QAAQ,WAAW;AAG5D,gBAAY,KAAK;AACjB,SAAK,SAAS,IAAI,MAAM,KAAK,IAAI,QAAQ,IAAI;AAC7C,SAAK,SAAS,IAAI,OAAO,KAAK,IAAI,QAAQ,IAAI;AAAA,EAChD;AAGA,YAAU,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,MAAM,UAAU,CAAC,CAAC;AACzD,YAAU,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,MAAM,UAAU,CAAC,CAAC;AAEzD,cAAY,SAAS,KAAK,SAAS;AAGnC,cAAYA,WAAU;AAGtB,QAAM,UAAU,UAAU;AAC1B,QAAM,YAAY,CAAC,aAAa,QAAQ,mBAAmB,CAAC;AAE5D,MAAI,YAAY,MAAM,eAAe,OAAO,UAAU;AACpD,aAAS;AAAA,MACP,CAAC,KAAK,IAAI,YAAY,SAAS,CAAC;AAAA,MAChC;AAAA,MACA,CAAC,KAAK,IAAI,YAAY,SAAS,CAAC;AAAA,IAClC;AAEA,mBAAe,WAAW,UAAU,EAAE,OAAO,OAAO,WAAW,OAAO,QAAQ,OAAO,WAAW,QAAQ,OAAO,OAAO,WAAW,MAAM,GAAG,KAAK;AAC/I,mBAAe;AAAA,EACjB;AAEA,oBAAkB,EAAE;AACtB;AAEA,SAAS,YAAYA,aAAiB;AACpC,QAAM,KAAKA,YAAW,YAAY,IAAI,UAAU;AAChD,QAAM,KAAKA,YAAW,YAAY,IAAI,UAAU;AAChD,MAAI,KAAK,KAAK,KAAK,KAAK,MAAM;AAC5B,gBAAY,SAAS,IAAI,KAAK,MAAM,CAAC,IAAI,CAAC,EAAE;AAAA,EAC9C;AACF;AAGA,SAAS,UAAUA,aAAiBC,YAAgB;AAClD,QAAM,MAAM,UAAU;AACtB,cAAY;AACZ,cAAY;AACZ,iBAAe,IAAI;AACnB,iBAAe,IAAI;AACnB,eAAa,KAAK,SAAS;AAG3B,QAAM,WAAW,sBAAsB;AACvC,QAAM,cAAc,KAAK,IAAID,YAAW,KAAK,IAAI,QAAQ,KAAK,IAAIA,YAAW,KAAK,IAAI;AAEtF,MAAI,UAAU;AACZ,YAAQ,IAAI,SAAS,GAAG,GAAG,SAAS,CAAC,EAAE,UAAU;AACjD,4BAAwB;AAAA,EAC1B,WAAW,IAAI,oBAAoB,cAAc,aAAa;AAC5D,YAAQ,IAAIA,YAAW,OAAO,GAAGA,YAAW,KAAK,EAAE,UAAU;AAAA,EAC/D,WAAW,IAAI,oBAAoB,OAAO;AACxC,YAAQ;AAAA,MACNA,YAAW,YAAY,IAAI,UAAU;AAAA,MAAG;AAAA,MACxCA,YAAW,YAAY,IAAI,UAAU;AAAA,IACvC,EAAE,UAAU;AAAA,EACd,OAAO;AAEL,QAAI,aAAa;AACf,cAAQ,IAAIA,YAAW,OAAO,GAAGA,YAAW,KAAK,EAAE,UAAU;AAAA,IAC/D,OAAO;AACL,cAAQ;AAAA,QACNA,YAAW,YAAY,IAAI,UAAU;AAAA,QAAG;AAAA,QACxCA,YAAW,YAAY,IAAI,UAAU;AAAA,MACvC,EAAE,UAAU;AAAA,IACd;AAAA,EACF;AAEA,EAAAC,WAAU,UAAU,KAAK,oBAAoB,IAAI;AAEjD,MAAI,IAAI,qBAAqB,GAAG;AAC9B,gBAAY,IAAI,oBAAoB,EAAE;AAAA,EACxC;AACF;AAEA,SAAS,WAAW,IAAYA,YAAgB;AAC9C,QAAM,MAAM,UAAU;AACtB,eAAa,KAAK;AAClB,QAAM,IAAI,KAAK,IAAI,YAAY,cAAc,CAAG;AAGhD,MAAI;AACJ,UAAQ,IAAI,OAAO;AAAA,IACjB,KAAK;AAAa,eAAS,KAAK,IAAI,MAAM,IAAI;AAAI;AAAA,IAClD,KAAK;AAAa,eAAS,IAAI;AAAG;AAAA,IAClC,KAAK;AAAa,eAAS,IAAI,MAAM,IAAI,IAAI,IAAI,IAAI,KAAK,IAAI,KAAK,IAAI,GAAG,CAAC,IAAI;AAAG;AAAA,IAClF;AAAkB,eAAS;AAAA,EAC7B;AAGA,YAAU,KAAK,YAAY;AAC3B,YAAU,KAAK,QAAQ,IAAI,eAAe;AAC1C,YAAU,KAAK,QAAQ,IAAI,eAAe;AAG1C,YAAU,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,MAAM,UAAU,CAAC,CAAC;AACzD,YAAU,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,MAAM,UAAU,CAAC,CAAC;AAGzD,iBAAe,IAAI,eAAe,aAAa,IAAI,eAAe,aAAa,IAAI;AAGnF,MAAI,IAAI,kBAAkB,GAAG;AAC3B,UAAM,WAAW,gBAAgB,IAAI,kBAAkB;AACvD,UAAM,YAAY,KAAK,OAAO,YAAY,KAAK,OAAQ,QAAQ;AAC/D,UAAM,YAAY,KAAK,MAAM,YAAY,QAAQ;AACjD,QAAI,YAAY,WAAW;AACzB,sBAAgB,GAAG;AAAA,IACrB;AAAA,EACF;AAGA,MAAI,KAAK,GAAK;AACZ,gBAAY;AACZ,mBAAe;AACf,kBAAc,IAAI;AAAA,EACpB;AACF;AAEA,SAAS,gBAAgB,KAAU;AACjC,QAAMF,SAAQ,SAAS;AACvB,QAAM,QAAQ,IAAI,MAAM,MAAM;AAG9B,MAAI,CAAC,qBAAqB;AACxB,0BAAsB,IAAI,MAAM,iBAAiB,OAAO,KAAK,QAAQ,OAAO,KAAK,SAAS,MAAM,OAAO,KAAK,SAAS,KAAK,CAAC;AAC3H,0BAAsB,IAAI,MAAM,eAAe,OAAO,KAAK,SAAS,MAAM,GAAG,CAAC;AAAA,EAChF;AACA,QAAM,YAAY,IAAI,MAAM;AAAA,IAC1B;AAAA,IACA,IAAI,MAAM,kBAAkB;AAAA,MAC1B,OAAO,IAAI;AAAA,MACX,aAAa;AAAA,MACb,SAAS;AAAA,IACX,CAAC;AAAA,EACH;AACA,YAAU,SAAS,IAAI;AACvB,QAAM,IAAI,SAAS;AAEnB,QAAM,YAAY,IAAI,MAAM;AAAA,IAC1B;AAAA,IACA,IAAI,MAAM,kBAAkB;AAAA,MAC1B,OAAO,IAAI;AAAA,MACX,aAAa;AAAA,MACb,SAAS;AAAA,IACX,CAAC;AAAA,EACH;AACA,YAAU,SAAS,IAAI;AACvB,QAAM,IAAI,SAAS;AAEnB,QAAM,SAAS,KAAK,SAAS;AAC7B,QAAM,SAAS,IAAI,YAAY,SAAS;AACxC,EAAAA,OAAM,IAAI,KAAK;AAEf,cAAY,KAAK,EAAE,MAAM,OAAO,MAAM,GAAG,SAAS,IAAI,uBAAuB,CAAC;AAChF;AAEA,SAAS,kBAAkB,IAAY;AACrC,QAAMA,SAAQ,SAAS;AACvB,WAAS,IAAI,YAAY,SAAS,GAAG,KAAK,GAAG,KAAK;AAChD,UAAM,KAAK,YAAY,CAAC;AACxB,OAAG,QAAQ,KAAK;AAChB,UAAM,OAAO,KAAK,IAAI,GAAG,IAAI,GAAG,OAAO,GAAG,OAAO;AAEjD,OAAG,KAAK,SAAS,QAAQ,CAAC,UAAe;AACvC,UAAI,MAAM,SAAU,OAAM,SAAS,UAAU,OAAO;AAAA,IACtD,CAAC;AAED,QAAI,GAAG,QAAQ,GAAG,SAAS;AACzB,MAAAA,OAAM,OAAO,GAAG,IAAI;AACpB,kBAAY,OAAO,GAAG,CAAC;AAAA,IACzB;AAAA,EACF;AACF;AAGA,SAAS,YAAYC,aAAiBC,YAAgB;AACpD,QAAM,MAAM,UAAU;AACtB,eAAa;AACb,gBAAc;AACd,EAAAA,WAAU,UAAU,SAAS,WAAW;AACxC,EAAAA,WAAU,UAAU,SAAS,UAAU;AAIvC,QAAM,KAAKD,YAAW,YAAY,IAAI,UAAU;AAChD,QAAM,KAAKA,YAAW,YAAY,IAAI,UAAU;AAChD,mBAAiB,KAAK,MAAM,IAAI,EAAE;AAGlC,wBAAsB,GAAG;AAGzB,OAAK,SAAS,SAAS,OAAO,OAAQ;AACtC,OAAK,SAAS,SAAS,OAAO,OAAQ;AACtC,OAAK,SAAS,oBAAoB;AAClC,OAAK,SAAS,oBAAoB;AACpC;AAEA,SAAS,sBAAsB,KAAU;AACvC,QAAMD,SAAQ,SAAS;AAEvB,yBAAuB,IAAI,MAAM,MAAM;AACvC,uBAAqB,SAAS,IAAI,UAAU,GAAG,MAAM,UAAU,CAAC;AAChE,uBAAqB,SAAS,IAAI;AAGlC,QAAMG,WAAU,IAAI,MAAM,cAAc,GAAG,CAAC;AAC5C,EAAAA,SAAQ,QAAQ,CAAC,KAAK,KAAK,CAAC;AAC5B,QAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,IAC1C,OAAO,IAAI;AAAA,IACX,aAAa;AAAA,IACb,SAAS,IAAI;AAAA,IACb,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AACD,mBAAiB,IAAI,MAAM,KAAKA,UAAS,OAAO;AAEhD,QAAM,UAAU,IAAI,YAAY;AAChC,iBAAe,MAAM,IAAI,IAAI,OAAO,GAAG,IAAI,SAAS;AACpD,iBAAe,SAAS,IAAI,GAAG,GAAG,OAAO;AACzC,uBAAqB,IAAI,cAAc;AAGvC,QAAM,YAAY,IAAI,MAAM,cAAc,GAAG,CAAC;AAC9C,QAAM,YAAY,IAAI,MAAM,cAAc,SAAS;AACnD,YAAU,QAAQ,CAAC,KAAK,KAAK,CAAC;AAC9B,QAAM,YAAY,IAAI,MAAM,kBAAkB;AAAA,IAC5C,OAAO,IAAI;AAAA,IACX,aAAa;AAAA,IACb,SAAS;AAAA,IACT,YAAY;AAAA,EACd,CAAC;AACD,qBAAmB,IAAI,MAAM,aAAa,WAAW,SAAS;AAC9D,oBAAkB;AAClB,mBAAiB,MAAM,IAAI,IAAI,OAAO,GAAG,IAAI,SAAS;AACtD,mBAAiB,SAAS,IAAI,GAAG,GAAG,OAAO;AAC3C,uBAAqB,IAAI,gBAAgB;AAEzC,EAAAH,OAAM,IAAI,oBAAoB;AAChC;AAEA,SAAS,aAAaC,aAAiB,IAAYC,YAAgB;AACjE,QAAM,MAAM,UAAU;AACtB,iBAAe,KAAK;AACpB,QAAM,UAAU,KAAK,IAAI,cAAc,IAAI,cAAc,CAAC;AAC1D,EAAAA,WAAU,UAAU,SAAS,UAAU;AAGvC,QAAM,KAAKD,YAAW,YAAY,IAAI,UAAU;AAChD,QAAM,KAAKA,YAAW,YAAY,IAAI,UAAU;AAChD,MAAI,KAAK,KAAK,KAAK,KAAK,MAAM;AAC5B,qBAAiB,KAAK,MAAM,IAAI,EAAE;AAAA,EACpC;AAGA,QAAM,gBAAgB,IAAI,aAAa,IAAI,YAAY,IAAI,aAAa;AAGxE,MAAI,sBAAsB;AACxB,yBAAqB,SAAS,IAAI,UAAU,GAAG,MAAM,UAAU,CAAC;AAChE,yBAAqB,SAAS,IAAI;AAGlC,UAAM,UAAU,gBAAgB;AAGhC,mBAAe,MAAM,IAAI,IAAI,OAAO,GAAG,aAAa;AACpD,mBAAe,SAAS,IAAI,GAAG,GAAG,OAAO;AAGzC,qBAAiB,MAAM,IAAI,IAAI,OAAO,GAAG,aAAa;AACtD,qBAAiB,SAAS,IAAI,GAAG,GAAG,OAAO;AAG3C,UAAM,QAAQ,MAAM,MAAM,KAAK,IAAI,YAAY,IAAI,IAAI,IAAK;AAC5D,qBAAiB,SAAS,UAAU;AAGpC,mBAAe,SAAS,UAAU,IAAI,mBAAmB,UAAU;AAAA,EACrE;AAGA,OAAK,SAAS,oBAAoB,MAAM,UAAU;AAClD,OAAK,SAAS,oBAAoB,MAAM,UAAU;AAGlD,MAAI,WAAW,KAAM,cAAc,OAAO,CAACA,YAAW,cAAe;AACnE,mBAAe,SAASC,UAAS;AAAA,EACnC;AACF;AAEA,SAAS,eAAe,SAAiBA,YAAgB;AACvD,QAAM,MAAM,UAAU;AACtB,QAAM,gBAAgB,IAAI,aAAa,IAAI,YAAY,IAAI,aAAa;AACxE,QAAM,QAAQ,IAAI,gBAAgB,IAAI,eAAe,IAAI,gBAAgB;AAIzE,QAAM,UAAU,gBAAgB;AAChC,QAAM,OAAO,KAAK,IAAI,cAAc;AACpC,QAAM,OAAO,KAAK,IAAI,cAAc;AACpC,QAAM,UAAU,UAAU,IAAI,OAAO;AACrC,QAAM,UAAU,UAAU,IAAI,OAAO;AAGrC,cAAY;AAAA,IACV,GAAG;AAAA,IACH,GAAG;AAAA,IACH,OAAO,IAAI;AAAA,IACX,QAAQ;AAAA,IACR,UAAU;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAGA,wBAAsB;AAGtB,eAAa;AACb,EAAAA,WAAU,UAAU,SAAS,WAAW;AACxC,EAAAA,WAAU,UAAU,SAAS,UAAU;AACvC,EAAAA,WAAU,UAAU,SAAS,oBAAoB,IAAI;AAGrD,OAAK,SAAS,SAAS,OAAO,aAAa;AAC3C,OAAK,SAAS,SAAS,OAAO,aAAa;AAC3C,OAAK,SAAS,oBAAoB;AAClC,OAAK,SAAS,oBAAoB;AAGlC,cAAY,IAAI,UAAU,GAAG,GAAG;AAClC;AAEA,SAAS,wBAAwB;AAC/B,MAAI,sBAAsB;AACxB,UAAMF,SAAQ,SAAS;AAEvB,QAAI,gBAAgB;AAClB,qBAAe,SAAS,QAAQ;AAChC,qBAAe,SAAS,QAAQ;AAAA,IAClC;AACA,QAAI,kBAAkB;AACpB,uBAAiB,SAAS,QAAQ;AAClC,UAAI,gBAAiB,iBAAgB,QAAQ;AAAA,IAC/C;AACA,IAAAA,OAAM,OAAO,oBAAoB;AACjC,2BAAuB;AACvB,qBAAiB;AACjB,uBAAmB;AACnB,sBAAkB;AAAA,EACpB;AACF;AAGO,SAAS,eAAe;AAAE,SAAO;AAAW;AAE5C,SAAS,qBAAqB;AAAE,SAAO;AAAc;AACrD,SAAS,kBAAkB;AAAE,SAAO;AAAW;AAC/C,SAAS,mBAAmB;AACjC,QAAM,MAAM;AACZ,cAAY;AACZ,SAAO;AACT;AAEO,SAAS,cAAc;AAC5B,YAAU,IAAI,GAAG,GAAG,CAAC;AACrB,cAAY,SAAS,IAAI,GAAG,GAAG,CAAC;AAChC,cAAY,SAAS,IAAI;AACzB,cAAY;AACZ,iBAAe;AACf,gBAAc;AACd,iBAAe;AACf,eAAa;AACb,gBAAc;AACd,cAAY;AACZ,wBAAsB;AACtB,OAAK,SAAS,SAAS,OAAO,aAAa;AAC3C,OAAK,SAAS,SAAS,OAAO,aAAa;AAC3C,OAAK,SAAS,oBAAoB;AAClC,OAAK,SAAS,oBAAoB;AAGlC,QAAMI,SAAQ,SAAS;AACvB,aAAW,MAAM,aAAa;AAC5B,IAAAA,OAAM,OAAO,GAAG,IAAI;AAAA,EACtB;AACA,cAAY,SAAS;AACvB;;;AC3hBA,IAAM,OAAgC,CAAC;AAEvC,IAAM,aAAa;AAAA,EACjB,OAAO;AAAA,EACP,OAAO;AAAA,EACP,aAAa,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE;AAAA,EAChC,UAAU,EAAE,GAAG,GAAG,GAAG,EAAE;AAAA,EACvB,MAAM;AAAA,EACN,UAAU;AAAA,EACV,cAAc;AAAA,EACd,cAAc;AAChB;AAMA,IAAM,YAAY,IAAI,KAAK;AAC3B,IAAM,cAAc;AACpB,IAAM,cAAc,CAAC;AACrB,IAAM,WAAW,CAAC;AAClB,IAAM,WAAW,CAAC;AAGlB,IAAM,WAAW;AACjB,IAAI,eAAe;AACnB,IAAI,mBAAmB;AACvB,IAAI,qBAA8C,CAAC;AAGnD,IAAI,eAAe;AAGnB,IAAI,aAAa;AAAjB,IAAoB,aAAa;AACjC,IAAI,YAAY;AAAhB,IAAmB,YAAY;AAC/B,IAAI,iBAAiB;AACrB,IAAI,cAAc;AAEX,SAAS,YAAY;AAC1B,SAAO,iBAAiB,WAAW,CAAC,MAAM;AACxC,QAAI,EAAE,OAAQ;AACd,SAAK,EAAE,IAAI,IAAI;AACf,mBAAe;AAGf,QAAI,EAAE,SAAS,SAAS;AAAE,iBAAW,OAAO;AAAM,QAAE,eAAe;AAAA,IAAG;AACtE,QAAI,EAAE,SAAS,OAAQ,YAAW,WAAW;AAC7C,QAAI,EAAE,SAAS,YAAa,YAAW,eAAe;AAAA,EACxD,CAAC;AAED,SAAO,iBAAiB,SAAS,CAAC,MAAM;AACtC,SAAK,EAAE,IAAI,IAAI;AAAA,EACjB,CAAC;AAED,SAAO,iBAAiB,aAAa,CAAC,MAAM;AAC1C,eAAW,SAAS,IAAK,EAAE,UAAU,OAAO,aAAc,IAAI;AAC9D,eAAW,SAAS,IAAI,EAAE,EAAE,UAAU,OAAO,eAAe,IAAI;AAChE,mBAAe;AAAA,EACjB,CAAC;AAGD,SAAO,iBAAiB,oBAAoB,CAAC,MAAoB;AAC/D,YAAQ,IAAI,8BAA8B,EAAE,QAAQ,EAAE,EAAE;AACxD,mBAAe,EAAE,QAAQ;AAAA,EAC3B,CAAC;AACD,SAAO,iBAAiB,uBAAuB,CAAC,MAAoB;AAClE,YAAQ,IAAI,iCAAiC,EAAE,QAAQ,EAAE,EAAE;AAC3D,QAAI,EAAE,QAAQ,UAAU,aAAc,gBAAe;AAAA,EACvD,CAAC;AAGD,qBAAmB;AACrB;AAEA,SAAS,cAAc,OAAe;AACpC,MAAI,KAAK,IAAI,KAAK,IAAI,SAAU,QAAO;AAEvC,QAAM,OAAO,QAAQ,IAAI,IAAI;AAC7B,SAAO,QAAQ,KAAK,IAAI,KAAK,IAAI,aAAa,IAAI;AACpD;AAEA,SAAS,qBAAqB;AAE5B,MAAI,OAAO,aAAa,YAAa;AACrC,QAAM,WAAW,kBAAkB,UAAU,UAAU,iBAAiB;AACxE,MAAI,CAAC,SAAU;AAEf,QAAM,WAAW,SAAS,eAAe,WAAW;AACpD,QAAM,YAAY,SAAS,eAAe,YAAY;AACtD,MAAI,CAAC,YAAY,CAAC,UAAW;AAG7B,WAAS,MAAM,UAAU;AACzB,YAAU,MAAM,UAAU;AAE1B,UAAQ,IAAI,qCAAqC;AAGjD,QAAM,eAAe,SAAS,OAAO;AAAA,IACnC,MAAM;AAAA,IACN,MAAM;AAAA,IACN,UAAU,EAAE,MAAM,OAAO,KAAK,MAAM;AAAA,IACpC,OAAO;AAAA,IACP,MAAM;AAAA,IACN,aAAa;AAAA,EACf,CAAC;AAED,eAAa,GAAG,QAAQ,CAAC,KAAU,SAAc;AAC/C,UAAM,QAAQ,KAAK,IAAI,KAAK,OAAO,GAAG,IAAI;AAC1C,UAAM,QAAQ,KAAK,MAAM;AACzB,iBAAa,KAAK,IAAI,KAAK,IAAI;AAC/B,iBAAa,KAAK,IAAI,KAAK,IAAI;AAC/B,kBAAc;AAAA,EAChB,CAAC;AACD,eAAa,GAAG,OAAO,MAAM;AAC3B,iBAAa;AACb,iBAAa;AAAA,EACf,CAAC;AAGD,QAAM,gBAAgB,SAAS,OAAO;AAAA,IACpC,MAAM;AAAA,IACN,MAAM;AAAA,IACN,UAAU,EAAE,MAAM,OAAO,KAAK,MAAM;AAAA,IACpC,OAAO;AAAA,IACP,MAAM;AAAA,IACN,aAAa;AAAA,EACf,CAAC;AAED,gBAAc,GAAG,QAAQ,CAAC,KAAU,SAAc;AAChD,UAAM,QAAQ,KAAK,IAAI,KAAK,OAAO,GAAG,IAAI;AAC1C,UAAM,QAAQ,KAAK,MAAM;AACzB,gBAAY,KAAK,IAAI,KAAK,IAAI;AAC9B,gBAAY,KAAK,IAAI,KAAK,IAAI;AAC9B,qBAAiB;AACjB,kBAAc;AAAA,EAChB,CAAC;AACD,gBAAc,GAAG,OAAO,MAAM;AAC5B,gBAAY;AACZ,gBAAY;AACZ,qBAAiB;AAAA,EACnB,CAAC;AACH;AAEA,SAAS,qBAAqB;AAC5B,MAAI,CAAC,YAAa;AAGlB,MAAI,KAAK,IAAI,UAAU,IAAI,QAAQ,KAAK,IAAI,UAAU,IAAI,MAAM;AAG9D,UAAM,SAAS,aAAa,cAAc,aAAa;AACvD,UAAM,SAAS,aAAa,cAAc,aAAa;AAGvD,UAAM,WAAW,KAAK,IAAI,WAAW,KAAK,IAAI,QAAQ,KAAK,IAAI,WAAW,KAAK,IAAI;AACnF,QAAI,CAAC,UAAU;AACb,iBAAW,QAAQ;AACnB,iBAAW,QAAQ;AACnB,YAAM,MAAM,KAAK,KAAK,WAAW,QAAQ,WAAW,QAAQ,WAAW,QAAQ,WAAW,KAAK;AAC/F,UAAI,MAAM,GAAG;AACX,mBAAW,SAAS;AACpB,mBAAW,SAAS;AAAA,MACtB;AAAA,IACF;AAAA,EACF;AAGA,MAAI,gBAAgB;AAClB,UAAM,UAAU,YAAY,cAAc,YAAY;AACtD,UAAM,UAAU,YAAY,cAAc,YAAY;AAEtD,UAAM,KAAK,aAAa;AACxB,UAAM,UAAU;AAChB,eAAW,YAAY,IAAI,GAAG,IAAI,UAAU;AAC5C,eAAW,YAAY,IAAI;AAC3B,eAAW,YAAY,IAAI,GAAG,IAAI,UAAU;AAAA,EAC9C;AACF;AAEA,SAAS,cAAc;AACrB,MAAI,eAAe,EAAG;AACtB,QAAM,WAAW,UAAU,YAAY;AACvC,QAAM,KAAK,SAAS,YAAY;AAChC,MAAI,CAAC,GAAI;AAET,iBAAe;AAGf,QAAM,KAAK,cAAc,GAAG,KAAK,CAAC,KAAK,CAAC;AACxC,QAAM,KAAK,cAAc,GAAG,KAAK,CAAC,KAAK,CAAC;AAIxC,QAAM,UAAU,KAAK,cAAe,CAAC,KAAM;AAC3C,QAAM,UAAU,KAAK,cAAe,CAAC,KAAM;AAG3C,QAAM,WAAW,KAAK,IAAI,WAAW,KAAK,IAAI,QAAQ,KAAK,IAAI,WAAW,KAAK,IAAI;AACnF,MAAI,CAAC,aAAa,KAAK,IAAI,OAAO,IAAI,QAAQ,KAAK,IAAI,OAAO,IAAI,OAAO;AACvE,eAAW,QAAQ;AACnB,eAAW,QAAQ;AAEnB,UAAM,MAAM,KAAK,KAAK,WAAW,QAAQ,WAAW,QAAQ,WAAW,QAAQ,WAAW,KAAK;AAC/F,QAAI,MAAM,GAAG;AACX,iBAAW,SAAS;AACpB,iBAAW,SAAS;AAAA,IACtB;AAAA,EACF;AAGA,QAAM,KAAK,cAAc,GAAG,KAAK,CAAC,KAAK,CAAC;AACxC,QAAM,KAAK,cAAc,GAAG,KAAK,CAAC,KAAK,CAAC;AAExC,qBAAoB,KAAK,IAAI,EAAE,IAAI,QAAQ,KAAK,IAAI,EAAE,IAAI;AAE1D,MAAI,kBAAkB;AAEpB,UAAM,UAAU,KAAK,cAAe,CAAC,KAAM;AAC3C,UAAM,UAAU,KAAK,cAAe,CAAC,KAAM;AAG3C,UAAM,KAAK,aAAa;AACxB,UAAM,UAAU;AAChB,eAAW,YAAY,IAAI,GAAG,IAAI,UAAU;AAC5C,eAAW,YAAY,IAAI;AAC3B,eAAW,YAAY,IAAI,GAAG,IAAI,UAAU;AAAA,EAC9C;AAMA,QAAM,UAAU,GAAG;AAGnB,QAAM,UAAW,QAAQ,CAAC,KAAK,QAAQ,CAAC,EAAE,WAAa,QAAQ,CAAC,KAAK,QAAQ,CAAC,EAAE;AAChF,MAAI,WAAW,CAAC,mBAAmB,KAAM,YAAW,OAAO;AAC3D,qBAAmB,OAAO,CAAC,CAAC;AAG5B,QAAM,SAAU,QAAQ,CAAC,KAAK,QAAQ,CAAC,EAAE,WAAa,QAAQ,CAAC,KAAK,QAAQ,CAAC,EAAE;AAC/E,MAAI,UAAU,CAAC,mBAAmB,IAAK,YAAW,WAAW;AAC7D,qBAAmB,MAAM,CAAC,CAAC;AAG3B,MAAI,OAAQ,YAAW,eAAe;AACxC;AAEO,SAAS,cAAc;AAE5B,MAAI,OAAO,GAAG,OAAO;AACrB,MAAI,KAAK,MAAM,KAAK,KAAK,YAAY,EAAG,SAAQ;AAChD,MAAI,KAAK,MAAM,KAAK,KAAK,WAAW,EAAI,SAAQ;AAChD,MAAI,KAAK,MAAM,KAAK,KAAK,SAAS,EAAM,SAAQ;AAChD,MAAI,KAAK,MAAM,KAAK,KAAK,WAAW,EAAI,SAAQ;AAGhD,aAAW,QAAQ,OAAO,cAAc,OAAO;AAC/C,aAAW,QAAQ,OAAO,cAAc,OAAO;AAG/C,QAAM,MAAM,KAAK,KAAK,WAAW,QAAQ,WAAW,QAAQ,WAAW,QAAQ,WAAW,KAAK;AAC/F,MAAI,MAAM,GAAG;AACX,eAAW,SAAS;AACpB,eAAW,SAAS;AAAA,EACtB;AAIA,aAAW,eAAe,CAAC,CAAC,KAAK,MAAM,KAAK;AAG5C,OAAK,CAAC,gBAAgB,CAAC,qBAAqB,CAAC,kBAAkB,CAAC,mBAAmB;AACjF,UAAM,WAAW,cAAc,WAAW,SAAS,GAAG,WAAW,SAAS,CAAC;AAC3E,eAAW,YAAY,IAAI,SAAS;AACpC,eAAW,YAAY,IAAI,SAAS;AACpC,eAAW,YAAY,IAAI,SAAS;AAAA,EACtC;AAGA,cAAY;AAGZ,qBAAmB;AACrB;AAEO,SAAS,eAAe;AAC7B,aAAW,OAAO;AAClB,aAAW,WAAW;AACtB,aAAW,eAAe;AAC5B;AAEO,SAAS,gBAAgB;AAAE,SAAO;AAAY;AAGrD,IAAI,gBAAgB;AACb,SAAS,cAAc;AAAE,aAAW,OAAO;AAAM;AACjD,SAAS,kBAAkB;AAAE,aAAW,WAAW;AAAM;AACzD,SAAS,gBAAgB,MAAe;AAAE,kBAAgB;AAAM;AAGvE,IAAI,oBAAoB;AACjB,SAAS,qBAAqB,SAAiB,SAAiB;AACrE,sBAAoB;AACpB,QAAM,UAAU,UAAU,cAAc,UAAU;AAClD,QAAM,UAAU,UAAU,cAAc,UAAU;AAElD,QAAM,KAAK,aAAa;AACxB,QAAM,UAAU;AAChB,aAAW,YAAY,IAAI,GAAG,IAAI,UAAU;AAC5C,aAAW,YAAY,IAAI;AAC3B,aAAW,YAAY,IAAI,GAAG,IAAI,UAAU;AAC9C;AAGA,IAAI,sBAAuD;AACpD,SAAS,sBAAsB,GAAW,GAAW;AAAE,wBAAsB,EAAE,GAAG,EAAE;AAAG;AACvF,SAAS,0BAA0B;AAAE,wBAAsB;AAAM,sBAAoB;AAAO;AAC5F,SAAS,wBAAwB;AAAE,SAAO;AAAqB;AAO/D,SAAS,oBAAoB,SAAgB;AAElD,MAAI,CAAC,YAAa;AAClB,MAAI,kBAAkB,kBAAmB;AAEzC,MAAI,CAAC,WAAW,QAAQ,WAAW,EAAG;AAEtC,QAAM,KAAK,aAAa;AACxB,MAAI,UAAe;AACnB,MAAI,cAAc;AAElB,WAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACvC,UAAM,IAAI,QAAQ,CAAC;AACnB,QAAI,EAAE,aAAa,EAAE,UAAU,EAAG;AAClC,UAAM,KAAK,EAAE,IAAI,IAAI,GAAG;AACxB,UAAM,KAAK,EAAE,IAAI,IAAI,GAAG;AACxB,UAAM,OAAO,KAAK,KAAK,KAAK;AAC5B,QAAI,OAAO,aAAa;AACtB,oBAAc;AACd,gBAAU;AAAA,IACZ;AAAA,EACF;AAEA,MAAI,SAAS;AACX,eAAW,YAAY,IAAI,QAAQ,IAAI;AACvC,eAAW,YAAY,IAAI;AAC3B,eAAW,YAAY,IAAI,QAAQ,IAAI;AAAA,EACzC;AACF;;;ACnWO,IAAM,QAA0B;AAAA,EACrC;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,QAAQ;AAAA,MACN;AAAA,QACE,IAAI;AAAA,QACJ,cAAc;AAAA,QACd,mBAAmB;AAAA,QACnB,SAAS;AAAA,QACT,QAAQ;AAAA,UACN,EAAE,MAAM,UAAU,GAAG,GAAG,GAAG,EAAE;AAAA,UAC7B,EAAE,MAAM,UAAU,GAAG,IAAI,GAAG,EAAE;AAAA,UAC9B,EAAE,MAAM,UAAU,GAAG,GAAG,GAAG,EAAE;AAAA,UAC7B,EAAE,MAAM,gBAAgB,GAAG,GAAG,GAAG,IAAI;AAAA,UACrC,EAAE,MAAM,gBAAgB,GAAG,KAAK,GAAG,EAAE;AAAA,QACvC;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,cAAc;AAAA,QACd,mBAAmB;AAAA,QACnB,SAAS;AAAA,QACT,QAAQ;AAAA,UACN,EAAE,MAAM,UAAU,GAAG,IAAI,GAAG,GAAG;AAAA,UAC/B,EAAE,MAAM,UAAU,GAAG,KAAK,GAAG,GAAG;AAAA,UAChC,EAAE,MAAM,UAAU,GAAG,KAAK,GAAG,EAAE;AAAA,QACjC;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,QAAQ;AAAA,MACN;AAAA,QACE,IAAI;AAAA,QACJ,cAAc;AAAA,QACd,mBAAmB;AAAA,QACnB,SAAS;AAAA,QACT,QAAQ;AAAA,UACN,EAAE,MAAM,UAAU,GAAG,IAAI,GAAG,EAAE;AAAA,UAC9B,EAAE,MAAM,cAAc,GAAG,IAAI,GAAG,EAAE;AAAA,UAClC,EAAE,MAAM,UAAU,GAAG,IAAI,GAAG,GAAG;AAAA,UAC/B,EAAE,MAAM,UAAU,GAAG,KAAK,GAAG,EAAE;AAAA,UAC/B,EAAE,MAAM,UAAU,GAAG,KAAK,GAAG,EAAE;AAAA,UAC/B,EAAE,MAAM,cAAc,GAAG,KAAK,GAAG,GAAG;AAAA,UACpC,EAAE,MAAM,UAAU,GAAG,GAAG,GAAG,GAAG;AAAA,UAC9B,EAAE,MAAM,UAAU,GAAG,IAAI,GAAG,EAAE;AAAA,QAChC;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,cAAc;AAAA,QACd,mBAAmB;AAAA,QACnB,SAAS;AAAA,QACT,QAAQ;AAAA,UACN,EAAE,MAAM,kBAAkB,GAAG,IAAI,GAAG,GAAG;AAAA,UACvC,EAAE,MAAM,kBAAkB,GAAG,KAAK,GAAG,IAAI;AAAA,UACzC,EAAE,MAAM,kBAAkB,GAAG,KAAK,GAAG,GAAG;AAAA,QAC1C;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,QAAQ;AAAA,MACN;AAAA,QACE,IAAI;AAAA,QACJ,cAAc;AAAA,QACd,mBAAmB;AAAA,QACnB,SAAS;AAAA,QACT,QAAQ;AAAA,UACN,EAAE,MAAM,UAAU,GAAG,IAAI,GAAG,EAAE;AAAA,UAC9B,EAAE,MAAM,UAAU,GAAG,IAAI,GAAG,GAAG;AAAA,UAC/B,EAAE,MAAM,UAAU,GAAG,KAAK,GAAG,EAAE;AAAA,UAC/B,EAAE,MAAM,UAAU,GAAG,KAAK,GAAG,GAAG;AAAA,UAChC,EAAE,MAAM,UAAU,GAAG,GAAG,GAAG,GAAG;AAAA,UAC9B,EAAE,MAAM,UAAU,GAAG,IAAI,GAAG,GAAG;AAAA,QACjC;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,cAAc;AAAA,QACd,mBAAmB;AAAA,QACnB,SAAS;AAAA,QACT,QAAQ;AAAA,UACN,EAAE,MAAM,kBAAkB,GAAG,IAAI,GAAG,GAAG;AAAA,UACvC,EAAE,MAAM,kBAAkB,GAAG,KAAK,GAAG,GAAG;AAAA,UACxC,EAAE,MAAM,kBAAkB,GAAG,GAAG,GAAG,IAAI;AAAA,UACvC,EAAE,MAAM,kBAAkB,GAAG,IAAI,GAAG,IAAI;AAAA,QAC1C;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,cAAc;AAAA,QACd,mBAAmB;AAAA,QACnB,SAAS;AAAA,QACT,QAAQ;AAAA,UACN,EAAE,MAAM,cAAc,GAAG,GAAG,GAAG,GAAG;AAAA,UAClC,EAAE,MAAM,cAAc,GAAG,KAAK,GAAG,GAAG;AAAA,UACpC,EAAE,MAAM,cAAc,GAAG,IAAI,GAAG,GAAG;AAAA,QACrC;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,cAAc;AAAA,QACd,mBAAmB;AAAA,QACnB,SAAS;AAAA,QACT,QAAQ;AAAA,UACN,EAAE,MAAM,gBAAgB,GAAG,KAAK,GAAG,EAAE;AAAA,UACrC,EAAE,MAAM,gBAAgB,GAAG,IAAI,GAAG,IAAI;AAAA,UACtC,EAAE,MAAM,gBAAgB,GAAG,IAAI,GAAG,EAAE;AAAA,UACpC,EAAE,MAAM,gBAAgB,GAAG,IAAI,GAAG,GAAG;AAAA,QACvC;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;;;ACpHA,IAAIC;AAGJ,IAAIC;AAAJ,IAAkB;AAClB,IAAM,WAAgC,CAAC;AAShC,SAAS,cAAcC,QAAY;AACxC,EAAAC,YAAWD;AAGX,EAAAE,WAAU,IAAI,MAAM,aAAa,KAAK,KAAK,EAAE;AAC7C,EAAAA,SAAQ,QAAQ,CAAC,KAAK,KAAK,CAAC;AAG5B,YAAU,IAAI,MAAM,eAAe,KAAK,EAAE;AAC1C,UAAQ,QAAQ,CAAC,KAAK,KAAK,CAAC;AAI5B,WAAS,SAAS,IAAI,MAAM,aAAa,KAAK,KAAK,CAAC;AAEpD,WAAS,iBAAiB,IAAI,MAAM,YAAY,MAAM,MAAM,IAAI;AAEhE,WAAS,aAAa,IAAI,MAAM,iBAAiB,MAAM,MAAM,KAAK,CAAC;AACrE;AAEO,SAAS,gBAAgB,GAAW,GAAW,UAAkB;AACtE,QAAM,QAAQ,YAAY,QAAQ,IAAI,YAAY,QAAQ,EAAE,QAAQ;AACpE,QAAM,QAAQ,IAAI,MAAM,MAAM;AAC9B,QAAM,SAAS,IAAI,GAAG,GAAG,CAAC;AAG1B,QAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,IAC1C;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AACD,QAAM,OAAO,IAAI,MAAM,KAAKA,UAAS,OAAO;AAC5C,OAAK,SAAS,IAAI;AAClB,QAAM,IAAI,IAAI;AAGd,QAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,IAC1C;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,YAAY;AAAA,EACd,CAAC;AACD,QAAM,OAAO,IAAI,MAAM,KAAK,SAAS,OAAO;AAC5C,OAAK,SAAS,IAAI;AAClB,QAAM,IAAI,IAAI;AAGd,QAAM,UAAU,SAAS,QAAQ,KAAK,SAAS;AAC/C,QAAM,UAAU,IAAI,MAAM,qBAAqB;AAAA,IAC7C;AAAA,IACA,UAAU;AAAA,IACV,mBAAmB;AAAA,IACnB,aAAa;AAAA,IACb,SAAS;AAAA,EACX,CAAC;AACD,QAAM,gBAAgB,IAAI,MAAM,KAAK,SAAS,OAAO;AACrD,gBAAc,SAAS,IAAI;AAC3B,MAAI,aAAa,kBAAkB;AACjC,kBAAc,SAAS,IAAI,KAAK,KAAK;AAAA,EACvC;AACA,QAAM,IAAI,aAAa;AAEvB,EAAAD,UAAS,IAAI,KAAK;AAElB,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,WAAW;AAAA,IACX,MAAM;AAAA,EACR;AACF;AAGO,SAAS,gBAAgB,WAAgB,UAAkB,IAAY;AAC5E,YAAU,QAAQ;AAGlB,YAAU,QAAQ,UAAU,WAAW;AAGvC,QAAM,OAAO,IAAI,WAAW;AAC5B,QAAM,QAAQ,MAAM,MAAM,KAAK,IAAI,UAAU,OAAO,OAAO,KAAK,KAAK,CAAC;AAGtE,YAAU,QAAQ,UAAU,MAAM,QAAQ;AAG1C,QAAM,QAAQ,IAAM,MAAM,KAAK,IAAI,UAAU,OAAO,OAAO,KAAK,KAAK,CAAC;AACtE,YAAU,KAAK,MAAM,IAAI,OAAO,GAAG,KAAK;AAGxC,MAAI,WAAW,KAAK;AAClB,UAAM,QAAQ,KAAK,IAAI,UAAU,OAAO,EAAE,IAAI;AAC9C,cAAU,QAAQ,MAAM,OAAO,QAAQ,WAAW,UAAU,SAAS;AACrE,cAAU,QAAQ,MAAM,OAAO,QAAQ,WAAW,UAAU,SAAS;AAAA,EACvE;AAGA,YAAU,cAAc,SAAS,IAAI,MAAM,OAAO,KAAK,IAAI,UAAU,OAAO,CAAC;AAC7E,YAAU,cAAc,SAAS,KAAK,KAAK;AAC7C;AAEO,SAASE,iBAAgB,WAAgB;AAC9C,MAAI,UAAU,MAAM,QAAQ;AAC1B,IAAAF,UAAS,OAAO,UAAU,KAAK;AAAA,EACjC;AAEA,YAAU,QAAQ,QAAQ;AAC1B,YAAU,QAAQ,QAAQ;AAC1B,YAAU,QAAQ,QAAQ;AAC5B;;;ACjIA,IAAIG;AAEJ,IAAM,YAAY;AAAA,EAChB,QAAQ;AAAA;AAAA,EACR,WAAW;AAAA,EACX,WAAW;AAAA;AAAA,EACX,eAAe;AAAA,EACf,iBAAiB;AAAA,EACjB,QAAQ,CAAC;AAAA;AACX;AAGA,IAAI;AAEG,SAAS,eAAeC,QAAY;AACzC,EAAAD,YAAWC;AACX,gBAAcA,MAAK;AAGnB,eAAa,SAAS,eAAe,eAAe;AACtD;AAEO,SAAS,UAAU,OAAeC,YAAgB;AACvD,MAAI,SAAS,MAAM,QAAQ;AACzB,cAAU,SAAS;AACnB,iBAAa,SAAS;AACtB;AAAA,EACF;AAEA,YAAU,YAAY;AACtB,YAAU,SAAS;AACnB,YAAU,gBAAgB;AAC1B,YAAU,YAAY;AACtB,YAAU,SAAS,CAAC;AAEpB,EAAAA,WAAU,cAAc,MAAM,KAAK,EAAE;AAGrC,eAAa,MAAM,KAAK,EAAE,OAAO;AACnC;AAEO,SAAS,iBAAiB,IAAYA,YAAgB;AAC3D,QAAM,OAAO,KAAK;AAElB,UAAQ,UAAU,QAAQ;AAAA,IACxB,KAAK;AAAA,IACL,KAAK;AACH;AAAA,IAEF,KAAK;AACH,gBAAU,iBAAiB;AAC3B,UAAI,UAAU,iBAAiB,GAAG;AAChC,qBAAa;AACb,kBAAU,SAAS;AACnB,0BAAkB;AAAA,MACpB;AACA;AAAA,IAEF,KAAK;AACH,gBAAU,aAAa;AACvB,UAAI,gBAAgB;AAEpB,iBAAW,KAAK,UAAU,QAAQ;AAChC,oBAAY,GAAG,IAAI,MAAMA,UAAS;AAClC,YAAI,EAAE,UAAU,OAAQ,iBAAgB;AAAA,MAC1C;AAGA,UAAI,iBAAiBA,WAAU,QAAQ,WAAW,GAAG;AACnD,kBAAU,SAAS;AACnB,kBAAU,kBAAkB;AAC5B,qBAAa,eAAe;AAAA,MAC9B;AACA;AAAA,IAEF,KAAK;AACH,gBAAU,mBAAmB;AAC7B,UAAI,UAAU,mBAAmB,GAAG;AAClC,qBAAa;AACb,kBAAU,UAAU,YAAY,GAAGA,UAAS;AAAA,MAC9C;AACA;AAAA,EACJ;AACF;AAEA,SAAS,oBAAoB;AAC3B,QAAM,UAAU,MAAM,UAAU,SAAS;AACzC,YAAU,SAAS,QAAQ,OAAO,IAAI,CAAC,cAAmB;AAAA,IACxD,QAAQ;AAAA,IACR,OAAO;AAAA;AAAA,IACP,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,cAAc;AAAA,IACd,YAAY,CAAC;AAAA,EACf,EAAE;AACJ;AAEA,SAAS,YAAY,GAAQ,IAAY,MAAcA,YAAgB;AACrE,UAAQ,EAAE,OAAO;AAAA,IACf,KAAK;AACH,UAAI,UAAU,aAAa,EAAE,OAAO,cAAc;AAChD,UAAE,QAAQ;AACV,UAAE,QAAQ,EAAE,OAAO;AAGnB,mBAAW,KAAK,EAAE,OAAO,QAAQ;AAC/B,gBAAM,IAAI,gBAAgB,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI;AAC1C,YAAE,WAAW,KAAK,CAAC;AAAA,QACrB;AAAA,MACF;AACA;AAAA,IAEF,KAAK;AACH,QAAE,SAAS;AACX,YAAM,WAAW,IAAM,KAAK,IAAI,GAAG,EAAE,QAAQ,EAAE,OAAO,iBAAiB;AAGvE,iBAAW,KAAK,EAAE,YAAY;AAC5B,wBAAgB,GAAG,UAAU,EAAE;AAAA,MACjC;AAEA,UAAI,EAAE,SAAS,GAAG;AAEhB,mBAAW,KAAK,EAAE,YAAY;AAC5B,UAAAC,iBAAgB,CAAC;AAAA,QACnB;AACA,UAAE,aAAa,CAAC;AAGhB,UAAE,QAAQ;AACV,UAAE,aAAa;AACf,UAAE,eAAe;AAAA,MACnB;AACA;AAAA,IAEF,KAAK;AACH,QAAE,gBAAgB;AAClB,aAAO,EAAE,gBAAgB,KAAK,EAAE,aAAa,EAAE,OAAO,OAAO,QAAQ;AACnE,cAAM,IAAI,EAAE,OAAO,OAAO,EAAE,UAAU;AACtC,mBAAW,EAAE,MAAM,IAAI,MAAM,QAAQ,EAAE,GAAG,GAAG,EAAE,CAAC,GAAGD,UAAS;AAC5D,UAAE;AACF,YAAI,EAAE,aAAa,EAAE,OAAO,OAAO,QAAQ;AACzC,YAAE,gBAAgB,EAAE,OAAO;AAAA,QAC7B;AAAA,MACF;AACA,UAAI,EAAE,cAAc,EAAE,OAAO,OAAO,QAAQ;AAC1C,UAAE,QAAQ;AAAA,MACZ;AACA;AAAA,EACJ;AACF;AAEO,SAAS,kBAAkB;AAEhC,aAAW,KAAK,UAAU,QAAQ;AAChC,eAAW,KAAK,EAAE,YAAY;AAC5B,MAAAC,iBAAgB,CAAC;AAAA,IACnB;AAAA,EACF;AACA,YAAU,SAAS;AACnB,YAAU,YAAY;AACtB,YAAU,YAAY;AACtB,YAAU,SAAS,CAAC;AACpB,eAAa;AACf;AAWA,SAAS,aAAa,MAAc;AAClC,MAAI,CAAC,WAAY;AACjB,aAAW,cAAc;AACzB,aAAW,UAAU,IAAI,SAAS;AACpC;AAEA,SAAS,eAAe;AACtB,MAAI,CAAC,WAAY;AACjB,aAAW,UAAU,OAAO,SAAS;AACvC;;;AClLA,IAAI,kBAAiC;AACrC,IAAI,YAA2B;AAC/B,IAAI,iBAAgC;AAG7B,SAAS,4BAAkC;AAChD,oBAAkB;AAClB,cAAY;AACZ,mBAAiB;AACnB;AASA,IAAM,eAA8B,CAAC;AAGrC,IAAI,gBAAyC;AAC7C,IAAI,gBAAuC;AAE3C,SAAS,gBAAgB,GAAW,GAAW,QAAgB,QAAgB,OAAsB;AACnG,MAAI,CAAC,eAAe;AAClB,oBAAgB,IAAI,MAAM,iBAAiB,GAAG,GAAG,GAAG,CAAC;AACrD,oBAAgB,IAAI,MAAM,eAAe,GAAG,GAAG,CAAC;AAAA,EAClD;AACA,QAAM,QAAQ,IAAI,MAAM,MAAM;AAE9B,QAAM,UAAU,IAAI,MAAM,kBAAkB,EAAE,OAAO,aAAa,MAAM,SAAS,IAAI,CAAC;AACtF,QAAMC,QAAO,IAAI,MAAM,KAAK,eAAe,OAAO;AAClD,QAAM,QAAQ,SAAS;AACvB,EAAAA,MAAK,MAAM,IAAI,QAAQ,OAAO,MAAM;AACpC,EAAAA,MAAK,SAAS,IAAI,SAAS;AAC3B,QAAM,IAAIA,KAAI;AAEd,QAAM,UAAU,IAAI,MAAM,kBAAkB,EAAE,OAAO,aAAa,MAAM,SAAS,IAAI,CAAC;AACtF,QAAM,QAAQ,SAAS;AACvB,QAAMC,QAAO,IAAI,MAAM,KAAK,eAAgB,OAAO;AACnD,EAAAA,MAAK,MAAM,IAAI,OAAO,OAAO,KAAK;AAClC,EAAAA,MAAK,SAAS,IAAI,SAAS;AAC3B,QAAM,IAAIA,KAAI;AAEd,QAAM,SAAS,IAAI,GAAG,GAAG,CAAC;AAC1B,WAAS,EAAE,IAAI,KAAK;AACpB,SAAO;AACT;AAEA,SAAS,gBAAgB,OAAc,MAAc,MAAc,MAAc,MAAoB;AACnG,QAAM,MAAM,MAAM;AAClB,QAAM,IAAI,IAAI,KAAK;AACnB,QAAM,IAAI,IAAI,KAAK;AACnB,WAAS,IAAI,MAAM,IAAI,GAAG,KAAK,MAAM;AACnC,UAAM,KAAK,QAAQ,OAAO,QAAQ;AAClC,UAAM,KAAK,QAAQ,OAAO,QAAQ;AAClC,UAAM,OAAO,gBAAgB,IAAI,IAAI,GAAG,GAAG,OAAQ;AACnD,iBAAa,KAAK,EAAE,MAAM,QAAQ,MAAM,MAAM,GAAG,SAAS,IAAI,CAAC;AAAA,EACjE;AACF;AAEA,SAAS,kBAAkB,OAAoB;AAC7C,QAAM,MAAM,MAAM;AAClB,QAAM,IAAI,IAAI,KAAK;AACnB,QAAM,IAAI,IAAI,KAAK;AACnB,QAAM,OAAO,gBAAgB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,GAAG,GAAG,OAAQ;AACrE,OAAK,SAAS,QAAQ,WAAS;AAC7B,IAAE,MAAe,SAA+B,UAAU;AAAA,EAC5D,CAAC;AACD,eAAa,KAAK,EAAE,MAAM,QAAQ,MAAM,MAAM,GAAG,SAAS,IAAI,CAAC;AACjE;AAEO,SAAS,mBAAmB,IAAkB;AACnD,QAAM,OAAO,KAAK;AAClB,QAAMC,SAAQ,SAAS;AAEvB,WAAS,IAAI,aAAa,SAAS,GAAG,KAAK,GAAG,KAAK;AACjD,UAAM,IAAI,aAAa,CAAC;AACxB,MAAE,QAAQ;AACV,UAAM,IAAI,KAAK,IAAI,EAAE,OAAO,EAAE,SAAS,CAAC;AAExC,QAAI,EAAE,SAAS,QAAQ;AACrB,YAAM,QAAQ,OAAO,IAAI;AACzB,QAAE,KAAK,SAAS,QAAQ,WAAS;AAC/B,QAAE,MAAe,SAA+B,UAAU;AAAA,MAC5D,CAAC;AAAA,IACH,WAAW,EAAE,SAAS,QAAQ;AAC5B,YAAM,QAAQ,IAAI;AAClB,QAAE,KAAK,MAAM,IAAI,OAAO,OAAO,KAAK;AACpC,QAAE,KAAK,SAAS,IAAI,OAAO;AAC3B,YAAM,QAAQ,OAAO,IAAI,IAAI;AAC7B,QAAE,KAAK,SAAS,QAAQ,WAAS;AAC/B,QAAE,MAAe,SAA+B,UAAU;AAAA,MAC5D,CAAC;AAAA,IACH;AAEA,QAAI,KAAK,GAAG;AACV,QAAE,KAAK,SAAS,QAAQ,WAAS;AAC/B,QAAE,MAAe,SAAsB,QAAQ;AAAA,MACjD,CAAC;AACD,MAAAA,OAAM,OAAO,EAAE,IAAI;AACnB,mBAAa,OAAO,GAAG,CAAC;AAAA,IAC1B;AAAA,EACF;AACF;AAEO,SAAS,oBAA0B;AACxC,QAAMA,SAAQ,SAAS;AACvB,aAAW,KAAK,cAAc;AAC5B,MAAE,KAAK,SAAS,QAAQ,WAAS;AAC/B,MAAE,MAAe,SAAsB,QAAQ;AAAA,IACjD,CAAC;AACD,IAAAA,OAAM,OAAO,EAAE,IAAI;AAAA,EACrB;AACA,eAAa,SAAS;AACxB;AAEA,SAAS,YAAoB;AAC3B,MAAI,CAAC,gBAAiB,mBAAkB,mBAAmB;AAC3D,SAAO;AACT;AAEA,SAAS,UAAkB;AACzB,MAAI,CAAC,UAAW,aAAY,aAAa;AACzC,SAAO;AACT;AAEA,SAAS,gBAAwB;AAC/B,MAAI,CAAC,eAAgB,kBAAiB,CAAC,GAAG,UAAU,GAAG,GAAG,QAAQ,CAAC;AACnE,SAAO;AACT;AAEA,SAAS,aAAa,IAAY,IAAY,QAAgB,KAA4C;AACxG,QAAM,WAAW,KAAK,IAAI,IAAI,MAAM,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC;AAC1D,QAAM,WAAW,KAAK,IAAI,IAAI,MAAM,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC;AAE1D,QAAM,KAAK,KAAK;AAChB,QAAM,KAAK,KAAK;AAChB,QAAM,SAAS,KAAK,KAAK,KAAK;AAE9B,MAAI,SAAS,SAAS,QAAQ;AAC5B,UAAM,OAAO,KAAK,KAAK,MAAM;AAC7B,QAAI,SAAS,GAAG;AACd,YAAM,cAAc,KAAK,IAAI;AAC7B,YAAM,eAAe,IAAI,OAAO;AAChC,YAAM,aAAa,KAAK,IAAI;AAC5B,YAAM,gBAAgB,IAAI,OAAO;AACjC,YAAM,aAAa,KAAK,IAAI,aAAa,cAAc,YAAY,aAAa;AAChF,UAAI,eAAe,YAAa,QAAO,EAAE,GAAG,EAAE,cAAc,SAAS,GAAG,EAAE;AAC1E,UAAI,eAAe,aAAc,QAAO,EAAE,GAAG,eAAe,QAAQ,GAAG,EAAE;AACzE,UAAI,eAAe,WAAY,QAAO,EAAE,GAAG,GAAG,GAAG,EAAE,aAAa,QAAQ;AACxE,aAAO,EAAE,GAAG,GAAG,GAAG,gBAAgB,OAAO;AAAA,IAC3C;AACA,UAAM,UAAU,SAAS;AACzB,WAAO,EAAE,GAAI,KAAK,OAAQ,SAAS,GAAI,KAAK,OAAQ,QAAQ;AAAA,EAC9D;AACA,SAAO;AACT;AAEA,SAAS,YAAY,IAAY,IAAY,KAAoB;AAC/D,SAAO,MAAM,IAAI,QAAQ,MAAM,IAAI,QAAQ,MAAM,IAAI,QAAQ,MAAM,IAAI;AACzE;AAEO,SAAS,wBAAwB,GAAW,GAAW,QAA0C;AACtG,QAAM,SAAS,UAAU;AACzB,MAAI,KAAK,GAAG,KAAK;AACjB,aAAW,OAAO,QAAQ;AACxB,UAAM,OAAO,aAAa,IAAI,IAAI,QAAQ,GAAG;AAC7C,QAAI,MAAM;AACR,YAAM,KAAK;AACX,YAAM,KAAK;AAAA,IACb;AAAA,EACF;AACA,SAAO,EAAE,GAAG,IAAI,GAAG,GAAG;AACxB;AAEO,SAAS,iBAAiB,IAAY,IAAqB;AAChE,QAAM,SAAS,UAAU;AACzB,aAAW,OAAO,QAAQ;AACxB,QAAI,YAAY,IAAI,IAAI,GAAG,EAAG,QAAO;AAAA,EACvC;AACA,SAAO;AACT;AAEO,SAAS,yBAAyB,GAAW,GAAW,QAAiE;AAC9H,QAAM,SAAS,cAAc;AAC7B,MAAI,KAAK,GAAG,KAAK;AACjB,MAAI,eAAe;AACnB,aAAW,OAAO,QAAQ;AACxB,UAAM,OAAO,aAAa,IAAI,IAAI,QAAQ,GAAG;AAC7C,QAAI,MAAM;AACR,YAAM,KAAK;AACX,YAAM,KAAK;AACX,qBAAe;AAAA,IACjB;AAAA,EACF;AACA,SAAO,EAAE,GAAG,IAAI,GAAG,IAAI,aAAa;AACtC;AAEO,SAAS,WAAW,IAAY,IAAqB;AAC1D,QAAM,OAAO,QAAQ;AACrB,aAAW,OAAO,MAAM;AACtB,QAAI,MAAM,IAAI,QAAQ,MAAM,IAAI,QAAQ,MAAM,IAAI,QAAQ,MAAM,IAAI,MAAM;AACxE,aAAO;AAAA,IACT;AAAA,EACF;AACA,SAAO;AACT;AAEO,SAAS,cAAcC,YAA4B;AACxD,QAAMC,aAAY,aAAa;AAE/B,MAAI,CAAC,gBAAgB,KAAK,CAAC,mBAAmB,GAAG;AAC/C,QAAI,WAAWA,WAAU,GAAGA,WAAU,CAAC,GAAG;AACxC,MAAAD,WAAU,eAAe;AACzB,MAAAA,WAAU,QAAQ;AAClB,kBAAY,GAAG,GAAG;AAClB,wBAAkBC,WAAU,GAAGA,WAAU,GAAG,SAAS,SAAS;AAAA,IAChE;AAAA,EACF;AAEA,aAAW,SAASD,WAAU,SAAS;AACrC,QAAI,MAAM,UAAU,EAAG;AACvB,QAAK,MAAc,UAAW;AAC9B,QAAI,WAAW,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,GAAG;AACxC,wBAAkB,KAAK;AACvB,oBAAc,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,KAAK,KAAK,OAAQ;AAE1D,YAAM,SAAS;AACf,MAAC,MAAc,YAAY;AAC3B,YAAM,YAAY;AAClB,wBAAkB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,SAAS,SAAS;AAC9D,kBAAY,GAAG,GAAG;AAAA,IACpB;AAAA,EACF;AACF;AAEA,SAAS,mBAAmB,OAAc,QAAgBA,YAA4B;AACpF,MAAK,MAAc,gBAAiB,MAAc,eAAe,GAAG;AAClE,IAAC,MAAc,gBAAgB;AAC/B,QAAK,MAAc,gBAAgB,GAAG;AACpC,YAAM,WAAW,CAAE,MAAc;AACjC,MAAC,MAAc,eAAe;AAC9B,MAAC,MAAc,eAAe;AAC9B,oBAAc,OAAOA,UAAS;AAC9B,UAAI,WAAW,GAAG;AAChB,cAAM,UAAU;AAAA,MAClB;AAAA,IACF;AAAA,EACF,OAAO;AACL,UAAM,UAAU;AAAA,EAClB;AACF;AAEA,SAAS,cAAc,OAAcA,YAA4B;AAC/D,QAAM,YAAY,MAAM,OAAO;AAC/B,MAAI,CAAC,UAAW;AAEhB,MAAK,MAAc,YAAY;AAC7B,IAAC,MAAc,WAAW,UAAU;AACpC,IAAC,MAAc,KAAK,OAAQ,MAAc,UAAU;AACpD,IAAC,MAAc,WAAW,SAAS,QAAQ;AAC3C,IAAC,MAAc,aAAa;AAAA,EAC9B;AAEA,YAAU,OAAO,UAAU,YAAY;AACvC,oBAAkB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,SAAS,SAAS;AAE9D,iBAAe;AAAA,IACb,GAAG,MAAM,IAAI;AAAA,IACb,GAAG,MAAM,IAAI;AAAA,IACb,QAAQ,UAAU;AAAA,IAClB,YAAY,UAAU,qBAAqB;AAAA,IAC3C,OAAO;AAAA,IACP,OAAO;AAAA,IACP,UAAU,CAAC,MAAM,UAAU,GAAG,UAAU,YAAY;AAAA,IACpD,WAAAA;AAAA,IACA,cAAc;AAAA,EAChB,CAAC;AAED,EAAC,MAAc,kBAAkB;AAEjC,MAAK,MAAc,UAAU;AAC3B,IAAC,MAAc,SAAS,SAAS,cAAc;AAC/C,IAAC,MAAc,SAAS,SAAS,UAAU;AAAA,EAC7C;AACA,MAAK,MAAc,UAAU;AAC3B,IAAC,MAAc,SAAS,SAAS,cAAc;AAC/C,IAAC,MAAc,SAAS,SAAS,UAAU;AAAA,EAC7C;AAEA,cAAY,GAAG,GAAG;AACpB;AAEO,SAAS,gBAAgBA,YAA4B;AAC1D,QAAMC,aAAY,aAAa;AAC/B,QAAM,UAAU,OAAO,KAAK;AAE5B,MAAI,CAAC,gBAAgB,GAAG;AACtB,UAAM,WAAW,yBAAyBA,WAAU,GAAGA,WAAU,GAAG,OAAO;AAC3E,IAAAA,WAAU,IAAI,SAAS;AACvB,IAAAA,WAAU,IAAI,SAAS;AAAA,EACzB;AAEA,aAAW,SAASD,WAAU,SAAS;AACrC,QAAK,MAAc,UAAW;AAC9B,UAAM,WAAW,yBAAyB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,MAAM,OAAO,KAAK,MAAM;AAC5F,UAAM,IAAI,IAAI,SAAS;AACvB,UAAM,IAAI,IAAI,SAAS;AACvB,IAAC,MAAc,eAAe,SAAS;AACvC,IAAC,MAAc,KAAK,SAAS,KAAK,MAAM,GAAG;AAAA,EAC7C;AAEA,QAAM,aAAa,qBAAqB;AACxC,WAAS,IAAI,WAAW,SAAS,GAAG,KAAK,GAAG,KAAK;AAC/C,UAAM,IAAI,WAAW,CAAC;AACtB,QAAI,CAAC,EAAE,KAAK,QAAS;AAErB,QAAI,iBAAiB,EAAE,KAAK,SAAS,GAAG,EAAE,KAAK,SAAS,CAAC,GAAG;AAC1D,wBAAkB,CAAC;AACnB;AAAA,IACF;AAEA,eAAW,SAASA,WAAU,SAAS;AACrC,YAAM,KAAK,EAAE,KAAK,SAAS,IAAI,MAAM,IAAI;AACzC,YAAM,KAAK,EAAE,KAAK,SAAS,IAAI,MAAM,IAAI;AACzC,YAAM,SAAS,KAAK,KAAK,KAAK;AAC9B,YAAM,OAAO,MAAM,OAAO,KAAK,SAAS,OAAO,WAAW;AAE1D,UAAI,SAAS,OAAO,MAAM;AACxB,cAAM,cAAe,MAAc;AACnC,2BAAmB,OAAO,EAAE,QAAQA,UAAS;AAC7C,0BAAkB,CAAC;AAEnB,cAAM,WAAW,cAAc,YAAY;AAC3C,0BAAkB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,EAAE,QAAQ,QAAQ;AAE9D,cAAM,aAAa;AACnB,QAAC,MAAc,SAAS,SAAS,SAAS,OAAO,QAAQ;AACzD,YAAK,MAAc,SAAU,CAAC,MAAc,SAAS,SAAS,SAAS,OAAO,QAAQ;AAEtF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,QAAM,YAAY,oBAAoB;AACtC,WAAS,IAAI,UAAU,SAAS,GAAG,KAAK,GAAG,KAAK;AAC9C,UAAM,IAAI,UAAU,CAAC;AACrB,QAAI,CAAC,EAAE,KAAK,QAAS;AAErB,QAAI,iBAAiB,EAAE,KAAK,SAAS,GAAG,EAAE,KAAK,SAAS,CAAC,GAAG;AAC1D,wBAAkB,CAAC;AACnB;AAAA,IACF;AAEA,QAAI,CAAC,mBAAmB,GAAG;AACzB,YAAM,KAAK,EAAE,KAAK,SAAS,IAAIC,WAAU;AACzC,YAAM,KAAK,EAAE,KAAK,SAAS,IAAIA,WAAU;AACzC,YAAM,SAAS,KAAK,KAAK,KAAK;AAC9B,YAAM,OAAO,UAAU;AAEvB,UAAI,SAAS,OAAO,MAAM;AACxB,QAAAD,WAAU,gBAAgB,EAAE;AAC5B,0BAAkB,CAAC;AACnB,oBAAY,GAAG,GAAG;AAElB,0BAAkBC,WAAU,GAAGA,WAAU,GAAG,EAAE,QAAQ,SAAS;AAE/D,YAAID,WAAU,gBAAgB,GAAG;AAC/B,UAAAA,WAAU,eAAe;AACzB,UAAAA,WAAU,QAAQ;AAAA,QACpB;AACA;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,MAAI,CAAC,mBAAmB,GAAG;AACzB,UAAM,MAAM,YAAY,IAAI;AAC5B,eAAW,SAASA,WAAU,SAAS;AACrC,UAAI,MAAM,aAAa,OAAQ;AAC/B,UAAI,MAAM,YAAY,EAAG;AAEzB,YAAM,KAAK,MAAM,IAAI,IAAIC,WAAU;AACnC,YAAM,KAAK,MAAM,IAAI,IAAIA,WAAU;AACnC,YAAM,SAAS,KAAK,KAAK,KAAK;AAC9B,YAAM,OAAO,UAAU,MAAM,OAAO,KAAK;AAEzC,UAAI,SAAS,OAAO,MAAM;AACxB,cAAM,iBAAiB,MAAM,OAAO,cAAc;AAClD,YAAI,MAAO,MAAc,iBAAiB,gBAAgB;AACxD,gBAAM,aAAc,MAAM,OAAO,QAAQ,MAAM,OAAO,KAAK,oBAAqB;AAChF,gBAAM,MAAO,MAAc,aAAa,MAAM,OAAO,SAAS,aAAa,MAAM,OAAO;AACxF,UAAAD,WAAU,gBAAgB;AAC1B,UAAC,MAAc,iBAAiB;AAChC,sBAAa,MAAc,aAAa,IAAI,GAAI,MAAc,aAAa,MAAM,EAAE;AAEnF,4BAAkBC,WAAU,GAAGA,WAAU,GAAG,KAAK,SAAS;AAE1D,cAAID,WAAU,gBAAgB,GAAG;AAC/B,YAAAA,WAAU,eAAe;AACzB,YAAAA,WAAU,QAAQ;AAAA,UACpB;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,QAAM,UAAU,iBAAiB;AACjC,MAAI,SAAS;AACX,UAAM,OAAO,QAAQ;AACrB,UAAM,OAAO,QAAQ;AACrB,eAAW,SAASA,WAAU,SAAS;AACrC,UAAI,MAAM,UAAU,EAAG;AACvB,UAAK,MAAc,UAAW;AAC9B,YAAM,cAAc,MAAM,OAAO,KAAK;AACtC,UAAI;AAAA,QAAgB,MAAM,IAAI;AAAA,QAAG,MAAM,IAAI;AAAA,QAAG,QAAQ;AAAA,QAAG,QAAQ;AAAA,QAC5C,QAAQ;AAAA,QAAO,QAAQ;AAAA,QAAQ,QAAQ;AAAA,QAAU;AAAA,MAAW,GAAG;AAClF,cAAM,OAAO,MAAM,IAAI;AACvB,cAAM,OAAO,MAAM,IAAI;AAEvB,cAAM,aAAa,cAAc,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,KAAK;AAChE,cAAM,SAAS,KAAM,MAAc,mBAAmB,MAAM,OAAO,mBAAmB;AACtF,cAAM,SAAS,QAAQ,QAAQ,SAAS,WAAW;AACnD,cAAM,IAAI,KAAK,OAAO;AACtB,cAAM,IAAI,KAAK,OAAO;AACtB,QAAC,MAAc,KAAK,SAAS,KAAK,MAAM,GAAG;AAE3C,wBAAgB,OAAO,MAAM,MAAM,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC;AAE3D,cAAM,aAAa;AACnB,QAAC,MAAc,SAAS,SAAS,SAAS,OAAO,OAAQ;AACzD,YAAK,MAAc,SAAU,CAAC,MAAc,SAAS,SAAS,SAAS,OAAO,OAAQ;AAEtF,0BAAkB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,QAAQ,SAAS;AAAA,MAC/D;AAAA,IACF;AAAA,EACF;AAEA,MAAI,SAAS;AACX,eAAW,SAASA,WAAU,SAAS;AACrC,UAAK,MAAc,UAAW;AAC9B,YAAM,WAAW,wBAAwB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG,MAAM,OAAO,KAAK,MAAM;AAC3F,YAAM,IAAI,IAAI,SAAS;AACvB,YAAM,IAAI,IAAI,SAAS;AACvB,MAAC,MAAc,KAAK,SAAS,KAAK,MAAM,GAAG;AAAA,IAC7C;AAAA,EACF;AACF;;;ACxcA,IAAI;AAAJ,IAAoB;AAApB,IAAqC;AAArC,IAAyD;AAAzD,IAA6E;AAG7E,IAAI;AAAJ,IAAwB;AAEjB,SAAS,UAAU;AACxB,cAAY,SAAS,eAAe,YAAY;AAChD,eAAa,SAAS,eAAe,aAAa;AAClD,kBAAgB,SAAS,eAAe,gBAAgB;AACxD,kBAAgB,SAAS,eAAe,gBAAgB;AACxD,eAAa,SAAS,eAAe,aAAa;AAGlD,aAAW,CAAC,KAAK,OAAO,KAAK,OAAO,QAAQ,SAAS,GAAG;AACtD,UAAM,KAAK,SAAS,cAAc,KAAK;AACvC,OAAG,YAAY;AACf,OAAG,KAAK,WAAW,GAAG;AACtB,OAAG,YACD,4BAA6B,QAAgB,GAAG,mCAClB,QAAgB,IAAI;AAGpD,eAAW,YAAY,EAAE;AAAA,EAC3B;AAGA,QAAM,WAAW,kBAAkB,UAAU,UAAU,iBAAiB;AACxE,MAAI,UAAU;AACZ,sBAAkB;AAAA,EACpB;AACF;AAGA,IAAM,iBAAiB;AACvB,IAAM,kBAAkB;AAGxB,IAAME,aAAY,IAAI,KAAK;AAC3B,IAAMC,eAAcD;AACpB,IAAME,eAAc,CAACF;AACrB,IAAMG,YAAW,CAACH;AAClB,IAAMI,YAAW,CAACJ;AAElB,SAAS,oBAAoB;AAC3B,kBAAgB,SAAS,eAAe,iBAAiB;AACzD,iBAAe,SAAS,eAAe,qBAAqB;AAC5D,MAAI,CAAC,iBAAiB,CAAC,aAAc;AAGrC,iBAAe,eAAe;AAAA,IAC5B,aAAa,MAAM;AAAA,IAA6C;AAAA,IAChE,YAAY,CAAC,OAAe,UAAkB;AAE5C,YAAM,OAAO,QAAQC,eAAc,QAAQE;AAC3C,YAAM,OAAO,QAAQD,eAAc,QAAQE;AAC3C,4BAAsB,MAAM,IAAI;AAChC,2BAAqB,OAAO,KAAK;AAAA,IACnC;AAAA,IACA,WAAW,CAAC,YAAqB;AAC/B,kBAAY;AACZ,UAAI,CAAC,QAAS,yBAAwB;AAAA,IAExC;AAAA,IACA,UAAU,MAAM;AACd,8BAAwB;AAAA,IAC1B;AAAA,EACF,CAAC;AAGD,iBAAe,cAAc;AAAA,IAC3B,aAAa,MAAM;AACjB,sBAAgB;AAChB,sBAAgB,IAAI;AAAA,IACtB;AAAA,IACA,YAAY,CAAC,OAAe,UAAkB;AAC5C,2BAAqB,OAAO,KAAK;AAAA,IACnC;AAAA,IACA,WAAW,MAAM;AACf,sBAAgB,KAAK;AACrB,8BAAwB;AAAA,IAC1B;AAAA,IACA,UAAU,MAAM;AACd,sBAAgB,KAAK;AACrB,8BAAwB;AAAA,IAC1B;AAAA,EACF,CAAC;AACH;AAYA,SAAS,eAAe,OAAY,EAAE,aAAa,YAAY,WAAW,SAAS,GAAQ;AACzF,MAAI,UAAyB;AAC7B,MAAI,SAAS,GAAG,SAAS;AACzB,MAAIC,cAAa;AAEjB,QAAM,iBAAiB,cAAc,CAAC,MAAW;AAC/C,MAAE,eAAe;AACjB,QAAI,YAAY,KAAM;AACtB,UAAM,QAAQ,EAAE,eAAe,CAAC;AAChC,cAAU,MAAM;AAChB,aAAS,MAAM;AACf,aAAS,MAAM;AACf,IAAAA,cAAa;AACb,gBAAY;AAAA,EACd,CAAC;AAGD,SAAO,iBAAiB,aAAa,CAAC,MAAW;AAC/C,QAAI,YAAY,KAAM;AACtB,UAAM,QAAQ,UAAU,EAAE,gBAAgB,OAAO;AACjD,QAAI,CAAC,MAAO;AAEZ,UAAM,KAAK,MAAM,UAAU;AAC3B,UAAM,KAAK,MAAM,UAAU;AAC3B,UAAM,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAExC,QAAI,OAAO,gBAAgB;AACzB,MAAAA,cAAa;AAEb,YAAM,cAAc,KAAK,IAAI,MAAM,eAAe;AAClD,YAAM,QAAS,KAAK,QAAS,cAAc;AAC3C,YAAM,QAAS,CAAC,KAAK,QAAS,cAAc;AAC5C,iBAAW,OAAO,KAAK;AAAA,IACzB;AAAA,EACF,GAAG,EAAE,SAAS,KAAK,CAAC;AAEpB,SAAO,iBAAiB,YAAY,CAAC,MAAW;AAC9C,QAAI,YAAY,KAAM;AACtB,UAAM,QAAQ,UAAU,EAAE,gBAAgB,OAAO;AACjD,QAAI,CAAC,MAAO;AACZ,cAAU;AACV,cAAUA,WAAU;AAAA,EACtB,CAAC;AAED,SAAO,iBAAiB,eAAe,CAAC,MAAW;AACjD,QAAI,YAAY,KAAM;AACtB,UAAM,QAAQ,UAAU,EAAE,gBAAgB,OAAO;AACjD,QAAI,CAAC,MAAO;AACZ,cAAU;AACV,aAAS;AAAA,EACX,CAAC;AACH;AAEA,SAAS,UAAU,WAAgB,IAAY;AAC7C,WAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACzC,QAAI,UAAU,CAAC,EAAE,eAAe,GAAI,QAAO,UAAU,CAAC;AAAA,EACxD;AACA,SAAO;AACT;AAEO,SAAS,UAAUC,YAAgB;AAExC,QAAM,MAAM,KAAK,IAAI,GAAGA,WAAU,eAAeA,WAAU,eAAe;AAC1E,YAAU,MAAM,QAAS,MAAM,MAAO;AAEtC,MAAI,MAAM,KAAK;AACb,cAAU,MAAM,kBAAkB;AAAA,EACpC,WAAW,MAAM,MAAM;AACrB,cAAU,MAAM,kBAAkB;AAAA,EACpC,OAAO;AACL,cAAU,MAAM,kBAAkB;AAAA,EACpC;AAEA,aAAW,cAAc,KAAK,KAAKA,WAAU,YAAY,IAAI,QAAQA,WAAU;AAG/E,gBAAc,cAAc,UAAUA,WAAU;AAGhD,gBAAc,cAAcA,WAAU;AAGtC,aAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQA,WAAU,SAAS,GAAG;AAC9D,QAAI,CAAE,UAAkB,GAAG,EAAG;AAC9B,UAAM,MAAO,UAAkB,GAAG;AAGlC,UAAM,OAAO,SAAS,eAAe,WAAW,GAAG,EAAE;AACrD,QAAI,MAAM;AACR,YAAM,UAAU,KAAK,cAAc,2BAA2B;AAC9D,YAAM,SAAS,KAAK,cAAc,wBAAwB;AAE1D,UAAK,MAAc,oBAAoB,GAAG;AACxC,cAAM,eAAe,KAAK,IAAI,GAAI,MAAc,oBAAoB,IAAI,QAAQ;AAChF,gBAAQ,MAAM,SAAU,eAAe,MAAO;AAC9C,aAAK,UAAU,OAAO,OAAO;AAC7B,cAAM,OAAO,KAAK,KAAM,MAAc,oBAAoB,GAAI;AAC9D,eAAO,cAAc;AACrB,eAAO,MAAM,UAAU;AAAA,MACzB,OAAO;AACL,gBAAQ,MAAM,SAAS;AACvB,aAAK,UAAU,IAAI,OAAO;AAC1B,eAAO,MAAM,UAAU;AAAA,MACzB;AAGA,UAAI,QAAQ,cAAe,MAAc,UAAU;AACjD,cAAM,YAAY,KAAK,MAAO,MAAc,UAAU,GAAG;AACzD,aAAK,MAAM,cAAc;AACzB,aAAK,MAAM,YAAY;AACvB,eAAO,cAAc,YAAY;AACjC,eAAO,MAAM,UAAU;AACvB,eAAO,MAAM,QAAQ;AACrB,gBAAQ,MAAM,UAAW,IAAK,MAAc,WAAW,MAAO;AAC9D,gBAAQ,MAAM,kBAAkB;AAAA,MAClC,OAAO;AACL,YAAI,KAAK,MAAM,YAAa,MAAK,MAAM,cAAc;AACrD,YAAI,KAAK,MAAM,UAAW,MAAK,MAAM,YAAY;AACjD,eAAO,MAAM,QAAQ;AACrB,gBAAQ,MAAM,kBAAkB;AAAA,MAClC;AAAA,IACF;AAGA,UAAM,OAAO,QAAQ,SAAS,gBAAgB,QAAQ,aAAa,eAAe;AAClF,QAAI,MAAM;AACR,YAAM,WAAW,KAAK,cAAc,wBAAwB;AAC5D,YAAM,UAAU,KAAK,cAAc,qBAAqB;AAExD,UAAK,MAAc,oBAAoB,GAAG;AACxC,cAAM,eAAe,KAAK,IAAI,GAAI,MAAc,oBAAoB,IAAI,QAAQ;AAChF,iBAAS,MAAM,SAAU,eAAe,MAAO;AAC/C,aAAK,UAAU,OAAO,OAAO;AAC7B,cAAM,OAAO,KAAK,KAAM,MAAc,oBAAoB,GAAI;AAC9D,gBAAQ,cAAc;AACtB,gBAAQ,MAAM,UAAU;AAAA,MAC1B,OAAO;AACL,iBAAS,MAAM,SAAS;AACxB,aAAK,UAAU,IAAI,OAAO;AAC1B,gBAAQ,MAAM,UAAU;AAAA,MAC1B;AAGA,UAAI,QAAQ,cAAe,MAAc,UAAU;AACjD,cAAM,YAAY,KAAK,MAAO,MAAc,UAAU,GAAG;AACzD,aAAK,MAAM,cAAc;AACzB,aAAK,MAAM,YAAY;AACvB,gBAAQ,cAAc,YAAY;AAClC,gBAAQ,MAAM,UAAU;AACxB,gBAAQ,MAAM,QAAQ;AACtB,iBAAS,MAAM,UAAW,IAAK,MAAc,WAAW,MAAO;AAC/D,iBAAS,MAAM,kBAAkB;AAAA,MACnC,WAAW,QAAQ,YAAY;AAC7B,YAAI,KAAK,MAAM,YAAa,MAAK,MAAM,cAAc;AACrD,YAAI,KAAK,MAAM,UAAW,MAAK,MAAM,YAAY;AACjD,gBAAQ,MAAM,QAAQ;AACtB,iBAAS,MAAM,kBAAkB;AAAA,MACnC;AAAA,IACF;AAAA,EACF;AACF;;;ACzQA,IAAI;AAAJ,IAAsB;AACtB,IAAI;AAAJ,IAAyB;AAAzB,IAA0C;AAEnC,SAAS,YAAY,WAAuB,SAAqB;AAEtE,gBAAc,SAAS,eAAe,cAAc;AACpD,aAAW,SAAS,eAAe,WAAW;AAE9C,QAAM,cAAc,MAAM;AACxB,oBAAgB;AAChB,YAAQ;AAAA,EACV;AACA,WAAS,iBAAiB,SAAS,WAAW;AAC9C,WAAS,iBAAiB,YAAY,CAAC,MAAW;AAChD,MAAE,eAAe;AACjB,gBAAY;AAAA,EACd,CAAC;AAGD,mBAAiB,SAAS,eAAe,kBAAkB;AAC3D,eAAa,SAAS,eAAe,aAAa;AAClD,kBAAgB,SAAS,eAAe,iBAAiB;AAEzD,aAAW,iBAAiB,SAAS,MAAM;AACzC,gBAAY;AACZ,cAAU;AAAA,EACZ,CAAC;AACH;AAEO,SAAS,kBAAkB;AAChC,cAAY,UAAU,IAAI,QAAQ;AACpC;AAEO,SAAS,aAAaC,YAAgB;AAC3C,gBAAc,cAAc,qBAAqBA,WAAU,QAAQ;AACnE,iBAAe,UAAU,OAAO,QAAQ;AAC1C;AAEO,SAAS,cAAc;AAC5B,iBAAe,UAAU,IAAI,QAAQ;AACvC;;;ACtCO,IAAM,OAAmB;AAAA,EAC9B,MAAM;AAAA,EACN,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,MAAM,EAAE,QAAQ,KAAK,QAAQ,EAAI;AAAA,EACjC,OAAO;AAAA,EACP,UAAU;AAAA,EACV,QAAQ;AAAA,IACN,EAAE,iBAAiB,GAAK,UAAU,SAAS,YAAY,IAAK;AAAA,IAC5D,EAAE,iBAAiB,KAAK,UAAU,UAAU,YAAY,KAAK,OAAO,GAAK,cAAc,EAAE,MAAM,UAAU,OAAO,EAAE,EAAE;AAAA,EACtH;AACF;;;ACFA,IAAM,eAAoC;AAAA,EACxC,QAAiB;AAAA,EACjB,QAAiB,YAAY;AAAA,EAC7B,gBAAiB,YAAY;AAAA,EAC7B,cAAiB,YAAY;AAAA,EAC7B,YAAiB,YAAY;AAAA,EAC7B,MAAiB,UAAU;AAAA,EAC3B,UAAiB,UAAU;AAAA,EAC3B,MAAiB;AACnB;AAEA,SAAS,eAAe,KAAU,MAAc;AAC9C,QAAM,QAAQ,KAAK,MAAM,GAAG;AAC5B,MAAI,MAAM;AACV,aAAW,KAAK,OAAO;AACrB,QAAI,OAAO,KAAM,QAAO;AACxB,UAAM,IAAI,CAAC;AAAA,EACb;AACA,SAAO;AACT;AAEA,SAAS,eAAe,KAAU,MAAc,OAAY;AAC1D,QAAM,QAAQ,KAAK,MAAM,GAAG;AAC5B,MAAI,MAAM;AACV,WAAS,IAAI,GAAG,IAAI,MAAM,SAAS,GAAG,KAAK;AACzC,QAAI,IAAI,MAAM,CAAC,CAAC,KAAK,KAAM,KAAI,MAAM,CAAC,CAAC,IAAI,CAAC;AAC5C,UAAM,IAAI,MAAM,CAAC,CAAC;AAAA,EACpB;AACA,MAAI,MAAM,MAAM,SAAS,CAAC,CAAC,IAAI;AACjC;AAEA,SAAS,WAAW,KAAa;AAC/B,MAAI,QAAQ,OAAQ,QAAO;AAC3B,MAAI,QAAQ,QAAS,QAAO;AAC5B,MAAI,IAAI,WAAW,IAAI,KAAK,IAAI,WAAW,IAAI,GAAG;AAChD,UAAM,MAAM,SAAS,KAAK,EAAE;AAC5B,QAAI,CAAC,MAAM,GAAG,EAAG,QAAO;AAAA,EAC1B;AACA,QAAM,MAAM,OAAO,GAAG;AACtB,SAAO,MAAM,GAAG,IAAI,MAAM;AAC5B;AAMO,SAAS,iBAAiB;AAC/B,QAAM,SAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM;AACzD,MAAI,UAAU;AAEd,aAAW,CAAC,KAAK,QAAQ,KAAK,QAAQ;AACpC,UAAM,SAAS,IAAI,QAAQ,GAAG;AAC9B,QAAI,WAAW,GAAI;AAEnB,UAAM,SAAS,IAAI,MAAM,GAAG,MAAM;AAClC,UAAM,OAAO,IAAI,MAAM,SAAS,CAAC;AACjC,QAAI,CAAC,KAAM;AAEX,UAAM,OAAO,aAAa,MAAM;AAChC,QAAI,CAAC,MAAM;AACT,cAAQ,KAAK,gCAAgC,MAAM,YAAY,GAAG,IAAI;AACtE;AAAA,IACF;AAGA,UAAM,WAAW,eAAe,MAAM,IAAI;AAC1C,QAAI,aAAa,QAAW;AAC1B,cAAQ,KAAK,8BAA8B,GAAG,2BAAsB;AACpE;AAAA,IACF;AAEA,UAAM,QAAQ,WAAW,QAAQ;AACjC,mBAAe,MAAM,MAAM,KAAK;AAChC;AACA,YAAQ,IAAI,eAAe,GAAG,MAAM,KAAK,EAAE;AAAA,EAC7C;AAEA,MAAI,UAAU,GAAG;AACf,YAAQ,IAAI,uBAAuB,OAAO,uBAAuB;AAAA,EACnE;AACA,SAAO;AACT;AAKO,SAAS,mBAAmB;AACjC,QAAM,OAA4B,CAAC;AACnC,aAAW,CAAC,QAAQ,IAAI,KAAK,OAAO,QAAQ,YAAY,GAAG;AACzD,SAAK,MAAM,IAAI,KAAK,MAAM,KAAK,UAAU,IAAI,CAAC;AAAA,EAChD;AACA,SAAO;AACT;AAKO,SAAS,cAAc,UAA+B;AAC3D,QAAM,SAAS,IAAI,gBAAgB;AAEnC,aAAW,CAAC,QAAQ,IAAI,KAAK,OAAO,QAAQ,YAAY,GAAG;AACzD,UAAM,UAAU,SAAS,MAAM;AAC/B,QAAI,CAAC,QAAS;AACd,iBAAa,QAAQ,QAAQ,SAAS,MAAM,EAAE;AAAA,EAChD;AAEA,QAAM,OAAO,OAAO,SAAS,SAAS,OAAO,SAAS;AACtD,QAAM,KAAK,OAAO,SAAS;AAC3B,SAAO,KAAK,OAAO,MAAM,KAAK;AAChC;AAEA,SAAS,aAAa,QAAyB,QAAgB,QAAa,QAAa,YAAoB;AAC3G,aAAW,OAAO,OAAO,KAAK,MAAM,GAAG;AACrC,UAAM,WAAW,aAAa,aAAa,MAAM,MAAM;AACvD,UAAM,SAAS,OAAO,GAAG;AACzB,UAAM,SAAS,eAAe,QAAQ,QAAQ;AAE9C,QAAI,UAAU,QAAQ,OAAO,WAAW,YAAY,CAAC,MAAM,QAAQ,MAAM,GAAG;AAC1E,mBAAa,QAAQ,QAAQ,QAAQ,QAAQ,QAAQ;AAAA,IACvD,WAAW,WAAW,QAAQ;AAC5B,aAAO,IAAI,SAAS,MAAM,UAAU,OAAO,MAAM,CAAC;AAAA,IACpD;AAAA,EACF;AACF;;;AChIA,IAAM,UAAiB;AAAA,EACrB;AAAA,IACE,OAAO;AAAA,IACP,OAAO;AAAA,MACL;AAAA,QAAE,OAAO;AAAA,QAAc,QAAQ,MAAM;AAAA,QAAmB,KAAK;AAAA,QAAqB,KAAK;AAAA,QAAK,KAAK;AAAA,QAAM,MAAM;AAAA,QAAI,QAAQ;AAAA,QAAM,QAAQ;AAAA,QACrI,MAAM;AAAA,QAAM,KAAK;AAAA,MAAyD;AAAA,MAC5E;AAAA,QAAE,OAAO;AAAA,QAAc,QAAQ,MAAM,OAAO;AAAA,QAAa,KAAK;AAAA,QAAoB,KAAK;AAAA,QAAK,KAAK;AAAA,QAAM,MAAM;AAAA,QAAI,QAAQ;AAAA,QACvH,MAAM;AAAA,QAAO,KAAK;AAAA,MAAsD;AAAA,MAC1E;AAAA,QAAE,OAAO;AAAA,QAAc,QAAQ,MAAM,OAAO;AAAA,QAAa,KAAK;AAAA,QAAoB,KAAK;AAAA,QAAM,KAAK;AAAA,QAAK,MAAM;AAAA,QAAM,QAAQ;AAAA,QACzH,MAAM;AAAA,QAAK,KAAK;AAAA,MAAqD;AAAA,IACzE;AAAA,EACF;AAAA,EACA;AAAA,IACE,OAAO;AAAA,IACP,OAAO;AAAA,MACL;AAAA,QAAE,OAAO;AAAA,QAAc,QAAQ,MAAM;AAAA,QAAmB,KAAK;AAAA,QAAoB,KAAK;AAAA,QAAK,KAAK;AAAA,QAAM,MAAM;AAAA,QAAK,QAAQ;AAAA,QACvH,MAAM;AAAA,QAAO,KAAK;AAAA,MAA6C;AAAA,IACnE;AAAA,EACF;AAAA,EACA;AAAA,IACE,OAAO;AAAA,IACP,OAAO;AAAA,MACL;AAAA,QAAE,OAAO;AAAA,QAAc,QAAQ,MAAM;AAAA,QAAmB,KAAK;AAAA,QAAoB,KAAK;AAAA,QAAK,KAAK;AAAA,QAAM,MAAM;AAAA,QAAK,QAAQ;AAAA,QAAK,QAAQ;AAAA,QACpI,MAAM;AAAA,QAAK,KAAK;AAAA,MAAoE;AAAA,IACxF;AAAA,EACF;AACF;AAGA,IAAI,uBAAuB;AAC3B,IAAM,iBAAsB,CAAC;AAG7B,SAAS,wBAAwB;AAC/B,aAAW,CAAC,MAAM,GAAG,KAAK,OAAO,QAAQ,WAAW,GAAG;AACrD,mBAAe,IAAI,IAAK,IAAY;AAAA,EACtC;AACF;AAEA,SAAS,0BAA0B,MAAc;AAC/C,yBAAuB;AACvB,aAAW,CAAC,MAAM,GAAG,KAAK,OAAO,QAAQ,WAAW,GAAG;AACrD,IAAC,IAAY,QAAQ,eAAe,IAAI,IAAI;AAAA,EAC9C;AACF;AAEA,IAAI;AAAJ,IAAgB,cAAc;AAEvB,SAAS,kBAAkB;AAChC,wBAAsB;AAGtB,UAAQ,SAAS,cAAc,KAAK;AACpC,QAAM,KAAK;AACX,QAAM,YAAY;AAGlB,QAAM,SAAS,SAAS,cAAc,KAAK;AAC3C,SAAO,KAAK;AACZ,SAAO,cAAc;AACrB,SAAO,iBAAiB,SAAS,MAAM;AACrC,kBAAc,CAAC;AACf,UAAM,UAAU,OAAO,aAAa,WAAW;AAC/C,WAAO,cAAc,cAAc,SAAS;AAAA,EAC9C,CAAC;AACD,QAAM,YAAY,MAAM;AAGxB,QAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,UAAQ,KAAK;AACb,QAAM,YAAY,OAAO;AAGzB,aAAW,SAAS,SAAS;AAC3B,UAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,YAAQ,YAAY;AAEpB,UAAMC,cAAa,SAAS,cAAc,KAAK;AAC/C,IAAAA,YAAW,YAAY;AACvB,IAAAA,YAAW,cAAc,MAAM;AAC/B,YAAQ,YAAYA,WAAU;AAE9B,eAAW,QAAQ,MAAM,OAAO;AAC9B,YAAM,MAAM,SAAS,cAAc,KAAK;AACxC,UAAI,YAAY;AAEhB,YAAM,QAAQ,SAAS,cAAc,MAAM;AAC3C,YAAM,YAAY;AAClB,YAAM,cAAc,KAAK;AACzB,UAAI,KAAK,KAAK;AACZ,cAAM,aAAa,YAAY,KAAK,GAAG;AACvC,cAAM,UAAU,IAAI,aAAa;AAAA,MACnC;AAEA,YAAM,SAAS,SAAS,cAAc,OAAO;AAC7C,aAAO,OAAO;AACd,aAAO,YAAY;AACnB,aAAO,MAAM,KAAK;AAClB,aAAO,MAAM,KAAK;AAClB,aAAO,OAAO,KAAK;AAGnB,UAAI;AACJ,UAAI,KAAK,WAAW,cAAc;AAChC,qBAAa;AAAA,MACf,OAAO;AACL,qBAAa,KAAK,OAAO,EAAE,KAAK,GAAG;AAAA,MACrC;AACA,aAAO,QAAQ;AAEf,YAAM,eAAe,SAAS,cAAc,MAAM;AAClD,mBAAa,YAAY;AACzB,mBAAa,cAAc,YAAY,YAAY,IAAI;AAEvD,aAAO,iBAAiB,SAAS,MAAM;AACrC,cAAM,MAAM,WAAW,OAAO,KAAK;AACnC,YAAI,KAAK,WAAW,cAAc;AAChC,oCAA0B,GAAG;AAAA,QAC/B,OAAO;AACL,eAAK,OAAO,EAAE,KAAK,GAAG,IAAI;AAAA,QAC5B;AACA,qBAAa,cAAc,YAAY,KAAK,IAAI;AAAA,MAClD,CAAC;AAED,UAAI,YAAY,KAAK;AACrB,UAAI,YAAY,MAAM;AACtB,UAAI,YAAY,YAAY;AAC5B,cAAQ,YAAY,GAAG;AAAA,IACzB;AAEA,YAAQ,YAAY,OAAO;AAAA,EAC7B;AAGA,QAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,UAAQ,KAAK;AACb,UAAQ,cAAc;AACtB,UAAQ,iBAAiB,SAAS,MAAM;AACtC,UAAM,OAAO,cAAc;AAC3B,cAAU,UAAU,UAAU,IAAI,EAAE,KAAK,MAAM;AAC7C,cAAQ,cAAc;AACtB,cAAQ,UAAU,IAAI,QAAQ;AAC9B,iBAAW,MAAM;AACf,gBAAQ,cAAc;AACtB,gBAAQ,UAAU,OAAO,QAAQ;AAAA,MACnC,GAAG,IAAI;AAAA,IACT,CAAC;AAAA,EACH,CAAC;AACD,UAAQ,YAAY,OAAO;AAG3B,QAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,WAAS,KAAK;AACd,WAAS,cAAc;AACvB,WAAS,iBAAiB,SAAS,MAAM;AACvC,UAAM,MAAM,cAAe,OAAe,oBAAoB,CAAC,CAAC;AAChE,cAAU,UAAU,UAAU,GAAG,EAAE,KAAK,MAAM;AAC5C,eAAS,cAAc;AACvB,eAAS,UAAU,IAAI,QAAQ;AAC/B,iBAAW,MAAM;AACf,iBAAS,cAAc;AACvB,iBAAS,UAAU,OAAO,QAAQ;AAAA,MACpC,GAAG,IAAI;AAAA,IACT,CAAC;AAAA,EACH,CAAC;AACD,UAAQ,YAAY,QAAQ;AAG5B,QAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,YAAU,KAAK;AACf,WAAS,KAAK,YAAY,SAAS;AAEnC,MAAI,kBAAuB;AAC3B,QAAM,iBAAiB,aAAa,CAAC,MAAW;AAC9C,UAAM,KAAK,EAAE,OAAO,QAAQ,cAAc;AAC1C,QAAI,MAAM,GAAG,aAAa,UAAU,GAAG;AACrC,wBAAkB;AAClB,gBAAU,cAAc,GAAG,aAAa,UAAU;AAClD,gBAAU,UAAU,IAAI,SAAS;AACjC,YAAM,OAAO,GAAG,sBAAsB;AAEtC,UAAI,OAAO,KAAK,OAAO,UAAU,cAAc;AAC/C,UAAI,MAAM,KAAK,MAAM,KAAK,SAAS,IAAI,UAAU,eAAe;AAChE,UAAI,OAAO,GAAG;AAAE,eAAO,KAAK,QAAQ;AAAA,MAAG;AACvC,YAAM,KAAK,IAAI,GAAG,KAAK,IAAI,OAAO,cAAc,UAAU,eAAe,GAAG,GAAG,CAAC;AAChF,gBAAU,MAAM,OAAO,OAAO;AAC9B,gBAAU,MAAM,MAAM,MAAM;AAAA,IAC9B;AAAA,EACF,CAAC;AACD,QAAM,iBAAiB,YAAY,CAAC,MAAW;AAC7C,UAAM,KAAK,EAAE,OAAO,QAAQ,cAAc;AAC1C,QAAI,OAAO,iBAAiB;AAC1B,wBAAkB;AAClB,gBAAU,UAAU,OAAO,SAAS;AAAA,IACtC;AAAA,EACF,CAAC;AAGD,QAAM,UAAU,IAAI,WAAW;AAC/B,WAAS,KAAK,YAAY,KAAK;AAC/B,eAAa;AACf;AAEA,SAAS,gBAAgB;AACvB,QAAM,QAAkB,CAAC;AACzB,aAAW,SAAS,SAAS;AAC3B,UAAM,KAAK,GAAG,MAAM,KAAK,GAAG;AAC5B,eAAW,QAAQ,MAAM,OAAO;AAC9B,UAAI;AACJ,UAAI,KAAK,WAAW,cAAc;AAChC,cAAM;AAAA,MACR,OAAO;AACL,cAAM,KAAK,OAAO,EAAE,KAAK,GAAG;AAAA,MAC9B;AACA,YAAM,UAAU,OAAO,UAAU,GAAG,IAAI,MAAM,WAAW,IAAI,QAAQ,CAAC,CAAC;AACvE,YAAM,SAAS,KAAK,SAAS,MAAM,KAAK,SAAS;AACjD,YAAM,KAAK,KAAK,KAAK,KAAK,KAAK,OAAO,GAAG,MAAM,EAAE;AAAA,IACnD;AAAA,EACF;AACA,SAAO,MAAM,KAAK,IAAI;AACxB;AAEA,SAAS,YAAY,KAAa,MAAW;AAC3C,QAAM,UAAU,OAAO,UAAU,GAAG,IAAI,MAAM,IAAI,QAAQ,CAAC;AAC3D,QAAM,UAAU,KAAK,QAAQ,KAAK,UAAU;AAC5C,SAAO,WAAW,UAAU,MAAM,UAAU;AAC9C;AAEA,SAAS,eAAe;AACtB,QAAM,QAAQ,SAAS,cAAc,OAAO;AAC5C,QAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6LpB,WAAS,KAAK,YAAY,KAAK;AACjC;;;ACvaA,QAAQ,IAAI,6CAAwC;AAYpD,IAAIC;AACJ,IAAI;AACJ,IAAIC;AACJ,IAAI,SAAS;AACb,IAAI,gBAAgB;AAGpB,IAAI,aAAa;AAGjB,IAAM,cAAc;AAAA,EAClB,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,WAAW;AAAA,EACX,kBAAkB;AAAA;AACpB;AAGA,IAAM,aAAa;AAAA,EACjB,cAAc;AAAA;AAAA,EACd,aAAa;AAAA;AACf;AAGA,IAAI,oBAAmC;AAGvC,IAAI,aAAa;AACjB,IAAI,cAAc;AAClB,IAAI,iBAAsB;AAG1B,IAAM,YAAmB,CAAC;AAC1B,IAAM,YAAmB,CAAC;AAC1B,IAAM,WAAW;AAEjB,SAAS,gBAAgB;AACvB,QAAM,OAAO,MAAM,YAAY,SAAS;AACxC,MAAI,CAAC,KAAM,QAAO;AAClB,QAAM,QAAQ,KAAK,OAAO,YAAY,UAAU;AAChD,MAAI,CAAC,MAAO,QAAO;AACnB,SAAO;AAAA,IACL,KAAK;AAAA,IACL,WAAW,YAAY;AAAA,IACvB,YAAY,YAAY;AAAA,IACxB,QAAQ,KAAK,MAAM,KAAK,UAAU,MAAM,MAAM,CAAC;AAAA,IAC/C,cAAc,MAAM;AAAA,IACpB,mBAAmB,MAAM;AAAA,IACzB,SAAS,MAAM;AAAA,EACjB;AACF;AAEA,SAAS,gBAAgB;AACvB,SAAO;AAAA,IACL,KAAK;AAAA,IACL,WAAW,KAAK,MAAM,KAAK,UAAU,SAAS,CAAC;AAAA,IAC/C,MAAM,KAAK,MAAM,KAAK,UAAU,IAAI,CAAC;AAAA,IACrC,cAAc,WAAW;AAAA,IACzB,aAAa,WAAW;AAAA,EAC1B;AACF;AAEA,SAAS,WAAW;AAClB,QAAM,OAAO,eAAe,UAAU,cAAc,IAAI,cAAc;AACtE,MAAI,CAAC,KAAM;AACX,YAAU,KAAK,IAAI;AACnB,MAAI,UAAU,SAAS,SAAU,WAAU,MAAM;AACjD,YAAU,SAAS;AACrB;AAEA,SAAS,cAAc,MAAW;AAChC,MAAI,KAAK,QAAQ,SAAS;AAExB,cAAU,SAAS;AACnB,eAAW,KAAK,KAAK,UAAW,WAAU,KAAK,CAAC;AAChD,SAAK,SAAS;AACd,eAAW,KAAK,KAAK,KAAM,MAAK,KAAK,CAAC;AACtC,eAAW,eAAe,KAAK;AAC/B,eAAW,cAAc,KAAK;AAC9B,mBAAe;AACf,wBAAoB;AACpB,cAAU;AAAA,EACZ,OAAO;AACL,gBAAY,YAAY,KAAK;AAC7B,gBAAY,aAAa,KAAK;AAC9B,UAAM,OAAO,MAAM,KAAK,SAAS;AACjC,QAAI,CAAC,KAAM;AACX,UAAM,QAAQ,KAAK,OAAO,KAAK,UAAU;AACzC,QAAI,CAAC,MAAO;AACZ,UAAM,SAAS,KAAK;AACpB,UAAM,eAAe,KAAK;AAC1B,UAAM,oBAAoB,KAAK;AAC/B,UAAM,UAAU,KAAK;AACrB,mBAAe;AACf,cAAU;AAAA,EACZ;AACF;AAEA,SAAS,UAAU;AACjB,MAAI,UAAU,WAAW,EAAG;AAE5B,QAAM,UAAU,eAAe,UAAU,cAAc,IAAI,cAAc;AACzE,MAAI,QAAS,WAAU,KAAK,OAAO;AACnC,gBAAc,UAAU,IAAI,CAAC;AAC/B;AAEA,SAAS,UAAU;AACjB,MAAI,UAAU,WAAW,EAAG;AAE5B,QAAM,UAAU,eAAe,UAAU,cAAc,IAAI,cAAc;AACzE,MAAI,QAAS,WAAU,KAAK,OAAO;AACnC,gBAAc,UAAU,IAAI,CAAC;AAC/B;AAGA,IAAI,UAAiB,CAAC;AAGtB,IAAI,eAAsB,CAAC;AAG3B,IAAI;AACJ,IAAM,aAAkB,CAAC;AAGzB,IAAI;AAAJ,IAAoB;AAApB,IAAqC;AACrC,IAAI;AACJ,IAAI;AAAJ,IAA0B;AAG1B,IAAM,aAAkB;AAAA,EACtB,QAAQ;AAAA,EACR,gBAAgB;AAAA,EAChB,cAAc;AAAA,EACd,YAAY;AACd;AAEA,IAAM,kBAAkB,OAAO,KAAK,WAAW;AAI/C,IAAM,uBAA4B;AAAA,EAChC,QAAQ;AAAA,IACN,EAAE,OAAO,UAAgB,KAAK,UAAsB,KAAK,GAAK,KAAK,KAAM,MAAM,GAAK,QAAQ,IAAI,MAAM,MAAO,KAAK,2BAA2B;AAAA,IAC7I,EAAE,OAAO,SAAgB,KAAK,SAAsB,KAAK,KAAK,KAAK,GAAM,MAAM,KAAK,QAAQ,IAAI,MAAM,OAAO,KAAK,sCAAsC;AAAA,IACxJ,EAAE,OAAO,UAAgB,KAAK,UAAsB,KAAK,GAAK,KAAK,IAAM,MAAM,GAAK,QAAQ,IAAI,MAAM,MAAO,KAAK,wBAAwB;AAAA,IAC1I,EAAE,OAAO,eAAgB,KAAK,cAAuB,KAAK,KAAK,KAAK,KAAM,MAAM,IAAK,QAAQ,MAAM,MAAM,MAAM,KAAK,sCAAsC;AAAA,IAC1J,EAAE,OAAO,aAAgB,KAAK,mBAAuB,KAAK,GAAK,KAAK,GAAM,MAAM,MAAK,QAAQ,IAAI,MAAM,IAAO,KAAK,2DAA2D;AAAA,IAC9K,EAAE,OAAO,aAAgB,KAAK,qBAAuB,KAAK,KAAK,KAAK,GAAM,MAAM,KAAK,QAAQ,IAAI,MAAM,KAAO,KAAK,0DAA0D;AAAA,IAC7K,EAAE,OAAO,aAAgB,KAAK,4BAA4B,KAAK,KAAM,KAAK,KAAM,MAAM,KAAK,QAAQ,MAAM,MAAM,MAAM,KAAK,wDAAwD;AAAA,IAClL,EAAE,OAAO,cAAgB,KAAK,qBAA4B,KAAK,GAAM,KAAK,IAAM,MAAM,KAAK,QAAQ,IAAI,MAAM,OAAO,KAAK,6DAA6D;AAAA,IACtL,EAAE,OAAO,eAAgB,KAAK,qBAA4B,KAAK,GAAM,KAAK,IAAM,MAAM,KAAK,QAAQ,IAAI,MAAM,KAAO,KAAK,yCAAyC;AAAA,IAClK,EAAE,OAAO,WAAgB,KAAK,oBAA4B,KAAK,KAAM,KAAK,KAAM,MAAM,KAAK,QAAQ,MAAM,MAAM,MAAM,KAAK,2CAA2C;AAAA,EACvK;AAAA,EACA,gBAAgB;AAAA,IACd,EAAE,OAAO,UAAoB,KAAK,UAA8B,KAAK,GAAK,KAAK,KAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,2BAA2B;AAAA,IAC1J,EAAE,OAAO,SAAoB,KAAK,SAA8B,KAAK,KAAK,KAAK,GAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,OAAO,KAAK,sCAAsC;AAAA,IACrK,EAAE,OAAO,UAAoB,KAAK,UAA8B,KAAK,GAAK,KAAK,IAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,qBAAqB;AAAA,IACpJ,EAAE,OAAO,eAAoB,KAAK,cAA+B,KAAK,KAAK,KAAK,KAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,2DAA2D;AAAA,IAC5L,EAAE,OAAO,gBAAoB,KAAK,eAA+B,KAAK,GAAK,KAAK,IAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,8CAA8C;AAAA,IAC9K,EAAE,OAAO,aAAoB,KAAK,mBAA+B,KAAK,GAAK,KAAK,GAAM,MAAM,MAAM,QAAQ,IAAI,MAAM,IAAO,KAAK,2DAA2D;AAAA,IAC3L,EAAE,OAAO,oBAAoB,KAAK,4BAA+B,KAAK,KAAK,KAAK,KAAM,MAAM,IAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,mFAAoF;AAAA,IACrN,EAAE,OAAO,cAAoB,KAAK,oBAA+B,KAAK,KAAK,KAAK,GAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,uDAAuD;AAAA,IACvL,EAAE,OAAO,eAAoB,KAAK,qBAA+B,KAAK,GAAK,KAAK,IAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,uDAAuD;AAAA,IACvL,EAAE,OAAO,cAAoB,KAAK,iBAA+B,KAAK,GAAK,KAAK,IAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,iEAAiE;AAAA,IACjM,EAAE,OAAO,YAAoB,KAAK,uBAAgC,KAAK,KAAK,KAAK,KAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,6CAA6C;AAAA,IAC/K,EAAE,OAAO,aAAoB,KAAK,mBAAgC,KAAK,KAAK,KAAK,GAAM,MAAM,MAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,mDAAmD;AAAA,IACpL,EAAE,OAAO,gBAAoB,KAAK,2BAA+B,KAAK,KAAK,KAAK,GAAM,MAAM,MAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,uEAAuE;AAAA,IACvM,EAAE,OAAO,eAAoB,KAAK,sBAA+B,KAAK,GAAK,KAAK,GAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,oDAAoD;AAAA,IACpL,EAAE,OAAO,eAAoB,KAAK,sBAA+B,KAAK,GAAK,KAAK,GAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,oDAAoD;AAAA,EACtL;AAAA,EACA,cAAc;AAAA,IACZ,EAAE,OAAO,UAAkB,KAAK,UAA6B,KAAK,GAAK,KAAK,KAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,2BAA2B;AAAA,IACvJ,EAAE,OAAO,SAAkB,KAAK,SAA6B,KAAK,KAAK,KAAK,GAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,OAAO,KAAK,sCAAsC;AAAA,IAClK,EAAE,OAAO,UAAkB,KAAK,UAA6B,KAAK,GAAK,KAAK,IAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,qBAAqB;AAAA,IACjJ,EAAE,OAAO,eAAkB,KAAK,cAA+B,KAAK,KAAK,KAAK,KAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,qDAAqD;AAAA,IACpL,EAAE,OAAO,gBAAkB,KAAK,eAA+B,KAAK,GAAK,KAAK,IAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,8CAA8C;AAAA,IAC5K,EAAE,OAAO,aAAkB,KAAK,mBAA+B,KAAK,GAAK,KAAK,GAAM,MAAM,MAAM,QAAQ,IAAI,MAAM,IAAO,KAAK,2BAA2B;AAAA,IACzJ,EAAE,OAAO,gBAAkB,KAAK,sBAA+B,KAAK,KAAK,KAAK,KAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,kFAAkF;AAAA,IACjN,EAAE,OAAO,cAAkB,KAAK,0BAA+B,KAAK,GAAK,KAAK,IAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,OAAO,KAAK,yCAAyC;AAAA,IACvK,EAAE,OAAO,cAAkB,KAAK,oBAA+B,KAAK,GAAK,KAAK,IAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,oCAAoC;AAAA,IAClK,EAAE,OAAO,gBAAkB,KAAK,sBAA+B,KAAK,GAAK,KAAK,GAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,+BAA+B;AAAA,IAC7J,EAAE,OAAO,cAAkB,KAAK,iBAA+B,KAAK,GAAK,KAAK,IAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,kDAAkD;AAAA,IAChL,EAAE,OAAO,cAAkB,KAAK,qBAA+B,KAAK,GAAK,KAAK,GAAM,MAAM,MAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,8DAA8D;AAAA,IAC5L,EAAE,OAAO,YAAkB,KAAK,uBAAgC,KAAK,KAAK,KAAK,KAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,6CAA6C;AAAA,IAC7K,EAAE,OAAO,aAAkB,KAAK,mBAAgC,KAAK,KAAK,KAAK,GAAM,MAAM,MAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,iCAAiC;AAAA,IAChK,EAAE,OAAO,gBAAkB,KAAK,2BAA+B,KAAK,MAAM,KAAK,GAAK,MAAM,MAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,0EAA0E;AAAA,IACxM,EAAE,OAAO,gBAAkB,KAAK,0BAA+B,KAAK,IAAK,KAAK,KAAM,MAAM,IAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,0EAA0E;AAAA,IACzM,EAAE,OAAO,gBAAkB,KAAK,2BAA+B,KAAK,KAAK,KAAK,GAAM,MAAM,MAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,gDAAgD;AAAA,IAC9K,EAAE,OAAO,eAAkB,KAAK,sBAA+B,KAAK,GAAK,KAAK,GAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,oDAAoD;AAAA,IAClL,EAAE,OAAO,eAAkB,KAAK,sBAA+B,KAAK,GAAK,KAAK,GAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,oDAAoD;AAAA,EACpL;AAAA,EACA,YAAY;AAAA,IACV,EAAE,OAAO,UAAmB,KAAK,UAA8B,KAAK,IAAM,KAAK,KAAM,MAAM,IAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,qCAAqC;AAAA,IACpK,EAAE,OAAO,SAAmB,KAAK,SAA8B,KAAK,KAAM,KAAK,GAAM,MAAM,MAAM,QAAQ,IAAI,MAAM,OAAO,KAAK,2CAA2C;AAAA,IAC1K,EAAE,OAAO,UAAmB,KAAK,UAA8B,KAAK,GAAM,KAAK,IAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,6BAA6B;AAAA,IAC5J,EAAE,OAAO,eAAmB,KAAK,cAA+B,KAAK,KAAM,KAAK,KAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,mCAAmC;AAAA,IACpK,EAAE,OAAO,aAAmB,KAAK,mBAA+B,KAAK,GAAM,KAAK,GAAM,MAAM,MAAM,QAAQ,IAAI,MAAM,IAAO,KAAK,qDAAqD;AAAA,IACrL,EAAE,OAAO,gBAAmB,KAAK,wBAA+B,KAAK,GAAM,KAAK,GAAM,MAAM,KAAM,QAAQ,KAAK,MAAM,KAAM,KAAK,yCAAyC;AAAA,IACzK,EAAE,OAAO,cAAmB,KAAK,uBAA+B,KAAK,KAAM,KAAK,KAAM,MAAM,IAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,6BAA6B;AAAA,IAC9J,EAAE,OAAO,iBAAmB,KAAK,0BAA+B,KAAK,KAAM,KAAK,KAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,oCAAoC;AAAA,IACrK,EAAE,OAAO,iBAAmB,KAAK,0BAA+B,KAAK,KAAM,KAAK,MAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,sDAAsD;AAAA,IACvL,EAAE,OAAO,cAAmB,KAAK,yBAA+B,KAAK,GAAM,KAAK,GAAM,MAAM,MAAM,QAAQ,KAAK,MAAM,KAAM,KAAK,uDAAuD;AAAA,IACvL,EAAE,OAAO,aAAmB,KAAK,oBAA+B,KAAK,GAAM,KAAK,KAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,iDAAiD;AAAA,IACjL,EAAE,OAAO,eAAmB,KAAK,qBAA+B,KAAK,GAAM,KAAK,IAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,sCAAsC;AAAA,IACtK,EAAE,OAAO,YAAmB,KAAK,uBAA+B,KAAK,KAAM,KAAK,KAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,sEAAsE;AAAA,IACvM,EAAE,OAAO,eAAkB,KAAK,yBAA+B,KAAK,GAAM,KAAK,IAAM,MAAM,KAAM,QAAQ,IAAI,MAAM,KAAO,KAAK,wEAAwE;AAAA,IACvM,EAAE,OAAO,eAAkB,KAAK,yBAA+B,KAAK,GAAM,KAAK,IAAM,MAAM,GAAM,QAAQ,IAAI,MAAM,MAAO,KAAK,uCAAuC;AAAA,IACtK,EAAE,OAAO,gBAAkB,KAAK,+BAA+B,KAAK,GAAM,KAAK,KAAM,MAAM,KAAM,QAAQ,MAAM,MAAM,MAAM,KAAK,2EAA2E;AAAA,IAC3M,EAAE,OAAO,iBAAkB,KAAK,oCAAoC,KAAK,GAAG,KAAK,KAAM,MAAM,KAAK,QAAQ,MAAM,MAAM,MAAM,KAAK,yFAAyF;AAAA,EAC5N;AACF;AAGA,SAASC,gBAAe,KAAU,MAAc;AAC9C,QAAM,QAAQ,KAAK,MAAM,GAAG;AAC5B,MAAI,MAAM;AACV,aAAW,KAAK,OAAO;AACrB,QAAI,OAAO,KAAM,QAAO;AACxB,UAAM,IAAI,CAAC;AAAA,EACb;AACA,SAAO;AACT;AAEA,SAASC,gBAAe,KAAU,MAAc,OAAY;AAC1D,QAAM,QAAQ,KAAK,MAAM,GAAG;AAC5B,MAAI,MAAM;AACV,WAAS,IAAI,GAAG,IAAI,MAAM,SAAS,GAAG,KAAK;AACzC,QAAI,IAAI,MAAM,CAAC,CAAC,KAAK,KAAM,KAAI,MAAM,CAAC,CAAC,IAAI,CAAC;AAC5C,UAAM,IAAI,MAAM,CAAC,CAAC;AAAA,EACpB;AACA,MAAI,MAAM,MAAM,SAAS,CAAC,CAAC,IAAI;AACjC;AAEA,IAAI,sBAAqC;AAElC,SAAS,gBAAgBC,QAAYC,YAAgB;AAC1D,EAAAL,YAAWI;AACX,iBAAeC;AAGf,cAAY,IAAI,MAAM,iBAAiB,MAAM,MAAM,KAAK,CAAC;AAGzD,aAAW,CAAC,MAAM,GAAG,KAAK,OAAO,QAAQ,WAAW,GAAG;AACrD,eAAW,IAAI,IAAI,IAAI,MAAM,qBAAqB;AAAA,MAChD,OAAQ,IAAY;AAAA,MACpB,UAAW,IAAY;AAAA,MACvB,mBAAmB;AAAA,MACnB,aAAa;AAAA,MACb,SAAS;AAAA,IACX,CAAC;AAAA,EACH;AAEA,aAAW;AACX,EAAAC,cAAa;AAGb,SAAO,iBAAiB,aAAa,WAAW;AAChD,SAAO,iBAAiB,aAAa,WAAW;AAChD,SAAO,iBAAiB,WAAW,SAAS;AAG5C,SAAO,iBAAiB,WAAW,WAAW;AAChD;AAEO,SAAS,kBAAkB,IAAY;AAC5C,QAAM,QAAQ,cAAc;AAG5B,MAAI,MAAM,cAAc;AACtB,iBAAa;AACb,iBAAa;AACb;AAAA,EACF;AACF;AAGO,SAAS,oBAAoB;AAClC,QAAM,QAAQ,cAAc;AAC5B,MAAI,MAAM,cAAc;AACtB,iBAAa;AAAA,EACf;AACF;AAEA,SAAS,eAAe;AACtB,MAAI,QAAQ;AACV,eAAW;AAAA,EACb,OAAO;AACL,gBAAY;AAAA,EACd;AACF;AAEA,SAAS,cAAc,GAAQ;AAC7B,IAAE,eAAe;AACjB,QAAM,QAAQ,EAAE,SAAS,IAAI,IAAI;AACjC,UAAQ,kBAAkB,IAAI,KAAK;AACrC;AAEA,SAAS,cAAc;AACrB,WAAS;AACT,kBAAgB,aAAa;AAC7B,eAAa,QAAQ;AACrB,EAAAL,OAAM,UAAU,OAAO,QAAQ;AAC/B,WAAS,UAAU,IAAI,SAAS;AAChC,SAAO,iBAAiB,SAAS,eAAe,EAAE,SAAS,MAAM,CAAC;AAClE,MAAI,eAAe,SAAS;AAC1B,mBAAe;AAAA,EACjB,OAAO;AACL,wBAAoB;AAAA,EACtB;AACA,YAAU;AACZ;AAEA,SAAS,aAAa;AACpB,WAAS;AACT,eAAa,QAAQ;AACrB,EAAAA,OAAM,UAAU,IAAI,QAAQ;AAC5B,WAAS,UAAU,OAAO,SAAS;AACnC,SAAO,oBAAoB,SAAS,aAAa;AACjD,YAAU;AACV,eAAa;AACb,oBAAkB;AACpB;AAQA,SAAS,UAAU,KAAa;AAC9B,MAAI,QAAQ,WAAY;AACxB,eAAa;AAGb,eAAa;AACb,oBAAkB;AAGlB,cAAY,mBAAmB;AAC/B,aAAW,eAAe;AAC1B,aAAW,cAAc;AACzB,eAAa;AACb,gBAAc;AAGd,MAAI,mBAAmB,iBAAiB;AACtC,oBAAgB,MAAM,UAAU,QAAQ,UAAU,UAAU;AAC5D,oBAAgB,MAAM,UAAU,QAAQ,UAAU,UAAU;AAAA,EAC9D;AAGA,QAAM,OAAOM,OAAM,iBAAiB,SAAS;AAC7C,OAAK,QAAQ,CAAC,MAAW,EAAE,UAAU,OAAO,UAAU,EAAE,QAAQ,QAAQ,GAAG,CAAC;AAG5E,MAAI,QAAQ,SAAS;AACnB,mBAAe;AAAA,EACjB,OAAO;AACL,wBAAoB;AAAA,EACtB;AACA,YAAU;AACZ;AAIA,SAAS,aAAa,GAAQ;AAC5B,QAAM,OAAQ,EAAE,UAAU,OAAO,aAAc,IAAI;AACnD,QAAM,OAAO,EAAE,EAAE,UAAU,OAAO,eAAe,IAAI;AACrD,SAAO,cAAc,MAAM,IAAI;AACjC;AAEA,SAAS,aAAa,GAAW,GAAW;AAC1C,QAAM,IAAI,aAAa;AACvB,SAAO;AAAA,IACL,GAAG,KAAK,MAAM,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,GAAG,CAAC,CAAC,CAAC;AAAA,IAC1C,GAAG,KAAK,MAAM,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,GAAG,CAAC,CAAC,CAAC;AAAA,EAC5C;AACF;AAGA,SAAS,iBAAiB,QAAgB,QAAgB,QAAgB;AACxE,QAAM,QAAQ,gBAAgB;AAC9B,MAAI,CAAC,MAAO,QAAO;AACnB,MAAI,UAAU,IAAI,WAAW,SAAS;AACtC,WAAS,IAAI,GAAG,IAAI,MAAM,OAAO,QAAQ,KAAK;AAC5C,UAAM,IAAI,MAAM,OAAO,CAAC;AACxB,UAAM,KAAK,EAAE,IAAI;AACjB,UAAM,KAAK,EAAE,IAAI;AACjB,UAAM,SAAS,KAAK,KAAK,KAAK;AAC9B,QAAI,SAAS,UAAU;AACrB,iBAAW;AACX,gBAAU;AAAA,IACZ;AAAA,EACF;AACA,SAAO;AACT;AAIA,SAAS,6BAA6B,QAAgB,QAAgB,QAAgB;AACpF,QAAM,OAAO,MAAM,YAAY,SAAS;AACxC,MAAI,CAAC,KAAM,QAAO;AAClB,MAAI,eAAe,IAAI,eAAe,IAAI,WAAW,SAAS;AAC9D,WAAS,KAAK,GAAG,KAAK,KAAK,OAAO,QAAQ,MAAM;AAC9C,UAAM,QAAQ,KAAK,OAAO,EAAE;AAC5B,aAAS,KAAK,GAAG,KAAK,MAAM,OAAO,QAAQ,MAAM;AAC/C,YAAM,IAAI,MAAM,OAAO,EAAE;AACzB,YAAM,KAAK,EAAE,IAAI;AACjB,YAAM,KAAK,EAAE,IAAI;AACjB,YAAM,SAAS,KAAK,KAAK,KAAK;AAC9B,UAAI,SAAS,UAAU;AACrB,mBAAW;AACX,uBAAe;AACf,uBAAe;AAAA,MACjB;AAAA,IACF;AAAA,EACF;AACA,MAAI,eAAe,EAAG,QAAO;AAC7B,SAAO,EAAE,UAAU,cAAc,UAAU,aAAa;AAC1D;AAIA,SAAS,uBAAuB,QAAgB,QAAgB,QAAgB;AAC9E,MAAI,WAA0B,MAAM,UAAU,IAAI,WAAW,SAAS;AAEtE,WAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACzC,UAAM,IAAI,UAAU,CAAC;AACrB,UAAM,KAAK,EAAE,IAAI;AACjB,UAAM,KAAK,EAAE,IAAI;AACjB,UAAM,SAAS,KAAK,KAAK,KAAK;AAC9B,QAAI,SAAS,UAAU;AACrB,iBAAW;AACX,iBAAW;AACX,gBAAU;AAAA,IACZ;AAAA,EACF;AAEA,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACpC,UAAM,IAAI,KAAK,CAAC;AAChB,UAAM,KAAK,EAAE,IAAI;AACjB,UAAM,KAAK,EAAE,IAAI;AACjB,UAAM,SAAS,KAAK,KAAK,KAAK;AAC9B,QAAI,SAAS,UAAU;AACrB,iBAAW;AACX,iBAAW;AACX,gBAAU;AAAA,IACZ;AAAA,EACF;AAEA,MAAI,aAAa,KAAM,QAAO;AAC9B,SAAO,EAAE,MAAM,UAAU,KAAK,QAAQ;AACxC;AAEA,SAAS,YAAY,GAAQ;AAC3B,MAAI,CAAC,OAAQ;AACb,MAAI,EAAE,OAAO,QAAQ,eAAe,EAAG;AAEvC,MAAI,eAAe,SAAS;AAC1B,qBAAiB,CAAC;AAClB;AAAA,EACF;AAEA,QAAM,WAAW,aAAa,CAAC;AAC/B,QAAM,QAAQ,gBAAgB;AAC9B,MAAI,CAAC,MAAO;AAGZ,MAAI,EAAE,WAAW,KAAK,EAAE,UAAU;AAEhC,QAAI,MAAM,iBAAiB,SAAS,GAAG,SAAS,GAAG,GAAG;AACtD,QAAI,OAAO,GAAG;AACZ,eAAS;AACT,YAAM,OAAO,OAAO,KAAK,CAAC;AAC1B,UAAI,YAAY,qBAAqB,IAAK,aAAY,mBAAmB;AAAA,eAChE,YAAY,mBAAmB,IAAK,aAAY;AACzD,qBAAe;AACf,gBAAU;AAAA,IACZ,OAAO;AAEL,YAAM,MAAM,6BAA6B,SAAS,GAAG,SAAS,GAAG,GAAG;AACpE,UAAI,KAAK;AAEP,oBAAY,aAAa,IAAI;AAC7B,oBAAY,mBAAmB;AAC/B,cAAM,cAAc,MAAM,YAAY,SAAS,EAAE,OAAO,IAAI,QAAQ;AACpE,iBAAS;AACT,oBAAY,OAAO,OAAO,IAAI,UAAU,CAAC;AACzC,uBAAe;AACf,kBAAU;AAAA,MACZ;AAAA,IACF;AACA;AAAA,EACF;AAGA,QAAM,SAAS,iBAAiB,SAAS,GAAG,SAAS,GAAG,GAAG;AAE3D,MAAI,UAAU,GAAG;AAEf,gBAAY,mBAAmB;AAC/B,iBAAa;AACb,kBAAc;AACd,qBAAiB,EAAE,GAAG,SAAS,GAAG,GAAG,SAAS,EAAE;AAChD,mBAAe;AACf,cAAU;AAAA,EACZ,OAAO;AAGL,UAAM,MAAM,6BAA6B,SAAS,GAAG,SAAS,GAAG,GAAG;AAEpE,QAAI,KAAK;AAEP,kBAAY,aAAa,IAAI;AAC7B,kBAAY,mBAAmB,IAAI;AACnC,mBAAa;AACb,oBAAc;AACd,uBAAiB,EAAE,GAAG,SAAS,GAAG,GAAG,SAAS,EAAE;AAChD,qBAAe;AACf,gBAAU;AAAA,IACZ,OAAO;AAEL,eAAS;AACT,YAAM,UAAU,aAAa,SAAS,GAAG,SAAS,CAAC;AACnD,YAAM,OAAO,KAAK,EAAE,MAAM,YAAY,WAAW,GAAG,QAAQ,GAAG,GAAG,QAAQ,EAAE,CAAC;AAC7E,kBAAY,mBAAmB,MAAM,OAAO,SAAS;AACrD,qBAAe;AACf,gBAAU;AAAA,IACZ;AAAA,EACF;AACF;AAEA,SAAS,iBAAiB,GAAQ;AAChC,QAAM,WAAW,aAAa,CAAC;AAG/B,MAAI,EAAE,WAAW,KAAK,EAAE,UAAU;AAChC,UAAMC,OAAM,uBAAuB,SAAS,GAAG,SAAS,GAAG,CAAC;AAC5D,QAAIA,MAAK;AACP,eAAS;AACT,UAAIA,KAAI,SAAS,YAAY;AAC3B,kBAAU,OAAOA,KAAI,KAAK,CAAC;AAAA,MAC7B,OAAO;AACL,aAAK,OAAOA,KAAI,KAAK,CAAC;AAAA,MACxB;AAEA,UAAI,WAAW,iBAAiBA,KAAI,QAAQ,WAAW,gBAAgBA,KAAI,KAAK;AAC9E,mBAAW,eAAe;AAC1B,mBAAW,cAAc;AAAA,MAC3B,WAAW,WAAW,iBAAiBA,KAAI,QAAQ,WAAW,cAAcA,KAAI,KAAK;AACnF,mBAAW;AAAA,MACb;AACA,qBAAe;AACf,0BAAoB;AACpB,gBAAU;AAAA,IACZ;AACA;AAAA,EACF;AAGA,QAAM,MAAM,uBAAuB,SAAS,GAAG,SAAS,GAAG,CAAC;AAE5D,MAAI,KAAK;AACP,eAAW,eAAe,IAAI;AAC9B,eAAW,cAAc,IAAI;AAC7B,iBAAa;AACb,kBAAc;AACd,qBAAiB,EAAE,GAAG,SAAS,GAAG,GAAG,SAAS,EAAE;AAChD,wBAAoB;AACpB,cAAU;AAAA,EACZ,OAAO;AAEL,eAAW,eAAe;AAC1B,eAAW,cAAc;AACzB,wBAAoB;AACpB,cAAU;AAAA,EACZ;AACF;AAEA,SAAS,YAAY,GAAQ;AAC3B,MAAI,CAAC,UAAU,CAAC,WAAY;AAE5B,MAAI,eAAe,SAAS;AAC1B,qBAAiB,CAAC;AAClB;AAAA,EACF;AAEA,QAAM,WAAW,aAAa,CAAC;AAC/B,QAAM,QAAQ,gBAAgB;AAC9B,MAAI,CAAC,SAAS,YAAY,mBAAmB,EAAG;AAGhD,MAAI,CAAC,aAAa;AAChB,UAAM,KAAK,SAAS,IAAI,eAAe;AACvC,UAAM,KAAK,SAAS,IAAI,eAAe;AACvC,QAAI,KAAK,KAAK,KAAK,KAAK,KAAM;AAC9B,kBAAc;AACd,aAAS;AAAA,EACX;AAGA,QAAM,UAAU,aAAa,SAAS,GAAG,SAAS,CAAC;AACnD,QAAM,QAAQ,MAAM,OAAO,YAAY,gBAAgB;AACvD,QAAM,IAAI,QAAQ;AAClB,QAAM,IAAI,QAAQ;AAGlB,QAAM,SAAS,QAAQ;AAAA,IAAK,CAAC,MAC3B,EAAE,aAAa,YAAY,cAAc,EAAE,aAAa,YAAY;AAAA,EACtE;AACA,MAAI,QAAQ;AACV,WAAO,KAAK,SAAS,IAAI,QAAQ,GAAG,GAAG,QAAQ,CAAC;AAAA,EAClD;AACF;AAEA,SAAS,iBAAiB,GAAQ;AAChC,MAAI,WAAW,iBAAiB,QAAQ,WAAW,cAAc,EAAG;AAEpE,QAAM,WAAW,aAAa,CAAC;AAG/B,MAAI,CAAC,aAAa;AAChB,UAAM,KAAK,SAAS,IAAI,eAAe;AACvC,UAAM,KAAK,SAAS,IAAI,eAAe;AACvC,QAAI,KAAK,KAAK,KAAK,KAAK,KAAM;AAC9B,kBAAc;AACd,aAAS;AAAA,EACX;AAGA,QAAM,MAAM,WAAW,iBAAiB,aAAa,YAAY;AACjE,QAAM,MAAM,IAAI,WAAW,WAAW;AACtC,MAAI,CAAC,IAAK;AACV,MAAI,IAAI,KAAK,MAAM,SAAS,IAAI,CAAC,IAAI;AACrC,MAAI,IAAI,KAAK,MAAM,SAAS,IAAI,CAAC,IAAI;AAGrC,QAAM,SAAS,aAAa;AAAA,IAAK,CAAC,MAChC,EAAE,SAAS,WAAW,gBAAgB,EAAE,QAAQ,WAAW;AAAA,EAC7D;AACA,MAAI,QAAQ;AACV,WAAO,KAAK,SAAS,IAAI,IAAI,GAAG,OAAO,KAAK,SAAS,GAAG,IAAI,CAAC;AAAA,EAC/D;AACF;AAEA,SAAS,UAAU,GAAQ;AACzB,MAAI,CAAC,OAAQ;AAEb,MAAI,eAAe,SAAS;AAC1B,QAAI,cAAc,aAAa;AAC7B,qBAAe;AACf,0BAAoB;AACpB,gBAAU;AAAA,IACZ;AACA,iBAAa;AACb,kBAAc;AACd,qBAAiB;AACjB;AAAA,EACF;AAEA,MAAI,cAAc,aAAa;AAE7B,mBAAe;AACf,cAAU;AAAA,EACZ;AACA,eAAa;AACb,gBAAc;AACd,mBAAiB;AACnB;AAIA,SAAS,iBAAiB;AACxB,sBAAoB;AACpB,4BAA0B;AAC5B;AAOA,IAAM,kBAAkB,MAAO,OAAe,kBAAkB;AAEhE,eAAe,kBAAkB;AAC/B,MAAI,CAAC,gBAAgB,EAAG,QAAO,CAAC;AAChC,MAAI;AACF,UAAM,MAAM,MAAM,MAAM,SAAS;AACjC,QAAI,CAAC,IAAI,GAAI,QAAO,CAAC;AACrB,WAAO,MAAM,IAAI,KAAK;AAAA,EACxB,SAAS,GAAG;AACV,YAAQ,KAAK,8CAA8C,CAAC;AAC5D,WAAO,CAAC;AAAA,EACV;AACF;AAEA,eAAe,wBAAwB;AACrC,QAAM,SAAS,SAAS,eAAe,kBAAkB;AACzD,MAAI,CAAC,OAAQ;AACb,QAAM,OAAO,MAAM,gBAAgB;AACnC,MAAI,OAAO;AACX,aAAW,QAAQ,MAAM;AACvB,UAAM,MAAM,SAAS,oBAAoB,cAAc;AACvD,YAAQ,kBAAkB,IAAI,IAAI,GAAG,IAAI,IAAI;AAAA,EAC/C;AACA,SAAO,YAAY;AACrB;AAEA,eAAe,WAAW,MAAc;AACtC,MAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAG;AACjC,MAAI;AACF,UAAM,MAAM,MAAM,MAAM,qBAAqB,mBAAmB,IAAI,CAAC,EAAE;AACvE,QAAI,CAAC,IAAI,GAAI,OAAM,IAAI,MAAM,IAAI,UAAU;AAC3C,UAAM,OAAO,MAAM,IAAI,KAAK;AAE5B,aAAS;AAGT,cAAU,SAAS;AACnB,eAAW,KAAK,KAAK,UAAW,WAAU,KAAK,CAAC;AAChD,SAAK,SAAS;AACd,eAAW,KAAK,KAAK,KAAM,MAAK,KAAK,CAAC;AAEtC,wBAAoB;AACpB,eAAW,eAAe;AAC1B,eAAW,cAAc;AAEzB,mBAAe;AACf,wBAAoB;AACpB,mBAAe;AACf,0BAAsB;AAAA,EACxB,SAAS,GAAG;AACV,YAAQ,MAAM,qCAAqC,CAAC;AAAA,EACtD;AACF;AAEA,eAAe,WAAW,MAAc;AACtC,MAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAG;AACjC,MAAI;AACF,UAAM,MAAM,MAAM,MAAM,gBAAgB;AAAA,MACtC,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAC9C,MAAM,KAAK,UAAU,EAAE,MAAM,WAAW,WAAW,MAAM,KAAK,CAAC;AAAA,IACjE,CAAC;AACD,QAAI,CAAC,IAAI,GAAI,OAAM,IAAI,MAAM,IAAI,UAAU;AAC3C,wBAAoB;AACpB,0BAAsB;AAAA,EACxB,SAAS,GAAG;AACV,YAAQ,MAAM,qCAAqC,CAAC;AAAA,EACtD;AACF;AAEA,eAAe,aAAa,MAAc;AACxC,MAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAG;AACjC,MAAI;AACF,UAAM,MAAM,MAAM,MAAM,kBAAkB;AAAA,MACxC,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAC9C,MAAM,KAAK,UAAU,EAAE,KAAK,CAAC;AAAA,IAC/B,CAAC;AACD,QAAI,CAAC,IAAI,GAAI,OAAM,IAAI,MAAM,IAAI,UAAU;AAC3C,QAAI,sBAAsB,KAAM,qBAAoB;AACpD,0BAAsB;AAAA,EACxB,SAAS,GAAG;AACV,YAAQ,MAAM,uCAAuC,CAAC;AAAA,EACxD;AACF;AAIA,SAAS,YAAY,GAAQ;AAC3B,MAAI,CAAC,OAAQ;AAGb,MAAI,EAAE,SAAS,WAAW,EAAE,WAAW,EAAE,YAAY,CAAC,EAAE,UAAU;AAChE,MAAE,eAAe;AACjB,YAAQ;AACR;AAAA,EACF;AAGA,MAAK,EAAE,SAAS,WAAW,EAAE,WAAW,EAAE,YACrC,EAAE,SAAS,WAAW,EAAE,WAAW,EAAE,YAAY,EAAE,UAAW;AACjE,MAAE,eAAe;AACjB,YAAQ;AACR;AAAA,EACF;AAGA,MAAI,EAAE,SAAS,UAAU;AACvB,QAAI,eAAe,SAAS;AAC1B,iBAAW,eAAe;AAC1B,iBAAW,cAAc;AACzB,0BAAoB;AAAA,IACtB,OAAO;AACL,kBAAY,mBAAmB;AAC/B,qBAAe;AAAA,IACjB;AACA,cAAU;AACV;AAAA,EACF;AAGA,MAAI,eAAe,SAAS;AAC1B,eAAW,CAAC;AACZ;AAAA,EACF;AAKA,QAAM,aAAkB,EAAE,UAAU,GAAG,UAAU,GAAG,UAAU,GAAG,UAAU,EAAE;AAC7E,MAAI,EAAE,QAAQ,YAAY;AACxB,UAAM,MAAM,WAAW,EAAE,IAAI;AAC7B,QAAI,MAAM,gBAAgB,QAAQ;AAChC,kBAAY,YAAY,gBAAgB,GAAG;AAE3C,UAAI,YAAY,oBAAoB,GAAG;AACrC,cAAM,QAAQ,gBAAgB;AAC9B,YAAI,SAAS,MAAM,OAAO,YAAY,gBAAgB,GAAG;AACvD,mBAAS;AACT,gBAAM,OAAO,YAAY,gBAAgB,EAAE,OAAO,gBAAgB,GAAG;AACrE,yBAAe;AAAA,QACjB;AAAA,MACF;AACA,gBAAU;AAAA,IACZ;AAAA,EACF;AAGA,MAAI,EAAE,SAAS,YAAY,EAAE,SAAS,aAAa;AACjD,QAAI,EAAE,OAAO,YAAY,QAAS;AAClC,UAAM,QAAQ,gBAAgB;AAC9B,QAAI,CAAC,MAAO;AAEZ,QAAI,YAAY,oBAAoB,KAAK,YAAY,mBAAmB,MAAM,OAAO,QAAQ;AAE3F,eAAS;AACT,YAAM,OAAO,OAAO,YAAY,kBAAkB,CAAC;AACnD,kBAAY,mBAAmB;AAC/B,qBAAe;AACf,gBAAU;AAAA,IACZ,OAAO;AAEL,eAAS;AACT,YAAM,SAAS,CAAC;AAChB,qBAAe;AACf,gBAAU;AAAA,IACZ;AAAA,EACF;AAGA,MAAI,EAAE,SAAS,QAAQ;AACrB,oBAAgB;AAAA,EAClB;AACF;AAEA,SAAS,WAAW,GAAQ;AAE1B,MAAI,EAAE,SAAS,YAAY,EAAE,SAAS,aAAa;AACjD,QAAI,EAAE,OAAO,YAAY,QAAS;AAClC,QAAI,WAAW,gBAAgB,WAAW,eAAe,GAAG;AAC1D,eAAS;AACT,UAAI,WAAW,iBAAiB,YAAY;AAC1C,kBAAU,OAAO,WAAW,aAAa,CAAC;AAAA,MAC5C,OAAO;AACL,aAAK,OAAO,WAAW,aAAa,CAAC;AAAA,MACvC;AACA,iBAAW,eAAe;AAC1B,iBAAW,cAAc;AACzB,qBAAe;AACf,0BAAoB;AACpB,gBAAU;AAAA,IACZ;AAAA,EACF;AACF;AAIA,SAAS,eAAe;AACtB,aAAW,KAAK,SAAS;AACvB,IAAAC,UAAS,OAAO,EAAE,IAAI;AAEtB,MAAE,KAAK,SAAS,QAAQ,CAAC,MAAW;AAClC,UAAI,EAAE,YAAY,EAAE,aAAa,WAAW,EAAE,IAAI,EAAG,GAAE,SAAS,QAAQ;AAAA,IAC1E,CAAC;AAAA,EACH;AACA,YAAU,CAAC;AACb;AAEA,SAAS,iBAAiB;AACxB,eAAa;AAEb,WAAS,KAAK,GAAG,KAAK,MAAM,QAAQ,MAAM;AACxC,UAAM,OAAO,MAAM,EAAE;AACrB,QAAI,OAAO,YAAY,UAAW;AAElC,aAAS,KAAK,GAAG,KAAK,KAAK,OAAO,QAAQ,MAAM;AAC9C,YAAM,QAAQ,KAAK,OAAO,EAAE;AAC5B,YAAM,YAAa,OAAO,YAAY;AAEtC,eAAS,KAAK,GAAG,KAAK,MAAM,OAAO,QAAQ,MAAM;AAC/C,cAAM,QAAQ,MAAM,OAAO,EAAE;AAC7B,cAAM,MAAM,WAAW,MAAM,IAAI,KAAK,WAAW;AACjD,cAAM,aAAa,aAAa,OAAO,YAAY;AAGnD,cAAM,YAAY,IAAI,MAAM;AAC5B,kBAAU,UAAU,YAAY,OAAO;AACvC,YAAI,YAAY;AACd,oBAAU,oBAAoB;AAAA,QAChC;AAEA,cAAM,OAAO,IAAI,MAAM,MAAM;AAG7B,cAAMC,QAAO,IAAI,MAAM,KAAK,WAAW,SAAS;AAChD,QAAAA,MAAK,SAAS,IAAI;AAClB,aAAK,IAAIA,KAAI;AAGb,cAAM,YAAY,aAAa,WACzB,YAAoB,MAAM,IAAI,IAAK,YAAoB,MAAM,IAAI,EAAE,QAAQ;AACjF,cAAMC,WAAU,IAAI,MAAM;AAAA,UACxB,aAAa,OAAO;AAAA,UACpB,aAAa,OAAO;AAAA,UACpB;AAAA,QACF;AACA,QAAAA,SAAQ,QAAQ,CAAC,KAAK,KAAK,CAAC;AAC5B,cAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,UAC1C,OAAO;AAAA,UACP,aAAa;AAAA,UACb,SAAS,aAAa,MAAO,YAAY,MAAM;AAAA,UAC/C,MAAM,MAAM;AAAA,UACZ,YAAY;AAAA,QACd,CAAC;AACD,cAAM,OAAO,IAAI,MAAM,KAAKA,UAAS,OAAO;AAC5C,aAAK,SAAS,IAAI;AAClB,aAAK,IAAI,IAAI;AAEb,aAAK,SAAS,IAAI,MAAM,GAAG,GAAG,MAAM,CAAC;AACrC,QAAAF,UAAS,IAAI,IAAI;AAEjB,gBAAQ,KAAK;AAAA,UACX;AAAA,UACA,MAAM,MAAM;AAAA,UACZ,SAAS;AAAA,UACT,UAAU;AAAA,UACV,UAAU;AAAA,QACZ,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AACF;AAIA,SAAS,oBAAoB;AAC3B,aAAW,KAAK,cAAc;AAC5B,IAAAA,UAAS,OAAO,EAAE,IAAI;AACtB,MAAE,KAAK,SAAS,QAAQ,CAAC,MAAW;AAClC,UAAI,EAAE,SAAU,GAAE,SAAS,QAAQ;AACnC,UAAI,EAAE,SAAU,GAAE,SAAS,QAAQ;AAAA,IACrC,CAAC;AAAA,EACH;AACA,iBAAe,CAAC;AAClB;AAEA,SAAS,sBAAsB;AAC7B,oBAAkB;AAElB,QAAM,gBAAgB,WAAW,iBAAiB;AAClD,QAAM,gBAAgB,WAAW,iBAAiB;AAGlD,WAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACzC,UAAM,IAAI,UAAU,CAAC;AACrB,UAAM,WAAW,iBAAiB,WAAW,gBAAgB;AAE7D,UAAM,QAAQ,IAAI,MAAM,MAAM;AAG9B,UAAM,SAAS,IAAI,MAAM,YAAY,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;AAClD,UAAM,WAAW,IAAI,MAAM,cAAc,MAAM;AAC/C,UAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,MAC1C,OAAO,WAAW,UAAW;AAAA,MAC7B,WAAW;AAAA,IACb,CAAC;AACD,UAAM,YAAY,IAAI,MAAM,aAAa,UAAU,OAAO;AAC1D,cAAU,SAAS,IAAI,EAAE,IAAI;AAC7B,UAAM,IAAI,SAAS;AAGnB,UAAME,WAAU,IAAI,MAAM;AAAA,MACxB,WAAW,MAAM;AAAA,MACjB,WAAW,OAAO;AAAA,MAClB;AAAA,IACF;AACA,IAAAA,SAAQ,QAAQ,CAAC,KAAK,KAAK,CAAC;AAC5B,UAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,MAC1C,OAAO,WAAW,UAAW;AAAA,MAC7B,aAAa;AAAA,MACb,SAAS,WAAW,MAAM;AAAA,MAC1B,MAAM,MAAM;AAAA,MACZ,YAAY;AAAA,IACd,CAAC;AACD,UAAM,OAAO,IAAI,MAAM,KAAKA,UAAS,OAAO;AAC5C,SAAK,SAAS,IAAI;AAClB,UAAM,IAAI,IAAI;AAEd,UAAM,SAAS,IAAI,EAAE,GAAG,GAAG,EAAE,CAAC;AAC9B,IAAAF,UAAS,IAAI,KAAK;AAElB,iBAAa,KAAK,EAAE,MAAM,OAAO,MAAM,YAAY,KAAK,EAAE,CAAC;AAAA,EAC7D;AAGA,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACpC,UAAM,IAAI,KAAK,CAAC;AAChB,UAAM,WAAW,iBAAiB,WAAW,gBAAgB;AAE7D,UAAM,QAAQ,IAAI,MAAM,MAAM;AAG9B,UAAMG,YAAW,IAAI,MAAM,cAAc,EAAE,GAAG,EAAE,CAAC;AACjD,UAAM,WAAW,IAAI,MAAM,cAAcA,SAAQ;AACjD,UAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,MAC1C,OAAO,WAAW,WAAW;AAAA,MAC7B,WAAW;AAAA,IACb,CAAC;AACD,UAAM,YAAY,IAAI,MAAM,aAAa,UAAU,OAAO;AAC1D,cAAU,SAAS,IAAI,CAAC,KAAK,KAAK;AAClC,cAAU,SAAS,IAAI;AACvB,UAAM,IAAI,SAAS;AAGnB,UAAMD,WAAU,IAAI,MAAM;AAAA,MACxB,WAAW,MAAM;AAAA,MACjB,WAAW,OAAO;AAAA,MAClB;AAAA,IACF;AACA,IAAAA,SAAQ,QAAQ,CAAC,KAAK,KAAK,CAAC;AAC5B,UAAM,UAAU,IAAI,MAAM,kBAAkB;AAAA,MAC1C,OAAO,WAAW,WAAW;AAAA,MAC7B,aAAa;AAAA,MACb,SAAS,WAAW,MAAM;AAAA,MAC1B,MAAM,MAAM;AAAA,MACZ,YAAY;AAAA,IACd,CAAC;AACD,UAAM,OAAO,IAAI,MAAM,KAAKA,UAAS,OAAO;AAC5C,SAAK,SAAS,IAAI;AAClB,UAAM,IAAI,IAAI;AAEd,UAAM,SAAS,IAAI,EAAE,GAAG,GAAG,EAAE,CAAC;AAC9B,IAAAF,UAAS,IAAI,KAAK;AAElB,iBAAa,KAAK,EAAE,MAAM,OAAO,MAAM,OAAO,KAAK,EAAE,CAAC;AAAA,EACxD;AACF;AAIA,SAAS,aAAa;AACpB,EAAAF,SAAQ,SAAS,cAAc,KAAK;AACpC,EAAAA,OAAM,KAAK;AACX,EAAAA,OAAM,YAAY;AAGlB,EAAAA,OAAM,iBAAiB,eAAe,CAAC,MAAW,EAAE,eAAe,CAAC;AAGpE,aAAW,SAAS,cAAc,KAAK;AACvC,WAAS,KAAK;AACd,WAAS,KAAK,YAAY,QAAQ;AAClC,WAAS,cAAc;AAEvB,MAAI,OAAO;AAGX,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,aAAW,CAAC,MAAM,GAAG,KAAK,OAAO,QAAQ,WAAW,GAAG;AACrD,UAAM,QAAQ,WAAW,IAAI,KAAK,KAAK,CAAC,EAAE,YAAY;AACtD,YAAQ,uCAAuC,IAAI,2BAA4B,IAAY,MAAM,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC,KAAK,KAAK,IAAK,IAAY,IAAI;AAAA,EAC/J;AACA,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAER,UAAQ;AAGR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAGR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AAER,UAAQ;AAER,EAAAA,OAAM,YAAY;AAClB,WAAS,KAAK,YAAYA,MAAK;AAG/B,oBAAkB,SAAS,eAAe,kBAAkB;AAC5D,oBAAkB,SAAS,eAAe,kBAAkB;AAG5D,QAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,YAAU,KAAK;AACf,WAAS,KAAK,YAAY,SAAS;AAGnC,aAAW,MAAM,WAAW,GAAG,CAAC;AAClC;AAEA,SAAS,aAAa;AAEpB,EAAAA,OAAM,iBAAiB,SAAS,EAAE,QAAQ,CAAC,QAAa;AACtD,QAAI,iBAAiB,SAAS,MAAM,UAAU,IAAI,QAAQ,GAAG,CAAC;AAAA,EAChE,CAAC;AAGD,WAAS,eAAe,cAAc,EAAG,iBAAiB,SAAS,MAAM;AACvE,gBAAY,YAAY,KAAK,IAAI,GAAG,YAAY,YAAY,CAAC;AAC7D,gBAAY,aAAa;AACzB,gBAAY,mBAAmB;AAC/B,mBAAe;AAAG,cAAU;AAAA,EAC9B,CAAC;AACD,WAAS,eAAe,cAAc,EAAG,iBAAiB,SAAS,MAAM;AACvE,gBAAY,YAAY,KAAK,IAAI,MAAM,SAAS,GAAG,YAAY,YAAY,CAAC;AAC5E,gBAAY,aAAa;AACzB,gBAAY,mBAAmB;AAC/B,mBAAe;AAAG,cAAU;AAAA,EAC9B,CAAC;AACD,WAAS,eAAe,aAAa,EAAG,iBAAiB,SAAS,MAAM;AACtE,UAAM,UAAU;AAAA,MACd,MAAM,MAAM,SAAS;AAAA,MACrB,SAAS,QAAQ,MAAM,SAAS,CAAC;AAAA,MACjC,QAAQ,CAAC;AAAA,QACP,IAAI,IAAI,MAAM,SAAS,CAAC;AAAA,QACxB,cAAc;AAAA,QACd,mBAAmB;AAAA,QACnB,SAAS;AAAA,QACT,QAAQ,CAAC;AAAA,MACX,CAAC;AAAA,IACH;AACA,UAAM,KAAK,OAAO;AAClB,gBAAY,YAAY,MAAM,SAAS;AACvC,gBAAY,aAAa;AACzB,gBAAY,mBAAmB;AAC/B,mBAAe;AAAG,cAAU;AAAA,EAC9B,CAAC;AAGD,QAAM,eAAe,SAAS,eAAe,aAAa;AAC1D,eAAa,iBAAiB,SAAS,MAAM;AAC3C,UAAM,OAAO,MAAM,YAAY,SAAS;AACxC,QAAI,KAAM,MAAK,UAAU,aAAa;AAAA,EACxC,CAAC;AACD,eAAa,iBAAiB,WAAW,CAAC,MAAW;AACnD,MAAE,gBAAgB;AAClB,QAAI,EAAE,QAAQ,QAAS,cAAa,KAAK;AAAA,EAC3C,CAAC;AACD,eAAa,iBAAiB,SAAS,MAAM,aAAa,OAAO,CAAC;AAGlE,WAAS,eAAe,eAAe,EAAG,iBAAiB,SAAS,MAAM;AACxE,gBAAY,aAAa,KAAK,IAAI,GAAG,YAAY,aAAa,CAAC;AAC/D,gBAAY,mBAAmB;AAC/B,mBAAe;AAAG,cAAU;AAAA,EAC9B,CAAC;AACD,WAAS,eAAe,eAAe,EAAG,iBAAiB,SAAS,MAAM;AACxE,UAAM,OAAO,MAAM,YAAY,SAAS;AACxC,QAAI,MAAM;AACR,kBAAY,aAAa,KAAK,IAAI,KAAK,OAAO,SAAS,GAAG,YAAY,aAAa,CAAC;AACpF,kBAAY,mBAAmB;AAC/B,qBAAe;AAAG,gBAAU;AAAA,IAC9B;AAAA,EACF,CAAC;AACD,WAAS,eAAe,cAAc,EAAG,iBAAiB,SAAS,MAAM;AACvE,UAAM,OAAO,MAAM,YAAY,SAAS;AACxC,QAAI,CAAC,KAAM;AACX,UAAM,WAAW;AAAA,MACf,IAAI,IAAI,YAAY,YAAY,CAAC,IAAI,KAAK,OAAO,SAAS,CAAC;AAAA,MAC3D,cAAc;AAAA,MACd,mBAAmB;AAAA,MACnB,SAAS;AAAA,MACT,QAAQ,CAAC;AAAA,IACX;AACA,SAAK,OAAO,KAAK,QAAQ;AACzB,gBAAY,aAAa,KAAK,OAAO,SAAS;AAC9C,mBAAe;AAAG,cAAU;AAAA,EAC9B,CAAC;AACD,WAAS,eAAe,cAAc,EAAG,iBAAiB,SAAS,MAAM;AACvE,UAAM,OAAO,MAAM,YAAY,SAAS;AACxC,QAAI,CAAC,QAAQ,KAAK,OAAO,UAAU,EAAG;AACtC,SAAK,OAAO,OAAO,YAAY,YAAY,CAAC;AAC5C,gBAAY,aAAa,KAAK,IAAI,YAAY,YAAY,KAAK,OAAO,SAAS,CAAC;AAChF,mBAAe;AAAG,cAAU;AAAA,EAC9B,CAAC;AAGD,QAAM,gBAAgB,SAAS,eAAe,YAAY;AAC1D,QAAM,kBAAkB,SAAS,eAAe,cAAc;AAC9D,QAAM,gBAAgB,SAAS,eAAe,YAAY;AAG1D,QAAM,iBAAiB,CAAC,WAAgB;AACtC,QAAI,SAAS;AACb,WAAO,iBAAiB,aAAa,MAAM;AAAE,eAAS;AAAG,eAAS;AAAA,IAAM,CAAC;AACzE,WAAO,iBAAiB,cAAc,MAAM;AAAE,UAAI,CAAC,OAAQ,UAAS;AAAG,eAAS;AAAA,IAAM,CAAC;AACvF,WAAO,iBAAiB,WAAW,MAAM;AAAE,eAAS;AAAA,IAAO,CAAC;AAC5D,WAAO,iBAAiB,YAAY,MAAM;AAAE,eAAS;AAAA,IAAO,CAAC;AAAA,EAC/D;AACA,iBAAe,aAAa;AAC5B,iBAAe,eAAe;AAC9B,iBAAe,aAAa;AAE5B,gBAAc,iBAAiB,SAAS,MAAM;AAC5C,UAAM,QAAQ,gBAAgB;AAC9B,QAAI,MAAO,OAAM,eAAe,SAAS,cAAc,KAAK;AAC5D,IAAC,SAAS,eAAe,gBAAgB,EAAU,QAAQ,cAAc,QAAQ;AAAA,EACnF,CAAC;AACD,kBAAgB,iBAAiB,SAAS,MAAM;AAC9C,UAAM,QAAQ,gBAAgB;AAC9B,QAAI,MAAO,OAAM,oBAAoB,SAAS,gBAAgB,KAAK;AACnE,IAAC,SAAS,eAAe,kBAAkB,EAAU,QAAQ,gBAAgB,QAAQ;AAAA,EACvF,CAAC;AACD,gBAAc,iBAAiB,SAAS,MAAM;AAC5C,UAAM,QAAQ,gBAAgB;AAC9B,QAAI,MAAO,OAAM,UAAU,SAAS,cAAc,KAAK;AACvD,IAAC,SAAS,eAAe,gBAAgB,EAAU,QAAQ,cAAc,QAAQ;AAAA,EACnF,CAAC;AAGD,QAAM,eAAe;AAAA,IACnB,EAAE,SAAS,kBAAkB,UAAU,cAAc,MAAM,gBAAgB,KAAK,GAAG,KAAK,IAAM;AAAA,IAC9F,EAAE,SAAS,oBAAoB,UAAU,gBAAgB,MAAM,qBAAqB,KAAK,KAAK,KAAK,IAAK;AAAA,IACxG,EAAE,SAAS,kBAAkB,UAAU,cAAc,MAAM,WAAW,KAAK,GAAG,KAAK,IAAK;AAAA,EAC1F;AACA,aAAW,KAAK,cAAc;AAC5B,UAAM,MAAM,SAAS,eAAe,EAAE,OAAO;AAC7C,UAAM,SAAS,SAAS,eAAe,EAAE,QAAQ;AACjD,UAAM,oBAAoB,MAAM;AAC9B,YAAM,SAAS,SAAS,IAAI,KAAK;AACjC,UAAI,MAAM,MAAM,GAAG;AACjB,cAAMM,SAAQ,gBAAgB;AAC9B,YAAI,SAASA,SAASA,OAAc,EAAE,IAAI,IAAI,OAAO,SAAS;AAC9D;AAAA,MACF;AACA,YAAM,UAAU,KAAK,IAAI,EAAE,KAAK,KAAK,IAAI,EAAE,KAAK,MAAM,CAAC;AACvD,YAAM,QAAQ,gBAAgB;AAC9B,UAAI,MAAO,CAAC,MAAc,EAAE,IAAI,IAAI;AACpC,aAAO,QAAQ;AACf,UAAI,QAAQ,UAAU;AAAA,IACxB;AACA,QAAI,iBAAiB,UAAU,iBAAiB;AAChD,QAAI,iBAAiB,QAAQ,iBAAiB;AAC9C,QAAI,iBAAiB,WAAW,CAAC,MAAW;AAC1C,QAAE,gBAAgB;AAClB,UAAI,EAAE,QAAQ,QAAS,KAAI,KAAK;AAAA,IAClC,CAAC;AACD,QAAI,iBAAiB,SAAS,MAAM,IAAI,OAAO,CAAC;AAAA,EAClD;AAGA,WAAS,eAAe,gBAAgB,EAAG,iBAAiB,SAAS,CAAC,MAAW;AAC/E,UAAM,MAAM,EAAE,OAAO,QAAQ,cAAc;AAC3C,QAAI,KAAK;AACP,kBAAY,YAAY,IAAI,QAAQ;AACpC,gBAAU;AAAA,IACZ;AAAA,EACF,CAAC;AAGD,WAAS,eAAe,UAAU,EAAG,iBAAiB,SAAS,MAAM;AACnE,UAAM,QAAQ,gBAAgB;AAC9B,QAAI,OAAO;AACT,eAAS;AACT,YAAM,SAAS,CAAC;AAChB,qBAAe;AAAG,gBAAU;AAAA,IAC9B;AAAA,EACF,CAAC;AAGD,WAAS,eAAe,SAAS,EAAG,iBAAiB,SAAS,eAAe;AAG7E,WAAS,eAAe,cAAc,EAAG,iBAAiB,SAAS,MAAM;AACvE,UAAM,OAAO,cAAc,YAAY,SAAS;AAChD,oBAAgB,MAAM,SAAS,eAAe,cAAc,CAAE;AAAA,EAChE,CAAC;AAGD,WAAS,eAAe,aAAa,EAAG,iBAAiB,SAAS,MAAM;AACtE,UAAM,OAAO,kBAAkB;AAC/B,oBAAgB,MAAM,SAAS,eAAe,aAAa,CAAE;AAAA,EAC/D,CAAC;AAGD,WAAS,eAAe,iBAAiB,EAAG,iBAAiB,SAAS,MAAM;AAC1E,UAAM,OAAO,qBAAqB;AAClC,oBAAgB,MAAM,SAAS,eAAe,iBAAiB,CAAE;AAAA,EACnE,CAAC;AAGD,WAAS,eAAe,kBAAkB,EAAG,iBAAiB,SAAS,MAAM;AAC3E,UAAMH,QAAO,SAAS,eAAe,gBAAgB;AACrD,IAAAA,MAAK,UAAU,OAAO,WAAW;AACjC,UAAM,SAAS,SAAS,eAAe,kBAAkB;AACzD,WAAO,YAAYA,MAAK,UAAU,SAAS,WAAW,IAClD,8BACA;AAAA,EACN,CAAC;AAGD,WAAS,eAAe,gBAAgB,EAAG,iBAAiB,SAAS,MAAM;AACzE,UAAM,SAAS,SAAS,eAAe,kBAAkB;AACzD,QAAI,OAAO,MAAO,YAAW,OAAO,KAAK;AAAA,EAC3C,CAAC;AAED,WAAS,eAAe,gBAAgB,EAAG,iBAAiB,SAAS,YAAY;AAC/E,QAAI,OAAO;AACX,QAAI,CAAC,MAAM;AACT,aAAO,OAAO,cAAc;AAC5B,UAAI,CAAC,KAAM;AAAA,IACb;AACA,UAAM,MAAM,SAAS,eAAe,gBAAgB;AACpD,UAAM,WAAW,IAAI;AACrB,UAAM,OAAO,IAAI;AACjB,QAAI,cAAc;AAClB,QAAI,UAAU,IAAI,QAAQ;AAC1B,eAAW,MAAM;AAAE,UAAI,cAAc;AAAM,UAAI,UAAU,OAAO,QAAQ;AAAA,IAAG,GAAG,IAAI;AAAA,EACpF,CAAC;AAED,WAAS,eAAe,kBAAkB,EAAG,iBAAiB,SAAS,YAAY;AACjF,UAAM,SAAS,SAAS,eAAe,kBAAkB;AACzD,UAAM,OAAO,OAAO;AACpB,QAAI,CAAC,KAAM;AACX,QAAI,CAAC,QAAQ,kBAAkB,IAAI,IAAI,EAAG;AAC1C,UAAM,aAAa,IAAI;AAAA,EACzB,CAAC;AAGD,wBAAsB;AAGtB,WAAS,eAAe,iBAAiB,EAAG,iBAAiB,SAAS,MAAM;AAC1E,aAAS;AACT,cAAU,KAAK,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,KAAK,GAAG,EAAE,CAAC;AACjD,eAAW,eAAe;AAC1B,eAAW,cAAc,UAAU,SAAS;AAC5C,mBAAe;AACf,wBAAoB;AACpB,cAAU;AAAA,EACZ,CAAC;AAED,WAAS,eAAe,YAAY,EAAG,iBAAiB,SAAS,MAAM;AACrE,aAAS;AACT,SAAK,KAAK,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE,CAAC;AACpC,eAAW,eAAe;AAC1B,eAAW,cAAc,KAAK,SAAS;AACvC,mBAAe;AACf,wBAAoB;AACpB,cAAU;AAAA,EACZ,CAAC;AAED,WAAS,eAAe,eAAe,EAAG,iBAAiB,SAAS,MAAM;AACxE,UAAM,OAAO,qBAAqB;AAClC,oBAAgB,MAAM,SAAS,eAAe,eAAe,CAAE;AAAA,EACjE,CAAC;AAGD,WAAS,eAAe,gBAAgB,EAAG,iBAAiB,SAAS,YAAY;AAC/E,UAAM,MAAM,SAAS,eAAe,gBAAgB;AACpD,UAAM,YAAY,kBAAkB;AACpC,UAAM,cAAc,qBAAqB;AACzC,UAAM,WAAW,mBAAmB,WAAW,GAAG;AAElD,UAAM,WAAW,qBAAqB,aAAa,GAAG;AAAA,EACxD,CAAC;AAED,WAAS,eAAe,eAAe,EAAG,iBAAiB,SAAS,MAAM;AACxE,UAAM,OAAO,qBAAqB;AAClC,eAAW,mBAAmB,MAAM,SAAS,eAAe,eAAe,CAAE;AAAA,EAC/E,CAAC;AAGD,SAAO,iBAAiB,eAAe,CAAC,MAAW;AACjD,QAAI,OAAQ,GAAE,eAAe;AAAA,EAC/B,CAAC;AAGD,QAAM,YAAY,SAAS,eAAe,YAAY;AACtD,MAAI,gBAAqB;AAEzB,EAAAH,OAAM,iBAAiB,aAAa,CAAC,MAAW;AAC9C,UAAM,KAAK,EAAE,OAAO,QAAQ,cAAc;AAC1C,QAAI,MAAM,GAAG,aAAa,UAAU,GAAG;AACrC,sBAAgB;AAChB,gBAAU,cAAc,GAAG,aAAa,UAAU;AAClD,gBAAU,UAAU,IAAI,SAAS;AACjC,sBAAgB,EAAE;AAAA,IACpB;AAAA,EACF,CAAC;AAED,EAAAA,OAAM,iBAAiB,YAAY,CAAC,MAAW;AAC7C,UAAM,KAAK,EAAE,OAAO,QAAQ,cAAc;AAC1C,QAAI,OAAO,eAAe;AACxB,sBAAgB;AAChB,gBAAU,UAAU,OAAO,SAAS;AAAA,IACtC;AAAA,EACF,CAAC;AAED,WAAS,gBAAgB,UAAe;AACtC,UAAM,OAAO,SAAS,sBAAsB;AAC5C,UAAM,UAAU,UAAU,sBAAsB;AAEhD,QAAI,OAAO,KAAK,QAAQ;AACxB,QAAI,MAAM,KAAK,MAAM,KAAK,SAAS,IAAI,QAAQ,SAAS;AAExD,QAAI,OAAO,MAAM,OAAO,YAAY;AAClC,aAAO,KAAK;AACZ,YAAM,KAAK,SAAS;AAAA,IACtB;AAEA,UAAM,KAAK,IAAI,GAAG,KAAK,IAAI,OAAO,cAAc,QAAQ,SAAS,GAAG,GAAG,CAAC;AACxE,cAAU,MAAM,OAAO,OAAO;AAC9B,cAAU,MAAM,MAAM,MAAM;AAAA,EAC9B;AAGA,cAAY,SAAS,eAAe,eAAe;AACnD,eAAa,SAAS,eAAe,gBAAgB;AACrD,oBAAkB,SAAS,eAAe,gBAAgB;AAC5D;AAEA,SAAS,kBAAkB;AACzB,QAAM,OAAO,MAAM,YAAY,SAAS;AACxC,MAAI,CAAC,KAAM,QAAO;AAClB,SAAO,KAAK,OAAO,YAAY,UAAU,KAAK;AAChD;AAEA,SAAS,YAAY;AACnB,MAAI,eAAe,SAAS;AAC1B,mBAAe;AAAA,EACjB,OAAO;AACL,mBAAe;AAAA,EACjB;AACF;AAEA,SAAS,iBAAiB;AACxB,QAAM,OAAO,MAAM,YAAY,SAAS;AAGxC,MAAI,UAAW,WAAU,cAAc,OAAO,KAAK,OAAO;AAG1D,QAAM,eAAe,SAAS,eAAe,aAAa;AAC1D,MAAI,aAAc,cAAa,QAAQ,OAAQ,KAAK,WAAW,KAAM;AAGrE,QAAM,QAAQ,gBAAgB;AAC9B,MAAI,WAAY,YAAW,cAAc,QAAQ,MAAM,KAAK;AAG5D,MAAI,gBAAiB,iBAAgB,cAAc,QAAQ,MAAM,OAAO,SAAS;AAGjF,QAAM,gBAAgB,SAAS,eAAe,YAAY;AAC1D,QAAM,kBAAkB,SAAS,eAAe,cAAc;AAC9D,QAAM,gBAAgB,SAAS,eAAe,YAAY;AAC1D,MAAI,SAAS,eAAe;AAC1B,kBAAc,QAAQ,MAAM;AAC5B,IAAC,SAAS,eAAe,gBAAgB,EAAU,QAAQ,MAAM,eAAe;AAChF,oBAAgB,QAAQ,MAAM;AAC9B,IAAC,SAAS,eAAe,kBAAkB,EAAU,QAAQ,MAAM,oBAAoB;AACvF,kBAAc,QAAQ,MAAM;AAC5B,IAAC,SAAS,eAAe,gBAAgB,EAAU,QAAQ,MAAM,UAAU;AAAA,EAC7E;AAGA,QAAM,OAAO,SAAS,iBAAiB,cAAc;AACrD,OAAK,QAAQ,CAAC,QAAa;AACzB,QAAI,UAAU,OAAO,YAAY,IAAI,QAAQ,SAAS,YAAY,SAAS;AAAA,EAC7E,CAAC;AAGD,QAAM,SAAS,SAAS,eAAe,kBAAkB;AACzD,MAAI,QAAQ;AACV,QAAI,YAAY,oBAAoB,KAAK,SAAS,MAAM,OAAO,YAAY,gBAAgB,GAAG;AAC5F,YAAM,IAAI,MAAM,OAAO,YAAY,gBAAgB;AACnD,YAAM,WAAY,YAAoB,EAAE,IAAI,IAAK,YAAoB,EAAE,IAAI,EAAE,OAAO,EAAE;AACtF,aAAO,cAAc,aAAa,QAAQ,KAAK,EAAE,CAAC,KAAK,EAAE,CAAC;AAC1D,aAAO,MAAM,UAAU;AAAA,IACzB,OAAO;AACL,aAAO,MAAM,UAAU;AAAA,IACzB;AAAA,EACF;AAGA,4BAA0B;AAC5B;AAEA,SAAS,iBAAiB;AAExB,QAAM,UAAU,SAAS,eAAe,kBAAkB;AAC1D,MAAI,SAAS;AACX,QAAI,OAAO;AACX,aAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACzC,YAAM,IAAI,UAAU,CAAC;AACrB,YAAM,MAAM,WAAW,iBAAiB,cAAc,WAAW,gBAAgB;AACjF,cAAQ,0BAA0B,MAAM,cAAc,EAAE,oCAAoC,CAAC;AAC7F,cAAQ,mCAAmC,IAAI,CAAC;AAChD,cAAQ,iCAAiC,EAAE,CAAC,KAAK,EAAE,CAAC;AACpD,cAAQ,8BAA8B,EAAE,CAAC,OAAS,EAAE,CAAC,OAAS,EAAE,CAAC;AACjE,cAAQ;AAAA,IACV;AACA,YAAQ,YAAY;AAGpB,YAAQ,iBAAiB,cAAc,EAAE,QAAQ,CAAC,QAAa;AAC7D,UAAI,iBAAiB,SAAS,MAAM;AAClC,mBAAW,eAAe,IAAI,QAAQ;AACtC,mBAAW,cAAc,SAAS,IAAI,QAAQ,GAAG;AACjD,4BAAoB;AACpB,uBAAe;AAAA,MACjB,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAGA,QAAM,UAAU,SAAS,eAAe,aAAa;AACrD,MAAI,SAAS;AACX,QAAI,OAAO;AACX,aAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACpC,YAAM,IAAI,KAAK,CAAC;AAChB,YAAM,MAAM,WAAW,iBAAiB,SAAS,WAAW,gBAAgB;AAC5E,cAAQ,0BAA0B,MAAM,cAAc,EAAE,+BAA+B,CAAC;AACxF,cAAQ,mCAAmC,IAAI,CAAC;AAChD,cAAQ,iCAAiC,EAAE,CAAC,KAAK,EAAE,CAAC;AACpD,cAAQ,8BAA8B,EAAE,CAAC,OAAS,EAAE,CAAC;AACrD,cAAQ;AAAA,IACV;AACA,YAAQ,YAAY;AAEpB,YAAQ,iBAAiB,cAAc,EAAE,QAAQ,CAAC,QAAa;AAC7D,UAAI,iBAAiB,SAAS,MAAM;AAClC,mBAAW,eAAe,IAAI,QAAQ;AACtC,mBAAW,cAAc,SAAS,IAAI,QAAQ,GAAG;AACjD,4BAAoB;AACpB,uBAAe;AAAA,MACjB,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAGA,QAAM,aAAa,SAAS,eAAe,gBAAgB;AAC3D,QAAM,aAAa,SAAS,eAAe,sBAAsB;AACjE,QAAM,YAAY,SAAS,eAAe,qBAAqB;AAE/D,MAAI,cAAc,WAAW,gBAAgB,WAAW,eAAe,GAAG;AACxE,UAAM,MAAM,WAAW,iBAAiB,aAAa,YAAY;AACjE,UAAM,MAAM,IAAI,WAAW,WAAW;AACtC,QAAI,CAAC,KAAK;AACR,iBAAW,MAAM,UAAU;AAC3B;AAAA,IACF;AAEA,eAAW,MAAM,UAAU;AAC3B,UAAM,QAAQ,WAAW,iBAAiB,aACtC,YAAY,WAAW,cAAc,CAAC,KACtC,OAAO,WAAW,cAAc,CAAC;AACrC,eAAW,cAAc;AAEzB,UAAM,UAAU,WAAW,iBAAiB,aACxC;AAAA,MACE,EAAE,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,IAAI,MAAM,KAAK,MAAM,GAAG;AAAA,MAC/D,EAAE,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,IAAI,MAAM,KAAK,MAAM,GAAG;AAAA,MAC/D,EAAE,OAAO,SAAS,KAAK,KAAK,KAAK,KAAK,KAAK,IAAI,MAAM,KAAK,MAAM,IAAI;AAAA,MACpE,EAAE,OAAO,SAAS,KAAK,KAAK,KAAK,KAAK,KAAK,IAAI,MAAM,KAAK,MAAM,IAAI;AAAA,MACpE,EAAE,OAAO,UAAU,KAAK,KAAK,KAAK,KAAK,KAAK,GAAG,MAAM,KAAK,MAAM,IAAI;AAAA,IACtE,IACA;AAAA,MACE,EAAE,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,IAAI,MAAM,KAAK,MAAM,GAAG;AAAA,MAC/D,EAAE,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,IAAI,MAAM,KAAK,MAAM,GAAG;AAAA,MAC/D,EAAE,OAAO,SAAS,KAAK,KAAK,KAAK,GAAG,KAAK,IAAI,MAAM,KAAK,MAAM,IAAI;AAAA,MAClE,EAAE,OAAO,SAAS,KAAK,KAAK,KAAK,GAAG,KAAK,IAAI,MAAM,KAAK,MAAM,IAAI;AAAA,IACpE;AAEJ,QAAI,OAAO;AACX,eAAW,KAAK,SAAS;AACvB,YAAM,MAAM,IAAI,EAAE,GAAG;AACrB,YAAM,UAAU,OAAO,UAAU,GAAG,IAAI,MAAM,WAAW,GAAG,EAAE,QAAQ,CAAC;AACvE,YAAM,cAAc,EAAE,OAAO,MAAM,EAAE,OAAO;AAC5C,cAAQ;AACR,cAAQ,SAAS,EAAE,KAAK;AACxB,cAAQ,yDAAyD,EAAE,GAAG,UAAU,EAAE,GAAG,UAAU,EAAE,GAAG,WAAW,EAAE,IAAI,YAAY,GAAG;AACpI,cAAQ,qDAAqD,EAAE,GAAG,YAAY,OAAO,GAAG,WAAW;AACnG,cAAQ;AAAA,IACV;AAGA,YAAQ,wEAAwE,WAAW,iBAAiB,aAAa,aAAa,KAAK;AAE3I,cAAU,YAAY;AAGtB,cAAU,iBAAiB,kBAAkB,EAAE,QAAQ,CAAC,OAAY;AAClE,YAAM,MAAM,GAAG,QAAQ;AACvB,YAAM,OAAO,QAAQ,KAAK,CAAC,MAAW,EAAE,QAAQ,GAAG;AACnD,SAAG,iBAAiB,SAAS,MAAM;AACjC,cAAM,SAAS,WAAW,GAAG,KAAK;AAClC,cAAM,SAAS,WAAW,iBAAiB,aAAa,YAAY;AACpE,cAAM,SAAS,OAAO,WAAW,WAAW;AAC5C,YAAI,CAAC,OAAQ;AACb,eAAO,GAAG,IAAI;AACd,cAAM,cAAc,KAAK,OAAO,MAAM,KAAK,OAAO;AAClD,cAAM,UAAU,OAAO,UAAU,MAAM,IAAI,SAAS,WAAW,MAAa,EAAE,QAAQ,CAAC;AACvF,kBAAU,cAAc,2BAA2B,GAAG,IAAI,EAAE,QAAQ,UAAU;AAC9E,uBAAe;AACf,4BAAoB;AAAA,MACtB,CAAC;AAGD,UAAI,SAAS;AACb,SAAG,iBAAiB,aAAa,MAAM;AAAE,iBAAS;AAAG,iBAAS;AAAA,MAAM,CAAC;AACrE,SAAG,iBAAiB,WAAW,MAAM;AAAE,iBAAS;AAAA,MAAO,CAAC;AAAA,IAC1D,CAAC;AAGD,cAAU,iBAAiB,eAAe,EAAE,QAAQ,CAAC,QAAa;AAChE,YAAM,MAAM,IAAI,QAAQ;AACxB,YAAM,OAAO,QAAQ,KAAK,CAAC,MAAW,EAAE,QAAQ,GAAG;AACnD,YAAM,cAAc,MAAM;AACxB,cAAM,SAAS,WAAW,IAAI,KAAK;AACnC,YAAI,MAAM,MAAM,GAAG;AACjB,gBAAMO,UAAS,WAAW,iBAAiB,aAAa,YAAY;AACpE,gBAAMC,UAASD,QAAO,WAAW,WAAW;AAC5C,cAAIC,SAAQ;AACV,kBAAM,MAAMA,QAAO,GAAG;AACtB,kBAAMC,eAAc,KAAK,OAAO,MAAM,KAAK,OAAO;AAClD,gBAAI,SAAS,OAAO,UAAU,GAAG,IAAI,MAAM,WAAW,GAAG,EAAE,QAAQ,CAAC,KAAKA;AAAA,UAC3E;AACA;AAAA,QACF;AACA,cAAM,UAAU,KAAK,IAAI,KAAK,KAAK,KAAK,IAAI,KAAK,KAAK,MAAM,CAAC;AAC7D,cAAM,SAAS,WAAW,iBAAiB,aAAa,YAAY;AACpE,cAAM,SAAS,OAAO,WAAW,WAAW;AAC5C,YAAI,CAAC,OAAQ;AACb,iBAAS;AACT,eAAO,GAAG,IAAI;AACd,cAAM,UAAU,UAAU,cAAc,8BAA8B,GAAG,IAAI;AAC7E,YAAI,QAAS,SAAQ,QAAQ;AAC7B,cAAM,cAAc,KAAK,OAAO,MAAM,KAAK,OAAO;AAClD,YAAI,SAAS,OAAO,UAAU,OAAO,IAAI,UAAU,WAAW,OAAc,EAAE,QAAQ,CAAC,KAAK;AAC5F,uBAAe;AACf,4BAAoB;AAAA,MACtB;AACA,UAAI,iBAAiB,UAAU,WAAW;AAC1C,UAAI,iBAAiB,QAAQ,WAAW;AACxC,UAAI,iBAAiB,WAAW,CAAC,MAAW;AAC1C,UAAE,gBAAgB;AAClB,YAAI,EAAE,QAAQ,QAAS,KAAI,KAAK;AAAA,MAClC,CAAC;AACD,UAAI,iBAAiB,SAAS,MAAM,IAAI,OAAO,CAAC;AAAA,IAClD,CAAC;AAGD,UAAM,YAAY,SAAS,eAAe,qBAAqB;AAC/D,QAAI,WAAW;AACb,gBAAU,iBAAiB,SAAS,MAAM;AACxC,iBAAS;AACT,YAAI,WAAW,iBAAiB,YAAY;AAC1C,oBAAU,OAAO,WAAW,aAAa,CAAC;AAAA,QAC5C,OAAO;AACL,eAAK,OAAO,WAAW,aAAa,CAAC;AAAA,QACvC;AACA,mBAAW,eAAe;AAC1B,mBAAW,cAAc;AACzB,uBAAe;AACf,4BAAoB;AACpB,uBAAe;AAAA,MACjB,CAAC;AAAA,IACH;AAAA,EACF,WAAW,YAAY;AACrB,eAAW,MAAM,UAAU;AAAA,EAC7B;AACF;AAIA,SAAS,4BAA4B;AACnC,QAAM,YAAY,SAAS,eAAe,gBAAgB;AAC1D,MAAI,CAAC,UAAW;AAGhB,MAAI,wBAAwB,YAAY,WAAW;AAEjD,6BAAyB;AACzB;AAAA,EACF;AACA,wBAAsB,YAAY;AAElC,QAAM,UAAU,qBAAqB,YAAY,SAAS;AAC1D,MAAI,CAAC,SAAS;AACZ,cAAU,YAAY;AACtB;AAAA,EACF;AAEA,QAAM,MAAO,YAAoB,YAAY,SAAS;AACtD,MAAI,OAAO;AACX,WAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACvC,UAAM,IAAI,QAAQ,CAAC;AACnB,UAAM,MAAMC,gBAAe,KAAK,EAAE,GAAG;AACrC,UAAM,aAAc,OAAO,OAAS,OAAO,UAAU,EAAE,IAAI,IAAI,MAAM,WAAW,GAAG,EAAE,QAAQ,CAAC,IAAK;AACnG,UAAM,UAAU,EAAE,QAAQ,EAAE,UAAU;AACtC,UAAM,cAAc,UAAU,MAAM,UAAU;AAC9C,UAAM,UAAU,EAAE,MAAM,cAAc,EAAE,IAAI,QAAQ,MAAM,QAAQ,CAAC,MAAM;AACzE,UAAM,WAAW,EAAE,MAAM,iBAAiB;AAC1C,YAAQ;AACR,YAAQ,gBAAgB,QAAQ,IAAI,OAAO,IAAI,EAAE,KAAK;AACtD,YAAQ,0DAA0D,CAAC,UAAU,EAAE,GAAG,UAAU,EAAE,GAAG,WAAW,EAAE,IAAI,YAAY,OAAO,OAAO,MAAM,EAAE,GAAG;AACvJ,YAAQ,sDAAsD,CAAC,YAAY,UAAU,GAAG,WAAW;AACnG,YAAQ;AAAA,EACV;AACA,YAAU,YAAY;AAGtB,QAAM,YAAY,UAAU,iBAAiB,mBAAmB;AAChE,YAAU,QAAQ,CAAC,OAAY;AAC7B,UAAM,MAAM,SAAS,GAAG,QAAQ,GAAG;AACnC,UAAM,IAAI,QAAQ,GAAG;AAErB,OAAG,iBAAiB,SAAS,MAAM;AACjC,YAAM,SAAS,WAAW,GAAG,KAAK;AAClC,MAAAC,gBAAgB,YAAoB,YAAY,SAAS,GAAG,EAAE,KAAK,MAAM;AACzE,YAAM,UAAU,EAAE,QAAQ,EAAE,UAAU;AACtC,YAAM,cAAc,UAAU,MAAM,UAAU;AAC9C,YAAM,UAAU,OAAO,UAAU,EAAE,IAAI,IAAI,SAAS,WAAW,MAAa,EAAE,QAAQ,CAAC;AACvF,gBAAU,cAAc,4BAA4B,GAAG,IAAI,EAAG,aAAa,SAAS,UAAU,WAAW;AACzG,MAAC,UAAU,cAAc,4BAA4B,GAAG,IAAI,EAAU,QAAQ,UAAU;AAAA,IAC1F,CAAC;AAAA,EACH,CAAC;AAGD,QAAM,YAAY,UAAU,iBAAiB,gBAAgB;AAC7D,YAAU,QAAQ,CAAC,QAAa;AAC9B,UAAM,MAAM,SAAS,IAAI,QAAQ,GAAG;AACpC,UAAM,IAAI,QAAQ,GAAG;AAErB,UAAM,cAAc,MAAM;AACxB,YAAM,SAAS,WAAW,IAAI,KAAK;AACnC,UAAI,MAAM,MAAM,GAAG;AAEjB,cAAM,MAAMD,gBAAgB,YAAoB,YAAY,SAAS,GAAG,EAAE,GAAG;AAC7E,cAAME,WAAU,EAAE,QAAQ,EAAE,UAAU;AACtC,cAAMH,eAAcG,WAAU,MAAMA,WAAU;AAC9C,cAAMC,WAAW,OAAO,OAAS,OAAO,UAAU,EAAE,IAAI,IAAI,MAAM,WAAW,GAAG,EAAE,QAAQ,CAAC,IAAK,EAAE;AAClG,YAAI,QAAQA,WAAUJ;AACtB;AAAA,MACF;AACA,YAAM,UAAU,KAAK,IAAI,EAAE,KAAK,KAAK,IAAI,EAAE,KAAK,MAAM,CAAC;AACvD,MAAAE,gBAAgB,YAAoB,YAAY,SAAS,GAAG,EAAE,KAAK,OAAO;AAE1E,YAAM,UAAU,UAAU,cAAc,+BAA+B,GAAG,IAAI;AAC9E,UAAI,QAAS,SAAQ,QAAQ;AAE7B,YAAM,UAAU,EAAE,QAAQ,EAAE,UAAU;AACtC,YAAM,cAAc,UAAU,MAAM,UAAU;AAC9C,YAAM,UAAU,OAAO,UAAU,EAAE,IAAI,IAAI,UAAU,WAAW,OAAc,EAAE,QAAQ,CAAC;AACzF,UAAI,QAAQ,UAAU;AAAA,IACxB;AAEA,QAAI,iBAAiB,UAAU,WAAW;AAC1C,QAAI,iBAAiB,QAAQ,WAAW;AAGxC,QAAI,iBAAiB,WAAW,CAAC,MAAW;AAC1C,QAAE,gBAAgB;AAClB,UAAI,EAAE,QAAQ,QAAS,KAAI,KAAK;AAAA,IAClC,CAAC;AAGD,QAAI,iBAAiB,SAAS,MAAM,IAAI,OAAO,CAAC;AAAA,EAClD,CAAC;AACH;AAEA,SAAS,2BAA2B;AAClC,QAAM,YAAY,SAAS,eAAe,gBAAgB;AAC1D,MAAI,CAAC,UAAW;AAChB,QAAM,UAAU,qBAAqB,YAAY,SAAS;AAC1D,MAAI,CAAC,QAAS;AACd,QAAM,MAAO,YAAoB,YAAY,SAAS;AAEtD,QAAM,YAAY,UAAU,iBAAiB,mBAAmB;AAChE,YAAU,QAAQ,CAAC,OAAY;AAC7B,UAAM,MAAM,SAAS,GAAG,QAAQ,GAAG;AACnC,UAAM,IAAI,QAAQ,GAAG;AACrB,QAAI,CAAC,EAAG;AACR,UAAM,MAAMD,gBAAe,KAAK,EAAE,GAAG;AACrC,QAAI,OAAO,MAAM;AACf,SAAG,QAAQ;AACX,YAAM,UAAU,EAAE,QAAQ,EAAE,UAAU;AACtC,YAAM,cAAc,UAAU,MAAM,UAAU;AAC9C,YAAM,UAAU,OAAO,UAAU,EAAE,IAAI,IAAI,MAAM,WAAW,GAAG,EAAE,QAAQ,CAAC;AAC1E,MAAC,UAAU,cAAc,4BAA4B,GAAG,IAAI,EAAU,QAAQ,UAAU;AAAA,IAC1F;AAAA,EACF,CAAC;AACH;AAEA,SAAS,uBAAuB;AAC9B,MAAI,OAAO;AACX,aAAW,CAAC,MAAM,GAAG,KAAK,OAAO,QAAQ,WAAW,GAAG;AACrD,YAAQ,KAAK,IAAI,KAAK,KAAK,UAAU,KAAK,MAAM,CAAC,EAAE,MAAM,IAAI,EAAE,IAAI,CAAC,GAAW,MAAc,MAAM,IAAI,IAAI,OAAO,CAAC,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA,EACjI;AACA,UAAQ;AACR,SAAO;AACT;AAEA,SAAS,uBAAuB;AAC9B,MAAI,OAAO;AACX,UAAQ;AACR,UAAQ,6BAA6B,UAAU;AAAA;AAAA;AAC/C,UAAQ;AACR,UAAQ;AACR,aAAW,KAAK,WAAW;AACzB,YAAQ,UAAU,EAAE,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,CAAC;AAAA;AAAA,EACnE;AACA,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,UAAQ;AACR,aAAW,KAAK,MAAM;AACpB,YAAQ,UAAU,EAAE,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,CAAC;AAAA;AAAA,EACxD;AACA,UAAQ;AAER,UAAQ;AACR,SAAO;AACT;AAGA,IAAM,sBAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA4C5B,SAAS,kBAAkB;AACzB,aAAW;AAEX,eAAa,YAAY;AACzB,wBAAsB;AACtB,kBAAgB;AAChB,eAAa,QAAQ;AACrB,YAAU,YAAY,WAAW,YAAY;AAC/C;AAIA,eAAe,WAAW,UAAkB,SAAiB,OAAY;AACvE,QAAM,OAAO,MAAM;AACnB,QAAM,cAAc;AACpB,MAAI;AACF,UAAM,MAAM,MAAM,MAAM,SAAS;AAAA,MAC/B,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAC9C,MAAM,KAAK,UAAU,EAAE,MAAM,UAAU,QAAQ,CAAC;AAAA,IAClD,CAAC;AACD,QAAI,CAAC,IAAI,GAAI,OAAM,IAAI,MAAM,IAAI,UAAU;AAC3C,UAAM,cAAc;AACpB,UAAM,UAAU,IAAI,QAAQ;AAAA,EAC9B,SAAS,GAAG;AACV,UAAM,cAAc;AACpB,YAAQ,MAAM,8BAA8B,UAAU,CAAC;AAAA,EACzD;AACA,aAAW,MAAM;AAAE,UAAM,cAAc;AAAM,UAAM,UAAU,OAAO,QAAQ;AAAA,EAAG,GAAG,IAAI;AACxF;AAIA,SAAS,gBAAgB,MAAc,OAAY;AACjD,YAAU,UAAU,UAAU,IAAI,EAAE,KAAK,MAAM;AAC7C,UAAM,OAAO,MAAM;AACnB,UAAM,cAAc;AAEpB,UAAM,UAAU,IAAI,QAAQ;AAC5B,eAAW,MAAM;AACf,YAAM,cAAc;AACpB,YAAM,UAAU,OAAO,QAAQ;AAAA,IACjC,GAAG,IAAI;AAAA,EACT,CAAC;AACH;AAEA,SAAS,cAAc,SAAiB;AACtC,QAAM,OAAO,MAAM,OAAO;AAC1B,MAAI,CAAC,KAAM,QAAO;AAClB,SAAO,cAAc,IAAI;AAC3B;AAEA,SAAS,oBAAoB;AAC3B,QAAM,QAAQ;AAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACA,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACrC,UAAM,KAAK,OAAO,cAAc,MAAM,CAAC,CAAC,EAAE,MAAM,IAAI,EAAE,KAAK,MAAM,IAAI,GAAG;AAAA,EAC1E;AACA,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,EAAE;AACb,SAAO,MAAM,KAAK,IAAI;AACxB;AAEA,SAAS,cAAc,MAAW;AAChC,MAAI,IAAI;AACR,OAAK,WAAW,KAAK,IAAI;AAAA;AACzB,OAAK,eAAe,KAAK,OAAO;AAAA;AAChC,OAAK;AAAA;AACL,aAAW,KAAK,KAAK,QAAQ;AAC3B,SAAK;AAAA;AACL,SAAK,cAAc,EAAE,EAAE;AAAA;AACvB,SAAK,uBAAuB,EAAE,YAAY;AAAA;AAC1C,SAAK,4BAA4B,EAAE,iBAAiB;AAAA;AACpD,SAAK,kBAAkB,EAAE,OAAO;AAAA;AAChC,SAAK;AAAA;AACL,eAAW,MAAM,EAAE,QAAQ;AACzB,WAAK,oBAAoB,GAAG,IAAI,SAAS,GAAG,CAAC,QAAQ,GAAG,CAAC;AAAA;AAAA,IAC3D;AACA,SAAK;AAAA;AACL,SAAK;AAAA;AAAA,EACP;AACA,OAAK;AAAA;AACL,OAAK;AACL,SAAO;AACT;AAIA,SAASI,gBAAe;AACtB,QAAM,QAAQ,SAAS,cAAc,OAAO;AAC5C,QAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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",
  "names": ["playerPos", "scene", "pool", "active", "camera", "sceneRef", "scene", "gameState", "sceneRef", "scene", "gameState", "playerPos", "gameState", "sceneRef", "gameState", "sceneRef", "sceneRef", "scene", "scene", "inputState", "gameState", "fillGeo", "scene", "sceneRef", "ringGeo", "scene", "sceneRef", "ringGeo", "removeTelegraph", "sceneRef", "scene", "gameState", "removeTelegraph", "body", "head", "scene", "gameState", "playerPos", "INV_SQRT2", "ISO_RIGHT_X", "ISO_RIGHT_Z", "ISO_UP_X", "ISO_UP_Z", "isDragging", "gameState", "gameState", "groupLabel", "sceneRef", "panel", "getNestedValue", "setNestedValue", "scene", "gameState", "injectStyles", "panel", "hit", "sceneRef", "body", "ringGeo", "planeGeo", "group", "arrRef", "objRef", "unitDisplay", "getNestedValue", "setNestedValue", "unitStr", "display", "injectStyles", "scene"]
}
